{
  "source": "github",
  "repository": "bitcoin/bitcoin",
  "fetched_at": "2026-01-15T19:34:47.682263+00:00",
  "date": "2025-04-22",
  "pull_requests": [
    {
      "number": 32328,
      "title": ".",
      "body": "\r\n<!--\r\n*** Please remove the following help text before submitting: ***\r\n\r\nPull requests without a rationale and clear improvement may be closed\r\nimmediately.\r\n\r\nGUI-related pull requests should be opened against\r\nhttps://github.com/bitcoin-core/gui\r\nfirst. See CONTRIBUTING.md\r\n-->\r\n\r\n<!--\r\nPlease provide clear motivation for your patch and explain how it improves\r\nBitcoin Core user experience or Bitcoin Core developer experience\r\nsignificantly:\r\n\r\n* Any test improvements or new tests that improve coverage are always welcome.\r\n* All other changes should have accompanying unit tests (see `src/test/`) or\r\n  functional tests (see `test/`). Contributors should note which tests cover\r\n  modified code. If no tests exist for a region of modified code, new tests\r\n  should accompany the change.\r\n* Bug fixes are most welcome when they come with steps to reproduce or an\r\n  explanation of the potential issue as well as reasoning for the way the bug\r\n  was fixed.\r\n* Features are welcome, but might be rejected due to design or scope issues.\r\n  If a feature is based on a lot of dependencies, contributors should first\r\n  consider building the system outside of Bitcoin Core, if possible.\r\n* Refactoring changes are only accepted if they are required for a feature or\r\n  bug fix or otherwise improve developer experience significantly. For example,\r\n  most \"code style\" refactoring changes require a thorough explanation why they\r\n  are useful, what downsides they have and why they *significantly* improve\r\n  developer experience or avoid serious programming bugs. Note that code style\r\n  is often a subjective matter. Unless they are explicitly mentioned to be\r\n  preferred in the [developer notes](/doc/developer-notes.md), stylistic code\r\n  changes are usually rejected.\r\n-->\r\n\r\n<!--\r\nBitcoin Core has a thorough review process and even the most trivial change\r\nneeds to pass a lot of eyes and requires non-zero or even substantial time\r\neffort to review. There is a huge lack of active reviewers on the project, so\r\npatches often sit for a long time.\r\n-->\r\n",
      "state": "closed",
      "user": "Jokacar10",
      "created_at": "2025-04-22T16:07:47Z",
      "updated_at": "2025-04-30T02:00:58Z",
      "comments": 2,
      "url": "https://github.com/bitcoin/bitcoin/pull/32328",
      "labels": [],
      "comment_list": [
        {
          "user": "DrahtBot",
          "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/32328.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\nA summary of reviews will appear here.\n<!--5faf32d7da4f0f540f40219e4f7537a3-->",
          "created_at": "2025-04-22T16:07:51Z"
        },
        {
          "user": "DrahtBot",
          "body": "‚ôªÔ∏è Automatically closing for now based on heuristics. Please leave a comment, if this was erroneous. Generally, please focus on creating high-quality, original content that demonstrates a clear understanding of the project's requirements and goals.",
          "created_at": "2025-04-22T16:07:59Z"
        }
      ]
    },
    {
      "number": 32327,
      "title": "test: Add missing check for empty stderr in util tester",
      "body": "Now that wine support was removed from the CI in 25b56fd9b469f8e5d36f0132c3b79a5214e3372a, it can probably be removed from the util tester as well.\r\n\r\nIf someone really needs this, they can comment the new check out, or submit a patch to add an option/env var to silence the new check.",
      "state": "closed",
      "user": "maflcko",
      "created_at": "2025-04-22T16:00:27Z",
      "updated_at": "2025-04-29T05:47:50Z",
      "comments": 2,
      "url": "https://github.com/bitcoin/bitcoin/pull/32327",
      "labels": [
        "Tests"
      ],
      "comment_list": [
        {
          "user": "DrahtBot",
          "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/32327.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| ACK | [i-am-yuvi](https://github.com/bitcoin/bitcoin/pull/32327#pullrequestreview-2790454279), [BrandonOdiwuor](https://github.com/bitcoin/bitcoin/pull/32327#pullrequestreview-2792840128), [ismaelsadeeq](https://github.com/bitcoin/bitcoin/pull/32327#pullrequestreview-2794431069), [achow101](https://github.com/bitcoin/bitcoin/pull/32327#issuecomment-2836763846) |\n\nIf your review is incorrectly listed, please react with üëé to this comment and the bot will ignore it on the next update.\n<!--5faf32d7da4f0f540f40219e4f7537a3-->",
          "created_at": "2025-04-22T16:00:30Z"
        },
        {
          "user": "achow101",
          "body": "ACK fadf12a56c294696052c4cb6ee5284030ada7498",
          "created_at": "2025-04-28T21:30:30Z"
        }
      ]
    },
    {
      "number": 32326,
      "title": "net: improve the interface around FindNode() and avoid a recursive mutex lock",
      "body": "`CConnman::FindNode()` would lock `m_nodes_mutex`, find the node in `m_nodes`, release the mutex and return the node. The current code is safe but it is a dangerous interface where a caller may end up using the node returned from `FindNode()` without owning `m_nodes_mutex` and without having that node's reference count incremented.\r\n\r\nChange `FindNode()` to return a boolean since all but one of its callers used its return value to check whether a node exists and did not do anything else with the return value.\r\n\r\nRemove a recursive lock on `m_nodes_mutex`.\r\n\r\nRename `FindNode()` to better describe what it does.\r\n\r\n",
      "state": "closed",
      "user": "vasild",
      "created_at": "2025-04-22T14:36:28Z",
      "updated_at": "2025-10-02T06:07:27Z",
      "comments": 18,
      "url": "https://github.com/bitcoin/bitcoin/pull/32326",
      "labels": [
        "P2P"
      ],
      "comment_list": [
        {
          "user": "DrahtBot",
          "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/32326.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| ACK | [furszy](https://github.com/bitcoin/bitcoin/pull/32326#pullrequestreview-3289688389), [hodlinator](https://github.com/bitcoin/bitcoin/pull/32326#pullrequestreview-3290340107), [achow101](https://github.com/bitcoin/bitcoin/pull/32326#issuecomment-3358144836) |\n| Concept ACK | [shahsb](https://github.com/bitcoin/bitcoin/pull/32326#pullrequestreview-2790763507), [theuni](https://github.com/bitcoin/bitcoin/pull/32326#issuecomment-2831361039) |\n| Stale ACK | [jonatack](https://github.com/bitcoin/bitcoin/pull/32326#issuecomment-2822019017), [sipa](https://github.com/bitcoin/bitcoin/pull/32326#pullrequestreview-3289213901) |\n\nIf your review is incorrectly listed, please react with üëé to this comment and the bot will ignore it on the next update.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#32983](https://github.com/bitcoin/bitcoin/pull/32983) (rpc: refactor: use string_view in Arg/MaybeArg by stickies-v)\n* [#32394](https://github.com/bitcoin/bitcoin/pull/32394) (net: make m_nodes_mutex non-recursive by vasild)\n* [#29641](https://github.com/bitcoin/bitcoin/pull/29641) (scripted-diff: Use LogInfo over LogPrintf [WIP, NOMERGE, DRAFT] by maflcko)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n<!--5faf32d7da4f0f540f40219e4f7537a3-->",
          "created_at": "2025-04-22T14:36:32Z"
        },
        {
          "user": "DrahtBot",
          "body": "<!--85328a0da195eb286784d51f73fa0af9-->\nüöß At least one of the CI tasks failed.\n<sub>Debug: https://github.com/bitcoin/bitcoin/runs/40947126551</sub>\n\n<details><summary>Hints</summary>\n\nTry to run the tests locally, according to the documentation. However, a CI failure may still\nhappen due to a number of reasons, for example:\n\n* Possibly due to a silent merge conflict (the changes in this pull request being\nincompatible with the current code in the target branch). If so, make sure to rebase on the latest\ncommit of the target branch.\n\n* A sanitizer issue, which can only be found by compiling with the sanitizer and running the\n  affected test.\n\n* An intermittent issue.\n\nLeave a comment here, if you need help tracking down a confusing failure.\n\n</details>\n",
          "created_at": "2025-04-22T14:57:03Z"
        },
        {
          "user": "jonatack",
          "body": "Review ACK 1e415d2cb703fcd1b622e5343fa264425601c8d modulo CI fixup\r\n\r\nHappy to see these methods see an update.\r\n\r\nI tried adding `EXCLUSIVE_LOCKS_REQUIRED(!m_nodes_mutex)` to the declarations, but it looks like that lock is already held by some of their callers.",
          "created_at": "2025-04-22T15:11:36Z"
        },
        {
          "user": "vasild",
          "body": "`1e415d2cb7...cc8f239663`: fix CI tidy",
          "created_at": "2025-04-22T15:33:19Z"
        },
        {
          "user": "jonatack",
          "body": "ACK cc8f239663a0874c307efa30815b40d9ef40badb",
          "created_at": "2025-04-22T17:32:58Z"
        },
        {
          "user": "theuni",
          "body": "Is making `m_nodes_mutex` non-recursive a goal? That sounds nice to me and I'm not opposed, but I'd rather not make changes just to get halfway there.\r\n\r\nConcept ACK on turning the `FindNode`s into bools, though. That's a nice improvement.",
          "created_at": "2025-04-25T20:21:30Z"
        },
        {
          "user": "hebasto",
          "body": "> Is making `m_nodes_mutex` non-recursive a goal? That sounds nice to me and I'm not opposed, but I'd rather not make changes just to get halfway there.\r\n\r\nI'm curious how far we are from a non-recursive `m_nodes_mutex`?",
          "created_at": "2025-04-26T12:35:06Z"
        },
        {
          "user": "vasild",
          "body": "> Is making `m_nodes_mutex` non-recursive a goal?\r\n\r\nNo, I did not think about that before you mentioned it. The goal here is to make the interface around `FindNode()` safer and simpler (don't return a possibly dangling pointer and don't return a pointer at all since callers can do with a boolean).\r\n\r\nI did mention dropping the recursive lock because I think less recursive locking is good, even if the mutex remains recursive.\r\n\r\n> I'm curious how far we are from a non-recursive `m_nodes_mutex`?\r\n\r\nThis far away:\r\n\r\n<details>\r\n<summary>[patch] make m_nodes_mutex non-recursive</summary>\r\n\r\n```diff\r\n--- i/src/net_processing.cpp\r\n+++ w/src/net_processing.cpp\r\n@@ -1284,29 +1284,29 @@ void PeerManagerImpl::MaybeSetPeerAsAnnouncingHeaderAndIDs(NodeId nodeid)\r\n                 std::swap(lNodesAnnouncingHeaderAndIDs.front(), *std::next(lNodesAnnouncingHeaderAndIDs.begin()));\r\n             }\r\n         }\r\n     }\r\n     m_connman.ForNode(nodeid, [this](CNode* pfrom) EXCLUSIVE_LOCKS_REQUIRED(::cs_main) {\r\n         AssertLockHeld(::cs_main);\r\n-        if (lNodesAnnouncingHeaderAndIDs.size() >= 3) {\r\n-            // As per BIP152, we only get 3 of our peers to announce\r\n-            // blocks using compact encodings.\r\n-            m_connman.ForNode(lNodesAnnouncingHeaderAndIDs.front(), [this](CNode* pnodeStop){\r\n-                MakeAndPushMessage(*pnodeStop, NetMsgType::SENDCMPCT, /*high_bandwidth=*/false, /*version=*/CMPCTBLOCKS_VERSION);\r\n-                // save BIP152 bandwidth state: we select peer to be low-bandwidth\r\n-                pnodeStop->m_bip152_highbandwidth_to = false;\r\n-                return true;\r\n-            });\r\n-            lNodesAnnouncingHeaderAndIDs.pop_front();\r\n-        }\r\n         MakeAndPushMessage(*pfrom, NetMsgType::SENDCMPCT, /*high_bandwidth=*/true, /*version=*/CMPCTBLOCKS_VERSION);\r\n         // save BIP152 bandwidth state: we select peer to be high-bandwidth\r\n         pfrom->m_bip152_highbandwidth_to = true;\r\n         lNodesAnnouncingHeaderAndIDs.push_back(pfrom->GetId());\r\n         return true;\r\n     });\r\n+    if (lNodesAnnouncingHeaderAndIDs.size() > 3) {\r\n+        // As per BIP152, we only get 3 of our peers to announce\r\n+        // blocks using compact encodings.\r\n+        m_connman.ForNode(lNodesAnnouncingHeaderAndIDs.front(), [this](CNode* pnodeStop){\r\n+            MakeAndPushMessage(*pnodeStop, NetMsgType::SENDCMPCT, /*high_bandwidth=*/false, /*version=*/CMPCTBLOCKS_VERSION);\r\n+            // save BIP152 bandwidth state: we select peer to be low-bandwidth\r\n+            pnodeStop->m_bip152_highbandwidth_to = false;\r\n+            return true;\r\n+        });\r\n+        lNodesAnnouncingHeaderAndIDs.pop_front();\r\n+    }\r\n }\r\n \r\n bool PeerManagerImpl::TipMayBeStale()\r\n {\r\n     AssertLockHeld(cs_main);\r\n     const Consensus::Params& consensusParams = m_chainparams.GetConsensus();\r\n```\r\n</details>\r\n\r\nOn top of this PR, plus a pile of `EXCLUSIVE_LOCKS_REQUIRED(!m_nodes_mutex)` additions in `net.h`. Should I PR that (separately from the current PR)?",
          "created_at": "2025-04-28T12:14:58Z"
        },
        {
          "user": "hebasto",
          "body": "> On top of this PR, plus a pile of `EXCLUSIVE_LOCKS_REQUIRED(!m_nodes_mutex)` additions in `net.h`. Should I PR that (separately from the current PR)?\r\n\r\nI'd appreciate it. It would be good to cross `m_nodes_mutex` off the [list](https://github.com/bitcoin/bitcoin/issues/19303).",
          "created_at": "2025-04-28T13:04:43Z"
        },
        {
          "user": "theuni",
          "body": "> I'd appreciate it. It would be good to cross `m_nodes_mutex` off the [list](https://github.com/bitcoin/bitcoin/issues/19303).\r\n\r\nYeah, agreed. That's a good justification for the change to non-recursive here.\r\n\r\nLooking at that diff, it's not clear to me if it's safe to move that hunk out of `cs_main`, but we can review/test/argue about it in a new PR.",
          "created_at": "2025-04-28T15:21:27Z"
        },
        {
          "user": "vasild",
          "body": "Converted to draft, waiting for:\r\n\r\n* https://github.com/bitcoin/bitcoin/pull/32338 to make it\r\n* then change this PR to use naming as in https://github.com/bitcoin/bitcoin/pull/32326#discussion_r2063650801\r\n\r\nFurther improvements away from this PR:\r\n* make `m_nodes_mutex` non-recursive, https://github.com/bitcoin/bitcoin/pull/32326#issuecomment-2835048806\r\n* assess all the checks that compare just the address or address+port and remove redundant ones and make the calls consistent regardless of whether `pzsDest` is set or not, https://github.com/bitcoin/bitcoin/pull/32326#discussion_r2065614037",
          "created_at": "2025-04-29T06:52:58Z"
        },
        {
          "user": "vasild",
          "body": "`cc8f239663...8ef769cc2d`: rebase and use the naming:\r\n\r\n```cpp\r\nbool IsConnectedToAddrPort(const std::string& addr_port);\r\nbool IsConnectedToAddrPort(const CService& addr_port);\r\nbool IsConnectedToAddr(const CNetAddr& addr);\r\n```",
          "created_at": "2025-05-01T09:07:26Z"
        },
        {
          "user": "vasild",
          "body": "`8ef769cc2d...4f635d100d`: make the methods `const`",
          "created_at": "2025-05-01T09:13:54Z"
        },
        {
          "user": "vasild",
          "body": "Made `m_nodes_mutex` non-recursive in https://github.com/bitcoin/bitcoin/pull/32394 which is this PR + one more commit.",
          "created_at": "2025-05-01T12:13:11Z"
        },
        {
          "user": "vasild",
          "body": "`4f635d100d...8668b0c64d`: address https://github.com/bitcoin/bitcoin/pull/32326#discussion_r2072443916",
          "created_at": "2025-05-16T08:36:40Z"
        },
        {
          "user": "vasild",
          "body": "`8668b0c64d...c9ffb6d710`: rebase and https://github.com/bitcoin/bitcoin/pull/32326#discussion_r2372244246",
          "created_at": "2025-09-29T11:50:54Z"
        },
        {
          "user": "vasild",
          "body": "`c9ffb6d710...87e7f37918`: do https://github.com/bitcoin/bitcoin/pull/32326#discussion_r2394630697",
          "created_at": "2025-10-01T14:40:42Z"
        },
        {
          "user": "achow101",
          "body": "ACK 87e7f37918d42c28033e9f684db52f94eeed617b",
          "created_at": "2025-10-01T21:10:15Z"
        }
      ]
    },
    {
      "number": 32325,
      "title": "ci: Add missing -Wno-error=array-bounds to valgrind fuzz",
      "body": "Due to an upstream GCC issue, any debug/fuzz build which aborts on failed assumes will print a false positive array-bounds warning in `src/test/fuzz/txgraph.cpp`.\r\n\r\nThis also affects one CI task.\r\n\r\nFix the CI task by ignoring the error for now.\r\n\r\nFixes https://github.com/bitcoin/bitcoin/issues/32276",
      "state": "closed",
      "user": "maflcko",
      "created_at": "2025-04-22T14:25:44Z",
      "updated_at": "2025-04-22T16:02:59Z",
      "comments": 1,
      "url": "https://github.com/bitcoin/bitcoin/pull/32325",
      "labels": [
        "Tests"
      ],
      "comment_list": [
        {
          "user": "DrahtBot",
          "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/32325.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| ACK | [fanquake](https://github.com/bitcoin/bitcoin/pull/32325#pullrequestreview-2784608357) |\n\nIf your review is incorrectly listed, please react with üëé to this comment and the bot will ignore it on the next update.\n<!--5faf32d7da4f0f540f40219e4f7537a3-->",
          "created_at": "2025-04-22T14:25:48Z"
        }
      ]
    },
    {
      "number": 32324,
      "title": "test: Treat executable paths in tests consistently",
      "body": "When using multi-config CMake generators, executable paths include per-config subdirectories, which require special handling in tests. Using dedicated environment variables to specify executable paths works well in such scenarios. However, the `util_test_runner` test sets these variables for the `util/test_runner.py` script unconditionally, which diverges from the approach used when running `functional/test_runner.py`.\r\n\r\nThis change makes the usage of the aforementioned environment variables uniform.\r\n\r\nAlso see: https://github.com/bitcoin/bitcoin/pull/32183#discussion_r2022565111.",
      "state": "closed",
      "user": "hebasto",
      "created_at": "2025-04-22T10:49:33Z",
      "updated_at": "2025-06-18T15:43:05Z",
      "comments": 5,
      "url": "https://github.com/bitcoin/bitcoin/pull/32324",
      "labels": [
        "Build system",
        "Tests"
      ],
      "comment_list": [
        {
          "user": "DrahtBot",
          "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/32324.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| Concept ACK | [janb84](https://github.com/bitcoin/bitcoin/pull/32324#pullrequestreview-2939760281) |\n\nIf your review is incorrectly listed, please react with üëé to this comment and the bot will ignore it on the next update.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#32697](https://github.com/bitcoin/bitcoin/pull/32697) (test: Turn util/test_runner into functional test by maflcko)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n<!--5faf32d7da4f0f540f40219e4f7537a3-->",
          "created_at": "2025-04-22T10:49:37Z"
        },
        {
          "user": "maflcko",
          "body": "Seems fine. An alternative could be to remove `BUILDDIR` and replace it with `BINDIR`, now that all bins are in one dir? `BINDIR` could include the multi-config subdir path element, if it exists.",
          "created_at": "2025-04-22T14:17:03Z"
        },
        {
          "user": "hebasto",
          "body": "> Seems fine. An alternative could be to remove `BUILDDIR` and replace it with `BINDIR`, now that all bins are in one dir? `BINDIR` could include the multi-config subdir path element, if it exists.\r\n\r\nThe question is how to choose the configuration for testing when we built more than one config.\r\n\r\n`ctest` has the `-C` option for that.",
          "created_at": "2025-04-22T14:22:38Z"
        },
        {
          "user": "maflcko",
          "body": "> But isn't this PR superseded by PR #32697 which removes the test and therefor the need to make this adjustment ? (it's not merged yet but the PR links to this PR as a conflicting PR)\r\n\r\nCorrect, the other pr was created to fix all issues in one go, instead of having to go through them one-by-one.",
          "created_at": "2025-06-18T15:40:29Z"
        },
        {
          "user": "fanquake",
          "body": "Given #32697 already has a number of ACKs, I think we can just close this.",
          "created_at": "2025-06-18T15:43:04Z"
        }
      ]
    },
    {
      "number": 32321,
      "title": "Update multiprocess.md",
      "body": "Hi, \r\n\r\nTwo suggestions for this doc:\r\n\r\n1. \"the getBlockHash method of the generated Chain server subclass in bitcoin-wallet\" Correction: This should be \"in bitcoin-node\", not \"bitcoin-wallet\", since the server class resides in the node process.\r\n\r\n2. \"capnp files in src/ipc/capnp/ was mostly done\" Correction: \"were mostly done\" (subject-verb agreement: plural noun \"files\")\r\n\r\nThanks.",
      "state": "closed",
      "user": "leonarddt05",
      "created_at": "2025-04-22T03:04:33Z",
      "updated_at": "2025-04-22T05:47:27Z",
      "comments": 1,
      "url": "https://github.com/bitcoin/bitcoin/pull/32321",
      "labels": [],
      "comment_list": [
        {
          "user": "DrahtBot",
          "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/32321.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\nA summary of reviews will appear here.\n<!--5faf32d7da4f0f540f40219e4f7537a3-->\n### LLM Linter (‚ú® experimental)\n\nPossible typos and grammar issues:\n\nThe choice to maintain interface definitions and C++ type mappings as `.capnp` files in the [`src/ipc/capnp/`](../../src/ipc/capnp/) were mostly done for convenience ‚Ä¶  \n‚Üí replace ‚Äúwere‚Äù with ‚Äúwas‚Äù  \n\nNo other typos were found.\n\n",
          "created_at": "2025-04-22T03:04:35Z"
        }
      ]
    }
  ],
  "issues": [
    {
      "number": 32323,
      "title": "build: CMake caching failing PIE check",
      "body": "Similar to https://github.com/bitcoin/bitcoin/issues/31942#issuecomment-2703801270, CMake caches the check failure, which leaves the user in a broken state (unless they nuke the build dir):\n```bash\ncmake -B build -DAPPEND_CXXFLAGS=\"-ftrivial-auto-var-init\"\n-- The CXX compiler identification is GNU 14.2.0\n-- Detecting CXX compiler ABI info\n-- Detecting CXX compiler ABI info - done\n-- Check for working CXX compiler: /usr/bin/c++ - skipped\n-- Detecting CXX compile features\n-- Detecting CXX compile features - done\n-- Setting build type to \"RelWithDebInfo\" as none was specified\n-- Performing Test CXX_SUPPORTS__WERROR\n-- Performing Test CXX_SUPPORTS__WERROR - Success\n-- Performing Test CXX_SUPPORTS__G3\n-- Performing Test CXX_SUPPORTS__G3 - Success\n-- Performing Test LINKER_SUPPORTS__G3\n-- Performing Test LINKER_SUPPORTS__G3 - Success\n-- Performing Test CXX_SUPPORTS__FTRAPV\n-- Performing Test CXX_SUPPORTS__FTRAPV - Success\n-- Performing Test LINKER_SUPPORTS__FTRAPV\n-- Performing Test LINKER_SUPPORTS__FTRAPV - Success\n-- Found SQLite3: /usr/include (found suitable version \"3.45.1\", minimum required is \"3.7.17\") \nCMake Warning at cmake/module/CheckLinkerSupportsPIE.cmake:24 (message):\n  PIE is not supported at link time.  See the configure log for details.\nCall Stack (most recent call first):\n  CMakeLists.txt:203 (check_linker_supports_pie)\n\n\n-- Performing Test LINKER_SUPPORTS__WL___FATAL_WARNINGS\n-- Performing Test LINKER_SUPPORTS__WL___FATAL_WARNINGS - Failed\n-- Performing Test CMAKE_HAVE_LIBC_PTHREAD\n-- Performing Test CMAKE_HAVE_LIBC_PTHREAD - Failed\n-- Check if compiler accepts -pthread\n-- Check if compiler accepts -pthread - no\n-- Looking for pthread_create in pthreads\n-- Looking for pthread_create in pthreads - not found\n-- Looking for pthread_create in pthread\n-- Looking for pthread_create in pthread - not found\nCMake Error at /usr/share/cmake-3.28/Modules/FindPackageHandleStandardArgs.cmake:230 (message):\n  Could NOT find Threads (missing: Threads_FOUND)\nCall Stack (most recent call first):\n  /usr/share/cmake-3.28/Modules/FindPackageHandleStandardArgs.cmake:600 (_FPHSA_FAILURE_MESSAGE)\n  /usr/share/cmake-3.28/Modules/FindThreads.cmake:226 (FIND_PACKAGE_HANDLE_STANDARD_ARGS)\n  CMakeLists.txt:345 (find_package)\n\n\n-- Configuring incomplete, errors occurred!\n```\n\nFix the compiler flag (forgot the `=zero`), and reconfigure:\n```bash\n cmake -B build -DAPPEND_CXXFLAGS=\"-ftrivial-auto-var-init=zero\"\nCMake Warning at cmake/module/CheckLinkerSupportsPIE.cmake:24 (message):\n  PIE is not supported at link time.  See the configure log for details.\nCall Stack (most recent call first):\n  CMakeLists.txt:203 (check_linker_supports_pie)\n\n\nCMake Error at /usr/share/cmake-3.28/Modules/FindPackageHandleStandardArgs.cmake:230 (message):\n  Could NOT find Threads (missing: Threads_FOUND)\nCall Stack (most recent call first):\n  /usr/share/cmake-3.28/Modules/FindPackageHandleStandardArgs.cmake:600 (_FPHSA_FAILURE_MESSAGE)\n  /usr/share/cmake-3.28/Modules/FindThreads.cmake:226 (FIND_PACKAGE_HANDLE_STANDARD_ARGS)\n  CMakeLists.txt:345 (find_package)\n\n\n-- Configuring incomplete, errors occurred!\n```",
      "state": "open",
      "user": "fanquake",
      "created_at": "2025-04-22T10:43:34Z",
      "updated_at": "2025-04-28T16:37:30Z",
      "comments": 4,
      "url": "https://github.com/bitcoin/bitcoin/issues/32323",
      "labels": [
        "Build system"
      ],
      "comment_list": [
        {
          "user": "hebasto",
          "body": "Quoting from https://github.com/bitcoin/bitcoin/issues/31942#issuecomment-2801696317:\n\n> ... a recommended debugging step is to discard any cached results from an existing build directory...\n\nAnd in this particular case, I don't think that the CMake cache is worth reusing.",
          "created_at": "2025-04-26T20:18:19Z"
        },
        {
          "user": "fanquake",
          "body": "Not sure I understand your suggestion; are you saying we don't fix this? Are you saying we should add a recommendation to the build docs to always delete the build dir before running CMake? Something else? Note that this is a generic issue, and the PIE check is just the first check that fails in this way, if you remove the PIE check the threads check will fail the same.",
          "created_at": "2025-04-28T09:07:33Z"
        },
        {
          "user": "hebasto",
          "body": "> are you saying we don't fix this?\n\n~Correct.~ UPD.: https://github.com/bitcoin/bitcoin/issues/32323#issuecomment-2835842776\n\n> Are you saying we should add a recommendation to the build docs to always delete the build dir before running CMake? Something else?\n\nNot \"always\" ‚Äî only when configuration fails. Similar to https://github.com/bitcoin/bitcoin/issues/31942#issuecomment-2737914378.\n\n",
          "created_at": "2025-04-28T09:38:45Z"
        },
        {
          "user": "hebasto",
          "body": "After further consideration, I believe this issue exposes a bug that is fixed in https://github.com/bitcoin/bitcoin/pull/32367.",
          "created_at": "2025-04-28T16:37:04Z"
        }
      ]
    },
    {
      "number": 32322,
      "title": "ci: failure in  interface_usdt_coinselection.py",
      "body": "https://github.com/bitcoin/bitcoin/actions/runs/14579386142/job/40892496346#step:6:5102:\n```bash\n 122/318 - interface_usdt_coinselection.py failed, Duration: 16 s\n\nstdout:\n2025-04-21T19:37:36.056000Z TestFramework (INFO): PRNG seed is: 4088013170701346751\n2025-04-21T19:37:36.066000Z TestFramework (INFO): Initializing test directory /home/runner/work/_temp/ci/scratch/test_runner/test_runner_‚Çø_üèÉ_20250421_192058/interface_usdt_coinselection_192\n2025-04-21T19:37:38.378000Z TestFramework (INFO): hook into the coin_selection tracepoints\n2025-04-21T19:37:48.532000Z TestFramework (INFO): Prepare wallets\n2025-04-21T19:37:50.021000Z TestFramework (INFO): Sending a transaction should result in all tracepoints\n2025-04-21T19:37:50.114000Z TestFramework (INFO): Failing to fund results in 1 tracepoint\n2025-04-21T19:37:50.146000Z TestFramework (INFO): Explicitly enabling APS results in 2 tracepoints\n2025-04-21T19:37:50.238000Z TestFramework (INFO): Change position is -1 if no change is created with APS when APS was initially not used\n2025-04-21T19:37:50.523000Z TestFramework (INFO): Change position is -1 if no change is created normally and APS is not used\n2025-04-21T19:37:50.772000Z TestFramework (INFO): Stopping nodes\n2025-04-21T19:37:51.192000Z TestFramework (INFO): Cleaning up /home/runner/work/_temp/ci/scratch/test_runner/test_runner_‚Çø_üèÉ_20250421_192058/interface_usdt_coinselection_192 on exit\n2025-04-21T19:37:51.192000Z TestFramework (INFO): Tests successful\n\n\nstderr:\nIn file included from /virtual/main.c:1:\nIn file included from include/uapi/linux/ptrace.h:183:\nIn file included from arch/x86/include/asm/ptrace.h:175:\nIn file included from arch/x86/include/asm/paravirt_types.h:12:\nIn file included from arch/x86/include/asm/nospec-branch.h:15:\narch/x86/include/asm/current.h:47:10: warning: multiple identical address spaces specified for type [-Wduplicate-decl-specifier]\n   47 |                 return this_cpu_read_const(const_pcpu_hot.current_task);\n      |                        ^\narch/x86/include/asm/percpu.h:577:36: note: expanded from macro 'this_cpu_read_const'\n  577 | #define this_cpu_read_const(pcp)                        __raw_cpu_read_const(pcp)\n      |                                                         ^\narch/x86/include/asm/percpu.h:163:35: note: expanded from macro '__raw_cpu_read_const'\n  163 | #define __raw_cpu_read_const(pcp)       __raw_cpu_read(, , pcp)\n      |                                         ^\narch/x86/include/asm/percpu.h:155:30: note: expanded from macro '__raw_cpu_read'\n  155 |         *(qual __my_cpu_type(pcp) *)__my_cpu_ptr(&(pcp));               \\\n      |                                     ^\nnote: (skipping 1 expansions in backtrace; use -fmacro-backtrace-limit=0 to see all)\narch/x86/include/asm/percpu.h:94:40: note: expanded from macro '__my_cpu_type'\n   94 | #define __my_cpu_type(var)      typeof(var) __percpu_seg_override\n      |                                             ^\narch/x86/include/asm/percpu.h:45:32: note: expanded from macro '__percpu_seg_override'\n   45 | # define __percpu_seg_override  __seg_gs\n      |                                 ^\n<built-in>:358:33: note: expanded from macro '__seg_gs'\n  358 | #define __seg_gs __attribute__((address_space(256)))\n      |                                 ^\nIn file included from /virtual/main.c:1:\nIn file included from include/uapi/linux/ptrace.h:183:\nIn file included from arch/x86/include/asm/ptrace.h:175:\nIn file included from arch/x86/include/asm/paravirt_types.h:12:\nIn file included from arch/x86/include/asm/nospec-branch.h:15:\narch/x86/include/asm/current.h:47:10: warning: multiple identical address spaces specified for type [-Wduplicate-decl-specifier]\narch/x86/include/asm/percpu.h:577:36: note: expanded from macro 'this_cpu_read_const'\n  577 | #define this_cpu_read_const(pcp)                        __raw_cpu_read_const(pcp)\n      |                                                         ^\narch/x86/include/asm/percpu.h:163:35: note: expanded from macro '__raw_cpu_read_const'\n  163 | #define __raw_cpu_read_const(pcp)       __raw_cpu_read(, , pcp)\n      |                                         ^\narch/x86/include/asm/percpu.h:155:9: note: expanded from macro '__raw_cpu_read'\n  155 |         *(qual __my_cpu_type(pcp) *)__my_cpu_ptr(&(pcp));               \\\n      |                ^\narch/x86/include/asm/percpu.h:94:40: note: expanded from macro '__my_cpu_type'\n   94 | #define __my_cpu_type(var)      typeof(var) __percpu_seg_override\n      |                                             ^\narch/x86/include/asm/percpu.h:45:32: note: expanded from macro '__percpu_seg_override'\n   45 | # define __percpu_seg_override  __seg_gs\n      |                                 ^\n<built-in>:358:33: note: expanded from macro '__seg_gs'\n  358 | #define __seg_gs __attribute__((address_space(256)))\n      |                                 ^\n2 warnings generated.\n```",
      "state": "closed",
      "user": "fanquake",
      "created_at": "2025-04-22T08:55:32Z",
      "updated_at": "2025-04-24T10:03:09Z",
      "comments": 7,
      "url": "https://github.com/bitcoin/bitcoin/issues/32322",
      "labels": [
        "Upstream",
        "CI failed"
      ],
      "comment_list": [
        {
          "user": "fanquake",
          "body": "cc @0xB10C ",
          "created_at": "2025-04-22T08:55:46Z"
        },
        {
          "user": "maflcko",
          "body": "Probably an erroneous kernel that was pushed to GHA by microsoft?  ",
          "created_at": "2025-04-22T09:02:45Z"
        },
        {
          "user": "maflcko",
          "body": "Passing one: https://github.com/bitcoin/bitcoin/actions/runs/14580801695/job/40919798022#step:6:2537\n\n`System info: Linux 6.8.0-1021-azure`\n\nFailing one: https://github.com/bitcoin/bitcoin/actions/runs/14580801695/job/40896887951#step:6:2538\n\n`System info: Linux 6.11.0-1012-azure`\n\nref: https://github.com/actions/runner-images/pull/12065",
          "created_at": "2025-04-22T18:18:52Z"
        },
        {
          "user": "0xB10C",
          "body": "Seems like a one-off event for now and not much that can be done about it?",
          "created_at": "2025-04-23T10:08:08Z"
        },
        {
          "user": "hodlinator",
          "body": "Happened again here:\nhttps://github.com/hodlinator/bitcoin/actions/runs/14614533923/job/40999660639#step:6:5096",
          "created_at": "2025-04-23T12:06:30Z"
        },
        {
          "user": "maflcko",
          "body": "> Seems like a one-off event for now and not much that can be done about it?\n\nNo, this happens consistently with the new kernel.\n\nI suspect anyone can reproduce this with a new kernel locally as well.\n\nMy suggestion would be to fix this or work around it in some way temporarily, until the kernel takes the patch (one was submitted iirc).\n\nIf it isn't possible to fix or work around, the test should be disabled temporarily:\n\n```diff\n    ci: Temporarily disable failing bpf checks\n\ndiff --git a/.github/workflows/ci.yml b/.github/workflows/ci.yml\nindex 9d8fdb4a16..13f86dd191 100644\n--- a/.github/workflows/ci.yml\n+++ b/.github/workflows/ci.yml\n@@ -405,11 +405,6 @@ jobs:\n           key: ${{ github.job }}-ccache-${{ github.run_id }}\n           restore-keys: ${{ github.job }}-ccache-\n \n-      - name: Enable bpfcc script\n-        # In the image build step, no external environment variables are available,\n-        # so any settings will need to be written to the settings env file:\n-        run: sed -i \"s|\\${INSTALL_BCC_TRACING_TOOLS}|true|g\" ./ci/test/00_setup_env_native_asan.sh\n-\n       - name: CI script\n         run: ./ci/test_run_all.sh\n \n```\n\nOtherwise, pull requests will unrelatedly  and intermittently fail.",
          "created_at": "2025-04-23T12:28:17Z"
        },
        {
          "user": "maflcko",
          "body": "Done in [32335](https://github.com/bitcoin/bitcoin/pull/32335) to buy more time to test/fix/workaround this in the meantime. ",
          "created_at": "2025-04-24T07:59:56Z"
        }
      ]
    }
  ],
  "summary": {
    "pull_requests": 6,
    "issues": 2
  }
}