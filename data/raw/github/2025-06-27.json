{
  "source": "github",
  "repository": "bitcoin/bitcoin",
  "fetched_at": "2026-01-15T19:52:48.101176+00:00",
  "date": "2025-06-27",
  "pull_requests": [
    {
      "number": 32823,
      "title": "test: Fix wait_for_getheaders() call in test_outbound_eviction_blocks_relay_only()",
      "body": "This change avoids relying on `tip_header.hash`, which is `None` when the header is deserialized from hex during `CBlockHeader()` construction.\r\nInstead, `tip_header.rehash()` explicitly computes the hash, making the test behavior more robust.\r\n\r\nUsing the explicit `rehash()` avoids depending on `wait_for_getheaders()` falling back to any received message, thus making the test more deterministic.\r\n\r\nThis is a follow-up to #32742.\r\n\r\nAlso, as noted in a previous review [comment](https://github.com/bitcoin/bitcoin/pull/32742#pullrequestreview-2923802386), \"_the hash field is wrong either way, simply due to being the wrong type (it is an optional hex string), as opposed to an optional int_\".\r\n\r\n---\r\n\r\nThe first commit intention is to improve clarity around the tests purpose, helping reviewers follow what's being verified and why. What started as a small comment during review of #32742 led me reviewing and try to improve most relevant tests comments for consistency and correctness.",
      "state": "closed",
      "user": "pablomartin4btc",
      "created_at": "2025-06-27T17:24:27Z",
      "updated_at": "2025-07-03T11:16:58Z",
      "comments": 3,
      "url": "https://github.com/bitcoin/bitcoin/pull/32823",
      "labels": [
        "Tests"
      ],
      "comment_list": [
        {
          "user": "DrahtBot",
          "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/32823.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| ACK | [theStack](https://github.com/bitcoin/bitcoin/pull/32823#pullrequestreview-2972945567), [yuvicc](https://github.com/bitcoin/bitcoin/pull/32823#pullrequestreview-2973475932), [danielabrozzoni](https://github.com/bitcoin/bitcoin/pull/32823#pullrequestreview-2975234206), [achow101](https://github.com/bitcoin/bitcoin/pull/32823#issuecomment-3029236281) |\n\nIf your review is incorrectly listed, please react with ðŸ‘Ž to this comment and the bot will ignore it on the next update.\n<!--5faf32d7da4f0f540f40219e4f7537a3-->",
          "created_at": "2025-06-27T17:24:32Z"
        },
        {
          "user": "achow101",
          "body": "ACK ec004cdb86e6471915e1033f390c76ee0428e415",
          "created_at": "2025-07-02T20:30:43Z"
        },
        {
          "user": "fanquake",
          "body": "Backported to 29.x in #32863.",
          "created_at": "2025-07-03T11:16:58Z"
        }
      ]
    },
    {
      "number": 32822,
      "title": "fuzz: Make process_message(s) more deterministic",
      "body": "`process_message(s)` are the least stable fuzz targets, according to OSS-Fuzz.\r\n\r\nTracking issue: https://github.com/bitcoin/bitcoin/issues/29018.\r\n\r\n### Testing\r\n\r\nNeeds coverage compilation, as explained in `./contrib/devtools/README.md`. And then, using 32 threads:\r\n\r\n```\r\ncargo run --manifest-path ./contrib/devtools/deterministic-fuzz-coverage/Cargo.toml -- $PWD/bld-cmake/ $PWD/../b-c-qa-assets/fuzz_corpora/ process_messages 32  \r\n```\r\n\r\nEach commit can be reverted to see more non-determinism re-appear.",
      "state": "closed",
      "user": "maflcko",
      "created_at": "2025-06-27T15:40:13Z",
      "updated_at": "2025-10-30T13:58:18Z",
      "comments": 9,
      "url": "https://github.com/bitcoin/bitcoin/pull/32822",
      "labels": [
        "Tests",
        "Fuzzing"
      ],
      "comment_list": [
        {
          "user": "DrahtBot",
          "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/32822.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| ACK | [marcofleon](https://github.com/bitcoin/bitcoin/pull/32822#issuecomment-3089686217), [dergoegge](https://github.com/bitcoin/bitcoin/pull/32822#pullrequestreview-3037221638) |\n| Stale ACK | [brunoerg](https://github.com/bitcoin/bitcoin/pull/32822#pullrequestreview-3006007306) |\n\nIf your review is incorrectly listed, please react with ðŸ‘Ž to this comment and the bot will ignore it on the next update.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#32430](https://github.com/bitcoin/bitcoin/pull/32430) (test: Add and use ElapseTime helper by maflcko)\n* [#32015](https://github.com/bitcoin/bitcoin/pull/32015) (net: replace manual reference counting of CNode with shared_ptr by vasild)\n* [#30988](https://github.com/bitcoin/bitcoin/pull/30988) (Split CConnman by vasild)\n* [#30214](https://github.com/bitcoin/bitcoin/pull/30214) (refactor: Improve assumeutxo state representation by ryanofsky)\n* [#29418](https://github.com/bitcoin/bitcoin/pull/29418) (rpc: provide per message stats for global traffic via new RPC 'getnetmsgstats' by vasild)\n* [#28792](https://github.com/bitcoin/bitcoin/pull/28792) (Embed default ASMap as binary dump header file by fjahr)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n<!--5faf32d7da4f0f540f40219e4f7537a3-->",
          "created_at": "2025-06-27T15:40:19Z"
        },
        {
          "user": "maflcko",
          "body": "for testing, the single-check doesn't hit here and can be quite expensive, so it could be disabled via:\r\n\r\n```diff\r\ndiff --git a/contrib/devtools/deterministic-fuzz-coverage/src/main.rs b/contrib/devtools/deterministic-fuzz-coverage/src/main.rs\r\nindex 3eeb121db0..f729740a3a 100644\r\n--- a/contrib/devtools/deterministic-fuzz-coverage/src/main.rs\r\n+++ b/contrib/devtools/deterministic-fuzz-coverage/src/main.rs\r\n@@ -219,13 +219,6 @@ The coverage was not deterministic between runs.\r\n         if !entry.is_file() {\r\n             Err(format!(\"{} should be a file\", entry.display()))?;\r\n         }\r\n-        let cov_txt_base = run_single('a', &entry, thread_id)?;\r\n-        let cov_txt_repeat = run_single('b', &entry, thread_id)?;\r\n-        check_diff(\r\n-            &cov_txt_base,\r\n-            &cov_txt_repeat,\r\n-            &format!(\"The fuzz target input was {}.\", entry.display()),\r\n-        )?;\r\n         Ok(())\r\n     };\r\n     thread::scope(|s| -> AppResult {\r\n```",
          "created_at": "2025-06-27T15:42:28Z"
        },
        {
          "user": "maflcko",
          "body": "Apologies for the force push. However, it seems that the fuzz target actually produces valid block headers, so the chainman state is dirty and needs to be reset as well for those fuzz inputs. I've pushed a new commit doing this (after a rebase).\r\n\r\nThere is still non-determinism in `operator==<transaction_identifier>`, however I fail to see the source. I may take a look in the future.",
          "created_at": "2025-07-01T16:41:41Z"
        },
        {
          "user": "maflcko",
          "body": "> mock time\r\n\r\nMy bad and nice catch. Added it there as well. should be trivial to re-review with range-diff",
          "created_at": "2025-07-03T06:49:23Z"
        },
        {
          "user": "marcofleon",
          "body": "ReACK fa501ea5ed874ffcba2b606806460e61a1204bd2",
          "created_at": "2025-07-03T20:49:32Z"
        },
        {
          "user": "dergoegge",
          "body": "This needs a rebase, but should be good to go otherwise. ",
          "created_at": "2025-07-17T12:47:45Z"
        },
        {
          "user": "maflcko",
          "body": "(rebased)",
          "created_at": "2025-07-18T13:32:40Z"
        },
        {
          "user": "marcofleon",
          "body": "ReACK fa1a14a13a15ecfb7587a94ee86b4ace7c819519\r\n\r\n`range-diff 33332cf86a..fa501ea5ed fa11eea405..fa1a14a13a` lgtm",
          "created_at": "2025-07-18T14:32:20Z"
        },
        {
          "user": "maflcko",
          "body": "fuzz-only pull with two acks and no conflicts with reviewed pulls, rfm?",
          "created_at": "2025-07-25T06:30:18Z"
        }
      ]
    },
    {
      "number": 32821,
      "title": "rpc: Handle -named argument parsing where '=' character is used",
      "body": "Addresses [comment](https://github.com/bitcoin/bitcoin/pull/31375#discussion_r2091886628) and [this](https://github.com/bitcoin/bitcoin/pull/31375#discussion_r2092039999).\r\n\r\nThe [PR #31375](https://github.com/bitcoin/bitcoin/pull/31375) got merged and enables `-named` by default in the `bitcoin rpc` interface; `bitcoin rpc` corresponds to `bitcoin-cli -named` as it's just a wrapper.  Now, the problem arises when we try to parse the positional paramater which might contain \"=\" character.  This splits the parameter into two parts first, before the \"=\" character, which treats this as the parameter name, but the other half is mostly passed as an empty string. Here, the first part of the string is an unknown parameter name; thus, an error is thrown. These types of errors are only applicable to those RPCs which might contain the `=` character as a parameter. Some examples are `finalizepsbt`, `decodepsbt`, `verifymessage` etc.\r\n\r\nThis is the one example of the error in `finalizepsbt` RPC:\r\n```\r\n./bitcoin-cli -named -regtest finalizepsbt cHNidP8BAJoCAAAAAqvNEjSrzRI0q80SNKvNEjSrzRI0q80SNKvNEjSrzRI0AAAAAAD9////NBLNqzQSzas0Es2rNBLNqzQSzas0Es2rNBLNqzQSzasBAAAAAP3///8CoIYBAAAAAAAWABQVQBGVs/sqFAmC8HZ8O+g1htqivkANAwAAAAAAFgAUir7MzgyzDnRMjdkVa7d+Dwr07jsAAAAAAAAAAAA=\r\nerror code: -8\r\nerror message:\r\nUnknown named parameter cHNidP8BAJoCAAAAAqvNEjSrzRI0q80SNKvNEjSrzRI0q80SNKvNEjSrzRI0AAAAAAD9////NBLNqzQSzas0Es2rNBLNqzQSzas0Es2rNBLNqzQSzasBAAAAAP3///8CoIYBAAAAAAAWABQVQBGVs/sqFAmC8HZ8O+g1htqivkANAwAAAAAAFgAUir7MzgyzDnRMjdkVa7d+Dwr07jsAAAAAAAAAAAA\r\n```\r\nThis PR fixes this by updating the `vRPCConvertParams` table that identifies parameters that need special handling in `-named` parameter mode. The parser now recognises these parameters and handles strings with \"=\" char correctly, preventing them from being incorrectly split as parameter assignments.",
      "state": "closed",
      "user": "zaidmstrr",
      "created_at": "2025-06-27T11:43:16Z",
      "updated_at": "2025-11-21T15:16:57Z",
      "comments": 25,
      "url": "https://github.com/bitcoin/bitcoin/pull/32821",
      "labels": [
        "RPC/REST/ZMQ"
      ]
    }
  ],
  "issues": [],
  "summary": {
    "pull_requests": 3,
    "issues": 0
  }
}