{
  "source": "github",
  "repository": "bitcoin/bitcoin",
  "fetched_at": "2026-01-15T20:03:34.237966+00:00",
  "date": "2025-08-02",
  "pull_requests": [
    {
      "number": 33127,
      "title": "Adding alert for failure to prevent dead-end user crash",
      "body": "In some cases after running the client for a bit, the chainstate seems to have blocks with a lower validity level than `VALID_SCRIPTS`. This causes a crash on launch in the `PruneBlockIndexCandidates` function, where the `setBlockIndexCandidates` is empty after filtering by m_chain.\r\n\r\nCould not figure out root cause as to why, so for now just added an alert so the user is not deadended. ",
      "state": "closed",
      "user": "Ataraxia009",
      "created_at": "2025-08-02T12:00:54Z",
      "updated_at": "2025-08-12T05:06:46Z",
      "comments": 6,
      "url": "https://github.com/bitcoin/bitcoin/pull/33127",
      "labels": [],
      "comment_list": [
        {
          "user": "DrahtBot",
          "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/33127.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\nA summary of reviews will appear here.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nNo conflicts as of last run.\n<!--5faf32d7da4f0f540f40219e4f7537a3-->",
          "created_at": "2025-08-02T12:00:57Z"
        },
        {
          "user": "Ataraxia009",
          "body": "> > Could not figure out root cause as to why, so for now just added an alert so the user is not deadended.\r\n> \r\n> Could you share steps to reproduce it?\r\n\r\nCouldn't really reproduce it myself, just a had a data dir in a bad state\r\n\r\nWhich, if this assert is true, should imply we are in a bad data dir state where the chainstate is not included in the setBlockIndexCandidates  and all setBlockIndexCandidates are less work. ",
          "created_at": "2025-08-02T12:27:53Z"
        },
        {
          "user": "DrahtBot",
          "body": "<!--85328a0da195eb286784d51f73fa0af9-->\nðŸš§ At least one of the CI tasks failed.\n<sub>Task `lint`: https://github.com/bitcoin/bitcoin/runs/47254107937</sub>\n<sub>LLM reason (âœ¨ experimental): The CI failure is caused by lint errors related to trailing whitespace.</sub>\n\n<details><summary>Hints</summary>\n\nTry to run the tests locally, according to the documentation. However, a CI failure may still\nhappen due to a number of reasons, for example:\n\n* Possibly due to a silent merge conflict (the changes in this pull request being\nincompatible with the current code in the target branch). If so, make sure to rebase on the latest\ncommit of the target branch.\n\n* A sanitizer issue, which can only be found by compiling with the sanitizer and running the\n  affected test.\n\n* An intermittent issue.\n\nLeave a comment here, if you need help tracking down a confusing failure.\n\n</details>\n\n",
          "created_at": "2025-08-02T13:05:07Z"
        },
        {
          "user": "luke-jr",
          "body": "Looking at the relevant code, this feels like a symptom of a problem we could/should detect earlier somehow (which may also be early enough to follow the reindex GUI path)",
          "created_at": "2025-08-04T21:43:14Z"
        },
        {
          "user": "Ataraxia009",
          "body": "> Looking at the relevant code, this feels like a symptom of a problem we could/should detect earlier somehow (which may also be early enough to follow the reindex GUI path)\n\nYeah agreed overall. However i cant repro and don't have the data dir. That being said this deadend the user to a crash with no explanation or logs. And the crash is repeated on every launch. This would just a lot of node runners to give up and move on. Atleast this way they have some way out. It's quite a soft change. ",
          "created_at": "2025-08-05T01:42:55Z"
        },
        {
          "user": "Ataraxia009",
          "body": "I agree with @mzumsande here. At a second glance this alert is too deep into the flow when the bad state can easily be detected somewhere between `LoadBlockIndex()` and `LoadChainTip()` which more directly would imply a db corruption state. \r\n\r\nUnfortunately I lost access to the datadir to reproduce and test this. If it comes up again will fix by moving the alert up, closing for now. ",
          "created_at": "2025-08-12T05:06:46Z"
        }
      ]
    },
    {
      "number": 33126,
      "title": "Removing Bitcoin core text where unnecessary",
      "body": "We do not need Bitcoin Core specific text on these guix-build flows. This makes forking the open source project easier. \r\n\r\nThese make the scripts more reusable. ",
      "state": "closed",
      "user": "Ataraxia009",
      "created_at": "2025-08-02T11:37:16Z",
      "updated_at": "2025-08-12T04:29:17Z",
      "comments": 29,
      "url": "https://github.com/bitcoin/bitcoin/pull/33126",
      "labels": [
        "Needs rebase"
      ]
    },
    {
      "number": 33125,
      "title": "ci: Use mlc `v1` and fix typos",
      "body": "Update mcl to `v1` & shellcheck to `0.11.0`.\r\nIncludes other cherry-picked lint-related changes.",
      "state": "closed",
      "user": "fanquake",
      "created_at": "2025-08-02T11:22:56Z",
      "updated_at": "2025-08-07T10:58:01Z",
      "comments": 4,
      "url": "https://github.com/bitcoin/bitcoin/pull/33125",
      "labels": [
        "Tests"
      ],
      "comment_list": [
        {
          "user": "DrahtBot",
          "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/33125.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| ACK | [maflcko](https://github.com/bitcoin/bitcoin/pull/33125#issuecomment-3163414840) |\n\nIf your review is incorrectly listed, please react with ðŸ‘Ž to this comment and the bot will ignore it on the next update.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nNo conflicts as of last run.\n<!--5faf32d7da4f0f540f40219e4f7537a3-->",
          "created_at": "2025-08-02T11:23:00Z"
        },
        {
          "user": "maflcko",
          "body": "Is this ready for review?",
          "created_at": "2025-08-07T08:08:58Z"
        },
        {
          "user": "fanquake",
          "body": "It can be.",
          "created_at": "2025-08-07T08:32:27Z"
        },
        {
          "user": "maflcko",
          "body": "lgtm ACK f28a94b40eea8669eafc1b4152823e1ab26fa618",
          "created_at": "2025-08-07T10:07:52Z"
        }
      ]
    },
    {
      "number": 33124,
      "title": "wallet: Improve wallet creation error message with usage hint",
      "body": "Improve wallet creation error message with usage hintï¼ŒThe original error message did not provide a method for specifying the wallet name, causing confusion for users.\r\n\r\nbefore:\r\n\r\n```\r\n$ ./build/bin/bitcoin-wallet create                                                 \r\nWallet name must be provided when creating a new wallet.\r\n```\r\n\r\nafter: \r\n```\r\n$ ./build/bin/bitcoin-wallet create                                                 \r\nWallet name must be provided when creating a new wallet. Use -wallet=<wallet-name> to specify the name.\r\n```",
      "state": "closed",
      "user": "chareice",
      "created_at": "2025-08-02T09:37:22Z",
      "updated_at": "2025-10-29T14:38:13Z",
      "comments": 2,
      "url": "https://github.com/bitcoin/bitcoin/pull/33124",
      "labels": [
        "Wallet"
      ],
      "comment_list": [
        {
          "user": "DrahtBot",
          "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/33124.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\nA summary of reviews will appear here.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nNo conflicts as of last run.\n<!--5faf32d7da4f0f540f40219e4f7537a3-->",
          "created_at": "2025-08-02T09:37:26Z"
        },
        {
          "user": "maflcko",
          "body": "Yeah, tend to agree. One will have to read the full help anyway to understand it.",
          "created_at": "2025-10-29T12:43:57Z"
        }
      ]
    }
  ],
  "issues": [
    {
      "number": 33128,
      "title": "*BSD, OmniOS: `-reindex` is broken",
      "body": "The `-reindex` option is broken on both the master branch and the 29.x branch (I have not tested older release branches).\n\nConsider the following workflow on OpenBSD 7.7:\n```\n$ rm -rf /home/hebasto/.bitcoin/regtest\n$ ./build/bin/bitcoind -regtest -daemon\nBitcoin Core starting\n$ ./build/bin/bitcoin-cli -regtest createwallet $(date +%Y-%m-%d)\n$ ./build/bin/bitcoin-cli -regtest -generate 200\n$ ./build/bin/bitcoin-cli -regtest getblockcount\n200\n$ ./build/bin/bitcoin-cli -regtest stop\nBitcoin Core stopping\n$ rm -rf /home/hebasto/.bitcoin/regtest/blocks/index\n$ ./build/bin/bitcoind -regtest -daemon\nBitcoin Core starting\n$ tail -6 /home/hebasto/.bitcoin/regtest/debug.log\n2025-08-02T15:02:00Z : Error initializing block database.\nPlease restart with -reindex or -reindex-chainstate to recover.\n2025-08-02T15:02:00Z Shutdown: In progress...\n2025-08-02T15:02:00Z scheduler thread exit\n2025-08-02T15:02:00Z Flushed fee estimates to fee_estimates.dat.\n2025-08-02T15:02:00Z Shutdown: done\n$ rm /home/hebasto/.bitcoin/regtest/debug.log\n$ ./build/bin/bitcoind -regtest -daemon -reindex\nBitcoin Core starting\n$ ./build/bin/bitcoin-cli -regtest getblockcount\n0\n$ cat /home/hebasto/.bitcoin/regtest/debug.log                    \n\n\n\n\n\n2025-08-02T15:13:08Z Bitcoin Core version v29.99.0-75ed673193c5 (release build)\n2025-08-02T15:13:08Z Using the 'sse4(1way),sse41(4way),avx2(8way)' SHA256 implementation\n2025-08-02T15:13:08Z Using RdSeed as an additional entropy source\n2025-08-02T15:13:08Z Using RdRand as an additional entropy source\n2025-08-02T15:13:08Z Default data directory /home/hebasto/.bitcoin\n2025-08-02T15:13:08Z Using data directory /home/hebasto/.bitcoin/regtest\n2025-08-02T15:13:08Z Config file: /home/hebasto/.bitcoin/bitcoin.conf (not found, skipping)\n2025-08-02T15:13:08Z Command-line arg: daemon=\"\"\n2025-08-02T15:13:08Z Command-line arg: regtest=\"\"\n2025-08-02T15:13:08Z Command-line arg: reindex=\"\"\n2025-08-02T15:13:08Z Using at most 125 automatic connections (512 file descriptors available)\n2025-08-02T15:13:08Z scheduler thread start\n2025-08-02T15:13:08Z Binding RPC on address ::1 port 18443\n2025-08-02T15:13:08Z Binding RPC on address 127.0.0.1 port 18443\n2025-08-02T15:13:08Z Generated RPC authentication cookie /home/hebasto/.bitcoin/regtest/.cookie\n2025-08-02T15:13:08Z Permissions used for cookie: rw-------\n2025-08-02T15:13:08Z Using random cookie authentication.\n2025-08-02T15:13:08Z Starting HTTP server with 16 worker threads\n2025-08-02T15:13:08Z Using wallet directory /home/hebasto/.bitcoin/regtest/wallets\n2025-08-02T15:13:08Z init message: Verifying wallet(s)â€¦\n2025-08-02T15:13:08Z Using /16 prefix for IP bucketing\n2025-08-02T15:13:08Z init message: Loading P2P addressesâ€¦\n2025-08-02T15:13:08Z Loaded 0 addresses from peers.dat  0ms\n2025-08-02T15:13:08Z init message: Loading banlistâ€¦\n2025-08-02T15:13:08Z SetNetworkActive: true\n2025-08-02T15:13:08Z Cache configuration:\n2025-08-02T15:13:08Z * Using 2.0 MiB for block index database\n2025-08-02T15:13:08Z * Using 8.0 MiB for chain state database\n2025-08-02T15:13:08Z * Using 440.0 MiB for in-memory UTXO set (plus up to 286.1 MiB of unused mempool space)\n2025-08-02T15:13:08Z Script verification uses 7 additional threads\n2025-08-02T15:13:08Z Using obfuscation key for blocksdir *.dat files (/home/hebasto/.bitcoin/regtest/blocks): '997651b2ed068218'\n2025-08-02T15:13:08Z Wiping LevelDB in /home/hebasto/.bitcoin/regtest/blocks/index\n2025-08-02T15:13:08Z Opening LevelDB in /home/hebasto/.bitcoin/regtest/blocks/index\n2025-08-02T15:13:08Z Opened LevelDB successfully\n2025-08-02T15:13:08Z Using obfuscation key for /home/hebasto/.bitcoin/regtest/blocks/index: 0000000000000000\n2025-08-02T15:13:08Z Using 16 MiB out of 16 MiB requested for signature cache, able to store 524288 elements\n2025-08-02T15:13:08Z Using 16 MiB out of 16 MiB requested for script execution cache, able to store 524288 elements\n2025-08-02T15:13:08Z init message: Loading block indexâ€¦\n2025-08-02T15:13:08Z Validating signatures for all blocks.\n2025-08-02T15:13:08Z Setting nMinimumChainWork=0000000000000000000000000000000000000000000000000000000000000000\n2025-08-02T15:13:08Z Initializing chainstate Chainstate [ibd] @ height -1 (null)\n2025-08-02T15:13:08Z Wiping LevelDB in /home/hebasto/.bitcoin/regtest/chainstate\n2025-08-02T15:13:08Z Opening LevelDB in /home/hebasto/.bitcoin/regtest/chainstate\n2025-08-02T15:13:08Z Opened LevelDB successfully\n2025-08-02T15:13:08Z Wrote new obfuscation key for /home/hebasto/.bitcoin/regtest/chainstate: cc8a83834d10b91a\n2025-08-02T15:13:08Z Using obfuscation key for /home/hebasto/.bitcoin/regtest/chainstate: cc8a83834d10b91a\n2025-08-02T15:13:08Z init message: Verifying blocksâ€¦\n2025-08-02T15:13:08Z Block index and chainstate loaded\n2025-08-02T15:13:08Z Setting NODE_NETWORK on non-prune mode\n2025-08-02T15:13:08Z initload thread start\n2025-08-02T15:13:08Z Reindexing block file blk00000.dat...\n2025-08-02T15:13:08Z UpdateTip: new best=0f9188f13cb7b2c71f2a335e3a4fc328bf5beb436012afca590b1a11466e2206 height=0 version=0x00000001 log2_work=1.000000 tx=1 date='2011-02-02T23:16:42Z' progress=0.000002 cache=0.3MiB(0txo)\n2025-08-02T15:13:08Z block tree size = 1\n2025-08-02T15:13:08Z nBestHeight = 0\n2025-08-02T15:13:08Z mapport thread start\n2025-08-02T15:13:08Z torcontrol thread start\n2025-08-02T15:13:08Z Bound to 127.0.0.1:18445\n2025-08-02T15:13:08Z Bound to [::]:18444\n2025-08-02T15:13:08Z Bound to 0.0.0.0:18444\n2025-08-02T15:13:08Z Loaded 0 addresses from \"anchors.dat\"\n2025-08-02T15:13:08Z 0 block-relay-only anchors will be tried for connections.\n2025-08-02T15:13:08Z init message: Starting network threadsâ€¦\n2025-08-02T15:13:08Z net thread start\n2025-08-02T15:13:08Z dnsseed thread start\n2025-08-02T15:13:08Z Loading addresses from DNS seed dummySeed.invalid.\n2025-08-02T15:13:08Z addcon thread start\n2025-08-02T15:13:08Z opencon thread start\n2025-08-02T15:13:08Z init message: Done loading\n2025-08-02T15:13:08Z msghand thread start\n2025-08-02T15:13:08Z 0 addresses found from DNS seeds\n2025-08-02T15:13:08Z dnsseed thread exit\n2025-08-02T15:13:08Z Loaded 1 blocks from external file in 38ms\n2025-08-02T15:13:08Z Reindexing finished\n2025-08-02T15:13:08Z Loading 0 mempool transactions from file...\n2025-08-02T15:13:08Z Imported mempool transactions from file: 0 succeeded, 0 failed, 0 expired, 0 already there, 0 waiting for initial broadcast\n2025-08-02T15:13:08Z initload thread exit\n$ ./build/bin/bitcoin-cli -regtest stop\nBitcoin Core stopping\n```\n\nDespite the log containing the messages \"Reindexing block file blk00000.dat...\" and \"Reindexing finished\", the `getblockcount` RPC returns 0.\n\nIt appears this issue affects other operating systems as well, as noted in https://github.com/bitcoin/bitcoin/pull/32987#discussion_r2248288321.",
      "state": "open",
      "user": "hebasto",
      "created_at": "2025-08-02T15:22:03Z",
      "updated_at": "2025-12-29T13:52:09Z",
      "comments": 13,
      "url": "https://github.com/bitcoin/bitcoin/issues/33128",
      "labels": [
        "Bug",
        "Block storage"
      ],
      "comment_list": [
        {
          "user": "hebasto",
          "body": "Apparently, after the failed run:\n```\n$ rm -rf /home/hebasto/.bitcoin/regtest/blocks/index\n$ ./build/bin/bitcoind -regtest -daemon\nBitcoin Core starting\n$ tail -6 /home/hebasto/.bitcoin/regtest/debug.log\n2025-08-02T15:02:00Z : Error initializing block database.\nPlease restart with -reindex or -reindex-chainstate to recover.\n2025-08-02T15:02:00Z Shutdown: In progress...\n2025-08-02T15:02:00Z scheduler thread exit\n2025-08-02T15:02:00Z Flushed fee estimates to fee_estimates.dat.\n2025-08-02T15:02:00Z Shutdown: done\n```\nthe `blk00000.dat` file contains only the genesis block, which is clearly incorrect behaviour.",
          "created_at": "2025-08-02T20:55:49Z"
        },
        {
          "user": "hebasto",
          "body": "@theStack \n\nCan you confirm the bug?",
          "created_at": "2025-08-02T21:08:26Z"
        },
        {
          "user": "mzumsande",
          "body": "Does this mean that `feature_reindex.py` still succeeds, so that reindex only fails if we delete the `index/` dir like in `feature_reindex_init.py`, but not if we just reindex without corrupting anything?!",
          "created_at": "2025-08-03T23:32:16Z"
        },
        {
          "user": "theStack",
          "body": "> [@theStack](https://github.com/theStack)\n> \n> Can you confirm the bug?\n\nWill test in 1-2 weeks, as I unfortunately don't have access to an OpenBSD machine right now.",
          "created_at": "2025-08-04T00:55:40Z"
        },
        {
          "user": "hebasto",
          "body": "> Does this mean that `feature_reindex.py` still succeeds, so that reindex only fails if we delete the `index/` dir like in `feature_reindex_init.py`, but not if we just reindex without corrupting anything?!\n\nCorrect.",
          "created_at": "2025-08-04T08:51:17Z"
        },
        {
          "user": "maflcko",
          "body": "Would be nice to see a test run with additional logging added to `ChainstateManager::LoadExternalBlockFile` (to the `continue` and `break` statements), and a log showing the size of the blk dat file.",
          "created_at": "2025-08-04T11:30:17Z"
        },
        {
          "user": "hebasto",
          "body": "> ... showing the size of the blk dat file.\n\nYou mean `blkdat.GetPos()`?",
          "created_at": "2025-08-04T12:07:38Z"
        },
        {
          "user": "maflcko",
          "body": "> > ... showing the size of the blk dat file.\n> \n> You mean `blkdat.GetPos()`?\n\nA bit like commit 734737b5930df7cebab83cf0dbe5fd390143f2be",
          "created_at": "2025-08-05T18:08:44Z"
        },
        {
          "user": "hebasto",
          "body": "> > > ... showing the size of the blk dat file.\n> > \n> > \n> > You mean `blkdat.GetPos()`?\n> \n> A bit like commit [734737b](https://github.com/bitcoin/bitcoin/commit/734737b5930df7cebab83cf0dbe5fd390143f2be)\n\nI used [this](https://github.com/hebasto/bitcoin/commits/250809-issue33128.debug.1/) branch for additional logging.\n\nOn OpenBSD, running `./build/bin/bitcoind -regtest -logsourcelocations -daemon -reindex` logs the following:\n```\n2025-08-09T12:33:19Z [init/common.cpp:152] [void init::LogPackageVersion()] Bitcoin Core version v29.99.0-26f02ab3d92d (release build)\n2025-08-09T12:33:19Z [kernel/context.cpp:20] [kernel::Context::Context()] Using the 'sse4(1way),sse41(4way),avx2(8way)' SHA256 implementation\n2025-08-09T12:33:19Z [random.cpp:110] [void (anonymous namespace)::ReportHardwareRand()] Using RdSeed as an additional entropy source\n2025-08-09T12:33:19Z [random.cpp:113] [void (anonymous namespace)::ReportHardwareRand()] Using RdRand as an additional entropy source\n2025-08-09T12:33:19Z [init/common.cpp:120] [bool init::StartLogging(const ArgsManager &)] Default data directory /home/hebasto/.bitcoin\n2025-08-09T12:33:19Z [init/common.cpp:121] [bool init::StartLogging(const ArgsManager &)] Using data directory /home/hebasto/.bitcoin/regtest\n2025-08-09T12:33:19Z [init/common.cpp:135] [bool init::StartLogging(const ArgsManager &)] Config file: /home/hebasto/.bitcoin/bitcoin.conf (not found, skipping)\n2025-08-09T12:33:19Z [common/args.cpp:851] [void ArgsManager::logArgsPrefix(const std::string &, const std::string &, const std::map<std::string, std::vector<common::SettingsValue>> &) const] Command-line arg: daemon=\"\"\n2025-08-09T12:33:19Z [common/args.cpp:851] [void ArgsManager::logArgsPrefix(const std::string &, const std::string &, const std::map<std::string, std::vector<common::SettingsValue>> &) const] Command-line arg: logsourcelocations=\"\"\n2025-08-09T12:33:19Z [common/args.cpp:851] [void ArgsManager::logArgsPrefix(const std::string &, const std::string &, const std::map<std::string, std::vector<common::SettingsValue>> &) const] Command-line arg: regtest=\"\"\n2025-08-09T12:33:19Z [common/args.cpp:851] [void ArgsManager::logArgsPrefix(const std::string &, const std::string &, const std::map<std::string, std::vector<common::SettingsValue>> &) const] Command-line arg: reindex=\"\"\n2025-08-09T12:33:19Z [init.cpp:1369] [bool AppInitMain(NodeContext &, interfaces::BlockAndHeaderTipInfo *)] Using at most 125 automatic connections (512 file descriptors available)\n2025-08-09T12:33:19Z [util/thread.cpp:20] [void util::TraceThread(std::string_view, std::function<void ()>)] scheduler thread start\n2025-08-09T12:33:19Z [httpserver.cpp:394] [bool HTTPBindAddresses(struct evhttp *)] Binding RPC on address ::1 port 18443\n2025-08-09T12:33:19Z [httpserver.cpp:394] [bool HTTPBindAddresses(struct evhttp *)] Binding RPC on address 127.0.0.1 port 18443\n2025-08-09T12:33:19Z [rpc/request.cpp:140] [GenerateAuthCookieResult GenerateAuthCookie(const std::optional<fs::perms> &, std::string &, std::string &)] Generated RPC authentication cookie /home/hebasto/.bitcoin/regtest/.cookie\n2025-08-09T12:33:19Z [rpc/request.cpp:141] [GenerateAuthCookieResult GenerateAuthCookie(const std::optional<fs::perms> &, std::string &, std::string &)] Permissions used for cookie: rw-------\n2025-08-09T12:33:19Z [httprpc.cpp:265] [bool InitRPCAuthentication()] Using random cookie authentication.\n2025-08-09T12:33:19Z [httpserver.cpp:504] [void StartHTTPServer()] Starting HTTP server with 16 worker threads\n2025-08-09T12:33:19Z [wallet/load.cpp:53] [bool wallet::VerifyWallets(WalletContext &)] Using wallet directory /home/hebasto/.bitcoin/regtest/wallets\n2025-08-09T12:33:19Z [noui.cpp:57] [void noui_InitMessage(const std::string &)] init message: Verifying wallet(s)â€¦\n2025-08-09T12:33:19Z [init.cpp:1521] [bool AppInitMain(NodeContext &, interfaces::BlockAndHeaderTipInfo *)] Using /16 prefix for IP bucketing\n2025-08-09T12:33:19Z [noui.cpp:57] [void noui_InitMessage(const std::string &)] init message: Loading P2P addressesâ€¦\n2025-08-09T12:33:19Z [addrdb.cpp:207] [util::Result<std::unique_ptr<AddrMan>> LoadAddrman(const NetGroupManager &, const ArgsManager &)] Loaded 0 addresses from peers.dat  1ms\n2025-08-09T12:33:19Z [noui.cpp:57] [void noui_InitMessage(const std::string &)] init message: Loading banlistâ€¦\n2025-08-09T12:33:19Z [net.cpp:3192] [void CConnman::SetNetworkActive(bool)] SetNetworkActive: true\n2025-08-09T12:33:19Z [init.cpp:1722] [bool AppInitMain(NodeContext &, interfaces::BlockAndHeaderTipInfo *)] Cache configuration:\n2025-08-09T12:33:19Z [init.cpp:1723] [bool AppInitMain(NodeContext &, interfaces::BlockAndHeaderTipInfo *)] * Using 2.0 MiB for block index database\n2025-08-09T12:33:19Z [init.cpp:1731] [bool AppInitMain(NodeContext &, interfaces::BlockAndHeaderTipInfo *)] * Using 8.0 MiB for chain state database\n2025-08-09T12:33:19Z [init.cpp:1257] [ChainstateLoadResult InitAndLoadChainstate(NodeContext &, bool, const bool, const kernel::CacheSizes &, const ArgsManager &)] * Using 440.0 MiB for in-memory UTXO set (plus up to 286.1 MiB of unused mempool space)\n2025-08-09T12:33:19Z [checkqueue.h:147] [CCheckQueue<CScriptCheck, std::pair<ScriptError_t, std::string>>::CCheckQueue(unsigned int, int) [T = CScriptCheck, R = std::pair<ScriptError_t, std::string>]] Script verification uses 7 additional threads\n2025-08-09T12:33:19Z [node/blockstorage.cpp:1176] [Obfuscation node::InitBlocksdirXorKey(const BlockManager::Options &)] Using obfuscation key for blocksdir *.dat files (/home/hebasto/.bitcoin/regtest/blocks): '2ce04306dc84ec9a'\n2025-08-09T12:33:19Z [dbwrapper.cpp:231] [CDBWrapper::CDBWrapper(const DBParams &)] Wiping LevelDB in /home/hebasto/.bitcoin/regtest/blocks/index\n2025-08-09T12:33:19Z [dbwrapper.cpp:236] [CDBWrapper::CDBWrapper(const DBParams &)] Opening LevelDB in /home/hebasto/.bitcoin/regtest/blocks/index\n2025-08-09T12:33:19Z [dbwrapper.cpp:244] [CDBWrapper::CDBWrapper(const DBParams &)] Opened LevelDB successfully\n2025-08-09T12:33:19Z [dbwrapper.cpp:260] [CDBWrapper::CDBWrapper(const DBParams &)] Using obfuscation key for /home/hebasto/.bitcoin/regtest/blocks/index: 0000000000000000\n2025-08-09T12:33:19Z [script/sigcache.cpp:36] [SignatureCache::SignatureCache(const size_t)] Using 16 MiB out of 16 MiB requested for signature cache, able to store 524288 elements\n2025-08-09T12:33:19Z [validation.cpp:2120] [ValidationCache::ValidationCache(const size_t, const size_t)] Using 16 MiB out of 16 MiB requested for script execution cache, able to store 524288 elements\n2025-08-09T12:33:19Z [noui.cpp:57] [void noui_InitMessage(const std::string &)] init message: Loading block indexâ€¦\n2025-08-09T12:33:19Z [node/chainstate.cpp:150] [ChainstateLoadResult node::LoadChainstate(ChainstateManager &, const CacheSizes &, const ChainstateLoadOptions &)] Validating signatures for all blocks.\n2025-08-09T12:33:19Z [node/chainstate.cpp:152] [ChainstateLoadResult node::LoadChainstate(ChainstateManager &, const CacheSizes &, const ChainstateLoadOptions &)] Setting nMinimumChainWork=0000000000000000000000000000000000000000000000000000000000000000\n2025-08-09T12:33:19Z [node/chainstate.cpp:87] [ChainstateLoadResult node::CompleteChainstateInitialization(ChainstateManager &, const ChainstateLoadOptions &)] Initializing chainstate Chainstate [ibd] @ height -1 (null)\n2025-08-09T12:33:19Z [dbwrapper.cpp:231] [CDBWrapper::CDBWrapper(const DBParams &)] Wiping LevelDB in /home/hebasto/.bitcoin/regtest/chainstate\n2025-08-09T12:33:19Z [dbwrapper.cpp:236] [CDBWrapper::CDBWrapper(const DBParams &)] Opening LevelDB in /home/hebasto/.bitcoin/regtest/chainstate\n2025-08-09T12:33:19Z [dbwrapper.cpp:244] [CDBWrapper::CDBWrapper(const DBParams &)] Opened LevelDB successfully\n2025-08-09T12:33:19Z [dbwrapper.cpp:258] [CDBWrapper::CDBWrapper(const DBParams &)] Wrote new obfuscation key for /home/hebasto/.bitcoin/regtest/chainstate: 715af8a1f6e7a857\n2025-08-09T12:33:19Z [dbwrapper.cpp:260] [CDBWrapper::CDBWrapper(const DBParams &)] Using obfuscation key for /home/hebasto/.bitcoin/regtest/chainstate: 715af8a1f6e7a857\n2025-08-09T12:33:19Z [noui.cpp:57] [void noui_InitMessage(const std::string &)] init message: Verifying blocksâ€¦\n2025-08-09T12:33:19Z [init.cpp:1343] [ChainstateLoadResult InitAndLoadChainstate(NodeContext &, bool, const bool, const kernel::CacheSizes &, const ArgsManager &)] Block index and chainstate loaded\n2025-08-09T12:33:19Z [init.cpp:1830] [bool AppInitMain(NodeContext &, interfaces::BlockAndHeaderTipInfo *)] Setting NODE_NETWORK on non-prune mode\n2025-08-09T12:33:19Z [util/thread.cpp:20] [void util::TraceThread(std::string_view, std::function<void ()>)] initload thread start\n2025-08-09T12:33:19Z [node/blockstorage.cpp:1236] [void node::ImportBlocks(ChainstateManager &, std::span<const fs::path>)] Reindexing block file blk00000.dat...\n2025-08-09T12:33:19Z [validation.cpp:2967] [void UpdateTipLog(const ChainstateManager &, const CCoinsViewCache &, const CBlockIndex *, const std::string &, const std::string &, const std::string &)] UpdateTip: new best=0f9188f13cb7b2c71f2a335e3a4fc328bf5beb436012afca590b1a11466e2206 height=0 version=0x00000001 log2_work=1.000000 tx=1 date='2011-02-02T23:16:42Z' progress=0.000002 cache=0.3MiB(0txo)\n2025-08-09T12:33:19Z [init.cpp:1940] [bool AppInitMain(NodeContext &, interfaces::BlockAndHeaderTipInfo *)] block tree size = 1\n2025-08-09T12:33:19Z [init.cpp:1953] [bool AppInitMain(NodeContext &, interfaces::BlockAndHeaderTipInfo *)] nBestHeight = 0\n2025-08-09T12:33:19Z [validation.cpp:5173] [void ChainstateManager::LoadExternalBlockFile(AutoFile &, FlatFilePos *, std::multimap<uint256, FlatFilePos> *)] blkdat.size()=20777208\n2025-08-09T12:33:19Z [util/thread.cpp:20] [void util::TraceThread(std::string_view, std::function<void ()>)] mapport thread start\n2025-08-09T12:33:19Z [util/thread.cpp:20] [void util::TraceThread(std::string_view, std::function<void ()>)] torcontrol thread start\n2025-08-09T12:33:19Z [net.cpp:3165] [bool CConnman::BindListenPort(const CService &, bilingual_str &, NetPermissionFlags)] Bound to 127.0.0.1:18445\n2025-08-09T12:33:19Z [net.cpp:3165] [bool CConnman::BindListenPort(const CService &, bilingual_str &, NetPermissionFlags)] Bound to [::]:18444\n2025-08-09T12:33:19Z [net.cpp:3165] [bool CConnman::BindListenPort(const CService &, bilingual_str &, NetPermissionFlags)] Bound to 0.0.0.0:18444\n2025-08-09T12:33:19Z [addrdb.cpp:239] [std::vector<CAddress> ReadAnchors(const fs::path &)] Loaded 0 addresses from \"anchors.dat\"\n2025-08-09T12:33:19Z [net.cpp:3321] [bool CConnman::Start(CScheduler &, const Options &)] 0 block-relay-only anchors will be tried for connections.\n2025-08-09T12:33:19Z [noui.cpp:57] [void noui_InitMessage(const std::string &)] init message: Starting network threadsâ€¦\n2025-08-09T12:33:19Z [util/thread.cpp:20] [void util::TraceThread(std::string_view, std::function<void ()>)] net thread start\n2025-08-09T12:33:19Z [util/thread.cpp:20] [void util::TraceThread(std::string_view, std::function<void ()>)] msghand thread start\n2025-08-09T12:33:19Z [util/thread.cpp:20] [void util::TraceThread(std::string_view, std::function<void ()>)] addcon thread start\n2025-08-09T12:33:19Z [noui.cpp:57] [void noui_InitMessage(const std::string &)] init message: Done loading\n2025-08-09T12:33:19Z [util/thread.cpp:20] [void util::TraceThread(std::string_view, std::function<void ()>)] opencon thread start\n2025-08-09T12:33:19Z [util/thread.cpp:20] [void util::TraceThread(std::string_view, std::function<void ()>)] dnsseed thread start\n2025-08-09T12:33:19Z [net.cpp:2338] [void CConnman::ThreadDNSAddressSeed()] Loading addresses from DNS seed dummySeed.invalid.\n2025-08-09T12:33:19Z [net.cpp:2374] [void CConnman::ThreadDNSAddressSeed()] 0 addresses found from DNS seeds\n2025-08-09T12:33:19Z [util/thread.cpp:22] [void util::TraceThread(std::string_view, std::function<void ()>)] dnsseed thread exit\n2025-08-09T12:33:20Z [validation.cpp:5080] [void ChainstateManager::LoadExternalBlockFile(AutoFile &, FlatFilePos *, std::multimap<uint256, FlatFilePos> *)] blkdat.size()=33554432\n2025-08-09T12:33:20Z [validation.cpp:5221] [void ChainstateManager::LoadExternalBlockFile(AutoFile &, FlatFilePos *, std::multimap<uint256, FlatFilePos> *)] Loaded 1 blocks from external file in 41ms\n2025-08-09T12:33:20Z [node/blockstorage.cpp:1246] [void node::ImportBlocks(ChainstateManager &, std::span<const fs::path>)] Reindexing finished\n2025-08-09T12:33:20Z [node/mempool_persist.cpp:77] [bool node::LoadMempool(CTxMemPool &, const fs::path &, Chainstate &, ImportMempoolOptions &&)] Loading 0 mempool transactions from file...\n2025-08-09T12:33:20Z [node/mempool_persist.cpp:149] [bool node::LoadMempool(CTxMemPool &, const fs::path &, Chainstate &, ImportMempoolOptions &&)] Imported mempool transactions from file: 0 succeeded, 0 failed, 0 expired, 0 already there, 0 waiting for initial broadcast\n2025-08-09T12:33:20Z [util/thread.cpp:22] [void util::TraceThread(std::string_view, std::function<void ()>)] initload thread exit\n2025-08-09T12:33:36Z [torcontrol.cpp:709] [void InterruptTorControl()] tor: Thread interrupt\n2025-08-09T12:33:36Z [util/thread.cpp:22] [void util::TraceThread(std::string_view, std::function<void ()>)] torcontrol thread exit\n2025-08-09T12:33:36Z [util/thread.cpp:22] [void util::TraceThread(std::string_view, std::function<void ()>)] mapport thread exit\n2025-08-09T12:33:36Z [util/thread.cpp:22] [void util::TraceThread(std::string_view, std::function<void ()>)] opencon thread exit\n2025-08-09T12:33:36Z [util/thread.cpp:22] [void util::TraceThread(std::string_view, std::function<void ()>)] addcon thread exit\n2025-08-09T12:33:36Z [init.cpp:287] [void Shutdown(NodeContext &)] Shutdown in progress...\n2025-08-09T12:33:36Z [util/thread.cpp:22] [void util::TraceThread(std::string_view, std::function<void ()>)] net thread exit\n2025-08-09T12:33:36Z [util/thread.cpp:22] [void util::TraceThread(std::string_view, std::function<void ()>)] msghand thread exit\n2025-08-09T12:33:36Z [logging/timer.h:56] [void BCLog::Timer<std::chrono::duration<long long>>::Log(const std::string &) [TimeType = std::chrono::duration<long long>]] DumpAnchors: Flush 0 outbound block-relay-only peer addresses to anchors.dat started\n2025-08-09T12:33:36Z [logging/timer.h:56] [void BCLog::Timer<std::chrono::duration<long long>>::Log(const std::string &) [TimeType = std::chrono::duration<long long>]] DumpAnchors: Flush 0 outbound block-relay-only peer addresses to anchors.dat completed (0.00s)\n2025-08-09T12:33:36Z [util/thread.cpp:22] [void util::TraceThread(std::string_view, std::function<void ()>)] scheduler thread exit\n2025-08-09T12:33:36Z [node/mempool_persist.cpp:195] [bool node::DumpMempool(const CTxMemPool &, const fs::path &, FopenFn, bool)] Writing 0 mempool transactions to file...\n2025-08-09T12:33:36Z [node/mempool_persist.cpp:205] [bool node::DumpMempool(const CTxMemPool &, const fs::path &, FopenFn, bool)] Writing 0 unbroadcast transactions to file.\n2025-08-09T12:33:36Z [node/mempool_persist.cpp:224] [bool node::DumpMempool(const CTxMemPool &, const fs::path &, FopenFn, bool)] Dumped mempool: 0.000s to copy, 0.001s to dump, 27 bytes dumped to file\n2025-08-09T12:33:36Z [policy/fees.cpp:974] [void CBlockPolicyEstimator::FlushFeeEstimates()] Flushed fee estimates to fee_estimates.dat.\n2025-08-09T12:33:36Z [init.cpp:398] [void Shutdown(NodeContext &)] Shutdown done\n```\n\nThere is not much difference compared with a run on Ubuntu, except that the line `[validation.cpp:5173] [void ChainstateManager::LoadExternalBlockFile(AutoFile &, FlatFilePos *, std::multimap<uint256, FlatFilePos> *)] blkdat.size()=20777208` appears only once in the log.",
          "created_at": "2025-08-09T11:45:36Z"
        },
        {
          "user": "luke-jr",
          "body": "The root issue here appears to be that `CompleteChainstateInitialization` calls `LoadGenesisBlock` before the chainstate is detected as corrupt, which then clobbers blk00000.dat via `AllocateFileRange` as it (re-)writes the unindexed genesis block to disk.",
          "created_at": "2025-08-20T00:22:22Z"
        },
        {
          "user": "maflcko",
          "body": "Diff to reproduce on Linux:\n\n\n```diff\ndiff --git a/src/util/fs_helpers.cpp b/src/util/fs_helpers.cpp\nindex be7f1ee5a2..ada3280dbc 100644\n--- a/src/util/fs_helpers.cpp\n+++ b/src/util/fs_helpers.cpp\n@@ -200,7 +200,7 @@ void AllocateFileRange(FILE* file, unsigned int offset, unsigned int length)\n     }\n     ftruncate(fileno(file), static_cast<off_t>(offset) + length);\n #else\n-#if defined(HAVE_POSIX_FALLOCATE)\n+#if 0\n     // Version using posix_fallocate\n     off_t nEndPos = (off_t)offset + length;\n     if (0 == posix_fallocate(fileno(file), 0, nEndPos)) return;\n```\n\nThen, `./bld-cmake/test/functional/feature_reindex_init.py` gives `AssertionError: not(0 == 200)`",
          "created_at": "2025-08-20T12:34:42Z"
        },
        {
          "user": "hebasto",
          "body": "It seems FreeBSD 15.0 is also [affected](https://github.com/hebasto/bitcoin-core-nightly/actions/runs/20347897719/job/58464788242).\n\ncc @vasild ",
          "created_at": "2025-12-18T20:20:49Z"
        },
        {
          "user": "vasild",
          "body": "> FreeBSD 15.0\n\nAlso FreeBSD 14.x ",
          "created_at": "2025-12-19T12:54:16Z"
        }
      ]
    },
    {
      "number": 33123,
      "title": ".",
      "body": ".",
      "state": "closed",
      "user": "byLAEV",
      "created_at": "2025-08-02T00:53:47Z",
      "updated_at": "2025-08-02T00:57:30Z",
      "comments": 0,
      "url": "https://github.com/bitcoin/bitcoin/issues/33123",
      "labels": []
    }
  ],
  "summary": {
    "pull_requests": 4,
    "issues": 2
  }
}