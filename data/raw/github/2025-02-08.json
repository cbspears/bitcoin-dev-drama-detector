{
  "source": "github",
  "repository": "bitcoin/bitcoin",
  "fetched_at": "2026-01-15T19:16:46.042759+00:00",
  "date": "2025-02-08",
  "pull_requests": [
    {
      "number": 31826,
      "title": "random: Check `GetRNDRRS` is supported in `InitHardwareRand` to avoid infinite loop",
      "body": "This PR want to fix #31817 by added a maximum retry limit (`max_retries`) to the `GetRNDRRS` function to prevent it from entering an infinite loop if the hardware random number generator fails to return a valid random number. This change improves stability and ensures that the function terminates after a predefined number of retries.\n",
      "state": "closed",
      "user": "eval-exec",
      "created_at": "2025-02-08T10:17:10Z",
      "updated_at": "2025-02-19T15:25:00Z",
      "comments": 11,
      "url": "https://github.com/bitcoin/bitcoin/pull/31826",
      "labels": [
        "Bug"
      ],
      "comment_list": [
        {
          "user": "DrahtBot",
          "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/31826.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| ACK | [sipa](https://github.com/bitcoin/bitcoin/pull/31826#pullrequestreview-2621167189), [achow101](https://github.com/bitcoin/bitcoin/pull/31826#issuecomment-2667347029) |\n| Stale ACK | [laanwj](https://github.com/bitcoin/bitcoin/pull/31826#issuecomment-2651183942), [theuni](https://github.com/bitcoin/bitcoin/pull/31826#pullrequestreview-2615930348) |\n\nIf your review is incorrectly listed, please react with ðŸ‘Ž to this comment and the bot will ignore it on the next update.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#29641](https://github.com/bitcoin/bitcoin/pull/29641) (scripted-diff: Use LogInfo over LogPrintf [WIP, NOMERGE, DRAFT] by maflcko)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n",
          "created_at": "2025-02-08T10:17:13Z"
        },
        {
          "user": "eval-exec",
          "body": "> To me this seems like a problem where a system claims to support a feature, but doesn't?\r\n\r\nI read the `RNDRRS`'s [documentation](https://developer.arm.com/documentation/ddi0601/2024-12/AArch64-Registers/RNDRRS--Random-Number-Full-Entropy), We have checked if bitcoin support this feature by:`g_rndr_supported`:\r\n```cpp\r\n#elif defined(__aarch64__) && defined(HWCAP2_RNG)\r\n\r\nbool g_rndr_supported = false;\r\n\r\nvoid InitHardwareRand()\r\n{\r\n    if (getauxval(AT_HWCAP2) & HWCAP2_RNG) {\r\n        g_rndr_supported = true;\r\n    }\r\n}\r\n```\r\n\r\n\r\n> it would be better to instead investigate and fix the feature test or feature reporting.\r\n\r\nAgree, it need time to invistigate this bug.\r\n\r\nAnd I did some research, this CPU have bug on `rndrrs`:\r\n> [04:28](https://oftc.irclog.whitequark.org/aarch64-laptops/2024-07-21#33392883) <HdkR> I found out yesterday that the bitcoin project uses rndrrs if it is available on aarch64 to fill its entropy pool. It spins in a loop until its pool is filled.\r\n> [04:28](https://oftc.irclog.whitequark.org/aarch64-laptops/2024-07-21#33392885) <HdkR> This means on Oryon it will hang at startup because of the bugged rndrrs :D\r\n\r\nRef: \r\n1. https://oftc.irclog.whitequark.org/aarch64-laptops/2024-07-21#1721536104-1721536124;\r\n2. https://oftc.irclog.whitequark.org/aarch64-laptops/2024-06-18#33280488;\r\n",
          "created_at": "2025-02-09T02:35:35Z"
        },
        {
          "user": "DrahtBot",
          "body": "<!--85328a0da195eb286784d51f73fa0af9-->\nðŸš§ At least one of the CI tasks failed.\n<sub>Debug: https://github.com/bitcoin/bitcoin/runs/36907425995</sub>\n\n<details><summary>Hints</summary>\n\nTry to run the tests locally, according to the documentation. However, a CI failure may still\nhappen due to a number of reasons, for example:\n\n* Possibly due to a silent merge conflict (the changes in this pull request being\nincompatible with the current code in the target branch). If so, make sure to rebase on the latest\ncommit of the target branch.\n\n* A sanitizer issue, which can only be found by compiling with the sanitizer and running the\n  affected test.\n\n* An intermittent issue.\n\nLeave a comment here, if you need help tracking down a confusing failure.\n\n</details>\n",
          "created_at": "2025-02-09T03:23:20Z"
        },
        {
          "user": "laanwj",
          "body": "Concept ACK.\r\n\r\nPlease update the PR title to reflect the new set of changes.",
          "created_at": "2025-02-11T08:23:31Z"
        },
        {
          "user": "sipa",
          "body": "Code review ACK 585aba6eec858e5b1411ae9a8684ef8f82a7e435. I have not tested this.",
          "created_at": "2025-02-11T15:30:46Z"
        },
        {
          "user": "laanwj",
          "body": "re-ACK 585aba6eec858e5b1411ae9a8684ef8f82a7e435\r\n\r\ni could test it on amazon graviton again like i did the original PR, but only the good-weather case, that won't reproduce the edge case that led to this.\r\n\r\nWould be good if @giahuy98 (who opened #31817) could test it on the specific target hardware.",
          "created_at": "2025-02-11T15:34:30Z"
        },
        {
          "user": "giahuy98",
          "body": "> re-ACK [585aba6](https://github.com/bitcoin/bitcoin/commit/585aba6eec858e5b1411ae9a8684ef8f82a7e435)\r\n> \r\n> i could test it on amazon graviton again like i did the original PR, but only the good-weather case, that won't reproduce the edge case that led to this.\r\n> \r\n> Would be good if @giahuy98 (who opened #31817) could test it on the specific target hardware.\r\n\r\nI tested [585aba6](https://github.com/bitcoin/bitcoin/commit/585aba6eec858e5b1411ae9a8684ef8f82a7e435) on a Samsung Galaxy S25, and it works. Thanks.\r\n\r\n",
          "created_at": "2025-02-12T07:00:07Z"
        },
        {
          "user": "laanwj",
          "body": "Checked on amazon r7g.xlarge (Graviton 3):\r\n```\r\n2025-02-12T10:07:35Z Bitcoin Core version v28.99.0-585aba6eec85 (release build)\r\n2025-02-12T10:07:35Z Using the 'arm_shani(1way,2way)' SHA256 implementation\r\n2025-02-12T10:07:35Z Using RNDR and RNDRRS as additional entropy sources\r\n```\r\nAlso verified that both `GetRNDR` and `GetRNDRRS` are still being called.\r\n\r\nAs baseline i also built and tested on rpi5 (ARM64 which has no support for RNG). It is still correctly not detected, no invalid instruction errors happen.\r\n\r\nCombined with the report above that the workaround works, this should be safe to merge in 29.0 and maybe even backported to 28.x.",
          "created_at": "2025-02-12T10:48:31Z"
        },
        {
          "user": "laanwj",
          "body": "> It's unclear to me under what scenario the call might fail\r\n\r\nThe [ARM documentation](https://developer.arm.com/documentation/107997/0000/AArch64-registers/AArch64-Generic-System-Control-registers-summary/RNDRRS--Reseeded-Random-Number) isn't very specific on that:\r\n\r\n> If the hardware returns a genuine random number, PSTATE.NZCV is set to 0b0000.\r\n>\r\n> If the instruction cannot return a genuine random number in a reasonable period of time, PSTATE.NZCV is set to 0b0100 and the data value returned is 0.\r\n\r\ni imagine there's some internal conditions under which the RNG module can't deliver a value quickly enough. What can be concluded is that `!ok` is a temporary failure, for chips working according to spec. So the normal usage (as we have before this PR, and in OpenSSL and such) is to keep trying forever. This simplifies the code paths, so that callers don't have to handle a \"randomness failed\" case.\r\n\r\nThe broken chips *always* return `!ok` for RNDRRS, the reason for retrying 10 times in the detection loop is to prevent false positives. That is, a working one might fail temporarily, but not for (say) 10 consecutive timeshares, so it won't be detected as broken.\r\n\r\n> gcc (since v10) and clang (since v13) have intrinsics for __rndr and __rndrrs that would imo be preferable.\r\n\r\nYes. But that's imo out of scope for this workaround PR.",
          "created_at": "2025-02-13T22:08:25Z"
        },
        {
          "user": "theuni",
          "body": "> > gcc (since v10) and clang (since v13) have intrinsics for __rndr and __rndrrs that would imo be preferable.\r\n> \r\n> Yes. But that's imo out of scope for this workaround PR.\r\n\r\nFor sure out of scope, yes, I didn't mean to imply that should be done here.",
          "created_at": "2025-02-14T20:46:23Z"
        },
        {
          "user": "achow101",
          "body": "ACK 09b150bb8adae00854f02ece69fc6ef222fb07d9",
          "created_at": "2025-02-19T02:15:08Z"
        }
      ]
    },
    {
      "number": 31825,
      "title": ".",
      "body": "<!--\r\n*** Please remove the following help text before submitting: ***\r\n\r\nPull requests without a rationale and clear improvement may be closed\r\nimmediately.\r\n\r\nGUI-related pull requests should be opened against\r\nhttps://github.com/bitcoin-core/gui\r\nfirst. See CONTRIBUTING.md\r\n-->\r\n\r\n<!--\r\nPlease provide clear motivation for your patch and explain how it improves\r\nBitcoin Core user experience or Bitcoin Core developer experience\r\nsignificantly:\r\n\r\n* Any test improvements or new tests that improve coverage are always welcome.\r\n* All other changes should have accompanying unit tests (see `src/test/`) or\r\n  functional tests (see `test/`). Contributors should note which tests cover\r\n  modified code. If no tests exist for a region of modified code, new tests\r\n  should accompany the change.\r\n* Bug fixes are most welcome when they come with steps to reproduce or an\r\n  explanation of the potential issue as well as reasoning for the way the bug\r\n  was fixed.\r\n* Features are welcome, but might be rejected due to design or scope issues.\r\n  If a feature is based on a lot of dependencies, contributors should first\r\n  consider building the system outside of Bitcoin Core, if possible.\r\n* Refactoring changes are only accepted if they are required for a feature or\r\n  bug fix or otherwise improve developer experience significantly. For example,\r\n  most \"code style\" refactoring changes require a thorough explanation why they\r\n  are useful, what downsides they have and why they *significantly* improve\r\n  developer experience or avoid serious programming bugs. Note that code style\r\n  is often a subjective matter. Unless they are explicitly mentioned to be\r\n  preferred in the [developer notes](/doc/developer-notes.md), stylistic code\r\n  changes are usually rejected.\r\n-->\r\n\r\n<!--\r\nBitcoin Core has a thorough review process and even the most trivial change\r\nneeds to pass a lot of eyes and requires non-zero or even substantial time\r\neffort to review. There is a huge lack of active reviewers on the project, so\r\npatches often sit for a long time.\r\n-->\r\n",
      "state": "closed",
      "user": "bhandariarun",
      "created_at": "2025-02-08T09:08:18Z",
      "updated_at": "2025-02-08T09:09:07Z",
      "comments": 1,
      "url": "https://github.com/bitcoin/bitcoin/pull/31825",
      "labels": [],
      "comment_list": [
        {
          "user": "DrahtBot",
          "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/31825.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\nA summary of reviews will appear here.\n",
          "created_at": "2025-02-08T09:08:22Z"
        }
      ]
    }
  ],
  "issues": [
    {
      "number": 31827,
      "title": "Rename bitcoin-wallet?",
      "body": "Some chatter from IRC:\n\n```\n17:21:41 < darosior> It might be confusing to release both a bitcoin-wallet utility and a bitcoin-wallet binary as part of multiprocess?\n17:24:08 < darosior> We could rename the utility, but then it would be nice to at least have one deprecation cycle. Given recent momentum i estimate it's possible we might release multiprocess in \n                     30.0, which means if we want to deprecate the bitcoin-wallet utility name we should do it.. now?\n17:33:31 < sipa> bitcoin-wallet-util ?\n...\n23:38:57 < _aj_> darosior: bitcoin-wallet-process, bitcoin-gui-process, etc? it's multi *-process!\n03:04:34 < Sjors[m]> darosior: at the moment there is no wallet binary if were to enable multiprocess. That won't happen until #19460.\n...\n03:05:18 < Sjors[m]> Or maybe already in #10102\n...\n03:05:50 < Sjors[m]> In any case #31802 only adds bitcoin-node and bitcoin-gui.\n...\n03:07:19 < Sjors[m]> Though if we want to rename the utility eventually, it's always better to do it early.\n```",
      "state": "closed",
      "user": "Sjors",
      "created_at": "2025-02-08T10:58:05Z",
      "updated_at": "2025-02-21T13:21:26Z",
      "comments": 4,
      "url": "https://github.com/bitcoin/bitcoin/issues/31827",
      "labels": [],
      "comment_list": [
        {
          "user": "ryanofsky",
          "body": "Thanks for opening this issue. The [multiprocess tracking issue](https://github.com/bitcoin/bitcoin/issues/28722) has a section called \"PRs for review related to building & releasing\" and if you look at two PRs there https://github.com/bitcoin/bitcoin/pull/31375 and https://github.com/bitcoin/bitcoin/pull/31679 they should clear these questions up if you want to see exactly what changes are planned and implemented.\n\nBut basically, there is no need to rename any current command line tools or break any existing command lines.\n\n[#31375](https://github.com/bitcoin/bitcoin/pull/31375) adds **one** new command line utiltity called `bitcoin`. It has `daemon` `gui` `rpc` and `wallet` subcommands that can be used to access different functions and accepts options (all disabled by default) controlling whether to enable or disable different IPC and multiprocess features.\n\n[#31679](https://github.com/bitcoin/bitcoin/pull/31679) moves new binaries out of bin/ into libexec/ where they will not be on the PATH, and there should be little need to call them directly, though calling them directly will still work.",
          "created_at": "2025-02-10T16:31:34Z"
        },
        {
          "user": "Sjors",
          "body": "Maybe to phrase it differently, it seems that the idea is to expand the current `bitcoin-wallet` to support IPC, as implemented in #19460. So there's no name clash. \n\ncc @sipa @ajtowns @darosior ",
          "created_at": "2025-02-10T16:43:12Z"
        },
        {
          "user": "ryanofsky",
          "body": "> Maybe to phrase it differently, it seems that the idea is to expand the current `bitcoin-wallet` to support IPC, as implemented in [#19460](https://github.com/bitcoin/bitcoin/pull/19460). So there's no name clash.\n\nI just think that's an implementation detail and there's no need to break the command line or rename binaries in any case.\n\nThere are two cases (1) wallet ipc features (like connecting to a node to perform some online operation, or starting an dedicated RPC server) are implemented in `bitcoin-wallet`, or (2) online wallet features using IPC are implemented in the some other executable in libexec/.\n\nIn either case, command line to access these features should be `bitcoin wallet FEATURE` and `bitcoin` should call the right executable.\n",
          "created_at": "2025-02-10T17:02:04Z"
        },
        {
          "user": "Sjors",
          "body": "It sounds like we've now documented that nothing needs to change, so closing this. ",
          "created_at": "2025-02-21T13:21:23Z"
        }
      ]
    }
  ],
  "summary": {
    "pull_requests": 2,
    "issues": 1
  }
}