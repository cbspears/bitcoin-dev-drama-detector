{
  "source": "github",
  "repository": "bitcoin/bitcoin",
  "fetched_at": "2026-01-15T20:16:22.327500+00:00",
  "date": "2025-09-20",
  "pull_requests": [
    {
      "number": 33446,
      "title": "rpc: fix getblock(header) returns target for tip",
      "body": "A `target` field was added to the `getblock` and `getblockheader` RPC calls in #31583, but it mistakingly always used the tip value.\r\n\r\nThis PR fixes it to return the target for the given block. Because regtest does not have difficulty adjustment, the mainnet test is expanded to cover the fix.\r\n\r\nA preliminary commit deals with mining block 2016 that's needed for the test. It also:\r\n- renames the `create_coinbase` `retarget_period` argument to `halving_period`. Before #31583 this was hardcoded for regtest where these values are the same.\r\n- drops unused `fees` argument from `mine` helper\r\n- expands the CPU miner instructions for generating the alternative mainnet chain\r\n\r\nFixes #33440",
      "state": "closed",
      "user": "Sjors",
      "created_at": "2025-09-20T16:52:50Z",
      "updated_at": "2025-09-24T15:37:01Z",
      "comments": 6,
      "url": "https://github.com/bitcoin/bitcoin/pull/33446",
      "labels": [
        "RPC/REST/ZMQ"
      ],
      "comment_list": [
        {
          "user": "DrahtBot",
          "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/33446.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| ACK | [luke-jr](https://github.com/bitcoin/bitcoin/pull/33446#pullrequestreview-3257204496), [sipa](https://github.com/bitcoin/bitcoin/pull/33446#issuecomment-3323745993), [TheCharlatan](https://github.com/bitcoin/bitcoin/pull/33446#pullrequestreview-3262639879), [ismaelsadeeq](https://github.com/bitcoin/bitcoin/pull/33446#pullrequestreview-3262538477) |\n\nIf your review is incorrectly listed, please react with ðŸ‘Ž to this comment and the bot will ignore it on the next update.\n<!--5faf32d7da4f0f540f40219e4f7537a3-->",
          "created_at": "2025-09-20T16:52:55Z"
        },
        {
          "user": "Sjors",
          "body": "This should probably be backported to v29 and v30. ",
          "created_at": "2025-09-20T16:56:24Z"
        },
        {
          "user": "Sjors",
          "body": "I split 88fb025c83c7aa84766a5385e6a797102dd94513 in two commits: one that adds the mock mainnet block and updates the docs, and one that's focussed on fixing the actual bug and adds test coverage for it (using this new block).",
          "created_at": "2025-09-20T19:38:02Z"
        },
        {
          "user": "sipa",
          "body": "utACK bf7996cbc3becf329d8b1cd2f1007fec9b3a3188",
          "created_at": "2025-09-23T12:12:12Z"
        },
        {
          "user": "fanquake",
          "body": "Backported to `30.x` in #33473.",
          "created_at": "2025-09-24T14:11:48Z"
        },
        {
          "user": "fanquake",
          "body": "Backported to `29.x` in #33474.",
          "created_at": "2025-09-24T14:41:57Z"
        }
      ]
    },
    {
      "number": 33445,
      "title": "ci: Update Clang in \"tidy\" job",
      "body": "This PR:\r\n\r\n1. Updates to [IWYU 0.25](https://github.com/include-what-you-use/include-what-you-use/releases/tag/0.25), which is compatible with Clang 21.\r\n\r\n2. Fixes new \"modernize-use-default-member-init\" warnings. The warning in `interpreter.cpp` is a [false positive](https://github.com/llvm/llvm-project/issues/160394), so it has been suppressed.",
      "state": "closed",
      "user": "hebasto",
      "created_at": "2025-09-20T16:13:30Z",
      "updated_at": "2025-11-04T11:22:57Z",
      "comments": 9,
      "url": "https://github.com/bitcoin/bitcoin/pull/33445",
      "labels": [
        "Tests"
      ],
      "comment_list": [
        {
          "user": "DrahtBot",
          "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/33445.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| ACK | [ryanofsky](https://github.com/bitcoin/bitcoin/pull/33445#pullrequestreview-3411868329), [maflcko](https://github.com/bitcoin/bitcoin/pull/33445#issuecomment-3484508481) |\n| Stale ACK | [vasild](https://github.com/bitcoin/bitcoin/pull/33445#pullrequestreview-3261242814) |\n\nIf your review is incorrectly listed, please react with ðŸ‘Ž to this comment and the bot will ignore it on the next update.\n<!--5faf32d7da4f0f540f40219e4f7537a3-->",
          "created_at": "2025-09-20T16:13:34Z"
        },
        {
          "user": "hebasto",
          "body": "@ryanofsky \r\n\r\nCould you please take a look at the following IPC-related warning:\r\n```\r\n/usr/include/kj/async-inl.h:404:12: warning: Out of bound access to memory preceding the region [clang-analyzer-security.ArrayBound]\r\n  404 |       ctor(*ptr, kj::mv(next), kj::fwd<Params>(params)...);\r\n      |            ^\r\n```",
          "created_at": "2025-09-20T16:17:20Z"
        },
        {
          "user": "hebasto",
          "body": "The feedback from @vasild has been addressed.",
          "created_at": "2025-09-23T12:50:05Z"
        },
        {
          "user": "hebasto",
          "body": "> re: [#33445 (comment)](https://github.com/bitcoin/bitcoin/pull/33445#issuecomment-3315082319)\r\n> \r\n> > Could you please take a look at the following IPC-related warning:\r\n> \r\n> Thanks, created [capnproto/capnproto#2417](https://github.com/capnproto/capnproto/pull/2417) to address it\r\n\r\nI've added a commit to temporarily silence this warning.",
          "created_at": "2025-09-23T17:49:37Z"
        },
        {
          "user": "hebasto",
          "body": "The [feedback](https://github.com/bitcoin/bitcoin/pull/33445#discussion_r2372684495) from @ryanofsky has been addressed.",
          "created_at": "2025-09-23T21:16:16Z"
        },
        {
          "user": "hebasto",
          "body": "Friendly ping @maflcko @fanquake :)",
          "created_at": "2025-10-06T11:29:31Z"
        },
        {
          "user": "hebasto",
          "body": "Rebased and addressed [feedback](https://github.com/bitcoin/bitcoin/pull/33445#discussion_r2469984562) from @fanquake.",
          "created_at": "2025-10-28T15:36:44Z"
        },
        {
          "user": "hebasto",
          "body": "@vasild @ryanofsky \r\n\r\nKindly asking you to refresh your ACKs after the comment [update](https://github.com/bitcoin/bitcoin/pull/33445#issuecomment-3457125965).",
          "created_at": "2025-11-03T15:30:15Z"
        },
        {
          "user": "maflcko",
          "body": "review ACK 5d784bebaff5e3acc0b5180ee51d9a16aec0e356 ðŸŽ’\r\n\r\n<details><summary>Show signature</summary>\r\n\r\nSignature:\r\n\r\n```\r\nuntrusted comment: signature from minisign secret key on empty file; verify via: minisign -Vm \"${path_to_any_empty_file}\" -P RWTRmVTMeKV5noAMqVlsMugDDCyyTSbA3Re5AkUrhvLVln0tSaFWglOw -x \"${path_to_this_whole_four_line_signature_blob}\"\r\nRUTRmVTMeKV5npGrKx1nqXCw5zeVHdtdYURB/KlyA/LMFgpNCs+SkW9a8N95d+U4AP1RJMi+krxU1A3Yux4bpwZNLvVBKy0wLgM=\r\ntrusted comment: review ACK 5d784bebaff5e3acc0b5180ee51d9a16aec0e356 ðŸŽ’\r\n/Flat3dfMtdVCyisqRmXnrrqdQxlTYjyYTH6+6P04ON5gkskBepJWaDELcnfysyR58QGN+HTU8o8hccPj1YtDg==\r\n```\r\n\r\n</details>\r\n",
          "created_at": "2025-11-04T08:20:50Z"
        }
      ]
    },
    {
      "number": 33444,
      "title": "rpc: Fix dumptxoutset rollback with competing forks",
      "body": "Fixes dumptxoutset rollback functionality when competing forks exist.\r\n\r\n**Problem:**\r\ndumptxoutset rollback fails when competing forks are present at the target height, even though it should work on the active chain regardless of forks.\r\n\r\n**Solution:**\r\nWhen competing forks exist, the current implementation's `InvalidateBlock` call causes a reorg to the competing fork instead of rolling back to the desired main chain block. \r\n\r\nThis PR fixes the issue by enhancing the `TemporaryRollback` class to:\r\n- Identify all competing fork blocks at heights above the target\r\n- Invalidate fork blocks first to prevent reorg during main chain invalidation\r\n- Then invalidate the main chain block for clean rollback\r\n- Restore all invalidated blocks in the destructor\r\n\r\n**Changes:**\r\n- Fix `TemporaryRollback` class in `src/rpc/blockchain.cpp` to handle competing forks\r\n- Add comprehensive functional test `rpc_dumptxoutset_forks.py` that verifies the fix\r\n- Update test to confirm `dumptxoutset` works correctly with competing forks present\r\n\r\n**Testing:**\r\nThe test creates competing forks and verifies that `dumptxoutset rollback` now works correctly, creating snapshots from the intended main chain block rather than failing or using the wrong chain.\r\n\r\nFixes #32817.",
      "state": "open",
      "user": "enirox001",
      "created_at": "2025-09-20T13:45:44Z",
      "updated_at": "2025-09-29T15:50:48Z",
      "comments": 7,
      "url": "https://github.com/bitcoin/bitcoin/pull/33444",
      "labels": [
        "RPC/REST/ZMQ"
      ],
      "comment_list": [
        {
          "user": "DrahtBot",
          "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/33444.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\nA summary of reviews will appear here.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#33477](https://github.com/bitcoin/bitcoin/pull/33477) (Rollback for dumptxoutset without invalidating blocks by fjahr)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n<!--5faf32d7da4f0f540f40219e4f7537a3-->",
          "created_at": "2025-09-20T13:45:49Z"
        },
        {
          "user": "enirox001",
          "body": "@fjahr @mzumsande Would appreciate your feedback on this implementation when you get a chance. Thanks!",
          "created_at": "2025-09-20T22:16:57Z"
        },
        {
          "user": "fjahr",
          "body": "This seems to implement the same logic that I used in #31117 but this turned out to be too fragile to be seriously considered for merging there. In this context it may work well enough for mainnet because there are not a lot of forks but we have been discussing an alternative approach for a while that does not rely on `invalidateblock`/`reconsiderblock` and this would solve the competing forks problem as well. I have worked on this idea for #31117 primarily but I will open a PR with that approach for `dumptxoutset` so it can be evaluated side-by-side since I am not sure which one is better yet.\r\n\r\nAlso, it seems like the test you added is failing.",
          "created_at": "2025-09-24T17:04:08Z"
        },
        {
          "user": "enirox001",
          "body": "Thanks for the review and context @fjahr . I wasn't aware of that prior work.\r\n\r\nYou're right that this approach has some fragility concerns. I'd be very interested to see your alternative approach that avoids invalidateblock/reconsiderblock altogether, as that does sound more robust.\r\n\r\nRegarding the test failure - let me investigate and fix that. Would you prefer I:\r\n1. Fix the test and keep this PR open for comparison with your upcoming alternative approach, or  \r\n2. Close this PR and wait for your alternative solution?\r\n\r\nI'm happy to help review/test your approach when it's ready, and I appreciate you taking the time to work on a cleaner solution to this issue.",
          "created_at": "2025-09-24T17:47:13Z"
        },
        {
          "user": "fjahr",
          "body": "> Regarding the test failure - let me investigate and fix that. Would you prefer I:\r\n\r\nI have opened #33477 now, as you can see there I am describing that there are some trade-offs between the approach and master which this PR would then be applied to. Let's see what reviewers think about those trade-offs. You should keep it open and ideally fix the test. If the CI is failing that usually signals to reviewers that the PR isn't ready for consideration since the code will need to change anyway. So reviewers might hold off from taking a look at the code.",
          "created_at": "2025-09-24T21:20:15Z"
        },
        {
          "user": "ajtowns",
          "body": "> dumptxoutset rollback fails when competing forks are present at the target height, even though it should work on the active chain regardless of forks.\r\n\r\nCouldn't this just be a contrib script or client-side bitcoin-cli feature? ie:\r\n\r\n```\r\n$ bitcoin-cli -invalidateto=00000000000000000001f3222fa4ad883d2d211443a77ecdec05604f4e253a02\r\n```\r\n\r\nwhich first looks up that block hash's height N, then iterates through each chain tip whose height is at least N, getting that tip's ancestor at height N+1 (optimise this using the `branchlen` field from getchaintips since there's no direct way to lookup a deep ancestor), B; if `B->pprev` is the target block, it invalidates B, otherwise it invalidates `B->pprev`. Make `-invalidateto=0` call `reconsiderblock` on the genesis block to reset everything, perhaps.",
          "created_at": "2025-09-29T03:10:36Z"
        },
        {
          "user": "fjahr",
          "body": "> Couldn't this just be a contrib script or client-side bitcoin-cli feature?\r\n\r\nFWIW, the rollback part used to be a contrib script and I integrated it into `dumptxoutset` for better robustness and easier testing in #29553. But the idea of implementing it client-side in bitcoin-cli was never discussed as far as I can remember.",
          "created_at": "2025-09-29T15:50:48Z"
        }
      ]
    },
    {
      "number": 33443,
      "title": "log: reduce excessive \"rolling back/forward\" messages during block replay",
      "body": "### Summary\r\nAfter an incomplete reindex the blocks will need to be replayed.\r\nThis results in excessive `Rolling back` and `Rolling forward` messages which quickly triggers the recently introduced log rate limiter.\r\n\r\nChange the logging strategy to:\r\n- Add single `LogInfo` messages showing the full range being replayed for both rollback and roll forward;\r\n- Log progress at `LogInfo` level only every 10,000 blocks to track the long operations.\r\n\r\n### Reproducer:\r\n* Start a normal ibd, stop after some progress\r\n* Do a reindex, stop before it finishes\r\n* Restart the node normally without specifying the reindex parameter\r\nIt should start rolling the blocks forward.\r\n\r\nBefore this change the excessive logging would show:\r\n```\r\n[*] Rolling forward 000000002f4f55aecfccc911076dc3f73ac0288c83dc1d79db0a026441031d40 (46245)\r\n[*] Rolling forward 0000000017ffcf34c8eac010c529670ba6745ea59cf1edf7b820928e3b40acf6 (46246)\r\n```\r\n\r\nAfter the change it shows:\r\n```\r\nReplaying blocks\r\nRolling forward to 00000000000000001034012d7e4facaf16ca747ea94b8ea66743086cfe298ef8 (326223 to 340991)\r\nRolling forward 00000000000000000faabab19f17c0178c754dbed023e6c871dcaf74159c5f02 (330000)\r\nRolling forward 00000000000000000d9b2508615d569e18f00c034d71474fc44a43af8d4a5003 (340000)\r\n...\r\nRolled forward to 00000000000000001034012d7e4facaf16ca747ea94b8ea66743086cfe298ef8\r\n```\r\n(similarly to rolling back)",
      "state": "closed",
      "user": "l0rinc",
      "created_at": "2025-09-20T05:56:12Z",
      "updated_at": "2025-11-10T17:17:35Z",
      "comments": 5,
      "url": "https://github.com/bitcoin/bitcoin/pull/33443",
      "labels": [
        "Utils/log/libs"
      ],
      "comment_list": [
        {
          "user": "DrahtBot",
          "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/33443.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| ACK | [vasild](https://github.com/bitcoin/bitcoin/pull/33443#pullrequestreview-3266970216), [Crypt-iQ](https://github.com/bitcoin/bitcoin/pull/33443#issuecomment-3334611538), [stickies-v](https://github.com/bitcoin/bitcoin/pull/33443#pullrequestreview-3415849302) |\n| Concept ACK | [hodlinator](https://github.com/bitcoin/bitcoin/pull/33443#pullrequestreview-3411788483) |\n\nIf your review is incorrectly listed, please react with ðŸ‘Ž to this comment and the bot will ignore it on the next update.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nNo conflicts as of last run.\n<!--5faf32d7da4f0f540f40219e4f7537a3-->\n### LLM Linter (âœ¨ experimental)\n\nPossible typos and grammar issues:\n\n- block-to-be-disconnect -> block-to-be-disconnected [past participle needed for \"the block to be disconnected\" so the sentence is grammatically correct]\n\n<sup>drahtbot_id_5_m</sup>\n",
          "created_at": "2025-09-20T05:56:18Z"
        },
        {
          "user": "ajtowns",
          "body": "Should call this `LogEssential()` or similar, rather than calling internal logging functions. cf https://github.com/ajtowns/bitcoin/commits/202509-logessential/\r\n\r\nIs this information actually very useful though, or is it only relevant for debugging? There's already the `Replaying blocks...` notification which should show progress. Would something like this make more sense?\r\n\r\n```c++\r\n     // Roll forward from the forking point to the new tip.\r\n     int nForkHeight = pindexFork ? pindexFork->nHeight : 0;\r\n+    LogInfo(\"Rolling forward to %s (%i to %i)\\n\", pindexNew->GetBlockHash().ToString(), nForkHeight, pindexNew->nHeight);\r\n     for (int nHeight = nForkHeight + 1; nHeight <= pindexNew->nHeight; ++nHeight) {\r\n         const CBlockIndex& pindex{*Assert(pindexNew->GetAncestor(nHeight))};\r\n\r\n-        LogEssential(\"Rolling forward %s (%i)\", pindex.GetBlockHash().ToString(), nHeight);\r\n+        LogDebug(BCLog::VALIDATION, \"Rolling forward %s (%i)\", pindex.GetBlockHash().ToString(), nHeight);\r\n         m_chainman.GetNotifications().progress(_(\"Replaying blocksâ€¦\"), (int)((nHeight - nForkHeight) * 100.0 / (pindexNew->nHeight - nForkHeight)), false);\r\n         if (!RollforwardBlock(&pindex, cache)) return false;\r\n     }\r\n```\r\n\r\n",
          "created_at": "2025-09-21T07:42:48Z"
        },
        {
          "user": "l0rinc",
          "body": "I don't think this info is essential (though I like your proposed solution in case it is).\r\nIt's extremely spammy currently (my guess is that the logging is more costly than the operation itself).\r\nAlternatively, we could show percentages only (as mentioned in the PR description), since we know how much work we need to do in advance.\r\nI will push a proposal for that as well.\r\n\r\nEdit: added the changes that @ajtowns proposed, I also favor removing the excessive logging instead of removing rate limiting. Reviewers are welcome to opine on whether showing any progress during the rolling forward is welcome (since it can take hours to do this in the worst case).",
          "created_at": "2025-09-21T14:49:25Z"
        },
        {
          "user": "Crypt-iQ",
          "body": "crACK 1fc7a81f1f5f30ba3ebe305ac2a520c7b4afb596",
          "created_at": "2025-09-25T14:59:42Z"
        },
        {
          "user": "stickies-v",
          "body": "Approach ACK 1fc7a81f1f5f30ba3ebe305ac2a520c7b4afb596\r\n\r\nExcept for progress indication I don't see the need to unconditionally log roll{back,forward} operations, so I strongly prefer the approach of this PR of logging it every n iterations instead of adding another non-ratelimited unconditional site.",
          "created_at": "2025-11-03T15:19:40Z"
        },
        {
          "user": "achow101",
          "body": "ACK 1fc7a81f1f5f30ba3ebe305ac2a520c7b4afb596",
          "created_at": "2025-11-10T16:10:27Z"
        }
      ]
    },
    {
      "number": 33442,
      "title": "validation: make the \"rolling forward\" loop interruptible",
      "body": "### Summary\r\n\r\nRestarting an unsuccessful reindex can result in replay of previously indexed blocks. This process can take many hours and is currently not interruptible.\r\n\r\n### Reproducer:\r\n* start a normal ibd, stop after some progress\r\n* do a reindex, stop before it finishes\r\n* restart the node normally without specifying the reindex parameter It should start rolling the blocks forward.\r\n\r\nAfter this change you should be able to interrupt the process:\r\n```\r\n2025-09-20T05:35:42Z Rolling forward 000000002f4f55aecfccc911076dc3f73ac0288c83dc1d79db0a026441031d40 (46245)\r\n2025-09-20T05:35:42Z Rolling forward 0000000017ffcf34c8eac010c529670ba6745ea59cf1edf7b820928e3b40acf6 (46246)\r\n^C2025-09-20T05:35:42Z Rolling forward 000000002857934511131e0800ac1dcbe3ae7873b715a9528747f29ae090b0d4 (46247)\r\n2025-09-20T05:35:42Z [error] Unable to replay blocks. You will need to rebuild the database using -reindex-chainstate.\r\nError: Unable to replay blocks. You will need to rebuild the database using -reindex-chainstate.\r\n2025-09-20T05:35:42Z Shutdown in progress...\r\n2025-09-20T05:35:42Z scheduler thread exit\r\n2025-09-20T05:35:42Z Shutdown done\r\n```\r\n",
      "state": "closed",
      "user": "l0rinc",
      "created_at": "2025-09-20T05:41:24Z",
      "updated_at": "2025-09-20T06:09:29Z",
      "comments": 2,
      "url": "https://github.com/bitcoin/bitcoin/pull/33442",
      "labels": [
        "Validation"
      ],
      "comment_list": [
        {
          "user": "DrahtBot",
          "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/33442.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\nA summary of reviews will appear here.\n<!--5faf32d7da4f0f540f40219e4f7537a3-->",
          "created_at": "2025-09-20T05:41:28Z"
        },
        {
          "user": "l0rinc",
          "body": "Closing in favor of https://github.com/bitcoin/bitcoin/pull/30155",
          "created_at": "2025-09-20T06:09:29Z"
        }
      ]
    }
  ],
  "issues": [
    {
      "number": 33441,
      "title": ".",
      "body": ".",
      "state": "closed",
      "user": "Johnpapandreou21",
      "created_at": "2025-09-20T05:17:05Z",
      "updated_at": "2025-09-21T08:15:27Z",
      "comments": 0,
      "url": "https://github.com/bitcoin/bitcoin/issues/33441",
      "labels": []
    },
    {
      "number": 33440,
      "title": "RPC: getblock(header) returns the same target for every block",
      "body": "### Is there an existing issue for this?\n\n- [x] I have searched the existing issues\n\n### Current behaviour\n\nRun `getblock` or `getblockheader` for block 1 and you get the same \"target\" reported as for block 900000\n\n### Expected behaviour\n\nI would expect the target to be different for different blocks\n\n### Steps to reproduce\n\nRun `getblock` or `getblockheader` for block 1 and you get the same \"target\" reported as for block 900000\n\n### Relevant log output\n\n_No response_\n\n### How did you obtain Bitcoin Core\n\nCompiled from source\n\n### What version of Bitcoin Core are you using?\n\nv29.0\n\n### Operating system and version\n\nDebian Linux\n\n### Machine specifications\n\n_No response_",
      "state": "closed",
      "user": "gmart7t2",
      "created_at": "2025-09-20T00:29:24Z",
      "updated_at": "2025-09-24T14:08:14Z",
      "comments": 10,
      "url": "https://github.com/bitcoin/bitcoin/issues/33440",
      "labels": [],
      "comment_list": [
        {
          "user": "pinheadmz",
          "body": "Hm yeah...\n\n```\npi@zippi:~ $ bitcoin-cli getblockheader `bitcoin-cli getblockhash 1` | jq .target\n\"00000000000000000001fa380000000000000000000000000000000000000000\"\npi@zippi:~ $ bitcoin-cli getblockheader `bitcoin-cli getblockhash 100` | jq .target\n\"00000000000000000001fa380000000000000000000000000000000000000000\"\npi@zippi:~ $ bitcoin-cli getblockheader `bitcoin-cli getblockhash 200000` | jq .target\n\"00000000000000000001fa380000000000000000000000000000000000000000\"\npi@zippi:~ $ bitcoin-cli getblockheader `bitcoin-cli getblockhash 900000` | jq .target\n\"00000000000000000001fa380000000000000000000000000000000000000000\"\n```",
          "created_at": "2025-09-20T00:40:31Z"
        },
        {
          "user": "pinheadmz",
          "body": "I believe it's always showing the current difficulty target for the next block",
          "created_at": "2025-09-20T00:43:09Z"
        },
        {
          "user": "pinheadmz",
          "body": "https://github.com/bitcoin/bitcoin/blob/11d80d4187afaa101de989330fa1982cd019cfa8/src/rpc/blockchain.cpp#L149-L177",
          "created_at": "2025-09-20T00:44:29Z"
        },
        {
          "user": "gmart7t2",
          "body": "Yes. It's the same as reported by `getblockchaininfo`:\n\n```\n$ bitcoin-cli getblockchaininfo | jq .target\n\"00000000000000000001fa380000000000000000000000000000000000000000\"\n```",
          "created_at": "2025-09-20T01:15:49Z"
        },
        {
          "user": "pinheadmz",
          "body": "This is expected, see https://github.com/bitcoin/bitcoin/pull/31583 and https://github.com/bitcoin/bitcoin/blob/master/doc/release-notes/release-notes-29.0.md#updated-rpcs\n\n>  getblock and getblockheader now return the current target in the target field (#31583)\n",
          "created_at": "2025-09-20T01:36:29Z"
        },
        {
          "user": "gmart7t2",
          "body": "That looks like a release note error to me. Why would we want to know the current target when looking up information about an old block?\n\nThe help text for the RPC calls says that it returns the difficulty target and difficulty of blockheader `<hash>`:\n\n![Image](https://github.com/user-attachments/assets/aadf1ad7-8d77-42c6-adc6-88708c79e438)\n\nIt makes no sense to return the target for a different block's difficulty. It means that the block header information returned for old blocks changes over time as the current difficulty changes.",
          "created_at": "2025-09-20T04:25:18Z"
        },
        {
          "user": "gmart7t2",
          "body": "This tiny change changes both RPCs to return the target for the block of interest rather than the current target:\n\n```\ndiff --git a/src/rpc/blockchain.cpp b/src/rpc/blockchain.cpp\nindex 8cbca51ccb..edda17d369 100644\n--- a/src/rpc/blockchain.cpp\n+++ b/src/rpc/blockchain.cpp\n@@ -164,7 +164,7 @@ UniValue blockheaderToJSON(const CBlockIndex& tip, const CBlockIndex& blockindex\n     result.pushKV(\"mediantime\", blockindex.GetMedianTimePast());\n     result.pushKV(\"nonce\", blockindex.nNonce);\n     result.pushKV(\"bits\", strprintf(\"%08x\", blockindex.nBits));\n-    result.pushKV(\"target\", GetTarget(tip, pow_limit).GetHex());\n+    result.pushKV(\"target\", GetTarget(blockindex, pow_limit).GetHex());\n     result.pushKV(\"difficulty\", GetDifficulty(blockindex));\n     result.pushKV(\"chainwork\", blockindex.nChainWork.GetHex());\n     result.pushKV(\"nTx\", blockindex.nTx);\n```",
          "created_at": "2025-09-20T04:38:48Z"
        },
        {
          "user": "pinheadmz",
          "body": "> Why would we want to know the current target when looking up information about an old block?\n\n@Sjors ",
          "created_at": "2025-09-20T10:24:26Z"
        },
        {
          "user": "Sjors",
          "body": "This is indeed a bug. The other commits in that PR use the tip, but that's incorrect for these two RPC methods. See https://github.com/bitcoin/bitcoin/pull/31583/commits/2a7bfebd5e788e1d9e7e07a9f1b8e3625a0301cd#r2365643082\n\nI'll PR a fix shortly, still working on adding test coverage.",
          "created_at": "2025-09-20T15:41:19Z"
        },
        {
          "user": "Sjors",
          "body": "#33446 fixes this",
          "created_at": "2025-09-20T16:53:45Z"
        }
      ]
    }
  ],
  "summary": {
    "pull_requests": 5,
    "issues": 2
  }
}