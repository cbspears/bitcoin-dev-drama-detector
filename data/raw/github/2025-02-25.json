{
  "source": "github",
  "repository": "bitcoin/bitcoin",
  "fetched_at": "2026-01-15T19:20:23.046412+00:00",
  "date": "2025-02-25",
  "pull_requests": [
    {
      "number": 31955,
      "title": "test: Fix authproxy named args debug logging",
      "body": "In Python the meaning of `args or argsn` is that `argsn` is fully ignored when `args` is a list with at least one element. However, the RPC server accepts mixed positional and named args in the same RPC.\r\n\r\nFix the debug log by always printing both. Also, add a new `_json_dumps` helper to avoid bloated code.\r\n\r\nCan be tested via `--tracerpc` on a call that uses named args mixed with positional args.",
      "state": "closed",
      "user": "maflcko",
      "created_at": "2025-02-25T21:46:30Z",
      "updated_at": "2025-03-12T16:56:39Z",
      "comments": 6,
      "url": "https://github.com/bitcoin/bitcoin/pull/31955",
      "labels": [
        "Tests"
      ],
      "comment_list": [
        {
          "user": "DrahtBot",
          "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/31955.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| ACK | [i-am-yuvi](https://github.com/bitcoin/bitcoin/pull/31955#pullrequestreview-2648856215), [rkrux](https://github.com/bitcoin/bitcoin/pull/31955#pullrequestreview-2654107325), [musaHaruna](https://github.com/bitcoin/bitcoin/pull/31955#pullrequestreview-2669050326), [ryanofsky](https://github.com/bitcoin/bitcoin/pull/31955#pullrequestreview-2672305067) |\n\nIf your review is incorrectly listed, please react with ðŸ‘Ž to this comment and the bot will ignore it on the next update.\n",
          "created_at": "2025-02-25T21:46:33Z"
        },
        {
          "user": "yuvicc",
          "body": "Approach ACK \r\n\r\nCorrect me if I misunderstood:\r\n\r\nIn Python, when a function accepts both positional(*args) and keyword(**argsn) arguments, for which args is handled as a tuple and argsn as dictionary where Python doesn't merge them automatically into a combined list.\r\n\r\n## The issue\r\nThe RPC server accepts a single call which includes both positional as well as keyword. That means if a caller provides both, the server expects to receive both types together. In that case, the original code(logging part) ignores the *argsn* when there were *args* present - hiding the fact that both kinds were sent. This leads to debugging ambiguity because the debug log might not show the complete set of parameters the RPC server receives.",
          "created_at": "2025-02-27T19:20:58Z"
        },
        {
          "user": "maflcko",
          "body": "@rkrux Not sure if I understand your question, but if you used `args or argsn` in your print: `print(args or argsn)`, then `argsn` is omitted from the print if the `args` list has at least one element. This should be true in general for all versions of Python that are supported. The changes in this pull request are fixing the problem, as explained in the pull request description.",
          "created_at": "2025-02-28T13:07:25Z"
        },
        {
          "user": "rkrux",
          "body": "Yes, correct, I agree. The PR description statement I highlighted in my comment led me to believe that `argsn` is ignored **_always in any function_** if `args` is a list with at least 1 element, which I found to be confusing to read and hence verified it with an example. The issue as I understand is with the usage of `args or argsn` as the first argument to the `json.dumps` function, which this PR correctly fixes.\r\n\r\nThe only concern is with the first statement in the PR description, which is too generic.\r\n\r\n> In Python the meaning of args or argsn is that argsn is fully ignored when args is a list with at least one element.",
          "created_at": "2025-02-28T13:19:05Z"
        },
        {
          "user": "maflcko",
          "body": "There may be a formatting issue. For me the pull description says (with code blocks):\r\n\r\n> In Python the meaning of `args or argsn` is that `argsn` is fully ignored when `args` is a list with at least one element.\r\n\r\nHowever, for you it seems to say:\r\n\r\n> In Python the meaning of args or argsn is that argsn is fully ignored when args is a list with at least one element.\r\n\r\nObviously, the two have different meaning (and the second doesn't really make sense). I am not sure how to fix this. What client are you using to access the description?",
          "created_at": "2025-02-28T13:27:01Z"
        },
        {
          "user": "rkrux",
          "body": "Oh interesting, I see where the confusion is. I do see the same description as you but I didn't read that particular part as a code expression instead read it as an English phrase (TFW Python does read like English), which made it sound too generic to me. Never mind.",
          "created_at": "2025-02-28T13:56:13Z"
        }
      ]
    },
    {
      "number": 31954,
      "title": "doc: update fuzz instructions when on macOS",
      "body": "Fixes: #31049 \r\n\r\nUpdates the instructions for fuzzing on macOS to use `lld` instead of `ld`.\r\n\r\nTested instructions on M1 Mac running 14.6.1\r\n",
      "state": "closed",
      "user": "m3dwards",
      "created_at": "2025-02-25T20:45:21Z",
      "updated_at": "2025-03-07T22:12:17Z",
      "comments": 6,
      "url": "https://github.com/bitcoin/bitcoin/pull/31954",
      "labels": [
        "Docs",
        "macOS"
      ],
      "comment_list": [
        {
          "user": "DrahtBot",
          "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/31954.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| ACK | [l0rinc](https://github.com/bitcoin/bitcoin/pull/31954#issuecomment-2697572586), [brunoerg](https://github.com/bitcoin/bitcoin/pull/31954#pullrequestreview-2658264313), [hebasto](https://github.com/bitcoin/bitcoin/pull/31954#pullrequestreview-2658499705) |\n| Concept ACK | [jonatack](https://github.com/bitcoin/bitcoin/pull/31954#issuecomment-2683479174) |\n| Stale ACK | [Prabhat1308](https://github.com/bitcoin/bitcoin/pull/31954#issuecomment-2686348268) |\n\nIf your review is incorrectly listed, please react with ðŸ‘Ž to this comment and the bot will ignore it on the next update.\n",
          "created_at": "2025-02-25T20:45:29Z"
        },
        {
          "user": "jonatack",
          "body": "Concept ACK",
          "created_at": "2025-02-25T22:57:35Z"
        },
        {
          "user": "Prabhat1308",
          "body": "Running the build after these configurations on MacOs 15.3.1 M4 Pro, the fuzz tests are running but I do get these warnings on almost every object being built . Is this expected ?\r\n\r\n```\r\n4 warnings generated.\r\n[ 12%] Linking CXX static library libbitcoin_cli.a\r\n4 warnings generated.\r\n[ 12%] Building CXX object src/test/fuzz/util/CMakeFiles/test_fuzz.dir/net.cpp.o\r\n[ 12%] Built target bitcoin_cli\r\n[ 12%] Building CXX object src/CMakeFiles/bitcoin_common.dir/base58.cpp.o\r\nclang++: warning: argument unused during compilation: '-fuse-ld=lld' [-Wunused-command-line-argument]\r\nclang++: warning: argument unused during compilation: '-fstack-clash-protection' [-Wunused-command-line-argument]\r\nwarning: unknown warning option '-Wduplicated-branches' [-Wunknown-warning-option]\r\nwarning: unknown warning option '-Wduplicated-cond' [-Wunknown-warning-option]\r\nwarning: unknown warning option '-Wlogical-op'; did you mean '-Wlong-long'? [-Wunknown-warning-option]\r\nwarning: unknown warning option '-Wbidi-chars=any' [-Wunknown-warning-option]\r\n4 warnings generated.\r\nclang++: warning: argument unused during compilation: '-fuse-ld=lld' [-Wunused-command-line-argument]\r\nclang++: warning: argument unused during compilation: '-fstack-clash-protection' [-Wunused-command-line-argument]\r\nwarning: unknown warning option '-Wduplicated-branches' [-Wunknown-warning-option]\r\nwarning: unknown warning option '-Wduplicated-cond' [-Wunknown-warning-option]\r\nwarning: unknown warning option '-Wlogical-op'; did you mean '-Wlong-long'? [-Wunknown-warning-option]\r\nwarning: unknown warning option '-Wbidi-chars=any' [-Wunknown-warning-option]\r\n[ 13%] Building CXX object src/CMakeFiles/bitcoin_consensus.dir/primitives/block.cpp.o\r\nclang++: warning: argument unused during compilation: '-fuse-ld=lld' [-Wunused-command-line-argument]\r\nclang++: warning: argument unused during compilation: '-fstack-clash-protection' [-Wunused-command-line-argument]\r\nwarning: unknown warning option '-Wduplicated-branches' [-Wunknown-warning-option]\r\nwarning: unknown warning option '-Wduplicated-cond' [-Wunknown-warning-option]\r\nwarning: unknown warning option '-Wlogical-op'; did you mean '-Wlong-long'? [-Wunknown-warning-option]\r\nwarning: unknown warning option '-Wbidi-chars=any' [-Wunknown-warning-option]\r\n4 warnings generated.\r\n[ 14%] Linking CXX static library libunivalue.a\r\n4 warnings generated.\r\n[ 14%] Building CXX object src/CMakeFiles/bitcoin_consensus.dir/primitives/transaction.cpp.o\r\nclang++: warning: argument unused during compilation: '-fuse-ld=lld' [-Wunused-command-line-argument]\r\nclang++: warning: argument unused during compilation: '-fstack-clash-protection' [-Wunused-command-line-argument]\r\nwarning: unknown warning option '-Wduplicated-branches' [-Wunknown-warning-option]\r\nwarning: unknown warning option '-Wduplicated-cond' [-Wunknown-warning-option]\r\nwarning: unknown warning option '-Wlogical-op'; did you mean '-Wlong-long'? [-Wunknown-warning-option]\r\nwarning: unknown warning option '-Wbidi-chars=any' [-Wunknown-warning-option]\r\n[ 14%] Built target univalue\r\n[ 14%] Building CXX object src/test/util/CMakeFiles/test_util.dir/setup_common.cpp.o\r\nclang++: warning: argument unused during compilation: '-fuse-ld=lld' [-Wunused-command-line-argument]\r\nclang++: warning: argument unused during compilation: '-fstack-clash-protection' [-Wunused-command-line-argument]\r\nwarning: unknown warning option '-Wduplicated-branches' [-Wunknown-warning-option]\r\nwarning: unknown warning option '-Wduplicated-cond' [-Wunknown-warning-option]\r\nwarning: unknown warning option '-Wlogical-op'; did you mean '-Wlong-long'? [-Wunknown-warning-option]\r\nwarning: unknown warning option '-Wbidi-chars=any' [-Wunknown-warning-option]\r\n4 warnings generated.\r\n[ 15%] Linking CXX static library libbitcoin_clientversion.a\r\n4 warnings generated.\r\n[ 15%] Built target bitcoin_clientversion\r\n[ 15%] Building CXX object src/crypto/CMakeFiles/bitcoin_crypto.dir/ripemd160.cpp.o\r\n[ 15%] Building CXX object CMakeFiles/leveldb.dir/src/leveldb/db/log_writer.cc.o\r\nclang++: warning: argument unused during compilation: '-fuse-ld=lld' [-Wunused-command-line-argument]\r\nclang++: warning: argument unused during compilation: '-fstack-clash-protection' [-Wunused-command-line-argument]\r\nwarning: unknown warning option '-Wduplicated-branches' [-Wunknown-warning-option]\r\nwarning: unknown warning option '-Wduplicated-cond' [-Wunknown-warning-option]\r\nwarning: unknown warning option '-Wlogical-op'; did you mean '-Wlong-long'? [-Wunknown-warning-option]\r\nwarning: unknown warning option '-Wbidi-chars=any' [-Wunknown-warning-option]\r\nclang++: warning: argument unused during compilation: '-fuse-ld=lld' [-Wunused-command-line-argument]\r\nclang++: warning: argument unused during compilation: '-fstack-clash-protection' [-Wunused-command-line-argument]\r\nwarning: unknown warning option '-Wduplicated-branches' [-Wunknown-warning-option]\r\nwarning: unknown warning option '-Wduplicated-cond' [-Wunknown-warning-option]\r\nwarning: unknown warning option '-Wlogical-op'; did you mean '-Wlong-long'? [-Wunknown-warning-option]\r\nwarning: unknown warning option '-Wbidi-chars=any' [-Wunknown-warning-option]\r\n4 warnings generated.\r\n4 warnings generated.\r\n```",
          "created_at": "2025-02-26T04:12:21Z"
        },
        {
          "user": "m3dwards",
          "body": "@Prabhat1308 and @l0rinc, I've updated the instructions to achieve the same goal but without the warnings.",
          "created_at": "2025-02-26T21:42:24Z"
        },
        {
          "user": "Prabhat1308",
          "body": "tACK [`725c0fd`](https://github.com/bitcoin/bitcoin/pull/31954/commits/725c0fd95b15157bd0ec141cc24d27818f536656)\r\n\r\n-Checked by running the fuzz tests on several fuzz targets . No warnings displayed now. ",
          "created_at": "2025-02-26T22:26:32Z"
        },
        {
          "user": "l0rinc",
          "body": "ACK 75486c8ed87a480b9f0c4dc7a10f3cd4eee87b12\r\n\r\nCompared to [previous review](https://github.com/bitcoin/bitcoin/compare/725c0fd95b15157bd0ec141cc24d27818f536656..75486c8ed87a480b9f0c4dc7a10f3cd4eee87b12#diff-7ff2e1d1ed59fa96766a663236d71bfdd00b4af3321fde39f7dbf022bd968a0a), `APPEND_LDFLAGS` was removed and the description simplified to avoid repetition.",
          "created_at": "2025-03-04T13:23:13Z"
        }
      ]
    },
    {
      "number": 31953,
      "title": "rpc: Allow fullrbf fee bump in (psbt)bumpfee",
      "body": "The RPCs (psbt)bumpfee, and the GUI, reject fee bumps when BIP 125 signalling is absent in the transaction even when the mempool and other RPCs allow them. Fix the confusion by allowing the fee bump.\r\n\r\nThis is done after fullrbf is always on (https://github.com/bitcoin/bitcoin/pull/30592)",
      "state": "closed",
      "user": "maflcko",
      "created_at": "2025-02-25T16:12:39Z",
      "updated_at": "2025-07-31T19:15:33Z",
      "comments": 5,
      "url": "https://github.com/bitcoin/bitcoin/pull/31953",
      "labels": [
        "RPC/REST/ZMQ"
      ],
      "comment_list": [
        {
          "user": "DrahtBot",
          "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/31953.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| ACK | [w0xlt](https://github.com/bitcoin/bitcoin/pull/31953#pullrequestreview-2776921300), [rkrux](https://github.com/bitcoin/bitcoin/pull/31953#pullrequestreview-2780807756), [1440000bytes](https://github.com/bitcoin/bitcoin/pull/31953#issuecomment-2818913559), [achow101](https://github.com/bitcoin/bitcoin/pull/31953#issuecomment-2819404698), [glozow](https://github.com/bitcoin/bitcoin/pull/31953#pullrequestreview-2782156380) |\n| Stale ACK | [ryanofsky](https://github.com/bitcoin/bitcoin/pull/31953#pullrequestreview-2708594899) |\n\nIf your review is incorrectly listed, please react with ðŸ‘Ž to this comment and the bot will ignore it on the next update.\n",
          "created_at": "2025-02-25T16:13:13Z"
        },
        {
          "user": "luke-jr",
          "body": "See also #26454",
          "created_at": "2025-04-12T20:16:07Z"
        },
        {
          "user": "maflcko",
          "body": "Force pushed some doc fixups. Should be trivial to re-review.",
          "created_at": "2025-04-17T11:14:45Z"
        },
        {
          "user": "1440000bytes",
          "body": "reACK https://github.com/bitcoin/bitcoin/commit/fa86190e6ed2aeda7bcceaf96f52403816bcd751",
          "created_at": "2025-04-21T16:11:31Z"
        },
        {
          "user": "achow101",
          "body": "ACK fa86190e6ed2aeda7bcceaf96f52403816bcd751",
          "created_at": "2025-04-21T20:11:20Z"
        }
      ]
    },
    {
      "number": 31952,
      "title": "chore: remove redundant word",
      "body": "remove redundant word\r\n",
      "state": "closed",
      "user": "costcould",
      "created_at": "2025-02-25T15:39:59Z",
      "updated_at": "2025-02-25T16:34:31Z",
      "comments": 2,
      "url": "https://github.com/bitcoin/bitcoin/pull/31952",
      "labels": [],
      "comment_list": [
        {
          "user": "DrahtBot",
          "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/31952.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| ACK | [maflcko](https://github.com/bitcoin/bitcoin/pull/31952#issuecomment-2682483302) |\n\nIf your review is incorrectly listed, please react with ðŸ‘Ž to this comment and the bot will ignore it on the next update.\n",
          "created_at": "2025-02-25T15:40:04Z"
        },
        {
          "user": "maflcko",
          "body": "lgtm ACK d9ba427f9d09dcf39cfdc7f871f7b093b876a0a3",
          "created_at": "2025-02-25T15:57:01Z"
        }
      ]
    },
    {
      "number": 31950,
      "title": "doc: fix typo and update subtree to resolve CI errors (#31949)",
      "body": "# Description\r\nThis PR addresses a simple typo in the file src/secp256k1/src/wycheproof/ecdsa_secp256k1_sha256_bitcoin_test.json, correcting the word \"occurences\" to \"occurrences.\"\r\n\r\nIn addition to this typo fix, I updated the subtree for src/secp256k1 to ensure compatibility with the latest changes in the upstream repository. This was necessary due to CI errors related to the previous version of the subtree.\r\n\r\nThis is related to [PR #31949](https://github.com/bitcoin/bitcoin/pull/31949#issue-2878432508), where the initial typo was identified.",
      "state": "closed",
      "user": "osrm",
      "created_at": "2025-02-25T14:26:54Z",
      "updated_at": "2025-02-25T14:37:04Z",
      "comments": 2,
      "url": "https://github.com/bitcoin/bitcoin/pull/31950",
      "labels": [
        "Docs"
      ],
      "comment_list": [
        {
          "user": "DrahtBot",
          "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/31950.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\nA summary of reviews will appear here.\n",
          "created_at": "2025-02-25T14:26:59Z"
        },
        {
          "user": "maflcko",
          "body": "pls no ai slop",
          "created_at": "2025-02-25T14:28:56Z"
        }
      ]
    },
    {
      "number": 31949,
      "title": "doc: fix minor typo",
      "body": "# Motivation\r\nThis PR fixes a typo: \"occurences\" is changed to \"occurrences\" to improve clarity and professionalism in the codebase. There are no tests associated with this typo change, as it is purely a spelling correction. Hope this helps.",
      "state": "closed",
      "user": "osrm",
      "created_at": "2025-02-25T13:38:23Z",
      "updated_at": "2025-02-25T13:44:30Z",
      "comments": 3,
      "url": "https://github.com/bitcoin/bitcoin/pull/31949",
      "labels": [
        "Docs",
        "CI failed"
      ],
      "comment_list": [
        {
          "user": "DrahtBot",
          "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/31949.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\nA summary of reviews will appear here.\n",
          "created_at": "2025-02-25T13:38:33Z"
        },
        {
          "user": "DrahtBot",
          "body": "<!--85328a0da195eb286784d51f73fa0af9-->\nðŸš§ At least one of the CI tasks failed.\n<sub>Debug: https://github.com/bitcoin/bitcoin/runs/37785040184</sub>\n\n<details><summary>Hints</summary>\n\nTry to run the tests locally, according to the documentation. However, a CI failure may still\nhappen due to a number of reasons, for example:\n\n* Possibly due to a silent merge conflict (the changes in this pull request being\nincompatible with the current code in the target branch). If so, make sure to rebase on the latest\ncommit of the target branch.\n\n* A sanitizer issue, which can only be found by compiling with the sanitizer and running the\n  affected test.\n\n* An intermittent issue.\n\nLeave a comment here, if you need help tracking down a confusing failure.\n\n</details>\n",
          "created_at": "2025-02-25T13:43:58Z"
        },
        {
          "user": "maflcko",
          "body": "Closing per CI failure. You'll have to submit upstream",
          "created_at": "2025-02-25T13:44:29Z"
        }
      ]
    },
    {
      "number": 31948,
      "title": "ci: [lint] Use Cirrus dockerfile cache",
      "body": "The lint task is problematic, because:\r\n\r\n* It doesn't check modifications to `ci/lint_imagefile`\r\n* It calls a separate script that installs packages on every run (taking time)\r\n* It uses `*_cache` instructions to cache some installed parts, but not all\r\n\r\nFix all issues by using `ci/lint_imagefile` (https://cirrus-ci.org/guide/docker-builder-vm/#dockerfile-as-a-ci-environment)",
      "state": "closed",
      "user": "maflcko",
      "created_at": "2025-02-25T12:12:34Z",
      "updated_at": "2025-03-18T15:14:06Z",
      "comments": 2,
      "url": "https://github.com/bitcoin/bitcoin/pull/31948",
      "labels": [
        "Tests"
      ],
      "comment_list": [
        {
          "user": "DrahtBot",
          "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/31948.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| ACK | [willcl-ark](https://github.com/bitcoin/bitcoin/pull/31948#pullrequestreview-2690146465) |\n\nIf your review is incorrectly listed, please react with ðŸ‘Ž to this comment and the bot will ignore it on the next update.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#31787](https://github.com/bitcoin/bitcoin/pull/31787) (ci: run in worktrees by willcl-ark)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n",
          "created_at": "2025-02-25T12:12:39Z"
        },
        {
          "user": "maflcko",
          "body": "cc @willcl-ark ",
          "created_at": "2025-03-17T07:53:45Z"
        }
      ]
    }
  ],
  "issues": [
    {
      "number": 31951,
      "title": "ci: failure in interface_usdt_utxocache.py",
      "body": "https://github.com/bitcoin/bitcoin/actions/runs/13501527489/job/37720897174?pr=31945:\n```bash\nUTXOCacheChange(outpoint=fab2396e3f726e1801b9e7303cf294783a3fd7e19ddc8f2dfa55e25b01575b3e:0, height=77, value=5000000000sat, is_coinbase=True) \n test  2025-02-24T16:25:34.721000Z TestFramework (INFO): check that we successfully traced 2 adds and 1 spent \n test  2025-02-24T16:25:34.721000Z TestFramework (ERROR): Assertion failed \n                                   Traceback (most recent call last):\n                                     File \"/home/runner/work/_temp/test/functional/test_framework/test_framework.py\", line 135, in main\n                                       self.run_test()\n                                     File \"/home/runner/work/_temp/build-asan/test/functional/interface_usdt_utxocache.py\", line 149, in run_test\n                                       self.test_add_spent()\n                                     File \"/home/runner/work/_temp/build-asan/test/functional/interface_usdt_utxocache.py\", line 323, in test_add_spent\n                                       compare_utxo_with_event(expected_utxo, actual_event)\n                                     File \"/home/runner/work/_temp/build-asan/test/functional/interface_usdt_utxocache.py\", line 264, in compare_utxo_with_event\n                                       assert_equal(utxo[\"txid\"], bytes(event.txid[::-1]).hex())\n                                     File \"/home/runner/work/_temp/test/functional/test_framework/util.py\", line 77, in assert_equal\n                                       raise AssertionError(\"not(%s)\" % \" == \".join(str(arg) for arg in (thing1, thing2) + args))\n                                   AssertionError: not(23b3dfef15c9b64445ffd44920adc48e7746aff1f03b59db3ed71936e90ff201 == d09ca39938b434b19a3338ef6b410071d85d4450dd7dc1f7db1bf7d95a53709a)\n test  2025-02-24T16:25:34.746000Z TestFramework (DEBUG): Closing down network thread \n```",
      "state": "closed",
      "user": "fanquake",
      "created_at": "2025-02-25T14:44:20Z",
      "updated_at": "2025-03-27T07:51:03Z",
      "comments": 3,
      "url": "https://github.com/bitcoin/bitcoin/issues/31951",
      "labels": [
        "interfaces",
        "CI failed"
      ],
      "comment_list": [
        {
          "user": "0xB10C",
          "body": "Based on the logs just before the assert:\n\n```log\nTestFramework (INFO): handle_utxocache_add(): UTXOCacheChange(outpoint=d09ca39938b434b19a3338ef6b410071d85d4450dd7dc1f7db1bf7d95a53709a:0, height=201, value=4999968800sat, is_coinbase=False) \nTestFramework (INFO): handle_utxocache_add(): UTXOCacheChange(outpoint=23b3dfef15c9b64445ffd44920adc48e7746aff1f03b59db3ed71936e90ff201:0, height=201, value=2500031200sat, is_coinbase=True) \nTestFramework (INFO): handle_utxocache_spent(): UTXOCacheChange(outpoint=fab2396e3f726e1801b9e7303cf294783a3fd7e19ddc8f2dfa55e25b01575b3e:0, height=77, value=5000000000sat, is_coinbase=True) \nTestFramework (INFO): check that we successfully traced 2 adds and 1 spent \n[...]\nAssertionError: not(23b3dfef15c9b64445ffd44920adc48e7746aff1f03b59db3ed71936e90ff201 == d09ca39938b434b19a3338ef6b410071d85d4450dd7dc1f7db1bf7d95a53709a)\n```\n\nIt seems like we learned about `d09ca3..` and then about `fab239..` but expected the order to be the other way around. This makes sense, since `fab239..` is a coinbase UTXO which is added first. Unclear why the order was mixed in this case.\n\nhttps://github.com/bitcoin/bitcoin/blob/0bb8a01810ec6f602b32d4677fa5004e12e0f538/test/functional/interface_usdt_utxocache.py#L319-L323\n\nA simple solution could be to not depend on the order of the tracepoint event arrival. As long as all expected events are received, pass the test.",
          "created_at": "2025-02-26T01:50:57Z"
        },
        {
          "user": "willcl-ark",
          "body": "From reading up on this a little it seems to be possible that if the tracepoint:\n\n- includes runtime [lookups](https://github.com/bitcoin/bitcoin/blob/aa87e0b44600a32b32a4b123d4f90d097f1f106f/src/txmempool.cpp#L513-L518)\n- is executed in a multi-threaded (or multi-CPU) environment\n- (possibly other factors)\n\n...then it may not be possible to totally guarantee ordering at userspace collection points. One can use BPF [queues](https://docs.kernel.org/bpf/map_queue_stack.html), but I suspect this wouldn't solve our problem here.\n\nI think if we wanted guaranteed ordering we may have to do something like add a [nanosecond timestamp](https://docs.ebpf.io/linux/helper-function/bpf_ktime_get_ns/) to each tracepoint, buffer them in the bpf program, and sort based on timestamp before processing in userspace.\n\nHowever, I don't think we need that and agree that we should probably just:\n\n> not depend on the order of the tracepoint event arrival. As long as all expected events are received, pass the test.\n\nWould we want to make all the usdt tests order-independent, or only this one? We have strict ordering in others, e.g.\n\nhttps://github.com/bitcoin/bitcoin/blob/aa87e0b44600a32b32a4b123d4f90d097f1f106f/test/functional/interface_usdt_coinselection.py#L184-L237\n\nTo change only this test is relatviely simple: https://github.com/bitcoin/bitcoin/compare/master...willcl-ark:bitcoin:usdt-order-independant but it will be more work to apply to all the tests...",
          "created_at": "2025-03-20T11:53:35Z"
        },
        {
          "user": "0xB10C",
          "body": "> To change only this test is relatviely simple: https://github.com/bitcoin/bitcoin/compare/master...willcl-ark:bitcoin:usdt-order-independant but it will be more work to apply to all the tests...\n\nThis was the first, and for now, the only time we saw this test fail due to ordering problems. I think we can't completely rule out ordering problems, but IMO it would be good to see this happening in some other test(s) before we start changing them.",
          "created_at": "2025-03-20T12:04:07Z"
        }
      ]
    }
  ],
  "summary": {
    "pull_requests": 7,
    "issues": 1
  }
}