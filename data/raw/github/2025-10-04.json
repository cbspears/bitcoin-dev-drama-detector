{
  "source": "github",
  "repository": "bitcoin/bitcoin",
  "fetched_at": "2026-01-15T20:19:50.351884+00:00",
  "date": "2025-10-04",
  "pull_requests": [
    {
      "number": 33540,
      "title": "argsman, cli: GNU-style command-line option parsing (allows options after non-option arguments)",
      "body": "This PR simplifies the argument parsing logic and resolves practical issues for `bitcoin-cli` and similar binaries (e.g. `bitcoin-wallet`) making their usage more consistent and predictable, enabling valid patterns such as mixing commands with wallet- or RPC-specific optionsâ€”without relying on argument ordering quirks.\r\n\r\n<details>\r\n<summary>What's changed in ArgsManager that allows the above.</summary>\r\n\r\n- Previously, `ArgsManager` stopped interpreting options once a non-option argument was encountered (non-GNU parsing). For example:\r\n\r\n        bitcoind -a -b param -c\r\n\r\n  would ignore `-c` because it followed the non-option argument `param`. In some cases '-c' is interpreted as an argument for 'param', producing unexpected behavior (eg empty arrays for listtransactions command).\r\n\r\n- This PR changes the behavior so that options following non-option argument are recognized and processed (GNU parsing). This is needed for workflows for tools like CLI where command arguments may be followed by wallet- or RPC-specific\r\noptions, e.g.:\r\n\r\n        bitcoin-cli -rpcwallet=\"\" listtransactions -rpcwallet=mywallet\r\n    \r\n        bitcoin-cli getaddressinfo <address> -rpcwallet=mywallet\r\n\r\n- (other binaries could also benefit from this change,  e.g. `bitcoin-wallet`)\r\n\r\n        bitcoin-wallet create -wallet=newname\r\n\r\n- Invalid options passed after non-options will be treated as RPC arguments that begin with a `-` character (so no\r\nbehavioural change against `master`), e.g.:\r\n\r\n        bitcoin-cli -regtest -datadir=/tmp/btc createwallet -mywallet\r\n        {\r\n            \"name\": \"-mywallet\"\r\n        }\r\n\r\n</details>\r\n\r\n<details><summary>Before and after outputs running RPC commands from <code>CLI</code>/ <code>bitcoin-cli</code>.</summary><ul>\r\n     <li><details><summary>wallet commands using <code>CLI</code>:</summary><ul> \r\n           <li><details><summary><code>getaddressinfo</code></summary><ul>\r\n           <li>before/ <code>master</code>\r\n\r\n```\r\n./build_master/bin/bitcoin-cli -regtest -datadir=/tmp/btc getaddressinfo bcrt1qrnz5xlcwz5d85n3fag6v0vc4lryjc90jhqtpsh -rpcwallet=nonExistent\r\nerror message:\r\ngetaddressinfo \"address\"\r\n...\r\n```\r\n</li>\r\n           <li>after\r\n\r\n```\r\n./build/bin/bitcoin-cli -regtest -datadir=/tmp/btc getaddressinfo bcrt1qrnz5xlcwz5d85n3fag6v0vc4lryjc90jhqtpsh -rpcwallet=nonExistent\r\nerror code: -18\r\nerror message:\r\nRequested wallet does not exist or is not loaded\r\n```\r\n\r\n</li>\r\n           </ul></details></li>\r\n           <li><details><summary><code>listtransactions</code></summary><ul>\r\n           <li>before/ <code>master</code>\r\n\r\n```\r\n./build_master/bin/bitcoin-cli -regtest -datadir=/tmp/btc listtransactions -rpcwallet=nonExistent\r\n[\r\n]\r\n```\r\n\r\n</li>\r\n           <li>after\r\n\r\n\r\n```\r\n./build/bin/bitcoin-cli -regtest -datadir=/tmp/btc listtransactions -rpcwallet=nonExistent\r\nerror code: -18\r\nerror message:\r\nRequested wallet does not exist or is not loaded\r\n```\r\n\r\n</li>\r\n           </ul></details></li>\r\n           <li><details><summary>any command that needs an option to be specifed, it can be added at the end directly instead of before the command</summary><ul>\r\n           <li>before/ <code>master</code>\r\n\r\n```\r\n./build_master/bin/bitcoin-cli -regtest -datadir=/tmp/btc listtransactions\r\nerror code: -19\r\nerror message:\r\nMultiple wallets are loaded. Please select which wallet to use by requesting the RPC through the /wallet/<walletname> URI path. Or for the CLI, specify the \"-rpcwallet=<walletname>\" option before the command (run \"bitcoin-cli -h\" for help or \"bitcoin-cli listwallets\" to see which wallets are currently loaded).\r\n```\r\n\r\n```\r\n./build_master/bin/bitcoin-cli -regtest -datadir=/tmp/btc listtransactions -rpcwallet=\"\"\r\nerror code: -19\r\nerror message:\r\nMultiple wallets are loaded. Please select which wallet to use by requesting the RPC through the /wallet/<walletname> URI path. Or for the CLI, specify the \"-rpcwallet=<walletname>\" option before the command (run \"bitcoin-cli -h\" for help or \"bitcoin-cli listwallets\" to see which wallets are currently loaded).\r\n```\r\n\r\n</li>\r\n           <li>after\r\n\r\n```\r\n/build/bin/bitcoin-cli -regtest -datadir=/tmp/btc listtransactions -rpcwallet=\"\"\r\n[\r\n  {\r\n    \"address\": \"bcrt1q5pqkrlfrp9rvsg43sxxagrees7r7ul6uyskhs4\",\r\n    \"parent_descs\": [\r\n      \"wpkh([76a11ab0/84h/1h/0h]tpubDCDCuyC1Rtm1weZ5kfBYtdchcmqa2t8db7M68wsPHbWhUrYnzFTrHu7ufVVRydt3FdWQy8iNmKbZYbgpWWcEKPAj896x53UbS6i2xRD1qct/0/*)#kuff3m9t\"\r\n    ],\r\n    \"category\": \"immature\",\r\n    \"amount\": 50.00000000,\r\n    \"label\": \"\",\r\n...\r\n```\r\n\r\n</li>\r\n           </ul></details></li>\r\n     </ul></details></li>\r\n     <li><details><summary>other binaries could benefit from it, e.g. <code>bitcoin-wallet:</code></summary><ul> \r\n           <li><details><summary><code>create</code> command</summary><ul>\r\n           <li>before/ <code>master</code>\r\n\r\n```\r\n./build_master/bin/bitcoin-wallet -regtest -datadir=/tmp/btc create\r\nWallet name must be provided when creating a new wallet.\r\n```\r\n_(`-wallet` option has to be passed before the `create` command in order to work)_\r\n```\r\n./build_master/bin/bitcoin-wallet -regtest -datadir=/tmp/btc create -wallet=newWalletName\r\nError: Additional arguments provided (-wallet=newWalletName). Methods do not take arguments. Please refer to `-help`.\r\n```\r\n\r\n</li>\r\n           <li>after\r\n\r\n```\r\n./build/bin/bitcoin-wallet -regtest -datadir=/tmp/btc create -wallet=newWallet\r\nTopping up keypool...\r\nWallet info\r\n===========\r\nName: newWallet\r\nFormat: sqlite\r\nDescriptors: yes\r\nEncrypted: no\r\nHD (hd seed available): yes\r\nKeypool Size: 8000\r\nTransactions: 0\r\nAddress Book: 0\r\n```\r\n</li>\r\n           </ul></details></li>\r\n     </ul></details></li>\r\n     </ul> <!-- End -->\r\n</details>\r\n\r\n-<ins>_**Notes**_</ins>:\r\n\r\n- <ins>Backwards compatibility</ins>:\r\nThis PR is backward compatible in the sense that it allows new valid invocations that were previously rejected (failed or somehow ignored).\r\nIn `master`, any valid option following a command is treated as a positional argument. This can lead to unexpected RPC errors or help messages due to mismatched argument types. With this PR, those cases are parsed as proper options when applicable.\r\n\r\n- `bitcoin-cli` continues to accept RPC arguments that begin with a `-` character as currently in `master` (check `createwallet` example in _\"What's change in ArgsManager\"_ section above).\r\n\r\n- `bitcoin-cli` could distinguish between options that begin with single and double dashes, and treat options after the RPC method name that begin with double dashes as RPC named parameters (check example in 4th [commit](https://github.com/bitcoin/bitcoin/pull/33540/commits/a101bbb61fdf5563337334d63a10432432ee3625) message body).\r\n\r\n- Refactored both `ArgsManager::ProcessOptionKey` (new function added in this PR) and `ArgsManager::ParseParameters` in separated commits making the code clearer and the PR much easier to follow and review.",
      "state": "open",
      "user": "pablomartin4btc",
      "created_at": "2025-10-04T22:43:07Z",
      "updated_at": "2025-12-19T04:11:25Z",
      "comments": 15,
      "url": "https://github.com/bitcoin/bitcoin/pull/33540",
      "labels": [],
      "comment_list": [
        {
          "user": "DrahtBot",
          "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/33540.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| Concept ACK | [w0xlt](https://github.com/bitcoin/bitcoin/pull/33540#pullrequestreview-3302396406), [ryanofsky](https://github.com/bitcoin/bitcoin/pull/33540#issuecomment-3371562956) |\n\nIf your review is incorrectly listed, please copy-paste <code>&lt;!--meta-tag:bot-skip--&gt;</code> into the comment that the bot should ignore.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#17783](https://github.com/bitcoin/bitcoin/pull/17783) (common: Disallow calling IsArgSet() on ALLOW_LIST options by ryanofsky)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n<!--5faf32d7da4f0f540f40219e4f7537a3-->\n### LLM Linter (âœ¨ experimental)\n\n\n\nPossible typos and grammar issues:\n\n- double dash'ed -> double-dashed [apostrophe misuse; \"dash'ed\" is nonstandard â€” use \"double-dashed\" (or \"double-dash\") for clarity]\n- startig -> starting [typo: \"startig\" should be \"starting\"]\n\n\n\n\n\n<sup>2025-12-18</sup>\n",
          "created_at": "2025-10-04T22:43:11Z"
        },
        {
          "user": "katesalazar",
          "body": "Such good news. Hard to believe this PR doesn't reference an existing user request.\r\n",
          "created_at": "2025-10-05T09:10:04Z"
        },
        {
          "user": "pinheadmz",
          "body": "> Such good news. Hard to believe this PR doesn't reference an existing user request.\n> \n> \n\n@katesalazar \n\nThis comment does not contribute to the technical discussion. Please put in more effort in the future or you may be banned. ",
          "created_at": "2025-10-05T14:08:08Z"
        },
        {
          "user": "ryanofsky",
          "body": "Haven't looked at code yet, so forgive if these are dumb questions, but could be nice if PR description addressed these:\r\n\r\n- Is there a way to pass `bitcoin-cli` RPC arguments that begin with a `-` character? Can you escape these arguments with `--` for example?\r\n\r\n- What's the PR's goal for backwards compatibility? Is the PR only allowing command lines that were disallowed before, and therefore fully backwards compatible? Or are there some command lines which used to be accepted which will now be interpreted differently?\r\n\r\n- What are \"numeric command arguments\" referenced in the PR description? Maybe give an example. I wasn't aware that numbers were treated differently than other characters for separating options arguments, and I would expect interpretation of numeric values to happen at a later phase than the phase distinguishing options from non-option arguments.",
          "created_at": "2025-10-06T13:02:48Z"
        },
        {
          "user": "ryanofsky",
          "body": "Concept ACK on the idea. I think it probably makes sense to allow options arguments to follow non-option arguments even this change is not strictly backwards compatible, as long as there is some way to escape non-option arguments beginning with `-`, such as with a `--` separator.",
          "created_at": "2025-10-06T13:09:52Z"
        },
        {
          "user": "ryanofsky",
          "body": "Assuming we are ok with losing some backwards compatibility by starting to treating arguments that begin with `-` as options instead of non-options when they follow arguments that don't begin with `-`, there could be other interesting ways to extend this PR.\r\n\r\nFor example, `bitcoin-cli` could distinguish between options that begin with single and double dashes, and treat options after the RPC method name that begin with double dashes as RPC named parameters. In other words, accept:\r\n\r\n```bash\r\nbitcoin-cli createwallet mywallet --load_on_startup=1\r\n```\r\n\r\nas an equivalent to:\r\n\r\n\r\n```bash\r\nbitcoin-cli -named createwallet mywallet load_on_startup=1\r\n```\r\n\r\nThis seems like it could provide a more convenient way of using named RPC parameters.",
          "created_at": "2025-10-06T14:39:33Z"
        },
        {
          "user": "pablomartin4btc",
          "body": ">     * Is there a way to pass `bitcoin-cli` RPC arguments that begin with a `-` character?\r\n\r\nAt the moment, please correct me if I'm wrong, there's no or I haven't seen an RPC that would receive a valid argument that starts with `-` (but I understand it could be in the future), and there's no test for it otherwise I think the PR would have caught it.\r\n\r\nTesting the scenario you mentioned in `master` would work like for example in:\r\n\r\n```\r\n./build_master/bin/bitcoin-cli -regtest -datadir=/tmp/btc createwallet -xyz\r\n{\r\n  \"name\": \"-xyz\"\r\n}\r\n\r\n```\r\n\r\nOn this PR would fail because it would be an invalid option (from the `ArgsMan`):\r\n\r\n```\r\n./build/bin/bitcoin-cli -regtest -datadir=/tmp/btc createwallet -xyz\r\nError parsing command line arguments: Invalid parameter -xyz\r\n\r\n```\r\n\r\nI think perhaps the scenario you mention is a valid one since any a string argument for an RPC could start with `-`, so only the \"invalid\" options (like -xyz in the previous example) would be leaved or passed to the RPC, which makes sense.\r\n\r\nThe change would look like [this](https://github.com/bitcoin/bitcoin/compare/master...pablomartin4btc:bitcoin:argsman-GNU-style-testing-ryan-non-options-begin-with--), and we can drop the 2nd commit (bringing back alive  `ParsePrechecks()` and `ParseDouble()`), which won't make sense anymore (I explain why I brought them back in your last question on this thread since you've asked as well). The change already [passes the CIs](https://github.com/pablomartin4btc/bitcoin/actions/runs/18440205297) - CentOS CI failure is unrelated.\r\n\r\nSo even the following case would be successful:\r\n\r\n```\r\n./build_ryan/bin/bitcoin-cli createwallet -regtest -zyx -datadir=/tmp/btc\r\n{\r\n  \"name\": \"-zyx\"\r\n}\r\n\r\n```\r\n\r\n> Can you escape these arguments with `--` for example?\r\n\r\nNot on this PR. I see you think we could extend it with the usage of `--` in a [later comment](https://github.com/bitcoin/bitcoin/pull/33540#issuecomment-3372043307). I wanted to make a minimum change to allow this feature of GNU-style parsing options so I'd prefer to add that on a separate PR if that's necessary.\r\n \r\n>     * What's the PR's goal for backwards compatibility? Is the PR only allowing command lines that were disallowed before, and therefore fully backwards compatible? Or are there some command lines which used to be accepted which will now be interpreted differently?\r\n\r\nThe difference now will be that valid options starting with `-` will be considered or accepted while before or in `master` these scenarios will be considered that an extra argument is passed to the command and sometimes would be treated as a valid string (when the arg is of such type for the command) returning something empty if it had to match certain condition or would fail because (1) it's a different type like a JSON error, (2) the RPC had received extra arguments resulting in the command help or (3) too many args for CLI commands. So in terms of backwards compatibility, it would consider valid scenarios that were invalid before, and if someone expected an error, if the option is valid it will be taken into consideration and the execution will be successful instead.\r\n\r\n>     * What are \"numeric command arguments\" referenced in the PR description? Maybe give an example. I wasn't aware that numbers were treated differently than other characters for separating options arguments, and I would expect interpretation of numeric values to happen at a later phase than the phase distinguishing options from non-option arguments.\r\n\r\nYeah the interpretation of numeric values come later on the command execution, not during the parsing in the Argsman, but when I made the change, there was a  a test that was failing:\r\n\r\nhttps://github.com/bitcoin/bitcoin/blob/d2987102dd13f965c7a0bf1d5b8ee15bcf025398/test/functional/wallet_transactiontime_rescan.py#L182\r\n\r\nSo then I checked that there is another RPC case (`getnetworkhashps`) which has a default `RPCArg::Type::NUM` with `RPCArg::Default{-1}`:\r\n\r\nhttps://github.com/bitcoin/bitcoin/blob/d2987102dd13f965c7a0bf1d5b8ee15bcf025398/src/rpc/mining.cpp#L120\r\n\r\nThat's the reason of the 2nd commit, reintroducing doubles parsing, but since your first question on this thread, I'm considering [this change](https://github.com/bitcoin/bitcoin/compare/master...pablomartin4btc:bitcoin:argsman-GNU-style-testing-ryan-non-options-begin-with--) to be pushed (added a test scenario where commands could receive args starting with `-`) so that 2nd commit can be dropped as it's no longer needed (that's done in the [change](https://github.com/bitcoin/bitcoin/compare/master...pablomartin4btc:bitcoin:argsman-GNU-style-testing-ryan-non-options-begin-with--) mentioned in the previous sentence).",
          "created_at": "2025-10-12T17:11:44Z"
        },
        {
          "user": "pablomartin4btc",
          "body": "-<ins>_**Updates**_</ins>:\r\n- Addressed @ryanofsky's feedback:\r\n  - `bitcoin-cli` accepts RPC arguments that begin with a `-` character;\r\n  - added a note in description about backwards compatibility;\r\n  - `bitcoin-cli` treat options after the RPC method name that begin with double dashes as RPC named parameters;\r\n- Dropped _\"Reintroduce ParsePrechecks and ParseDouble\"_ commit;\r\n- Updated description accordingly;\r\n- CentOS CI failure is unrelated (_\"no space left on device\"_ -> it seems #33293);\r\n- Pending to fix Tidy CI failure (_\"recursive call chain\"_).",
          "created_at": "2025-10-13T03:37:48Z"
        },
        {
          "user": "pablomartin4btc",
          "body": "-<ins>_**Updates**_</ins>:\r\n- Fixed previous Tidy CI failure (_\"recursive call chain\"_), but still working on a refactor of `ArgsManager::ProcessOptionKey`.",
          "created_at": "2025-10-13T05:33:52Z"
        },
        {
          "user": "pablomartin4btc",
          "body": "> This command works on master but not in this PR: `./build/bin/bitcoin-cli --datadir=/tmp/btc1 --signet getblockhash 1000` \r\n<detail>\r\n<summarys>Thanks for testing it (not sure if that's valid, no test failed, perhaps we need to add one?), anyways just putting the output's diff here.</summarys><br>\r\n\r\n`master`:\r\n```\r\n/build_master/bin/bitcoin-cli --datadir=/tmp/btc --signet getblockhash 1000\r\nerror code: -8\r\nerror message:\r\nBlock height out of range\r\n```\r\nthis branch:\r\n```\r\n./build/bin/bitcoin-cli --datadir=/tmp/btc --signet getblockhash 1000\r\nerror: timeout on transient error: Could not connect to the server 127.0.0.1:8332\r\n\r\nMake sure the bitcoind server is running and that you are connecting to the correct RPC port.\r\nUse \"bitcoin-cli -help\" for more info.\r\n```\r\n</details>",
          "created_at": "2025-12-04T14:20:19Z"
        },
        {
          "user": "pablomartin4btc",
          "body": "> Restructuring `ProcessOptionKey` as below seems to solve the problem...\r\n\r\nChecking it... Thanks for the suggestion!",
          "created_at": "2025-12-04T14:24:40Z"
        },
        {
          "user": "pablomartin4btc",
          "body": "> > Restructuring `ProcessOptionKey` as below seems to solve the problem...\r\n> \r\n> Checking it... Thanks for the suggestion!\r\n\r\nOk, all tests pass...\r\n\r\nFirst checked only the affected ones by my changes:\r\n\r\n```\r\n./build/test/functional/feature_config_args.py\r\n./build/test/functional/tool_wallet.py\r\n./build/test/functional/wallet_multiwallet.py\r\n./build/test/functional/wallet_transactiontime_rescan.py\r\n\r\n./build/bin/test_bitcoin --log_level=all --run_test=argsman_tests\r\n```\r\n\r\nThen I ran them all including the functional `--extended`.\r\n\r\nThanks again for working on this! I'm seeing if I can make the code a bit clearer otherwise I'll include your suggestion.",
          "created_at": "2025-12-04T15:16:12Z"
        },
        {
          "user": "DrahtBot",
          "body": "<!--85328a0da195eb286784d51f73fa0af9-->\nðŸš§ At least one of the CI tasks failed.\n<sub>Task `lint`: https://github.com/bitcoin/bitcoin/actions/runs/20032344935/job/57444563462</sub>\n<sub>LLM reason (âœ¨ experimental): Python linting failed: ruff detected an f-string without placeholders in test code, causing the lint step to fail and CI to exit with error.</sub>\n\n<details><summary>Hints</summary>\n\nTry to run the tests locally, according to the documentation. However, a CI failure may still\nhappen due to a number of reasons, for example:\n\n* Possibly due to a silent merge conflict (the changes in this pull request being\nincompatible with the current code in the target branch). If so, make sure to rebase on the latest\ncommit of the target branch.\n\n* A sanitizer issue, which can only be found by compiling with the sanitizer and running the\n  affected test.\n\n* An intermittent issue.\n\nLeave a comment here, if you need help tracking down a confusing failure.\n\n</details>\n\n",
          "created_at": "2025-12-08T15:02:49Z"
        },
        {
          "user": "pablomartin4btc",
          "body": "-<ins>_**Updates**_</ins>:\r\n- Added @w0xlt's [fix](https://github.com/bitcoin/bitcoin/pull/33540#pullrequestreview-3490620415) on long (double dash --) options that [worked](https://github.com/bitcoin/bitcoin/pull/33540#pullrequestreview-3490254189) on `master`, adding a new test for it (the test would pass in `master` but fail without @w0xlt's changes).\r\n- Refactored both `ArgsManager::ProcessOptionKey` (new function added in this PR) and `ArgsManager::ParseParameters` in separated commits making the code clearer and the PR much easier to follow and review.",
          "created_at": "2025-12-08T16:57:02Z"
        },
        {
          "user": "pablomartin4btc",
          "body": "_Rebased._",
          "created_at": "2025-12-18T17:12:44Z"
        }
      ]
    },
    {
      "number": 33537,
      "title": "guix: build `bitcoin-qt` with static libxcb & utils",
      "body": "Related to https://github.com/bitcoin/bitcoin/pull/33434.\r\nTested on:\r\n* Fedora 42: https://github.com/bitcoin/bitcoin/pull/33537#pullrequestreview-3455373185.\r\n* Ubuntu 24.04: https://github.com/bitcoin/bitcoin/pull/33537#issuecomment-3533276038.\r\n* Debian 13.x: https://github.com/bitcoin/bitcoin/pull/33537#issuecomment-3540923567.",
      "state": "closed",
      "user": "fanquake",
      "created_at": "2025-10-04T00:39:00Z",
      "updated_at": "2025-11-20T09:45:52Z",
      "comments": 21,
      "url": "https://github.com/bitcoin/bitcoin/pull/33537",
      "labels": [
        "Build system"
      ]
    }
  ],
  "issues": [
    {
      "number": 33539,
      "title": "Compilation failure with Clang SNAPSHOT",
      "body": "```\n$ clang++ --version\nUbuntu clang version 22.0.0 (++20251003081846+36dc2a941f53-1~exp1~20251003202013.1205)\nTarget: x86_64-pc-linux-gnu\nThread model: posix\nInstalledDir: /usr/lib/llvm-22/bin\n$ cmake --build build -j 1\n[4/447] Building CXX object src/CMakeFiles/bitcoin_node.dir/mapport.cpp.o\nFAILED: src/CMakeFiles/bitcoin_node.dir/mapport.cpp.o \n/usr/bin/ccache /usr/bin/clang++-22 -DBOOST_MULTI_INDEX_DISABLE_SERIALIZATION -DBOOST_NO_CXX98_FUNCTION_BASE -I/home/hebasto/dev/bitcoin/build/src -I/home/hebasto/dev/bitcoin/src -I/home/hebasto/dev/bitcoin/src/leveldb/include -I/home/hebasto/dev/bitcoin/src/minisketch/include -I/home/hebasto/dev/bitcoin/src/univalue/include -O2 -g -std=c++20 -fPIC -fdebug-prefix-map=/home/hebasto/dev/bitcoin/src=. -fmacro-prefix-map=/home/hebasto/dev/bitcoin/src=. -U_FORTIFY_SOURCE -D_FORTIFY_SOURCE=3 -Wstack-protector -fstack-protector-all -fcf-protection=full -fstack-clash-protection -Wall -Wextra -Wgnu -Wformat -Wformat-security -Wvla -Wshadow-field -Wthread-safety -Wthread-safety-pointer -Wloop-analysis -Wredundant-decls -Wunused-member-function -Wdate-time -Wconditional-uninitialized -Woverloaded-virtual -Wsuggest-override -Wimplicit-fallthrough -Wunreachable-code -Wdocumentation -Wself-assign -Wundef -Wno-unused-parameter -MD -MT src/CMakeFiles/bitcoin_node.dir/mapport.cpp.o -MF src/CMakeFiles/bitcoin_node.dir/mapport.cpp.o.d -o src/CMakeFiles/bitcoin_node.dir/mapport.cpp.o -c /home/hebasto/dev/bitcoin/src/mapport.cpp \n../src/mapport.cpp:115:59: error: no matching member function for call to 'randrange'\n  115 |         sleep_time = sleep_time_min + FastRandomContext().randrange<std::chrono::milliseconds>(sleep_time_max - sleep_time_min);\n      |                                       ~~~~~~~~~~~~~~~~~~~~^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n../src/random.h:254:7: note: candidate template ignored: constraints not satisfied [with I = std::chrono::milliseconds]\n  254 |     I randrange(I range) noexcept\n      |       ^\n../src/random.h:253:14: note: because 'std::chrono::milliseconds' (aka 'duration<long, ratio<1, 1000>>') does not satisfy 'integral'\n  253 |     template<std::integral I>\n      |              ^\n/usr/lib/gcc/x86_64-linux-gnu/14/../../../../include/c++/14/concepts:107:24: note: because 'is_integral_v<std::chrono::duration<long, std::ratio<1, 1000>>>' evaluated to false\n  107 |     concept integral = is_integral_v<_Tp>;\n      |                        ^\n../src/random.h:346:9: note: candidate template ignored: constraints not satisfied [with Dur = std::chrono::milliseconds]\n  346 |     Dur randrange(std::common_type_t<Dur> range) noexcept\n      |         ^\n../src/random.h:345:15: note: because 'std::chrono::milliseconds' (aka 'duration<long, ratio<1, 1000>>') does not satisfy 'StdChronoDuration'\n  345 |     template <StdChronoDuration Dur>\n      |               ^\n../src/random.h:157:5: note: because '[]<class Rep, class Period>(std::type_identity<std::chrono::duration<Rep, Period>>) {\n}(std::type_identity<T>())' would be invalid: no matching function for call to object of type '(lambda at ../src/random.h:157:5)'\n  157 |     []<class Rep, class Period>(std::type_identity<std::chrono::duration<Rep, Period>>){}(\n      |     ^\n1 error generated.\nninja: build stopped: subcommand failed.\n```",
      "state": "closed",
      "user": "hebasto",
      "created_at": "2025-10-04T09:54:14Z",
      "updated_at": "2025-10-16T10:32:25Z",
      "comments": 6,
      "url": "https://github.com/bitcoin/bitcoin/issues/33539",
      "labels": [
        "Upstream"
      ],
      "comment_list": [
        {
          "user": "hebasto",
          "body": "cc @sipa as the code [author](https://github.com/bitcoin/bitcoin/commit/4eaa239dc3e189369d59144b524cb2808cbef8c3).",
          "created_at": "2025-10-04T09:55:07Z"
        },
        {
          "user": "sipa",
          "body": "I can't reproduce this on godbolt. Does the code there work for you? https://godbolt.org/z/f7E4Y7rrb",
          "created_at": "2025-10-04T13:16:01Z"
        },
        {
          "user": "hebasto",
          "body": "> I can't reproduce this on godbolt. Does the code there work for you? https://godbolt.org/z/f7E4Y7rrb\n\nIt does. No issues.",
          "created_at": "2025-10-04T13:20:56Z"
        },
        {
          "user": "sipa",
          "body": "That makes no sense!\n\nThe warning above complains:\n```\n../src/random.h:345:15: note: because 'std::chrono::milliseconds' (aka 'duration<long, ratio<1, 1000>>') does not satisfy 'StdChronoDuration'\n  345 |     template <StdChronoDuration Dur>\n      |               ^\n```\n\nAnd yet, the godbolt snippet invokes `rand`, which is templated as `template <StdChronoDuration Dur>` just the same, with `std::chrono::milliseconds` as argument.\n\nCompiler bug, which is hopefully resolved before they release?",
          "created_at": "2025-10-04T13:25:47Z"
        },
        {
          "user": "maflcko",
          "body": "https://github.com/llvm/llvm-project/issues/163057",
          "created_at": "2025-10-13T07:01:10Z"
        },
        {
          "user": "hebasto",
          "body": "> [llvm/llvm-project#163057](https://github.com/llvm/llvm-project/issues/163057)\n\nThe snapshot containing the fix builds successfully: https://github.com/hebasto/bitcoin-core-nightly/actions/runs/18549098308.",
          "created_at": "2025-10-16T10:32:25Z"
        }
      ]
    },
    {
      "number": 33538,
      "title": ".",
      "body": ".",
      "state": "closed",
      "user": "venpisey12",
      "created_at": "2025-10-04T04:48:47Z",
      "updated_at": "2025-10-04T05:11:51Z",
      "comments": 0,
      "url": "https://github.com/bitcoin/bitcoin/issues/33538",
      "labels": []
    }
  ],
  "summary": {
    "pull_requests": 2,
    "issues": 2
  }
}