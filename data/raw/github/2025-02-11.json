{
  "source": "github",
  "repository": "bitcoin/bitcoin",
  "fetched_at": "2026-01-15T19:16:24.989130+00:00",
  "date": "2025-02-11",
  "pull_requests": [
    {
      "number": 31844,
      "title": "cmake: add a component for each binary",
      "body": "This makes it possible to build/install only the desired binaries regardless of the configuration.\r\nFor consistency, the component names match the binary names. `Kernel` and `GUI` have been renamed.\r\n\r\nAdditionally it fixes #31762 by installing only the manpages for the configured targets (and includes them in the component installs for each).\r\n\r\nAlso fixes #31745.\r\n\r\nAlternative to #31765 which is (imo) more correct/thorough.\r\n\r\nCan be tested using (for ex):\r\n```bash\r\n$ cmake -B build\r\n$ cmake --build build -t bitcoind -t bitcoin-cli\r\n$ cmake --install build --component bitcoind\r\n$ cmake --install build --component bitcoin-cli\r\n```",
      "state": "closed",
      "user": "theuni",
      "created_at": "2025-02-11T20:39:22Z",
      "updated_at": "2025-02-14T17:23:51Z",
      "comments": 15,
      "url": "https://github.com/bitcoin/bitcoin/pull/31844",
      "labels": [
        "Build system"
      ],
      "comment_list": [
        {
          "user": "DrahtBot",
          "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/31844.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| ACK | [hebasto](https://github.com/bitcoin/bitcoin/pull/31844#pullrequestreview-2616350801), [TheCharlatan](https://github.com/bitcoin/bitcoin/pull/31844#pullrequestreview-2617102083), [stickies-v](https://github.com/bitcoin/bitcoin/pull/31844#pullrequestreview-2617756135) |\n| Stale ACK | [s373nZ](https://github.com/bitcoin/bitcoin/pull/31844#issuecomment-2656143427) |\n\nIf your review is incorrectly listed, please react with ðŸ‘Ž to this comment and the bot will ignore it on the next update.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#31765](https://github.com/bitcoin/bitcoin/pull/31765) (cmake: Install man pages for configured targets only by hebasto)\n* [#30595](https://github.com/bitcoin/bitcoin/pull/30595) (kernel: Introduce initial C header API by TheCharlatan)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n",
          "created_at": "2025-02-11T20:39:25Z"
        },
        {
          "user": "DrahtBot",
          "body": "<!--85328a0da195eb286784d51f73fa0af9-->\nðŸš§ At least one of the CI tasks failed.\n<sub>Debug: https://github.com/bitcoin/bitcoin/runs/37053681658</sub>\n\n<details><summary>Hints</summary>\n\nTry to run the tests locally, according to the documentation. However, a CI failure may still\nhappen due to a number of reasons, for example:\n\n* Possibly due to a silent merge conflict (the changes in this pull request being\nincompatible with the current code in the target branch). If so, make sure to rebase on the latest\ncommit of the target branch.\n\n* A sanitizer issue, which can only be found by compiling with the sanitizer and running the\n  affected test.\n\n* An intermittent issue.\n\nLeave a comment here, if you need help tracking down a confusing failure.\n\n</details>\n",
          "created_at": "2025-02-11T22:03:45Z"
        },
        {
          "user": "s373nZ",
          "body": "ACK fb0546b1c5ebb858605bef4c9fa001782e0ab213\r\n\r\nTested lightly by building and installing for targeted components `bitcoind` and `bitcoin-cli` as described in the PR description.\r\n\r\nShould be mentioned this also closes #31745.",
          "created_at": "2025-02-12T15:26:43Z"
        },
        {
          "user": "theuni",
          "body": "@maflcko Mind taking a look at the first commit here to see if you'd prefer a different approach?",
          "created_at": "2025-02-12T19:20:26Z"
        },
        {
          "user": "maflcko",
          "body": "> @maflcko Mind taking a look at the first commit here to see if you'd prefer a different approach?\r\n\r\nThe first commit lgtm. Anything should be fine in the fuzz ci task as long as it compiles and runs the fuzz executable.",
          "created_at": "2025-02-13T08:02:17Z"
        },
        {
          "user": "s373nZ",
          "body": "ACK 686ebcfe93efa9ecca9b94e78da23a36c3b01f90",
          "created_at": "2025-02-13T10:23:27Z"
        },
        {
          "user": "hebasto",
          "body": "Concept ACK.\r\n\r\nIn addition to installation, components are also intended for use in packaging via [`cpack`](https://cmake.org/cmake/help/latest/manual/cpack.1.html). However, Bitcoin Core does not currently utilise it.",
          "created_at": "2025-02-13T15:54:57Z"
        },
        {
          "user": "theuni",
          "body": "@stickies-v Thanks for pointing that out, that was accidental! I actually didn't notice the difference. I think we should fix it so that they're aligned instead of having a single outlier.\r\n\r\n~Though.. would it make sense to rename the target to `libbitcoinkernel` instead of changing the component to `bitcoinkernel`? I think the former would be more obvious?~\r\n\r\nEdit: nm, can't do that as CMake will rename the resulting file to liblibbitcoinkernel.so.",
          "created_at": "2025-02-13T17:33:00Z"
        },
        {
          "user": "theuni",
          "body": "Addressed @stickies-v's review.\r\n\r\nOnly change of interest is changing the name of the `Kernel` component to `bitcoinkernel` rather than `libbitcoinkernel` as it was before.",
          "created_at": "2025-02-13T18:28:46Z"
        },
        {
          "user": "hebasto",
          "body": "> @stickies-v Thanks for pointing that out, that was accidental! I actually didn't notice the difference. I think we should fix it so that they're aligned instead of having a single outlier.\r\n> \r\n> ~Though.. would it make sense to rename the target to `libbitcoinkernel` instead of changing the component to `bitcoinkernel`? I think the former would be more obvious?~\r\n> \r\n> Edit: nm, can't do that as CMake will rename the resulting file to liblibbitcoinkernel.so.\r\n\r\nBut we can:\r\n```cmake\r\nadd_custom_target(libbitcoinkernel)\r\nadd_dependencies(libbitcoinkernel bitcoinkernel)\r\n```",
          "created_at": "2025-02-13T21:36:53Z"
        },
        {
          "user": "Sjors",
          "body": "Tested 9b033bebb18dfd609c02736292f37cc6589fcc8d a bit on arm macOS 15.3.",
          "created_at": "2025-02-14T10:34:04Z"
        },
        {
          "user": "s373nZ",
          "body": "re-ACK https://github.com/bitcoin/bitcoin/commit/9b033bebb18dfd609c02736292f37cc6589fcc8d\r\n\r\nConsider the prefix name feedback a nit.",
          "created_at": "2025-02-14T13:22:42Z"
        },
        {
          "user": "theuni",
          "body": "> > @stickies-v Thanks for pointing that out, that was accidental! I actually didn't notice the difference. I think we should fix it so that they're aligned instead of having a single outlier.\r\n> > ~Though.. would it make sense to rename the target to `libbitcoinkernel` instead of changing the component to `bitcoinkernel`? I think the former would be more obvious?~\r\n> > Edit: nm, can't do that as CMake will rename the resulting file to liblibbitcoinkernel.so.\r\n> \r\n> But we can:\r\n> \r\n> ```cmake\r\n> add_custom_target(libbitcoinkernel)\r\n> add_dependencies(libbitcoinkernel bitcoinkernel)\r\n> ```\r\n\r\nClever :)\r\n\r\nWant to PR that along with a comment along the lines of \"Add a convenience libbitcoinkernel target as a synonym for bitcoinkernel\" and I'll give it a quick ACK?",
          "created_at": "2025-02-14T16:50:04Z"
        },
        {
          "user": "hebasto",
          "body": "> Want to PR that along with a comment along the lines of \"Add a convenience libbitcoinkernel target as a synonym for bitcoinkernel\" and I'll give it a quick ACK?\r\n\r\nhttps://github.com/bitcoin/bitcoin/pull/31869.",
          "created_at": "2025-02-14T17:10:12Z"
        },
        {
          "user": "hebasto",
          "body": "> ACK [9b033be](https://github.com/bitcoin/bitcoin/commit/9b033bebb18dfd609c02736292f37cc6589fcc8d).\r\n\r\nMy apologies not very solid testing, but this branch seems not always working:\r\n```\r\n$ cmake -B build -G Ninja -DBUILD_UTIL_CHAINSTATE=ON -DBUILD_SHARED_LIBS=OFF\r\n$ cmake --build build --target bitcoinkernel\r\n$ cmake --install build --component bitcoinkernel --prefix /home/hebasto/INSTALL\r\n-- Install configuration: \"RelWithDebInfo\"\r\nCMake Error at build/src/kernel/cmake_install.cmake:46 (file):\r\n  file INSTALL cannot find\r\n  \"/home/hebasto/dev/bitcoin/build/src/crypto/libbitcoin_crypto.a\": No such\r\n  file or directory.\r\nCall Stack (most recent call first):\r\n  build/src/cmake_install.cmake:172 (include)\r\n  build/cmake_install.cmake:57 (include)\r\n\r\n\r\n```\r\n\r\nUPD. This behaviour is not introduced in this PR and is observed @ 7bbd761e816b713ac88c87f8b0045ea2f958ecbf.",
          "created_at": "2025-02-14T17:21:42Z"
        }
      ]
    },
    {
      "number": 31841,
      "title": "fuzz: Use immediate task runner to increase fuzz stability",
      "body": "Leaking a scheduler with a non-empty queue from the fuzz initialization phase into the fuzz target execution phase is problematic, because it messes with coverage data. This in turn is problematic, because it leads to:\r\n\r\n* Decrease in fuzz target execution stability (non-determinism when running the fuzz target).\r\n* Decrease in fuzz input merge stability (non-determinism when selecting a minimum set of fuzz input to reach maximum coverage), which leads to qa-assets bloat.\r\n\r\nFix one such issue. Tracking issue: https://github.com/bitcoin/bitcoin/issues/29018\r\n\r\nCan be tested via: `RUST_BACKTRACE=1 cargo run --manifest-path ./contrib/devtools/deterministic-fuzz-coverage/Cargo.toml -- $PWD/bld-cmake $PWD/../b-c-qa-assets/fuzz_corpora/ partially_downloaded_block`.\r\n\r\nThe failure is non-deterministic (obviously) and will show coverage in validation signals such as `UpdatedBlockTip` before this change and will have this one fixed after this change.",
      "state": "closed",
      "user": "maflcko",
      "created_at": "2025-02-11T13:42:49Z",
      "updated_at": "2025-03-21T07:06:57Z",
      "comments": 12,
      "url": "https://github.com/bitcoin/bitcoin/pull/31841",
      "labels": [
        "Tests"
      ],
      "comment_list": [
        {
          "user": "DrahtBot",
          "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/31841.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| ACK | [marcofleon](https://github.com/bitcoin/bitcoin/pull/31841#pullrequestreview-2691764413), [dergoegge](https://github.com/bitcoin/bitcoin/pull/31841#pullrequestreview-2702662698) |\n\nIf your review is incorrectly listed, please react with ðŸ‘Ž to this comment and the bot will ignore it on the next update.\n",
          "created_at": "2025-02-11T13:42:52Z"
        },
        {
          "user": "maflcko",
          "body": "Actually, this is incomplete. It will handle the coverage generated in the notification itself (`f()`), but there is no guarantee that the re-lock is handled as well when the context ends happens before fuzz target execution starts after init. Relevant scope for the re-lock:\r\n\r\nhttps://github.com/bitcoin/bitcoin/blob/86528937e5c4da2e12c46085fc41e87ed759258e/src/scheduler.cpp#L56-L61\r\n\r\nThe change here should be an improvement, but I wonder if there is a trivial one-line complete solution.\r\n\r\nOn alternative would be to inline the scheduler in tests (make it synchronous), but the patch would be larger.",
          "created_at": "2025-02-11T16:47:46Z"
        },
        {
          "user": "DrahtBot",
          "body": "<!--85328a0da195eb286784d51f73fa0af9-->\nðŸš§ At least one of the CI tasks failed.\n<sub>Debug: https://github.com/bitcoin/bitcoin/runs/37046883391</sub>\n\n<details><summary>Hints</summary>\n\nTry to run the tests locally, according to the documentation. However, a CI failure may still\nhappen due to a number of reasons, for example:\n\n* Possibly due to a silent merge conflict (the changes in this pull request being\nincompatible with the current code in the target branch). If so, make sure to rebase on the latest\ncommit of the target branch.\n\n* A sanitizer issue, which can only be found by compiling with the sanitizer and running the\n  affected test.\n\n* An intermittent issue.\n\nLeave a comment here, if you need help tracking down a confusing failure.\n\n</details>\n",
          "created_at": "2025-02-11T19:27:16Z"
        },
        {
          "user": "maflcko",
          "body": "> On alternative would be to inline the scheduler in tests (make it synchronous), but the patch would be larger.\r\n\r\nLooks like this will lead to deadlocks due to lock order inversions between cs_main and cs_wallet in the unit tests. I'll try to apply it to the fuzz tests only. If there are still issues in this pull, or in the future, they could be worked around for the affected fuzz target.",
          "created_at": "2025-02-11T19:47:27Z"
        },
        {
          "user": "maflcko",
          "body": "CI passed and coverage is as expected:\r\n\r\n* This pull: https://drahtbot.space/host_reports/DrahtBot/reports/coverage_fuzz/monotree/faad87189015e559/733f70b21be22925/fuzz.coverage/index.html\r\n* Before this pull: https://drahtbot.space/host_reports/DrahtBot/reports/coverage_fuzz/monotree/6a46be75c43e6489/733f70b21be22925/fuzz.coverage/index.html",
          "created_at": "2025-02-13T12:44:46Z"
        },
        {
          "user": "dergoegge",
          "body": "Concept ACK",
          "created_at": "2025-02-19T10:36:17Z"
        },
        {
          "user": "maflcko",
          "body": "(rebased without changes to make testing easier)",
          "created_at": "2025-02-19T10:38:45Z"
        },
        {
          "user": "fanquake",
          "body": "cc @marcofleon ",
          "created_at": "2025-03-17T06:50:08Z"
        },
        {
          "user": "maflcko",
          "body": "> Am I correct in saying that this change makes calling something like `SyncWithValidationInterfaceQueue()` in fuzz targets effectively a no-op?\r\n\r\nYes, they could be removed now. Happy to include that here, but they should also be harmless.",
          "created_at": "2025-03-17T19:35:10Z"
        },
        {
          "user": "marcofleon",
          "body": "> Happy to include that here\r\n\r\nNo need, just confirming for my own understanding. ",
          "created_at": "2025-03-18T10:57:30Z"
        },
        {
          "user": "maflcko",
          "body": "> The only downside to this is that we diverge from the production setup and e.g. bugs that only occur when fuzzing and using the `SerialTaskRunner` would be masked by this change.\r\n\r\nRight, but I wonder what type of bug this could possibly uncover, given that the fuzz targets are mostly single threaded and require some kind of sync (like `SyncWithValidationInterfaceQueue`) when they use the task runner.\r\n\r\nObviously, bugs in `CScheduler` itself could be missed. Though, if we are worried about that, a `CScheduler` fuzz target should be added. Unrelated to this pull, if we want to test multiple threads to detect lock issues and data races, I presume we'd have to add a specific fuzz target for those as well and add a tsan-fuzz CI task.",
          "created_at": "2025-03-20T14:13:29Z"
        },
        {
          "user": "sedited",
          "body": "Post-merge ACK",
          "created_at": "2025-03-21T05:36:39Z"
        }
      ]
    },
    {
      "number": 31840,
      "title": "depends: add missing Darwin objcopy",
      "body": "Our CMake toolchain for a Darwin cross build currently contains:\r\n```bash\r\nset(CMAKE_AR \"/usr/bin/llvm-ar\")\r\nset(CMAKE_RANLIB \"/usr/bin/llvm-ranlib\")\r\nset(CMAKE_STRIP \"/usr/bin/llvm-strip\")\r\nset(CMAKE_OBJCOPY \"arm64-apple-darwin-objcopy\")\r\nset(CMAKE_OBJDUMP \"/usr/bin/llvm-objdump\")\r\n```\r\n\r\n`objcopy` isn't currently used for the Darwin build (only for Linux and splitting the debug symbols), but we shouldn't be producing a toolchain file that refers to nonexistent tools.",
      "state": "closed",
      "user": "fanquake",
      "created_at": "2025-02-11T10:56:05Z",
      "updated_at": "2025-07-20T01:27:18Z",
      "comments": 7,
      "url": "https://github.com/bitcoin/bitcoin/pull/31840",
      "labels": [
        "Build system"
      ],
      "comment_list": [
        {
          "user": "DrahtBot",
          "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/31840.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| ACK | [laanwj](https://github.com/bitcoin/bitcoin/pull/31840#pullrequestreview-2612710149), [theuni](https://github.com/bitcoin/bitcoin/pull/31840#pullrequestreview-2612728849) |\n\nIf your review is incorrectly listed, please react with ðŸ‘Ž to this comment and the bot will ignore it on the next update.\n",
          "created_at": "2025-02-11T10:56:09Z"
        },
        {
          "user": "hebasto",
          "body": "> Our CMake toolchain for a Darwin cross build currently contains:\r\n> \r\n> ```shell\r\n> set(CMAKE_AR \"/usr/bin/llvm-ar\")\r\n> set(CMAKE_RANLIB \"/usr/bin/llvm-ranlib\")\r\n> set(CMAKE_STRIP \"/usr/bin/llvm-strip\")\r\n> set(CMAKE_OBJCOPY \"arm64-apple-darwin-objcopy\")\r\n> set(CMAKE_OBJDUMP \"/usr/bin/llvm-objdump\")\r\n> ```\r\n> \r\n> `objcopy` isn't currently used for the Darwin build (only for Linux and splitting the debug symbols), but we shouldn't be producing a toolchain file that refers to nonexistent tools.\r\n\r\nFrom CMakeâ€™s [perspective](https://gitlab.kitware.com/cmake/cmake/-/blob/master/Modules/CMakeFindBinUtils.cmake), the complete toolchain for the Darwin platform additionally includes `install_name_tool`. It seems reasonable to reconsider 3bee51427a05075150721f0a05ead8f92e1ba019 to avoid the following hack:https://github.com/bitcoin/bitcoin/blob/c242fa5be358150d83c2446896b6f4c45c6365e9/CMakeLists.txt#L62-L66",
          "created_at": "2025-02-13T15:15:50Z"
        },
        {
          "user": "theuni",
          "body": "@hebasto Agreed as long as it's trivial. From what I can tell `llvm-install-name-tool` is just as available as the rest of the tools, so even though it's annoying because it's not actually necessary, I don't see much harm in setting it. @fanquake ?\r\n\r\nThis required a similar hack for https://github.com/bitcoin/bitcoin/pull/30434 as well.",
          "created_at": "2025-02-13T17:18:29Z"
        },
        {
          "user": "fanquake",
          "body": "> even though it's annoying because it's not actually necessary, I don't see much harm in setting it. @fanquake ?\r\n\r\nI'm just not sure of us having to setup/provide tools because CMake thinks they should be available, when we don't use them. iirc one of the issues with `install-name-tool` was that it was only available version-suffixed on certain distros (even when the main llvm install was not suffixed), making it hard to find. \r\n\r\n> This required a similar hack for https://github.com/bitcoin/bitcoin/pull/30434 as well.\r\n\r\nThis hack is only to work around other Boost/CMake issues right? (CMake wants a tool available to compile libraries just for us to throw those libraries away anyways). I'm not sure redundantly compiling things is a great argument for setting up tools we don't otherwise need.\r\n\r\nI'm assuming there are likely other tools/programs for various toolchains that CMake might expect in some sense, that we aren't providing (or using) or ensuring are available?",
          "created_at": "2025-02-13T17:55:13Z"
        },
        {
          "user": "theuni",
          "body": "> > even though it's annoying because it's not actually necessary, I don't see much harm in setting it. @fanquake ?\r\n> \r\n> I'm just not sure of us having to setup/provide tools because CMake thinks they should be available, when we don't use them. iirc one of the issues with `install-name-tool` was that it was only available version-suffixed on certain distros (even when the main llvm install was not suffixed), making it hard to find.\r\n\r\nAh right, I'd forgotten that bit. Blah.\r\n\r\nYeah, ok, nevermind. I figured there was no harm in adding this if it was trivial, but indeed the missing prefix makes it annoying enough to treat differently.",
          "created_at": "2025-02-13T18:32:12Z"
        },
        {
          "user": "hebasto",
          "body": "> iirc one of the issues with `install-name-tool` was that it was only available version-suffixed on certain distros (even when the main llvm install was not suffixed), making it hard to find.\r\n\r\nIf it's not too much trouble, could you recall which distros those were?",
          "created_at": "2025-02-14T08:53:56Z"
        },
        {
          "user": "fanquake",
          "body": "> If it's not too much trouble, could you recall which distros those were?\r\n\r\nIt's still the case with Ubuntu, i.e 24.04:\r\n```bash\r\n# apt install llvm\r\n# ls /usr/bin/llvm-* | grep objdump\r\n/usr/bin/llvm-objdump\r\n/usr/bin/llvm-objdump-18\r\n# ls /usr/bin/llvm-* | grep install-name\r\n/usr/bin/llvm-install-name-tool-18\r\n```",
          "created_at": "2025-02-14T13:44:32Z"
        }
      ]
    },
    {
      "number": 31839,
      "title": "streams: Add stream position validation in BufferedFile::AdvanceStream",
      "body": "Description:\r\nAdd safety check in BufferedFile::AdvanceStream to prevent potential integer overflow when calculating bytes_until_source_pos. This ensures that m_read_pos never exceeds nSrcPos, which could lead to undefined behavior.\r\n\r\nThe change:\r\n- Adds validation before calculating (nSrcPos - m_read_pos)\r\n- Throws std::ios_base::failure if invalid state is detected",
      "state": "closed",
      "user": "crStiv",
      "created_at": "2025-02-11T00:41:30Z",
      "updated_at": "2025-02-11T16:57:42Z",
      "comments": 2,
      "url": "https://github.com/bitcoin/bitcoin/pull/31839",
      "labels": [],
      "comment_list": [
        {
          "user": "DrahtBot",
          "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/31839.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\nA summary of reviews will appear here.\n",
          "created_at": "2025-02-11T00:41:33Z"
        },
        {
          "user": "maflcko",
          "body": "The prior assert with the exact same check covers this. This is adding dead code.\r\n\r\nIs this AI generated?",
          "created_at": "2025-02-11T07:06:10Z"
        }
      ]
    }
  ],
  "issues": [
    {
      "number": 31843,
      "title": "build: `-static-pie` builds no-longer working with CMake",
      "body": "Using 28.x, it's easy to produce a `-static-pie` binary doing:\n```bash\n# aarch64 alpine, 28.x (32efe850438ef22e2de39e562af557872a402c31)\nmake -C depends/ NO_QT=1 NO_WALLET=1 NO_ZMQ=1 NO_USDT=1 NO_UPNP=1 NO_NATPMP=1 LDFLAGS=\"-static-pie\"\n./autogen.sh\nCONFIG_SITE=/bitcoin/depends/aarch64-unknown-linux-musl/share/config.site ./configure\nmake src/bitcoind\n# link line\nlibtool: link: /usr/bin/ccache g++ -std=c++20 <snip> -fPIE <snip> -pie -static-pie -o bitcoind bitcoind-bitcoind.o ....\n# file src/bitcoind\nsrc/bitcoind: ELF 64-bit LSB pie executable, ARM aarch64, version 1 (SYSV), static-pie linked, BuildID[sha1]=b2b5020870722780c89654169ae9e8d21fde955b, with debug_info, not stripped\n```\n\nThis no-longer works with master (86528937e5c4da2e12c46085fc41e87ed759258e):\n```bash\n# aarch64 alpine, master (86528937e5c4da2e12c46085fc41e87ed759258e)\nmake -C depends/ NO_QT=1 NO_WALLET=1 NO_ZMQ=1 NO_USDT=1 LDFLAGS=\"-static-pie\"\ncmake -B build --toolchain /bitcoin/depends/aarch64-unknown-linux-musl/toolchain.cmake\ncmake --build build --target bitcoind\n# link line\n/usr/bin/g++ <snip> -static-pie <snip> -fPIE -pie <snip> CMakeFiles/bitcoind.dir/init/bitcoind.cpp.o -o bitcoind  ....\n# file build/src/bitcoind\nbuild/src/bitcoind: ELF 64-bit LSB pie executable, ARM aarch64, version 1 (SYSV), dynamically linked, interpreter /lib/ld-musl-aarch64.so.1, BuildID[sha1]=fc952a9ebce3b0627f2b93f0a6011323071ce27a, with debug_info, not stripped\n```\n\nI assumed using something like [`-DCMAKE_EXE_LINKER_FLAGS`](https://cmake.org/cmake/help/latest/variable/CMAKE_EXE_LINKER_FLAGS.html) would work, but it also does not:\n```bash\n# aarch64 alpine, master (86528937e5c4da2e12c46085fc41e87ed759258e)\nmake -C depends/ NO_QT=1 NO_WALLET=1 NO_ZMQ=1 NO_USDT=1\ncmake -B build --toolchain /bitcoin/depends/aarch64-unknown-linux-musl/toolchain.cmake -DCMAKE_EXE_LINKER_FLAGS=\"-static-pie\"\ncmake --build build --target bitcoind\n# link line\n/usr/bin/g++ <snip> -static-pie <snip> -fPIE -pie <snip> CMakeFiles/bitcoind.dir/init/bitcoind.cpp.o -o bitcoind â€¦\n# file build/src/bitcoind\nbuild/src/bitcoind: ELF 64-bit LSB pie executable, ARM aarch64, version 1 (SYSV), dynamically linked, interpreter /lib/ld-musl-aarch64.so.1, BuildID[sha1]=fc952a9ebce3b0627f2b93f0a6011323071ce27a, with debug_info, not stripped\n```\n\nSeems this is due to the linker flag ordering, where `-pie` is now appearing later on the link line, and nullifying the `-static-pie`.\nYou can make things work using `-DAPPEND_LDFLAGS`, but using this (non-standard workaround) shouldn't be necessary.",
      "state": "open",
      "user": "fanquake",
      "created_at": "2025-02-11T15:08:27Z",
      "updated_at": "2025-03-12T03:08:17Z",
      "comments": 7,
      "url": "https://github.com/bitcoin/bitcoin/issues/31843",
      "labels": [
        "Build system",
        "Upstream"
      ],
      "comment_list": [
        {
          "user": "hebasto",
          "body": "> You can make things work using `-DAPPEND_LDFLAGS`, but using this (non-standard workaround) shouldn't be necessary.\n\nThis can be achieved by introducing a dedicated build option, such as `ENABLE_STATIC_PIE`, if that's acceptable.",
          "created_at": "2025-03-07T08:45:28Z"
        },
        {
          "user": "fanquake",
          "body": ">  introducing a dedicated build option, such as ENABLE_STATIC_PIE, if that's acceptable.\n\nI don't think so. We shouldn't have to introduce our own options, to map to compiler options, to workaround CMake issues. This seems like something that needs to be solved in CMake itself.",
          "created_at": "2025-03-07T09:11:26Z"
        },
        {
          "user": "Sjors",
          "body": "Same suggestion as https://github.com/bitcoin/bitcoin/issues/31491#issuecomment-2705984429 to document this as a known cmake-migration regression in release notes.",
          "created_at": "2025-03-07T09:45:52Z"
        },
        {
          "user": "hebasto",
          "body": "> This seems like something that needs to be solved in CMake itself.\n\nAsked here: https://discourse.cmake.org/t/static-pie-is-incompatible-with-checkpiesupported/13696",
          "created_at": "2025-03-07T17:16:13Z"
        },
        {
          "user": "hebasto",
          "body": "> > This seems like something that needs to be solved in CMake itself.\n> \n> Asked here: https://discourse.cmake.org/t/static-pie-is-incompatible-with-checkpiesupported/13696\n\nUpstream issue: https://gitlab.kitware.com/cmake/cmake/-/issues/26757.",
          "created_at": "2025-03-11T11:20:50Z"
        },
        {
          "user": "hebasto",
          "body": "> You can make things work using `-DAPPEND_LDFLAGS`, but using this (non-standard workaround) shouldn't be necessary.\n\nIt has been clarified that this is a CMake issue, and we have a workaround for it.\n\nShould this issue still be a blocker for 29.0?",
          "created_at": "2025-03-11T11:24:36Z"
        },
        {
          "user": "fanquake",
          "body": "We'll just have to use workarounds for `29.x`; hopefully CMake will fix it at some point. Somewhat suprising that we are the first to raise the issue, given the `-static-pie` option has existed in GCC for ~8 years.",
          "created_at": "2025-03-12T03:08:16Z"
        }
      ]
    },
    {
      "number": 31842,
      "title": "Wallet symlinks are not rejected as expected",
      "body": "Since https://github.com/bitcoin/bitcoin/pull/10885, `bitcoind` is expected to reject symlinks to wallets. This behaviour is also intended to be tested in the following test:https://github.com/bitcoin/bitcoin/blob/86528937e5c4da2e12c46085fc41e87ed759258e/test/functional/wallet_multiwallet.py#L168-L170\n\nHowever, this is not the case:\n```\n$ ls -l ~/.bitcoin/regtest/wallets/\ntotal 3\ndrwx------ 2 hebasto hebasto  3 Feb 11 14:49 w8\nlrwxrwxrwx 1 hebasto hebasto 41 Feb 11 14:11 w8_symlink_abs -> /home/hebasto/.bitcoin/regtest/wallets/w8\nlrwxrwxrwx 1 hebasto hebasto  2 Feb 11 14:31 w8_symlink_rel -> w8\n$ ./build/src/bitcoind -regtest -wallet=w8_symlink_abs\n$ ./build/src/bitcoin-cli -regtest listwallets\n[\n  \"w8_symlink_abs\"\n]\n$ ./build/src/bitcoind -regtest -wallet=w8_symlink_rel\n$ ./build/src/bitcoin-cli -regtest listwallets\n[\n  \"w8_symlink_rel\"\n]\n```",
      "state": "closed",
      "user": "hebasto",
      "created_at": "2025-02-11T15:03:19Z",
      "updated_at": "2025-02-11T21:23:51Z",
      "comments": 1,
      "url": "https://github.com/bitcoin/bitcoin/issues/31842",
      "labels": [
        "Wallet"
      ],
      "comment_list": [
        {
          "user": "achow101",
          "body": "Symlink to a wallet directory is allowed, but a symlink to a wallet file is not. What you've tested manually is a symlink to a wallet directory, so it works.",
          "created_at": "2025-02-11T18:56:13Z"
        }
      ]
    }
  ],
  "summary": {
    "pull_requests": 4,
    "issues": 2
  }
}