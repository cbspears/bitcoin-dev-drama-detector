{
  "source": "github",
  "repository": "bitcoin/bitcoin",
  "fetched_at": "2026-01-15T20:43:30.627476+00:00",
  "date": "2025-12-28",
  "pull_requests": [
    {
      "number": 34167,
      "title": "tests: add concise docstrings in chain_tiebreaks",
      "body": "Added concise docstrings for test_chain_split_in_memory and test_chain_split_from_disk",
      "state": "closed",
      "user": "Olly60",
      "created_at": "2025-12-28T21:45:25Z",
      "updated_at": "2026-01-05T08:25:29Z",
      "comments": 2,
      "url": "https://github.com/bitcoin/bitcoin/pull/34167",
      "labels": [
        "Tests"
      ],
      "comment_list": [
        {
          "user": "DrahtBot",
          "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/34167.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\nA summary of reviews will appear here.\n<!--5faf32d7da4f0f540f40219e4f7537a3-->",
          "created_at": "2025-12-28T21:45:32Z"
        },
        {
          "user": "maflcko",
          "body": "Please squash your commits according to https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#squashing-commits\r\n\r\nThough, I think the code is already self-documenting. So thx, but i think i'll close this for now.",
          "created_at": "2026-01-05T08:25:28Z"
        }
      ]
    },
    {
      "number": 34166,
      "title": ".",
      "body": ".",
      "state": "closed",
      "user": "Olly60",
      "created_at": "2025-12-28T21:13:49Z",
      "updated_at": "2025-12-29T17:44:54Z",
      "comments": 1,
      "url": "https://github.com/bitcoin/bitcoin/pull/34166",
      "labels": [],
      "comment_list": [
        {
          "user": "DrahtBot",
          "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/34166.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\nA summary of reviews will appear here.\n<!--5faf32d7da4f0f540f40219e4f7537a3-->\n### LLM Linter (‚ú® experimental)\n\n\n\nPossible typos and grammar issues:\n\n- # B9 is now active. Despite B7 being received earlier, the missing parent. -> # B9 is now active. Despite B7 being received earlier, the missing parent caused B9 to become active. [original is a sentence fragment and is incomplete; replacement makes the causal relationship explicit]\n\n\n\n<sup>2025-12-28</sup>\n",
          "created_at": "2025-12-28T21:13:56Z"
        }
      ]
    },
    {
      "number": 34165,
      "title": "coins: don't mutate main cache when connecting block",
      "body": "This is a slightly modified version of the second commit of #31132, which can be merged as an independent change. It has a small benefit on its own, but will help in moving the parent PR forward.\r\n\r\nWhen accessing coins via the `CCoinsViewCache`, the const methods like `GetCoin` actually mutate `cacheCoins` internally to cache entries when they are pulled from the backing db. This is generally a performance improvement for single threaded access patterns, but it precludes us from accessing entries in a `CCoinsViewCache` from multiple threads without a lock.\r\n\r\nAnother aspect is that when we add an ephemeral `CCoinsViewCache` view backed by the main cache for use in `ConnectBlock()`, we will insert entries into the main cache even if the block is determined to be invalid. This is not the biggest concern, since an invalid block requires proof-of-work. But, an attacker could craft multiple invalid blocks to fill the main cache. This would make us `Flush` the cache more often than necessary. Obviously this would be very expensive to do on mainnet.\r\n\r\nIntroduce `CoinsViewCacheNonMutating`, a `CCoinsViewCache` subclass that reads coins without mutating the underlying cache via `FetchCoin()`.\r\n\r\nAdd `PeekCoin()` to look up a Coin through a stack of `CCoinsViewCache` layers without populating parent caches. This prevents the main cache from caching inputs pulled from disk for a block that has not yet been fully validated. Once `Flush()` is called on the view, these inputs will be added as spent to `coinsCache` in the main cache via `BatchWrite()`.\r\n\r\nThis is the foundation for async input fetching, where worker threads must not mutate shared state.\r\n",
      "state": "open",
      "user": "andrewtoth",
      "created_at": "2025-12-28T20:32:34Z",
      "updated_at": "2026-01-11T00:53:42Z",
      "comments": 4,
      "url": "https://github.com/bitcoin/bitcoin/pull/34165",
      "labels": [
        "UTXO Db and Indexes"
      ],
      "comment_list": [
        {
          "user": "DrahtBot",
          "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/34165.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| ACK | [l0rinc](https://github.com/bitcoin/bitcoin/pull/34165#issuecomment-3733769971) |\n\nIf your review is incorrectly listed, please copy-paste <code>&lt;!--meta-tag:bot-skip--&gt;</code> into the comment that the bot should ignore.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#34164](https://github.com/bitcoin/bitcoin/pull/34164) (validation: add reusable coins view for ConnectBlock by andrewtoth)\n* [#34124](https://github.com/bitcoin/bitcoin/pull/34124) (refactor: make `CCoinsView` a purely virtual abstract base class by l0rinc)\n* [#32317](https://github.com/bitcoin/bitcoin/pull/32317) (kernel: Separate UTXO set access from validation functions by sedited)\n* [#31132](https://github.com/bitcoin/bitcoin/pull/31132) (validation: fetch block inputs on parallel threads 3x faster IBD by andrewtoth)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n<!--5faf32d7da4f0f540f40219e4f7537a3-->",
          "created_at": "2025-12-28T20:32:40Z"
        },
        {
          "user": "andrewtoth",
          "body": "Thank you @l0rinc, I have taken your integration test. I had unit tests for this behavior but the integration test is a great idea.",
          "created_at": "2026-01-02T15:00:46Z"
        },
        {
          "user": "DrahtBot",
          "body": "<!--85328a0da195eb286784d51f73fa0af9-->\nüöß At least one of the CI tasks failed.\n<sub>Task `macOS native`: https://github.com/bitcoin/bitcoin/actions/runs/20681569759/job/59376499348</sub>\n<sub>LLM reason (‚ú® experimental): Blockchain tests aborted due to a DisconnectTip failure during tip/disconnect handling (BLOCK_FAILED_VALID), causing the CI run to fail.</sub>\n\n<details><summary>Hints</summary>\n\nTry to run the tests locally, according to the documentation. However, a CI failure may still\nhappen due to a number of reasons, for example:\n\n* Possibly due to a silent merge conflict (the changes in this pull request being\nincompatible with the current code in the target branch). If so, make sure to rebase on the latest\ncommit of the target branch.\n\n* A sanitizer issue, which can only be found by compiling with the sanitizer and running the\n  affected test.\n\n* An intermittent issue.\n\nLeave a comment here, if you need help tracking down a confusing failure.\n\n</details>\n\n",
          "created_at": "2026-01-03T19:22:37Z"
        },
        {
          "user": "l0rinc",
          "body": "Ran a `reindex-chainstate`, no measurable change compared to master: üëç\r\n\r\nACK 2e67c5b604d2cf2e56db6b5d2906391d22113941",
          "created_at": "2026-01-11T00:53:39Z"
        }
      ]
    },
    {
      "number": 34164,
      "title": "validation: add reusable coins view for ConnectBlock",
      "body": "This is the first commit of #31132, which can be merged as an independent change. It has a small benefit on its own, but will help in moving the parent PR forward.\r\n\r\nAdd a `Reset()` method to `CCoinsViewCache` that clears `cacheCoins`, `cachedCoinsUsage`, and `hashBlock` without flushing to the `base` view. This allows efficiently reusing a cache instance across multiple blocks.\r\n\r\nIntroduce `CoinsViewCacheController` to wrap a `CCoinsViewCache` and provide scoped access through a `Handle`. The `Handle` dereferences to the cache and automatically calls `Reset()` on destruction. This RAII pattern ensures the cache is always properly reset between blocks.\r\n\r\nAdd `m_connect_block_controller` as a persistent controller for `ConnectBlock`, avoiding repeated memory allocations.",
      "state": "open",
      "user": "andrewtoth",
      "created_at": "2025-12-28T20:05:04Z",
      "updated_at": "2026-01-15T15:22:34Z",
      "comments": 3,
      "url": "https://github.com/bitcoin/bitcoin/pull/34164",
      "labels": [
        "Validation"
      ],
      "comment_list": [
        {
          "user": "DrahtBot",
          "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/34164.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| Stale ACK | [l0rinc](https://github.com/bitcoin/bitcoin/pull/34164#pullrequestreview-3627385946), [bensig](https://github.com/bitcoin/bitcoin/pull/34164#issuecomment-3712250396) |\n\nIf your review is incorrectly listed, please copy-paste <code>&lt;!--meta-tag:bot-skip--&gt;</code> into the comment that the bot should ignore.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#34165](https://github.com/bitcoin/bitcoin/pull/34165) (coins: don't mutate main cache when connecting block by andrewtoth)\n* [#34132](https://github.com/bitcoin/bitcoin/pull/34132) (refactor: inline `CCoinsViewErrorCatcher` into `CCoinsViewDB` by l0rinc)\n* [#34124](https://github.com/bitcoin/bitcoin/pull/34124) (refactor: make `CCoinsView` a purely virtual abstract base class by l0rinc)\n* [#32317](https://github.com/bitcoin/bitcoin/pull/32317) (kernel: Separate UTXO set access from validation functions by sedited)\n* [#31132](https://github.com/bitcoin/bitcoin/pull/31132) (validation: fetch block inputs on parallel threads 3x faster IBD by andrewtoth)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n<!--5faf32d7da4f0f540f40219e4f7537a3-->",
          "created_at": "2025-12-28T20:05:11Z"
        },
        {
          "user": "bensig",
          "body": "ACK b46b61bdcefbaa649fc73b8f8936bc80468de763\r\n\r\nBuilt and tested on macOS. Clean implementation - `Reset()` method is straightforward, tests cover it well, and the `m_connect_block_view` integration in `ConnectTip()` correctly calls `Reset()` on both failure and success paths.",
          "created_at": "2026-01-05T22:06:42Z"
        },
        {
          "user": "andrewtoth",
          "body": "I updated this to have the `ChainState` own a controller instead of the actual `CCoinsViewCache`. The controller owns a private `CCoinsViewCache`, and returns a handle to it via a `Start` method. The handle dereferences to the `CCoinsViewCache`, and automatically calls `Reset` when the handle goes out of scope.",
          "created_at": "2026-01-15T15:22:34Z"
        }
      ]
    },
    {
      "number": 34162,
      "title": "net: Avoid undershooting in GetAddressesUnsafe",
      "body": "This is demonstrating an alternative approach to #33663. The author didn't seem to like by suggestion so I am putting it here to be considered by reviewers. I personally prefer this approach due to it's simplicity.\r\n\r\n`GetAddressesUnsafe` filters banned and discouraged addresses if those exist. If addresses are filtered the returned list of addresses can be shorter than originally requested because the list isn't backfilled with more valid addresses. These results end up in `GETADDR` responses as well as the `getnodeaddresses` RPC.\r\n\r\nFix this by requesting all available addresses and filter them, then only trim them to the requested `max_addresses` afterwards. Also adds a functional test which checks the new behavior via `getnodeaddresses` RPC.",
      "state": "open",
      "user": "fjahr",
      "created_at": "2025-12-28T17:01:53Z",
      "updated_at": "2026-01-08T20:08:48Z",
      "comments": 3,
      "url": "https://github.com/bitcoin/bitcoin/pull/34162",
      "labels": [
        "P2P"
      ],
      "comment_list": [
        {
          "user": "DrahtBot",
          "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/34162.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| ACK | [Bicaru20](https://github.com/bitcoin/bitcoin/pull/34162#issuecomment-3695165157), [bensig](https://github.com/bitcoin/bitcoin/pull/34162#issuecomment-3725563400) |\n| Concept ACK | [danielabrozzoni](https://github.com/bitcoin/bitcoin/pull/34162#pullrequestreview-3616089504) |\n\nIf your review is incorrectly listed, please copy-paste <code>&lt;!--meta-tag:bot-skip--&gt;</code> into the comment that the bot should ignore.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#33663](https://github.com/bitcoin/bitcoin/pull/33663) (net: Filter addrman during address selection via AddrPolicy to avoid underfill by waketraindev)\n* [#29418](https://github.com/bitcoin/bitcoin/pull/29418) (rpc: provide per message stats for global traffic via new RPC 'getnetmsgstats' by vasild)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n<!--5faf32d7da4f0f540f40219e4f7537a3-->",
          "created_at": "2025-12-28T17:02:00Z"
        },
        {
          "user": "Bicaru20",
          "body": "Code review ACK b4394c8048bcb790d4d8e583f311040d6d20e4f2. I prefer this approach instead of the proposed in https://github.com/bitcoin/bitcoin/pull/33663 as this one is much simpler. I tested the code an it works as expected. \r\n\r\nMy only concern is the impact on efficiency, since now we are passing the filters to all available addresses instead of limiting them to `max_addresses`. However, I believe this will probably not be an issue, as the number should never be large enough to cause problems,",
          "created_at": "2025-12-29T00:14:03Z"
        },
        {
          "user": "bensig",
          "body": "ACK b4394c8048bcb790d4d8e583f311040d6d20e4f2 \r\ntested",
          "created_at": "2026-01-08T20:08:43Z"
        }
      ]
    },
    {
      "number": 34161,
      "title": "refactor: Avoid UB from `std::distance` with `nullptr` in `PoolAllocator`",
      "body": "### Problem\r\n\r\nCalling `std::distance(nullptr, nullptr)` is undefined behavior per the C++ standard [iterator.requirements.general](https://eel.is/c++draft/iterator.requirements.general#7):\r\n> Iterators can also have singular values that are not associated with any sequence. Results of most expressions are undefined for singular values.\r\n\r\nNull pointers are singular iterators not associated with any sequence, so they cannot form a valid range required by [std::distance](https://eel.is/c++draft/iterator.operations#4):\r\n> Preconditions: last is reachable from first\r\n\r\nWhile [expr.add#5.1](https://eel.is/c++draft/expr.add#5.1) defines pointer subtraction for null pointers:\r\n> If P and Q both evaluate to null pointer values, the value is 0\r\n\r\nThis applies to direct pointer arithmetic (`nullptr - nullptr`), not to `std::distance`, which has additional preconditions requiring non-singular iterators.\r\n\r\n### Fix\r\n\r\nChecked for `nullptr` before calling `std::distance` to avoid this undefined behavior.\r\nThis check only affects the very first call, after which the pointers are initialized.",
      "state": "open",
      "user": "l0rinc",
      "created_at": "2025-12-28T13:01:04Z",
      "updated_at": "2026-01-09T13:55:50Z",
      "comments": 2,
      "url": "https://github.com/bitcoin/bitcoin/pull/34161",
      "labels": [
        "Refactoring"
      ],
      "comment_list": [
        {
          "user": "DrahtBot",
          "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/34161.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| ACK | [bensig](https://github.com/bitcoin/bitcoin/pull/34161#issuecomment-3725967647) |\n\nIf your review is incorrectly listed, please copy-paste <code>&lt;!--meta-tag:bot-skip--&gt;</code> into the comment that the bot should ignore.\n<!--5faf32d7da4f0f540f40219e4f7537a3-->",
          "created_at": "2025-12-28T13:01:11Z"
        },
        {
          "user": "bensig",
          "body": "ACK b9ffd11eeca0171ac3a429aa4fc74e455a13698a\r\ntested",
          "created_at": "2026-01-08T21:44:36Z"
        }
      ]
    }
  ],
  "issues": [
    {
      "number": 34163,
      "title": "qa: Framework fails when initiating node from cached chain",
      "body": "Consider the following MRE:\n```\n#!/usr/bin/env python3\n# File: test/functional/MRE.py\n\nfrom test_framework.test_framework import BitcoinTestFramework\n\nclass MRE(BitcoinTestFramework):\n    def set_test_params(self):\n        self.num_nodes = 1\n        self.setup_clean_chain = False  # Test succeeds when True.\n\n    def skip_test_if_missing_module(self):\n        self.skip_if_no_wallet()\n\n    def run_test(self):\n        self.log.info(\"OK\")\n\nif __name__ == '__main__':\n    MRE(__file__).main()\n```\n\nOn OpenIndiana:\n```\n$ $ env CXXFLAGS=\"-pthread\" cmake -B build -DENABLE_IPC=OFF\n$ cmake --build build\n$ python3.14 ./build/test/functional/MRE.py \n2025-12-28T17:43:24.329616Z TestFramework (INFO): PRNG seed is: 2377333319933758475\n2025-12-28T17:43:24.331825Z TestFramework (INFO): Initializing test directory /tmp/bitcoin_func_test_f81ll6fk\n2025-12-28T17:43:24.627126Z TestFramework (ERROR): Unexpected exception\nTraceback (most recent call last):\n  File \"/export/home/hebasto/dev/bitcoin/test/functional/test_framework/test_framework.py\", line 138, in main\n    self.setup()\n    ~~~~~~~~~~^^\n  File \"/export/home/hebasto/dev/bitcoin/test/functional/test_framework/test_framework.py\", line 269, in setup\n    self.setup_network()\n    ~~~~~~~~~~~~~~~~~~^^\n  File \"/export/home/hebasto/dev/bitcoin/test/functional/test_framework/test_framework.py\", line 360, in setup_network\n    self.setup_nodes()\n    ~~~~~~~~~~~~~~~~^^\n  File \"/export/home/hebasto/dev/bitcoin/test/functional/test_framework/test_framework.py\", line 384, in setup_nodes\n    self.import_deterministic_coinbase_privkeys()\n    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^\n  File \"/export/home/hebasto/dev/bitcoin/test/functional/test_framework/test_framework.py\", line 401, in import_deterministic_coinbase_privkeys\n    self.init_wallet(node=i)\n    ~~~~~~~~~~~~~~~~^^^^^^^^\n  File \"/export/home/hebasto/dev/bitcoin/test/functional/test_framework/test_framework.py\", line 408, in init_wallet\n    n.createwallet(wallet_name=wallet_name, load_on_startup=True)\n    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/export/home/hebasto/dev/bitcoin/test/functional/test_framework/coverage.py\", line 50, in __call__\n    return_val = self.auth_service_proxy_instance.__call__(*args, **kwargs)\n  File \"/export/home/hebasto/dev/bitcoin/test/functional/test_framework/authproxy.py\", line 156, in __call__\n    raise JSONRPCException(response['error'], status)\ntest_framework.authproxy.JSONRPCException: Wallet file verification failed. SQLiteDatabase: Failed to open database: unable to open database file\n (-4)\n2025-12-28T17:43:24.682846Z TestFramework (INFO): Not stopping nodes as test failed. The dangling processes will be cleaned up later.\n2025-12-28T17:43:24.683153Z TestFramework (WARNING): Not cleaning up dir /tmp/bitcoin_func_test_f81ll6fk\n2025-12-28T17:43:24.683377Z TestFramework (ERROR): Test failed. Test logging available at /tmp/bitcoin_func_test_f81ll6fk/test_framework.log\n2025-12-28T17:43:24.684155Z TestFramework (ERROR): \n2025-12-28T17:43:24.684615Z TestFramework (ERROR): Hint: Call /export/home/hebasto/dev/bitcoin/test/functional/combine_logs.py '/tmp/bitcoin_func_test_f81ll6fk' to consolidate all logs\n2025-12-28T17:43:24.684729Z TestFramework (ERROR): \n2025-12-28T17:43:24.684901Z TestFramework (ERROR): If this failure happened unexpectedly or intermittently, please file a bug and provide a link or upload of the combined log.\n2025-12-28T17:43:24.685270Z TestFramework (ERROR): https://github.com/bitcoin/bitcoin/issues\n2025-12-28T17:43:24.685378Z TestFramework (ERROR): \n[node 0] Cleaning up leftover process\n```",
      "state": "open",
      "user": "hebasto",
      "created_at": "2025-12-28T18:45:59Z",
      "updated_at": "2026-01-06T00:04:46Z",
      "comments": 14,
      "url": "https://github.com/bitcoin/bitcoin/issues/34163",
      "labels": [
        "Wallet",
        "Tests",
        "Upstream"
      ],
      "comment_list": [
        {
          "user": "maflcko",
          "body": "I think the difference is where the wallets dir is located with a clean datadir vs a datadir with a chain (reminds me of https://github.com/bitcoin/bitcoin/issues/34128)\n\nIf yes, this may be possible to reproduce outside the test framework.\n\nIs OpenIndiana the only distro that fails?",
          "created_at": "2025-12-29T10:22:28Z"
        },
        {
          "user": "hebasto",
          "body": "> Is OpenIndiana the only distro that fails?\n\nYes, as far I'm aware of. OmniOS, another illumos-based distro, works fine.",
          "created_at": "2025-12-29T11:06:57Z"
        },
        {
          "user": "furszy",
          "body": "I don't think it is related to #34128. It sounds more like a permissions issue. Can try creating a wallet in the /tmp/ dir manually to test it?",
          "created_at": "2025-12-29T17:30:16Z"
        },
        {
          "user": "furszy",
          "body": "@hebasto, run #34176 whenever you get a chance.",
          "created_at": "2025-12-29T19:46:45Z"
        },
        {
          "user": "hebasto",
          "body": "> [@hebasto](https://github.com/hebasto), run [#34176](https://github.com/bitcoin/bitcoin/pull/34176) whenever you get a chance.\n\nThanks @furszy!\n\nBelow is the log of running https://github.com/bitcoin/bitcoin/pull/34176:\n```\n$ git rev-parse HEAD\n68a467799381d6e89f40267fc500b734975b5433\n$ env CXXFLAGS=\"-pthread\" cmake -B build -DENABLE_IPC=OFF\n$ cmake --build build\n$ python3.14 ./build/test/functional/MRE.py\n2025-12-29T19:35:37.016521Z TestFramework (INFO): PRNG seed is: 3863112130535673226\n2025-12-29T19:35:37.017830Z TestFramework (INFO): Initializing test directory /tmp/bitcoin_func_test_3_be70q7\n2025-12-29T19:35:37.317178Z TestFramework (ERROR): Unexpected exception\nTraceback (most recent call last):\n  File \"/export/home/hebasto/dev/bitcoin/test/functional/test_framework/test_framework.py\", line 138, in main\n    self.setup()\n    ~~~~~~~~~~^^\n  File \"/export/home/hebasto/dev/bitcoin/test/functional/test_framework/test_framework.py\", line 269, in setup\n    self.setup_network()\n    ~~~~~~~~~~~~~~~~~~^^\n  File \"/export/home/hebasto/dev/bitcoin/test/functional/test_framework/test_framework.py\", line 360, in setup_network\n    self.setup_nodes()\n    ~~~~~~~~~~~~~~~~^^\n  File \"/export/home/hebasto/dev/bitcoin/test/functional/test_framework/test_framework.py\", line 384, in setup_nodes\n    self.import_deterministic_coinbase_privkeys()\n    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^\n  File \"/export/home/hebasto/dev/bitcoin/test/functional/test_framework/test_framework.py\", line 401, in import_deterministic_coinbase_privkeys\n    self.init_wallet(node=i)\n    ~~~~~~~~~~~~~~~~^^^^^^^^\n  File \"/export/home/hebasto/dev/bitcoin/test/functional/test_framework/test_framework.py\", line 408, in init_wallet\n    n.createwallet(wallet_name=wallet_name, load_on_startup=True)\n    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/export/home/hebasto/dev/bitcoin/test/functional/test_framework/coverage.py\", line 50, in __call__\n    return_val = self.auth_service_proxy_instance.__call__(*args, **kwargs)\n  File \"/export/home/hebasto/dev/bitcoin/test/functional/test_framework/authproxy.py\", line 156, in __call__\n    raise JSONRPCException(response['error'], status)\ntest_framework.authproxy.JSONRPCException: Wallet file verification failed. SQLiteDatabase: Failed to open database: unable to open database file\n (-4)\n2025-12-29T19:35:37.372890Z TestFramework (INFO): Not stopping nodes as test failed. The dangling processes will be cleaned up later.\n2025-12-29T19:35:37.373126Z TestFramework (WARNING): Not cleaning up dir /tmp/bitcoin_func_test_3_be70q7\n2025-12-29T19:35:37.373353Z TestFramework (ERROR): Test failed. Test logging available at /tmp/bitcoin_func_test_3_be70q7/test_framework.log\n2025-12-29T19:35:37.374043Z TestFramework (ERROR): \n2025-12-29T19:35:37.374478Z TestFramework (ERROR): Hint: Call /export/home/hebasto/dev/bitcoin/test/functional/combine_logs.py '/tmp/bitcoin_func_test_3_be70q7' to consolidate all logs\n2025-12-29T19:35:37.374601Z TestFramework (ERROR): \n2025-12-29T19:35:37.374783Z TestFramework (ERROR): If this failure happened unexpectedly or intermittently, please file a bug and provide a link or upload of the combined log.\n2025-12-29T19:35:37.375148Z TestFramework (ERROR): https://github.com/bitcoin/bitcoin/issues\n2025-12-29T19:35:37.375266Z TestFramework (ERROR): \n[node 0] Cleaning up leftover process\n```\n\nThe combined log follows:\n```\n$ python3.14 /export/home/hebasto/dev/bitcoin/test/functional/combine_logs.py '/tmp/bitcoin_func_test_3_be70q7'\n test  2025-12-29T19:35:37.016521Z TestFramework (INFO): PRNG seed is: 3863112130535673226 \n test  2025-12-29T19:35:37.016742Z TestFramework (DEBUG): Setting up network thread \n test  2025-12-29T19:35:37.017830Z TestFramework (INFO): Initializing test directory /tmp/bitcoin_func_test_3_be70q7 \n test  2025-12-29T19:35:37.018043Z TestFramework (DEBUG): Copy cache directory /export/home/hebasto/dev/bitcoin/build/test/cache/node0 to node 0 \n test  2025-12-29T19:35:37.051574Z TestFramework.node0 (DEBUG): bitcoind started, waiting for RPC to come up \n node0 2025-12-29T19:35:37.067254Z [init] [init/common.cpp:153] [LogPackageVersion] Bitcoin Core version v30.99.0-68a467799381 (release build) \n node0 2025-12-29T19:35:37.067260Z [init] [init.cpp:747] [InitParameterInteraction] parameter interaction: -bind set -> setting -listen=1 \n node0 2025-12-29T19:35:37.067442Z [init] [kernel/context.cpp:20] [operator()] Using the 'x86_shani(1way;2way)' SHA256 implementation \n node0 2025-12-29T19:35:37.168629Z [init] [random.cpp:110] [ReportHardwareRand] Using RdSeed as an additional entropy source \n node0 2025-12-29T19:35:37.168644Z [init] [random.cpp:113] [ReportHardwareRand] Using RdRand as an additional entropy source \n node0 2025-12-29T19:35:37.170733Z [init] [init/common.cpp:121] [StartLogging] Default data directory /export/home/hebasto/.bitcoin \n node0 2025-12-29T19:35:37.170741Z [init] [init/common.cpp:122] [StartLogging] Using data directory /tmp/bitcoin_func_test_3_be70q7/node0/regtest \n node0 2025-12-29T19:35:37.170756Z [init] [init/common.cpp:131] [StartLogging] Config file: /tmp/bitcoin_func_test_3_be70q7/node0/bitcoin.conf \n node0 2025-12-29T19:35:37.170772Z [init] [common/args.cpp:863] [logArgsPrefix] Config file arg: regtest=\"1\" \n node0 2025-12-29T19:35:37.170781Z [init] [common/args.cpp:863] [logArgsPrefix] Config file arg: [regtest] bind=\"127.0.0.1\" \n node0 2025-12-29T19:35:37.170787Z [init] [common/args.cpp:863] [logArgsPrefix] Config file arg: [regtest] connect=\"0\" \n node0 2025-12-29T19:35:37.170793Z [init] [common/args.cpp:863] [logArgsPrefix] Config file arg: [regtest] discover=\"0\" \n node0 2025-12-29T19:35:37.170799Z [init] [common/args.cpp:863] [logArgsPrefix] Config file arg: [regtest] dnsseed=\"0\" \n node0 2025-12-29T19:35:37.170805Z [init] [common/args.cpp:863] [logArgsPrefix] Config file arg: [regtest] fallbackfee=\"0.0002\" \n node0 2025-12-29T19:35:37.170810Z [init] [common/args.cpp:863] [logArgsPrefix] Config file arg: [regtest] fixedseeds=\"0\" \n node0 2025-12-29T19:35:37.170817Z [init] [common/args.cpp:863] [logArgsPrefix] Config file arg: [regtest] keypool=\"1\" \n node0 2025-12-29T19:35:37.170825Z [init] [common/args.cpp:863] [logArgsPrefix] Config file arg: [regtest] listenonion=\"0\" \n node0 2025-12-29T19:35:37.170831Z [init] [common/args.cpp:863] [logArgsPrefix] Config file arg: [regtest] maxconnections=\"94\" \n node0 2025-12-29T19:35:37.170837Z [init] [common/args.cpp:863] [logArgsPrefix] Config file arg: [regtest] natpmp=\"0\" \n node0 2025-12-29T19:35:37.170842Z [init] [common/args.cpp:863] [logArgsPrefix] Config file arg: [regtest] par=\"2\" \n node0 2025-12-29T19:35:37.170849Z [init] [common/args.cpp:863] [logArgsPrefix] Config file arg: [regtest] peertimeout=\"999999999\" \n node0 2025-12-29T19:35:37.170855Z [init] [common/args.cpp:863] [logArgsPrefix] Config file arg: [regtest] port=\"11413\" \n node0 2025-12-29T19:35:37.170861Z [init] [common/args.cpp:863] [logArgsPrefix] Config file arg: [regtest] printtoconsole=\"0\" \n node0 2025-12-29T19:35:37.170867Z [init] [common/args.cpp:863] [logArgsPrefix] Config file arg: [regtest] rpcdoccheck=\"1\" \n node0 2025-12-29T19:35:37.170873Z [init] [common/args.cpp:863] [logArgsPrefix] Config file arg: [regtest] rpcport=\"16413\" \n node0 2025-12-29T19:35:37.170878Z [init] [common/args.cpp:863] [logArgsPrefix] Config file arg: [regtest] rpcservertimeout=\"99000\" \n node0 2025-12-29T19:35:37.170885Z [init] [common/args.cpp:863] [logArgsPrefix] Config file arg: [regtest] rpcthreads=\"2\" \n node0 2025-12-29T19:35:37.170891Z [init] [common/args.cpp:863] [logArgsPrefix] Config file arg: [regtest] server=\"1\" \n node0 2025-12-29T19:35:37.170897Z [init] [common/args.cpp:863] [logArgsPrefix] Config file arg: [regtest] shrinkdebugfile=\"0\" \n node0 2025-12-29T19:35:37.170902Z [init] [common/args.cpp:863] [logArgsPrefix] Config file arg: [regtest] unsafesqlitesync=\"1\" \n node0 2025-12-29T19:35:37.170910Z [init] [common/args.cpp:863] [logArgsPrefix] Command-line arg: datadir=\"/tmp/bitcoin_func_test_3_be70q7/node0\" \n node0 2025-12-29T19:35:37.170916Z [init] [common/args.cpp:863] [logArgsPrefix] Command-line arg: debug=\"\" \n node0 2025-12-29T19:35:37.170922Z [init] [common/args.cpp:863] [logArgsPrefix] Command-line arg: debugexclude=\"libevent\" \n node0 2025-12-29T19:35:37.170928Z [init] [common/args.cpp:863] [logArgsPrefix] Command-line arg: debugexclude=\"leveldb\" \n node0 2025-12-29T19:35:37.170933Z [init] [common/args.cpp:863] [logArgsPrefix] Command-line arg: debugexclude=\"rand\" \n node0 2025-12-29T19:35:37.170945Z [init] [common/args.cpp:863] [logArgsPrefix] Command-line arg: loglevel=\"trace\" \n node0 2025-12-29T19:35:37.170951Z [init] [common/args.cpp:863] [logArgsPrefix] Command-line arg: logratelimit=false \n node0 2025-12-29T19:35:37.170957Z [init] [common/args.cpp:863] [logArgsPrefix] Command-line arg: logsourcelocations=\"\" \n node0 2025-12-29T19:35:37.170962Z [init] [common/args.cpp:863] [logArgsPrefix] Command-line arg: logthreadnames=\"\" \n node0 2025-12-29T19:35:37.170969Z [init] [common/args.cpp:863] [logArgsPrefix] Command-line arg: logtimemicros=\"\" \n node0 2025-12-29T19:35:37.170975Z [init] [common/args.cpp:863] [logArgsPrefix] Command-line arg: uacomment=\"testnode0\" \n node0 2025-12-29T19:35:37.170981Z [init] [common/args.cpp:863] [logArgsPrefix] Command-line arg: v2transport=\"0\" \n node0 2025-12-29T19:35:37.171018Z [init] [init.cpp:1414] [AppInitMain] Using at most 94 automatic connections (65536 file descriptors available) \n node0 2025-12-29T19:35:37.171600Z [init] [init.cpp:1454] [AppInitMain] Log rate limiting disabled \n node0 2025-12-29T19:35:37.171642Z [scheduler] [util/thread.cpp:20] [TraceThread] scheduler thread start \n node0 2025-12-29T19:35:37.177124Z [init] [httpserver.cpp:241] [InitHTTPAllowList] [http] Allowing HTTP connections from: 127.0.0.0/8 ::1/128 \n node0 2025-12-29T19:35:37.177357Z [init] [httpserver.cpp:394] [HTTPBindAddresses] Binding RPC on address ::1 port 16413 \n node0 2025-12-29T19:35:37.177537Z [init] [httpserver.cpp:394] [HTTPBindAddresses] Binding RPC on address 127.0.0.1 port 16413 \n node0 2025-12-29T19:35:37.177575Z [init] [httpserver.cpp:477] [InitHTTPServer] [http] Initialized HTTP server \n node0 2025-12-29T19:35:37.177586Z [init] [httpserver.cpp:479] [InitHTTPServer] [http] creating work queue of depth 64 \n node0 2025-12-29T19:35:37.177593Z [init] [rpc/server.cpp:275] [StartRPC] [rpc] Starting RPC \n node0 2025-12-29T19:35:37.177611Z [init] [httprpc.cpp:333] [StartHTTPRPC] [rpc] Starting HTTP RPC server \n node0 2025-12-29T19:35:37.177709Z [init] [rpc/request.cpp:140] [GenerateAuthCookie] Generated RPC authentication cookie /tmp/bitcoin_func_test_3_be70q7/node0/regtest/.cookie \n node0 2025-12-29T19:35:37.177725Z [init] [rpc/request.cpp:141] [GenerateAuthCookie] Permissions used for cookie: rw------- \n node0 2025-12-29T19:35:37.177742Z [init] [httprpc.cpp:265] [InitRPCAuthentication] Using random cookie authentication. \n node0 2025-12-29T19:35:37.177776Z [init] [httpserver.cpp:759] [RegisterHTTPHandler] [http] Registering HTTP handler for / (exactmatch 1) \n node0 2025-12-29T19:35:37.177788Z [init] [httpserver.cpp:759] [RegisterHTTPHandler] [http] Registering HTTP handler for /wallet/ (exactmatch 0) \n node0 2025-12-29T19:35:37.177797Z [init] [httpserver.cpp:502] [StartHTTPServer] Starting HTTP server with 2 worker threads \n node0 2025-12-29T19:35:37.177917Z [http] [httpserver.cpp:354] [ThreadHTTP] [http] Entering http event loop \n node0 2025-12-29T19:35:37.178037Z [init] [wallet/load.cpp:53] [VerifyWallets] Using wallet directory /tmp/bitcoin_func_test_3_be70q7/node0/regtest \n node0 2025-12-29T19:35:37.178063Z [init] [wallet/walletdb.cpp:69] [LogDBInfo] Using SQLite Version 3.51.1 \n node0 2025-12-29T19:35:37.178111Z [init] [noui.cpp:57] [noui_InitMessage] init message: Verifying wallet(s)‚Ä¶ \n node0 2025-12-29T19:35:37.178216Z [init] [init.cpp:1574] [AppInitMain] Using /16 prefix for IP bucketing \n node0 2025-12-29T19:35:37.178223Z [init] [noui.cpp:57] [noui_InitMessage] init message: Loading P2P addresses‚Ä¶ \n node0 2025-12-29T19:35:37.180357Z [init] [addrdb.cpp:211] [LoadAddrman] Creating peers.dat because the file was not found (\"/tmp/bitcoin_func_test_3_be70q7/node0/regtest/peers.dat\") \n node0 2025-12-29T19:35:37.180575Z [init] [noui.cpp:57] [noui_InitMessage] init message: Loading banlist‚Ä¶ \n node0 2025-12-29T19:35:37.180592Z [init] [banman.cpp:42] [LoadBanlist] Recreating the banlist database \n node0 2025-12-29T19:35:37.180648Z [init] [banman.cpp:68] [DumpBanlist] [net] Flushed 0 banned node addresses/subnets to disk  0ms \n node0 2025-12-29T19:35:37.180674Z [init] [net.cpp:2434] [SetTryNewOutboundPeer] [net] setting try another outbound peer=false \n node0 2025-12-29T19:35:37.180701Z [init] [net.cpp:3219] [SetNetworkActive] SetNetworkActive: true \n node0 2025-12-29T19:35:37.183146Z [init] [policy/fees/block_policy_estimator.cpp:564] [CBlockPolicyEstimator] /tmp/bitcoin_func_test_3_be70q7/node0/regtest/fee_estimates.dat is not found. Continue anyway. \n node0 2025-12-29T19:35:37.183260Z [init] [init.cpp:1780] [AppInitMain] Cache configuration: \n node0 2025-12-29T19:35:37.183276Z [init] [init.cpp:1781] [AppInitMain] * Using 2.0 MiB for block index database \n node0 2025-12-29T19:35:37.183288Z [init] [init.cpp:1789] [AppInitMain] * Using 8.0 MiB for chain state database \n node0 2025-12-29T19:35:37.183342Z [init] [init.cpp:1300] [InitAndLoadChainstate] * Using 440.0 MiB for in-memory UTXO set (plus up to 286.1 MiB of unused mempool space) \n node0 2025-12-29T19:35:37.183384Z [init] [checkqueue.h:147] [CCheckQueue] Script verification uses 1 additional threads \n node0 2025-12-29T19:35:37.183606Z [init] [node/blockstorage.cpp:1203] [InitBlocksdirXorKey] Using obfuscation key for blocksdir *.dat files (/tmp/bitcoin_func_test_3_be70q7/node0/regtest/blocks): '5d4aa856db94dcfc' \n node0 2025-12-29T19:35:37.183686Z [init] [dbwrapper.cpp:236] [CDBWrapper] Opening LevelDB in /tmp/bitcoin_func_test_3_be70q7/node0/regtest/blocks/index \n node0 2025-12-29T19:35:37.184533Z [init] [dbwrapper.cpp:244] [CDBWrapper] Opened LevelDB successfully \n node0 2025-12-29T19:35:37.184564Z [init] [dbwrapper.cpp:260] [CDBWrapper] Using obfuscation key for /tmp/bitcoin_func_test_3_be70q7/node0/regtest/blocks/index: 0000000000000000 \n node0 2025-12-29T19:35:37.206110Z [init] [script/sigcache.cpp:35] [SignatureCache] Using 16 MiB out of 16 MiB requested for signature cache, able to store 524288 elements \n node0 2025-12-29T19:35:37.227564Z [init] [validation.cpp:2067] [ValidationCache] Using 16 MiB out of 16 MiB requested for script execution cache, able to store 524288 elements \n node0 2025-12-29T19:35:37.227582Z [init] [noui.cpp:57] [noui_InitMessage] init message: Loading block index‚Ä¶ \n node0 2025-12-29T19:35:37.227596Z [init] [node/chainstate.cpp:150] [LoadChainstate] Validating signatures for all blocks. \n node0 2025-12-29T19:35:37.227607Z [init] [node/chainstate.cpp:152] [LoadChainstate] Setting nMinimumChainWork=0000000000000000000000000000000000000000000000000000000000000000 \n node0 2025-12-29T19:35:37.228053Z [init] [node/blockstorage.cpp:530] [LoadBlockIndexDB] Loading block index db: last block file = 0 \n node0 2025-12-29T19:35:37.228070Z [init] [node/blockstorage.cpp:534] [LoadBlockIndexDB] Loading block index db: last block file info: CBlockFileInfo(blocks=200, size=52530, heights=0...199, time=2011-02-02...2011-02-02) \n node0 2025-12-29T19:35:37.228077Z [init] [node/blockstorage.cpp:545] [LoadBlockIndexDB] Checking all blk files are present... \n node0 2025-12-29T19:35:37.228202Z [init] [node/chainstate.cpp:87] [CompleteChainstateInitialization] Initializing chainstate Chainstate [ibd] @ height -1 (null) \n node0 2025-12-29T19:35:37.228221Z [init] [dbwrapper.cpp:236] [CDBWrapper] Opening LevelDB in /tmp/bitcoin_func_test_3_be70q7/node0/regtest/chainstate \n node0 2025-12-29T19:35:37.228740Z [init] [dbwrapper.cpp:244] [CDBWrapper] Opened LevelDB successfully \n node0 2025-12-29T19:35:37.228765Z [init] [dbwrapper.cpp:260] [CDBWrapper] Using obfuscation key for /tmp/bitcoin_func_test_3_be70q7/node0/regtest/chainstate: 926cb82614cf3a36 \n node0 2025-12-29T19:35:37.228872Z [init] [validation.cpp:4651] [LoadChainTip] Loaded best chain: hashBestChain=30068a561f1d748696d6fe1368b2b9b9f765095cda5b767b291e8bf84caff9f1 height=199 date=2011-02-02T23:17:17Z progress=0.000425 \n node0 2025-12-29T19:35:37.228913Z [init] [noui.cpp:57] [noui_InitMessage] init message: Verifying blocks‚Ä¶ \n node0 2025-12-29T19:35:37.228938Z [init] [validation.cpp:4699] [VerifyDB] Verifying last 6 blocks at level 3 \n node0 2025-12-29T19:35:37.228966Z [init] [validation.cpp:4708] [VerifyDB] Verification progress: 0% \n node0 2025-12-29T19:35:37.229357Z [init] [validation.cpp:4716] [VerifyDB] Verification progress: 16% \n node0 2025-12-29T19:35:37.229547Z [init] [validation.cpp:4716] [VerifyDB] Verification progress: 33% \n node0 2025-12-29T19:35:37.229733Z [init] [validation.cpp:4716] [VerifyDB] Verification progress: 50% \n node0 2025-12-29T19:35:37.229926Z [init] [validation.cpp:4716] [VerifyDB] Verification progress: 66% \n node0 2025-12-29T19:35:37.230132Z [init] [validation.cpp:4716] [VerifyDB] Verification progress: 83% \n node0 2025-12-29T19:35:37.230322Z [init] [validation.cpp:4716] [VerifyDB] Verification progress: 99% \n node0 2025-12-29T19:35:37.230330Z [init] [validation.cpp:4810] [VerifyDB] Verification: No coin database inconsistencies in last 6 blocks (6 transactions) \n node0 2025-12-29T19:35:37.230337Z [init] [init.cpp:1388] [InitAndLoadChainstate] Block index and chainstate loaded \n node0 2025-12-29T19:35:37.230396Z [init] [init.cpp:1888] [AppInitMain] Setting NODE_NETWORK in non-prune mode \n node0 2025-12-29T19:35:37.230464Z [init] [init.cpp:2018] [AppInitMain] block tree size = 200 \n node0 2025-12-29T19:35:37.230470Z [init] [init.cpp:2031] [AppInitMain] nBestHeight = 199 \n node0 2025-12-29T19:35:37.230510Z [initload] [util/thread.cpp:20] [TraceThread] initload thread start \n node0 2025-12-29T19:35:37.230592Z [init] [net.cpp:3192] [BindListenPort] Bound to 127.0.0.1:11413 \n node0 2025-12-29T19:35:37.230615Z [init] [noui.cpp:57] [noui_InitMessage] init message: Starting network threads‚Ä¶ \n node0 2025-12-29T19:35:37.230678Z [initload] [node/mempool_persist.cpp:49] [LoadMempool] Failed to open mempool file. Continuing anyway. \n node0 2025-12-29T19:35:37.230710Z [init] [net.cpp:3388] [Start] DNS seeding disabled \n node0 2025-12-29T19:35:37.230825Z [net] [util/thread.cpp:20] [TraceThread] net thread start \n node0 2025-12-29T19:35:37.230889Z [init] [noui.cpp:57] [noui_InitMessage] init message: Done loading \n node0 2025-12-29T19:35:37.230906Z [addcon] [util/thread.cpp:20] [TraceThread] addcon thread start \n node0 2025-12-29T19:35:37.230955Z [msghand] [util/thread.cpp:20] [TraceThread] msghand thread start \n node0 2025-12-29T19:35:37.231022Z [initload] [util/thread.cpp:22] [TraceThread] initload thread exit \n node0 2025-12-29T19:35:37.311596Z [http] [httpserver.cpp:307] [http_request_cb] [http] Received a POST request for / from 127.0.0.1:41193 \n node0 2025-12-29T19:35:37.311969Z [httpworker.1] [rpc/request.cpp:243] [parse] [rpc] ThreadRPCServer method=getblockcount user=__cookie__ \n node0 2025-12-29T19:35:37.313694Z [http] [httpserver.cpp:307] [http_request_cb] [http] Received a POST request for / from 127.0.0.1:41193 \n node0 2025-12-29T19:35:37.313798Z [httpworker.1] [rpc/request.cpp:243] [parse] [rpc] ThreadRPCServer method=getmempoolinfo user=__cookie__ \n test  2025-12-29T19:35:37.314579Z TestFramework.node0 (DEBUG): RPC successfully started \n node0 2025-12-29T19:35:37.315136Z [http] [httpserver.cpp:307] [http_request_cb] [http] Received a POST request for / from 127.0.0.1:41193 \n node0 2025-12-29T19:35:37.315238Z [httpworker.1] [rpc/request.cpp:243] [parse] [rpc] ThreadRPCServer method=createwallet user=__cookie__ \n node0 2025-12-29T19:35:37.316047Z [httpworker.1] [wallet/sqlite.cpp:43] [ErrorLogCallback] [warning] SQLite Error. Code: 14. Message: cannot open file at line 46164 of [281fc0e9af] \n node0 2025-12-29T19:35:37.316066Z [httpworker.1] [wallet/sqlite.cpp:43] [ErrorLogCallback] [warning] SQLite Error. Code: 14. Message: os_unix.c:46164: (0) lstat(/tmp/bitcoin_func_test_3_be70q7/node0/regtest/default_wallet/wallet.dat) - \n node0 2025-12-29T19:35:37.316084Z [httpworker.1] [wallet/sqlite.cpp:43] [ErrorLogCallback] [warning] SQLite Error. Code: 14. Message: cannot open file at line 46239 of [281fc0e9af] \n test  2025-12-29T19:35:37.317178Z TestFramework (ERROR): Unexpected exception \n                                   Traceback (most recent call last):\n                                     File \"/export/home/hebasto/dev/bitcoin/test/functional/test_framework/test_framework.py\", line 138, in main\n                                       self.setup()\n                                       ~~~~~~~~~~^^\n                                     File \"/export/home/hebasto/dev/bitcoin/test/functional/test_framework/test_framework.py\", line 269, in setup\n                                       self.setup_network()\n                                       ~~~~~~~~~~~~~~~~~~^^\n                                     File \"/export/home/hebasto/dev/bitcoin/test/functional/test_framework/test_framework.py\", line 360, in setup_network\n                                       self.setup_nodes()\n                                       ~~~~~~~~~~~~~~~~^^\n                                     File \"/export/home/hebasto/dev/bitcoin/test/functional/test_framework/test_framework.py\", line 384, in setup_nodes\n                                       self.import_deterministic_coinbase_privkeys()\n                                       ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^\n                                     File \"/export/home/hebasto/dev/bitcoin/test/functional/test_framework/test_framework.py\", line 401, in import_deterministic_coinbase_privkeys\n                                       self.init_wallet(node=i)\n                                       ~~~~~~~~~~~~~~~~^^^^^^^^\n                                     File \"/export/home/hebasto/dev/bitcoin/test/functional/test_framework/test_framework.py\", line 408, in init_wallet\n                                       n.createwallet(wallet_name=wallet_name, load_on_startup=True)\n                                       ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n                                     File \"/export/home/hebasto/dev/bitcoin/test/functional/test_framework/coverage.py\", line 50, in __call__\n                                       return_val = self.auth_service_proxy_instance.__call__(*args, **kwargs)\n                                     File \"/export/home/hebasto/dev/bitcoin/test/functional/test_framework/authproxy.py\", line 156, in __call__\n                                       raise JSONRPCException(response['error'], status)\n                                   test_framework.authproxy.JSONRPCException: Wallet file verification failed. SQLiteDatabase: Failed to open database: unable to open database file\n                                    (-4)\n test  2025-12-29T19:35:37.321618Z TestFramework (DEBUG): Closing down network thread \n test  2025-12-29T19:35:37.372890Z TestFramework (INFO): Not stopping nodes as test failed. The dangling processes will be cleaned up later. \n test  2025-12-29T19:35:37.373126Z TestFramework (WARNING): Not cleaning up dir /tmp/bitcoin_func_test_3_be70q7 \n test  2025-12-29T19:35:37.373353Z TestFramework (ERROR): Test failed. Test logging available at /tmp/bitcoin_func_test_3_be70q7/test_framework.log \n test  2025-12-29T19:35:37.374043Z TestFramework (ERROR): \n test  2025-12-29T19:35:37.374478Z TestFramework (ERROR): Hint: Call /export/home/hebasto/dev/bitcoin/test/functional/combine_logs.py '/tmp/bitcoin_func_test_3_be70q7' to consolidate all logs \n test  2025-12-29T19:35:37.374601Z TestFramework (ERROR): \n test  2025-12-29T19:35:37.374783Z TestFramework (ERROR): If this failure happened unexpectedly or intermittently, please file a bug and provide a link or upload of the combined log. \n test  2025-12-29T19:35:37.375148Z TestFramework (ERROR): https://github.com/bitcoin/bitcoin/issues \n test  2025-12-29T19:35:37.375266Z TestFramework (ERROR): \n\n```",
          "created_at": "2025-12-29T20:43:00Z"
        },
        {
          "user": "hebasto",
          "body": "> I don't think it is related to [#34128](https://github.com/bitcoin/bitcoin/issues/34128). It sounds more like a permissions issue. Can try creating a wallet in the /tmp/ dir manually to test it?\n\nSpecifing any other directory, for example, with `--tmpdir $(pwd)/tmp`, does not help.",
          "created_at": "2025-12-29T20:46:21Z"
        },
        {
          "user": "maflcko",
          "body": "I wonder if you can reproduce this outside of the test framework:\n\n* Start once, to create a datadir\n* Delete empty wallets dir, similar to the test framework: `os.rmdir(cache_path('wallets'))  # Remove empty wallets dir`\n* Start again, and create the wallet, similar to the test framework via the `createwallet` RPC.",
          "created_at": "2025-12-30T07:58:24Z"
        },
        {
          "user": "furszy",
          "body": "> node0 2025-12-29T19:35:37.316047Z [httpworker.1] [wallet/sqlite.cpp:43] [ErrorLogCallback] [warning] SQLite Error. Code: 14. Message: cannot open file at line 46164 of [281fc0e9af] \n node0 2025-12-29T19:35:37.316066Z [httpworker.1] [wallet/sqlite.cpp:43] [ErrorLogCallback] [warning] SQLite Error. Code: 14. Message: os_unix.c:46164: (0) lstat(/tmp/bitcoin_func_test_3_be70q7/node0/regtest/default_wallet/wallet.dat) - \n node0 2025-12-29T19:35:37.316084Z [httpworker.1] [wallet/sqlite.cpp:43] [ErrorLogCallback] [warning] SQLite Error. Code: 14. Message: cannot open file at line 46239 of [281fc0e9af] \n\nPer the logs, sqlite is failing after a `lstat()` call. This seems to be OS specific rather than an issue on our side. OpenIndiana seems to have more advanced access control features, so probably perms behave differently than on other systems.\n\nCould try explicitly setting broader perms on the directory to ensure sqlite can access it. Also, could check perms during the test; add a breakpoint just before calling `createwallet` and check the directory perms manually.",
          "created_at": "2025-12-30T16:48:46Z"
        },
        {
          "user": "hebasto",
          "body": "> I wonder if you can reproduce this outside of the test framework:\n> \n>    * Start once, to create a datadir\n> \n>    * Delete empty wallets dir, similar to the test framework: `os.rmdir(cache_path('wallets'))  # Remove empty wallets dir`\n> \n>    * Start again, and create the wallet, similar to the test framework via the `createwallet` RPC.\n\nI tested this scenario, and it works as expected.",
          "created_at": "2026-01-01T10:59:47Z"
        },
        {
          "user": "hebasto",
          "body": "It appears that `sqlite3_open_v2` fails only when executed in the functional test context. However, I didn't find any filesystem permission violations.",
          "created_at": "2026-01-01T17:27:07Z"
        },
        {
          "user": "maflcko",
          "body": "I wonder if the `            shutil.copytree(cache_node_dir, to_dir)` changes any permissions.\n\n\n\n\n> I tested this scenario, and it works as expected.\n\nDoes it even pass when you run it with the datadir set to the datadir of the previously failing test. I.e. `/tmp/bitcoin_func_test_3_be70q7`.\n\nDoes it pass when you set the datadir to the `cache_node_dir` manually?",
          "created_at": "2026-01-01T17:44:38Z"
        },
        {
          "user": "hebasto",
          "body": "> It appears that `sqlite3_open_v2` fails only when executed in the functional test context. However, I didn't find any filesystem permission violations.\n\nWhen building `sqlite` from source (using the pre-[1db74914706fcfafb22646288458604a4a7b6282](https://github.com/bitcoin/bitcoin/commit/1db74914706fcfafb22646288458604a4a7b6282) branch), the issue disappears, which makes me even more confused. ",
          "created_at": "2026-01-01T18:58:07Z"
        },
        {
          "user": "hebasto",
          "body": "> I wonder if the ` shutil.copytree(cache_node_dir, to_dir)` changes any permissions.\n> \n> > I tested this scenario, and it works as expected.\n> \n> Does it even pass when you run it with the datadir set to the datadir of the previously failing test. I.e. `/tmp/bitcoin_func_test_3_be70q7`.\n\nIt fails:\n```\n$ ./build/bin/bitcoin-cli -regtest -datadir=/tmp/bitcoin_func_test_2ku20ra3/node0 createwallet default_wallet\nerror code: -4\nerror message:\nWallet file verification failed. SQLiteDatabase: Failed to open database: unable to open database file\n\n$ ./build/bin/bitcoin-cli -regtest -datadir=/tmp/bitcoin_func_test_2ku20ra3/node0 createwallet default_wallet_2\nerror code: -4\nerror message:\nWallet file verification failed. SQLiteDatabase: Failed to open database: unable to open database file\n\n```\n\n> Does it pass when you set the datadir to the `cache_node_dir` manually?\n\nIt fails as well:\n```\n$ ./build/bin/bitcoin-cli -regtest -datadir=/export/home/hebasto/dev/bitcoin/build/test/cache/node0 createwallet default_wallet\nerror code: -4\nerror message:\nWallet file verification failed. SQLiteDatabase: Failed to open database: unable to open database file\n\n```",
          "created_at": "2026-01-01T21:46:25Z"
        },
        {
          "user": "hebasto",
          "body": "> > I wonder if you can reproduce this outside of the test framework:\n> > \n> > * Start once, to create a datadir\n> > * Delete empty wallets dir, similar to the test framework: `os.rmdir(cache_path('wallets'))  # Remove empty wallets dir`\n> > * Start again, and create the wallet, similar to the test framework via the `createwallet` RPC.\n> \n> I tested this scenario, and it works as expected.\n\nI found the culprit: the `-bind` option.\n\nBelow are the steps to reproduce the issue:\n```\n$ mkdir $HOME/dd\n$ ./build/bin/bitcoind -regtest -datadir=$HOME/dd -bind=127.0.0.1 -daemon\nBitcoin Core starting\n$ ./build/bin/bitcoin-cli -regtest -datadir=$HOME/dd stop\nBitcoin Core stopping\n$ rm -rf $HOME/dd/regtest/wallets\n$ ./build/bin/bitcoind -regtest -datadir=$HOME/dd -bind=127.0.0.1 -daemon\nBitcoin Core starting\n$ ./build/bin/bitcoin-cli -regtest -datadir=$HOME/dd createwallet default_wallet\nerror code: -4\nerror message:\nWallet file verification failed. SQLiteDatabase: Failed to open database: unable to open database file\n\n$ ./build/bin/bitcoin-cli -regtest -datadir=$HOME/dd stop\nBitcoin Core stopping\n```\n\nThe SQLite package installed on the system is `database/sqlite-3@3.51.1-2025.0.0.0`.",
          "created_at": "2026-01-01T23:01:53Z"
        }
      ]
    }
  ],
  "summary": {
    "pull_requests": 6,
    "issues": 1
  }
}