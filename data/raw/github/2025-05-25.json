{
  "source": "github",
  "repository": "bitcoin/bitcoin",
  "fetched_at": "2026-01-15T19:45:38.084283+00:00",
  "date": "2025-05-25",
  "pull_requests": [
    {
      "number": 32615,
      "title": "fee estimate test: fix #31944 by handling a legitimate scenario that â€¦",
      "body": "Fix a legitimate scenario that feerate is not always available, due to the randomly generated fees that causes current percentage to be smaller than success break point, in TxConfirmStats::EstimateMedianVal (in src/policy/fees.cpp).  The solution is to hard code a list of fees that guarantee to pass the check of fees and smart fees.\r\n\r\nTo reproduce/validate the issue, run the test with a specific randomseed: 2986529890161488286\r\n\r\nbuild/test/functional/test_runner.py test/functional/feature_fee_estimation.py --randomseed=2986529890161488286 --tmpdir /tmp\r\n\r\nTo generate the good data point, i.e., **global_fee_list**, I ran the original test with --randomseed=298652989016148828, which is a good randomseed, and output the calculated result of fee:\r\n\r\n```\r\nrand_fee = float(fee_increment) * (1.1892 ** random.randint(0, 28))\r\n\r\nfee = min_fee - fee_increment + satoshi_round(rand_fee, rounding=ROUND_DOWN) # output this fee as the data point that can be used to generate deterministic result.\r\n\r\n```\r\nThen, for each calling of function **small_txpuzzle_randfee** , simply take the result from the data point, i.e., **global_fee_list** and that's it.\r\n\r\nMore details can be found in discussion of https://github.com/bitcoin/bitcoin/issues/31944 ",
      "state": "closed",
      "user": "tnndbtc",
      "created_at": "2025-05-25T19:47:50Z",
      "updated_at": "2025-07-03T15:32:31Z",
      "comments": 11,
      "url": "https://github.com/bitcoin/bitcoin/pull/32615",
      "labels": [],
      "comment_list": [
        {
          "user": "DrahtBot",
          "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/32615.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| Concept NACK | [ismaelsadeeq](https://github.com/bitcoin/bitcoin/pull/32615#issuecomment-3032501112) |\n\nIf your review is incorrectly listed, please react with ðŸ‘Ž to this comment and the bot will ignore it on the next update.\n<!--5faf32d7da4f0f540f40219e4f7537a3-->\n### LLM Linter (âœ¨ experimental)\n\nPossible typos and grammar issues:\n\n- typo: \"instead of randomly generate the fees\" -> \"instead of randomly generating the fees\" [â€˜instead ofâ€™ requires a gerund]\n- typo: \"this small fee will cause too many transactions congested in mempool\" -> \"this small fee will cause too many transactions to be congested in the mempool\" [clarifies the intended causation]\n\n<sup>drahtbot_id_4_m</sup>\n",
          "created_at": "2025-05-25T19:47:53Z"
        },
        {
          "user": "DrahtBot",
          "body": "<!--85328a0da195eb286784d51f73fa0af9-->\nðŸš§ At least one of the CI tasks failed.\n<sub>Task `lint`: https://github.com/bitcoin/bitcoin/runs/43237710416</sub>\n<sub>LLM reason (âœ¨ experimental): The CI failure is caused by linting errors, including unused imports, dead code, spelling mistakes, and typos, which caused the lint check to fail.</sub>\n\n<details><summary>Hints</summary>\n\nTry to run the tests locally, according to the documentation. However, a CI failure may still\nhappen due to a number of reasons, for example:\n\n* Possibly due to a silent merge conflict (the changes in this pull request being\nincompatible with the current code in the target branch). If so, make sure to rebase on the latest\ncommit of the target branch.\n\n* A sanitizer issue, which can only be found by compiling with the sanitizer and running the\n  affected test.\n\n* An intermittent issue.\n\nLeave a comment here, if you need help tracking down a confusing failure.\n\n</details>\n\n",
          "created_at": "2025-05-31T17:05:04Z"
        },
        {
          "user": "fanquake",
          "body": "@tnndbtc I've moved this to draft, as we aren't going to merge this with the current approach, using the generated `global_fee_list`.",
          "created_at": "2025-07-02T13:41:31Z"
        },
        {
          "user": "tnndbtc",
          "body": "@fanquake Any other thoughts on how to fix this issue, like smaller fixed data set?  Currently this test is flawed as it uses random fees and missed the fact that, the randomness will go through different execution path thus the random test failure.",
          "created_at": "2025-07-02T17:56:30Z"
        },
        {
          "user": "maflcko",
          "body": "Just ensure enough random transactions have been created to reliably return a fee estimate in any run?",
          "created_at": "2025-07-03T07:56:51Z"
        },
        {
          "user": "ismaelsadeeq",
          "body": "Still NACK\r\nfwiw what I meant in my suggestion here https://github.com/bitcoin/bitcoin/pull/32615#discussion_r2107593916\r\nis what @maflcko recently commented.\r\n\r\nIt's been a while since I take a look at this, I think it's best to discuss exact suggestion in the tracking issue.",
          "created_at": "2025-07-03T14:33:06Z"
        },
        {
          "user": "tnndbtc",
          "body": "@ismaelsadeeq Not sure your comment of \"Still NACK\" is to this PR, or to other people's comments.  From your suggestion: `I believe the correct fix is to update the test to generate and mine the correct number of transactions with a fee rate that will always reliably return a fee rate.`\r\nThis PR is to use a hard-coded fee list which is generated from an actual good random seed that reliably return the fee rate.  In my understanding, this matches your suggestion.  If not, please clarify.  Thanks.",
          "created_at": "2025-07-03T15:00:54Z"
        },
        {
          "user": "tnndbtc",
          "body": "> Just ensure enough random transactions have been created to reliably return a fee estimate in any run?\r\n\r\n@maflcko Random is random.  How can we ensure randomly generated transactions can reliably return a fee estimate **in any run**?\r\n\r\nFor example, we currently know that random seed `2986529890161488286` is bad but `298652989016148828` is good.  Follow your suggestion, if there is a _**randomness**_ which can guarantee not to generate transactions created by the bad seed, then is that randomness still random?  ",
          "created_at": "2025-07-03T15:03:23Z"
        },
        {
          "user": "maflcko",
          "body": "I am not sure if you are using an LLM in the background, but the goal of a pull request is not to open it and then ask others to provide the solution for you, then ask others to review it.\r\n\r\nThe burden to understand the issue, to propose the fix, and to understand the fix is on the author.\r\n\r\nClosing for now, because this is clearly the wrong approach here.\r\n\r\nDiscussion can continue, of course. Also, if a proper solution is found, a new pull request can be opened.\r\n\r\n\r\n\r\n> Random is random.\r\n\r\nIf we didn't want randomness, it could be trivially disabled for this test with likely a one-line patch. A 50k+ char patch is not the right approach here.",
          "created_at": "2025-07-03T15:11:20Z"
        },
        {
          "user": "ismaelsadeeq",
          "body": "\r\n\r\n> @ismaelsadeeq I'm not sure if your comment \"Still NACK\" is directed at this PR.\r\n\r\nYes, as it stands, I don't think this PR is reviewable, as other reviewers have also mentioned.\r\n\r\n> This PR proposes using a hard-coded fee list generated from a properly seeded random source that reliably returns the fee rate. From my understanding, this matches your suggestion. If not, please clarify. Thanks.\r\n\r\n@tnndbtc I think you may have misread the comment. Randomness should have defined bounds. What I initially thought maybe be a \"potential\" solution is to limit both the number of random transactions generated and the range of the fee rates, in order to better match the behavior of `estimatesmartfee`. Or, if it's discovered indeed a rare edge case that causes the failure then we can document and avoid like #31080 .\r\n\r\n@tnndbtc thanks for trying to contribute and attempt to fix the issue but I think it should be the responsibility of the PR author to thoroughly research the issue based on previous discussions and comments before opening a PR. If the author is unsure about the approach, it is best to start by discussing it in tracking issue.\r\n\r\nI initially began investigating the issue and discovered the root cause, but I have not yet looked into the \"why\" behind it.\r\n\r\nI wasnâ€™t sure I fully understood your follow-up comment here https://github.com/bitcoin/bitcoin/issues/31944#issuecomment-2906917517, which is why I didnâ€™t respond. I also suspect there may have been LLM hallucinations involved, as @maflcko mentioned.\r\n\r\n",
          "created_at": "2025-07-03T15:18:58Z"
        },
        {
          "user": "tnndbtc",
          "body": "> I am not sure if you are using an LLM in the background, but the goal of a pull request is not to open it and then ask others to provide the solution for you, then ask others to review it.\r\n> \r\n> The burden to understand the issue, to propose the fix, and to understand the fix is on the author.\r\n> \r\n> Closing for now, because this is clearly the wrong approach here.\r\n> \r\n> Discussion can continue, of course. Also, if a proper solution is found, a new pull request can be opened.\r\n> \r\n> > Random is random.\r\n> \r\n> If we didn't want randomness, it could be trivially disabled for this test with likely a one-line patch. A 50k+ char patch is not the right approach here.\r\n\r\n@maflcko and @ismaelsadeeq Thanks for the response.  After a quick glance at https://github.com/bitcoin/bitcoin/pull/31080 , my comment at https://github.com/bitcoin/bitcoin/issues/31944#issuecomment-2906917517 is similar, which is to demonstrate my debugging results that why this current functional test fail because it didn't handle the unhappy path.\r\n\r\nAs for `LLM hallucinations`, I gave thoughts first and then typed comments by myself.  For URL links in the comment, I indeed copied and pasted them.\r\nFor the `global_fee_list` in this PR, I run the test and print out the generated fees, then copied and pasted to the python source file.  \r\n\r\nHopefully these are not considered `LLM hallucinations` ",
          "created_at": "2025-07-03T15:32:31Z"
        }
      ]
    }
  ],
  "issues": [
    {
      "number": 32613,
      "title": ".",
      "body": "",
      "state": "closed",
      "user": "Ciornenichii",
      "created_at": "2025-05-25T14:21:04Z",
      "updated_at": "2025-05-25T14:22:14Z",
      "comments": 0,
      "url": "https://github.com/bitcoin/bitcoin/issues/32613",
      "labels": []
    },
    {
      "number": 32610,
      "title": ".",
      "body": ".",
      "state": "closed",
      "user": "FarrelAlFeshall",
      "created_at": "2025-05-25T02:34:18Z",
      "updated_at": "2025-05-25T03:05:05Z",
      "comments": 0,
      "url": "https://github.com/bitcoin/bitcoin/issues/32610",
      "labels": []
    }
  ],
  "summary": {
    "pull_requests": 1,
    "issues": 2
  }
}