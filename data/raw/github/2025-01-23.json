{
  "source": "github",
  "repository": "bitcoin/bitcoin",
  "fetched_at": "2026-01-15T19:11:48.938265+00:00",
  "date": "2025-01-23",
  "pull_requests": [
    {
      "number": 31727,
      "title": "miniscript: convert non-critical asserts to CHECK_NONFATAL",
      "body": "The Miniscript code contains assertions to prevent ending up in an insane state or prevent UB, but also to enforce logical invariants. For the latter it is not necessary to crash the program if they are broken. Raising an exception suffices, especially as this code is often called through the RPC interface which can in turn handle the exception and the user can report it to developers.\r\n\r\nThis revives #28678 from Pieter Wuille.",
      "state": "closed",
      "user": "darosior",
      "created_at": "2025-01-23T16:17:05Z",
      "updated_at": "2025-04-14T13:38:01Z",
      "comments": 7,
      "url": "https://github.com/bitcoin/bitcoin/pull/31727",
      "labels": [
        "Descriptors"
      ],
      "comment_list": [
        {
          "user": "DrahtBot",
          "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/31727.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| ACK | [TheCharlatan](https://github.com/bitcoin/bitcoin/pull/31727#pullrequestreview-2753369190), [brunoerg](https://github.com/bitcoin/bitcoin/pull/31727#pullrequestreview-2754839794), [hodlinator](https://github.com/bitcoin/bitcoin/pull/31727#pullrequestreview-2756972966) |\n| Concept ACK | [kevkevinpal](https://github.com/bitcoin/bitcoin/pull/31727#issuecomment-2638757606) |\n\nIf your review is incorrectly listed, please react with ðŸ‘Ž to this comment and the bot will ignore it on the next update.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#31719](https://github.com/bitcoin/bitcoin/pull/31719) (miniscript: fixes #29098 by only use first k valid signatures by tnndbtc)\n* [#31713](https://github.com/bitcoin/bitcoin/pull/31713) (miniscript refactor: Remove unique_ptr-indirection (#30866 follow-up) by hodlinator)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n",
          "created_at": "2025-01-23T16:17:09Z"
        },
        {
          "user": "brunoerg",
          "body": "Concept ACK",
          "created_at": "2025-01-23T16:37:47Z"
        },
        {
          "user": "darosior",
          "body": "> Why aren't these converted to use `CHECK_NONFATAL`?\r\n\r\nSame reason as [here](https://github.com/bitcoin/bitcoin/pull/31727#discussion_r1929121645). I kept asserts where breaking the invariant would lead to UB. In the examples you point out it would read out of the `sats` vector bounds.\r\n\r\nActually this should be a strict check, not an inferior or equal to!",
          "created_at": "2025-01-28T15:33:23Z"
        },
        {
          "user": "hodlinator",
          "body": "> Same reason as [here](https://github.com/bitcoin/bitcoin/pull/31727#discussion_r1929121645). I kept asserts where breaking the invariant would lead to UB. In the examples you point out it would read out of the `sats` vector bounds.\r\n\r\nOkay, and there is no way *user input* from RPCs etc would currently be able to trigger the asserts?\r\n\r\n> Actually this should be a strict check, not an inferior or equal to!\r\n\r\nAh, didn't realize, good catch indeed, `=` should be dropped.",
          "created_at": "2025-01-29T13:56:17Z"
        },
        {
          "user": "kevkevinpal",
          "body": "Concept ACK\r\n\r\nlightly reviewed the code and looks good to me",
          "created_at": "2025-02-06T03:44:14Z"
        },
        {
          "user": "hodlinator",
          "body": "@darosior discovered (https://github.com/bitcoin/bitcoin/pull/31727#issuecomment-2619342125) in response to https://github.com/bitcoin/bitcoin/pull/31727#pullrequestreview-2577746602:\r\n> Ah, didn't realize, good catch indeed, `=` should be dropped.\r\n\r\nThis is now fixed together with some more cases in follow-up #32255.",
          "created_at": "2025-04-12T08:05:35Z"
        },
        {
          "user": "darosior",
          "body": "Thanks for picking it up @hodlinator.\n\n-------- Original Message --------\nOn 4/12/25 4:06 AM, hodlinator  wrote:\n\n> ***@***.***(https://github.com/darosior) discovered ([#31727 (comment)](https://github.com/bitcoin/bitcoin/pull/31727#issuecomment-2619342125)) in response to [#31727 (review)](https://github.com/bitcoin/bitcoin/pull/31727#pullrequestreview-2577746602):\n>\n>> Ah, didn't realize, good catch indeed, = should be dropped.\n>\n> This is now fixed together with some more cases in follow-up [#32255](https://github.com/bitcoin/bitcoin/pull/32255).\n>\n> â€”\n> Reply to this email directly, [view it on GitHub](https://github.com/bitcoin/bitcoin/pull/31727#issuecomment-2798727539), or [unsubscribe](https://github.com/notifications/unsubscribe-auth/AFLK3F7LAMHJFREVZJC7WRD2ZDCORAVCNFSM6AAAAABVXXMUSOVHI2DSMVQWIX3LMV43OSLTON2WKQ3PNVWWK3TUHMZDOOJYG4ZDONJTHE).\n> You are receiving this because you were mentioned.Message ID: ***@***.***>\n>\n> hodlinator left a comment [(bitcoin/bitcoin#31727)](https://github.com/bitcoin/bitcoin/pull/31727#issuecomment-2798727539)\n>\n> ***@***.***(https://github.com/darosior) discovered ([#31727 (comment)](https://github.com/bitcoin/bitcoin/pull/31727#issuecomment-2619342125)) in response to [#31727 (review)](https://github.com/bitcoin/bitcoin/pull/31727#pullrequestreview-2577746602):\n>\n>> Ah, didn't realize, good catch indeed, = should be dropped.\n>\n> This is now fixed together with some more cases in follow-up [#32255](https://github.com/bitcoin/bitcoin/pull/32255).\n>\n> â€”\n> Reply to this email directly, [view it on GitHub](https://github.com/bitcoin/bitcoin/pull/31727#issuecomment-2798727539), or [unsubscribe](https://github.com/notifications/unsubscribe-auth/AFLK3F7LAMHJFREVZJC7WRD2ZDCORAVCNFSM6AAAAABVXXMUSOVHI2DSMVQWIX3LMV43OSLTON2WKQ3PNVWWK3TUHMZDOOJYG4ZDONJTHE).\n> You are receiving this because you were mentioned.Message ID: ***@***.***>",
          "created_at": "2025-04-12T19:46:49Z"
        }
      ]
    },
    {
      "number": 31726,
      "title": "ci: Replace `CMAKE_CXX_FLAGS` with `APPEND_CXXFLAGS`",
      "body": "This PR ensures that compiler flags are applied exclusively during compiler invocations.\r\n\r\nBelow is a summary of differences between `CMAKE_CXX_FLAGS` and `APPEND_CXXFLAGS` variables:\r\n\r\n|   | `CMAKE_CXX_FLAGS`  | `APPEND_CXXFLAGS`  |\r\n|---|---|---|\r\n| Origin | CMake's standard variable | Bitcoin Core's custom variable |\r\n| Context | Language-wide, applied during compiling and linking | Compiler only |\r\n| Position | Prepends others flags | Appends other flags |\r\n\r\nFixes https://github.com/bitcoin/bitcoin/issues/31487. However, during the development of the staging branch, the general consensus was to adhere to CMake's standard variables as much as possible.",
      "state": "closed",
      "user": "hebasto",
      "created_at": "2025-01-23T15:19:48Z",
      "updated_at": "2025-02-05T17:26:10Z",
      "comments": 7,
      "url": "https://github.com/bitcoin/bitcoin/pull/31726",
      "labels": [
        "Tests"
      ],
      "comment_list": [
        {
          "user": "DrahtBot",
          "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/31726.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\nA summary of reviews will appear here.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#31766](https://github.com/bitcoin/bitcoin/pull/31766) ([WIP] leveldb: pull upstream C++23 changes by fanquake)\n* [#30975](https://github.com/bitcoin/bitcoin/pull/30975) (ci: build multiprocess on most jobs by Sjors)\n* [#30595](https://github.com/bitcoin/bitcoin/pull/30595) (kernel: Introduce initial C header API by TheCharlatan)\n* [#29881](https://github.com/bitcoin/bitcoin/pull/29881) (guix: use GCC 13 to build releases by fanquake)\n* [#28710](https://github.com/bitcoin/bitcoin/pull/28710) (Remove the legacy wallet and BDB dependency by achow101)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n",
          "created_at": "2025-01-23T15:19:51Z"
        },
        {
          "user": "fanquake",
          "body": "This will \"fix\" #31487 for the CI, but just by hiding the underlying issue using `APPEND_CXXFLAGS`. Maybe this is better in any case, but it doesn't fix it for general, or non-CI usage.\r\n\r\nI'm also wondering if fixing it in this way, is worth introducing the inconsistency of using `CMAKE_C_FLAGS` but not `CMAKE_CXX_FLAGS` within the same CI job. I guess this would need to be documented, otherwise any changes or new jobs that don't use the right variables, will be back to having the less useful output. I'm also wondering about if we start primarily using the `APPEND_*` flags in the CI we might miss/introduce other issues, for those using the `CMAKE_*_FLAGS`, given the difference in behaviour of the variable.",
          "created_at": "2025-01-23T15:43:54Z"
        },
        {
          "user": "hebasto",
          "body": "> This will \"fix\" #31487 for the CI, but just by hiding the underlying issue using `APPEND_CXXFLAGS`. Maybe this is better in any case, but it doesn't fix it for general, or non-CI usage.\r\n\r\nI don't think there are any underlying issues with `APPEND_CXXFLAGS`. The summary correctly and completely reports flags passed to a compiler and to a linker, which was not the case with the Autotools-based system.",
          "created_at": "2025-01-23T15:57:58Z"
        },
        {
          "user": "theuni",
          "body": "> This will \"fix\" #31487 for the CI, but just by hiding the underlying issue using `APPEND_CXXFLAGS`. Maybe this is better in any case, but it doesn't fix it for general, or non-CI usage.\r\n\r\nFor better or worse, this is just how CMake works. `CMAKE_CXX_FLAGS` and `CXXFLAGS` go to the linker. If there's no conflict with the linker, I don't see the harm in the warnings ending up there. But if you don't want to see them there, I agree that `APPEND_CXXFLAGS` is the best solution :(",
          "created_at": "2025-01-23T19:20:55Z"
        },
        {
          "user": "hebasto",
          "body": "@theuni \r\n\r\nThank you for your feedback!\r\n\r\n> For better or worse, this is just how CMake works. ... `CXXFLAGS` go to the linker.\r\n\r\nThis passage might give the impression that this behaviour is specific to CMake. However, it is [not](https://github.com/bitcoin/bitcoin/issues/31487#issuecomment-2541468913):\r\n> Passing {C,CXX}FLAGS variables when using Autotools exhibits the same behaviour.",
          "created_at": "2025-01-24T07:20:45Z"
        },
        {
          "user": "maflcko",
          "body": "Are there any flags that one could put into `CMAKE_CXX_FLAGS` and cause a link error (or other error in the resulting binary), when such error wouldn't happen when putting the same flags in `APPEND_CXXFLAGS`? I couldn't come up with one, but it is easier to come up with compiler flags that should also be passed to the linker. So on a quick glance this seems better to leave as-is and close this pull? But no strong opinion, the changes here look fine either way.",
          "created_at": "2025-01-24T07:35:15Z"
        },
        {
          "user": "hebasto",
          "body": "> Are there any flags that one could put into `CMAKE_CXX_FLAGS` and cause a link error (or other error in the resulting binary), when such error wouldn't happen when putting the same flags in `APPEND_CXXFLAGS`? I couldn't come up with one\r\n\r\nNeither could I.\r\n\r\n>but it is easier to come up with compiler flags that should also be passed to the linker. So on a quick glance this seems better to leave as-is and close this pull?\r\n\r\nIn that case, https://github.com/bitcoin/bitcoin/issues/31487 should be closed, as the summary is technically correct.",
          "created_at": "2025-01-24T08:46:04Z"
        }
      ]
    },
    {
      "number": 31725,
      "title": "test: clarify timewarp grace period griefing attack",
      "body": "Adjust the timewarp test to better illustrate the griefing attack discussed here: https://delvingbitcoin.org/t/timewarp-attack-600-second-grace-period/1326/19 \r\n\r\nChanging `MAX_TIMEWARP` to something `> MAX_FUTURE_BLOCK_TIME` in `consensus.h` and `mining_basic.py` will cause the updated test to fail. I'm not proposing such a change here of course. The new test should be useful guidance for pool software developers, for why they really should use `curtime`, or least not ignore `mintime`.\r\n\r\nAdditionally, if the proposal is changed to make `MAX_TIMEWARP >  MAX_FUTURE_BLOCK_TIME` then this test will break, which could be used to demonstrate there's no such griefing attack anymore.\r\n\r\nOriginally part of #31600.",
      "state": "closed",
      "user": "Sjors",
      "created_at": "2025-01-23T15:07:32Z",
      "updated_at": "2025-12-03T14:55:15Z",
      "comments": 8,
      "url": "https://github.com/bitcoin/bitcoin/pull/31725",
      "labels": [
        "Tests"
      ],
      "comment_list": [
        {
          "user": "DrahtBot",
          "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/31725.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| ACK | [Prabhat1308](https://github.com/bitcoin/bitcoin/pull/31725#issuecomment-3220153666) |\n| Concept NACK | [darosior](https://github.com/bitcoin/bitcoin/pull/31725#pullrequestreview-3535301159) |\n\nIf your review is incorrectly listed, please copy-paste <code>&lt;!--meta-tag:bot-skip--&gt;</code> into the comment that the bot should ignore.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nNo conflicts as of last run.\n<!--5faf32d7da4f0f540f40219e4f7537a3-->",
          "created_at": "2025-01-23T15:07:35Z"
        },
        {
          "user": "Sjors",
          "body": "#31600 landed, ready for review",
          "created_at": "2025-02-01T09:07:58Z"
        },
        {
          "user": "DrahtBot",
          "body": "<!--8ac04cdde196e94527acabf64b896448-->\nThere hasn't been much activity lately. What is the status here?\n\n[Finding reviewers](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#finding-reviewers) may take time. However, if the patch is no longer relevant, please close this pull request. If the author lost interest or time to work on this, please close it and mark it 'Up for grabs' with the label, so that it can be picked up in the future.\n",
          "created_at": "2025-08-11T00:44:08Z"
        },
        {
          "user": "DrahtBot",
          "body": "<!--8ac04cdde196e94527acabf64b896448-->\nThere hasn't been much activity lately. What is the status here?\n\n[Finding reviewers](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#finding-reviewers) may take time. However, if the patch is no longer relevant, please close this pull request. If the author lost interest or time to work on this, please close it and mark it 'Up for grabs' with the label, so that it can be picked up in the future.\n",
          "created_at": "2025-08-11T02:49:47Z"
        },
        {
          "user": "Sjors",
          "body": "@Prabhat1308 can you update your review to the latest version?\r\n\r\nI've rebased it just in case.",
          "created_at": "2025-08-25T12:13:33Z"
        },
        {
          "user": "Prabhat1308",
          "body": "re-ACK [`37d2246`](https://github.com/bitcoin/bitcoin/pull/31725/commits/37d22461aa8f62d7fee9b65c8580b7f7a25f3382)",
          "created_at": "2025-08-25T12:54:30Z"
        },
        {
          "user": "fanquake",
          "body": "@darosior @sedited want to leave a conceptual opinion here, given your comments in #31600?",
          "created_at": "2025-12-03T10:50:30Z"
        },
        {
          "user": "Sjors",
          "body": "[BIP54](https://github.com/bitcoin/bips/blob/master/bip-0054.md) has been updated to use a 2 hour grace period rather than the `MAX_TIMEWARP = 600;` which our code still uses.\r\n\r\nIf you change `MAX_TIMEWARP` to `7200` there's no way to make the test in this PR pass. I'll leave that as an exercise to the reader.\r\n\r\nNote that the list of three bullet items boils down to _a single mistake_: using wall time for `nTime`. And as documented in the Delving post, that's not a hypothetical mistake. It's no longer a problem because BIP54 uses the longer grace period.",
          "created_at": "2025-12-03T14:54:52Z"
        }
      ]
    },
    {
      "number": 31724,
      "title": "cmake: Fix `-pthread` flags presentation in summary",
      "body": "This PR removes the raw CMake generator expressions from the summary output.\r\n\r\nFixes https://github.com/bitcoin/bitcoin/issues/31482.\r\n\r\nHere are a few examples of the summary:\r\n- on FreeBSD: https://github.com/hebasto/bitcoin-core-nightly/actions/runs/12930644678/job/36062648395\r\n- on OpenBSD: https://github.com/hebasto/bitcoin-core-nightly/actions/runs/12930647880/job/36062659528\r\n- on NetBSD: https://github.com/hebasto/bitcoin-core-nightly/actions/runs/12930651817/job/36062672223\r\n- on OmniOS: https://github.com/hebasto/bitcoin-core-nightly/actions/runs/12930654711/job/36062682690",
      "state": "closed",
      "user": "hebasto",
      "created_at": "2025-01-23T14:08:33Z",
      "updated_at": "2025-11-20T17:25:01Z",
      "comments": 13,
      "url": "https://github.com/bitcoin/bitcoin/pull/31724",
      "labels": [
        "Build system"
      ],
      "comment_list": [
        {
          "user": "DrahtBot",
          "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/31724.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| ACK | [davidgumberg](https://github.com/bitcoin/bitcoin/pull/31724#issuecomment-2613819385) |\n\nIf your review is incorrectly listed, please react with ðŸ‘Ž to this comment and the bot will ignore it on the next update.\n",
          "created_at": "2025-01-23T14:08:38Z"
        },
        {
          "user": "fanquake",
          "body": "> on OmniOS: https://github.com/hebasto/bitcoin-core-nightly/actions/runs/12930654711/job/36062682690#step:5:25\r\n\r\n```bash\r\n -- Found SQLite3: /usr/include (found suitable version \"3.46.1\", minimum required is \"3.7.17\")\r\nCMake Warning at CMakeLists.txt:195 (message):\r\n  PIE is not supported at link time: PIE (CXX): Change Dir:\r\n  '/home/runner/work/bitcoin-core-nightly/bitcoin-core-nightly/build/CMakeFiles/CMakeScratch/TryCompile-.raysb'\r\n\r\n  Run Build Command(s): /opt/ooce/bin/cmake -E env VERBOSE=1 /usr/bin/make -f\r\n  Makefile cmTC_93ec4/fast\r\n\r\n  /usr/bin/make -f CMakeFiles/cmTC_93ec4.dir/build.make\r\n  CMakeFiles/cmTC_93ec4.dir/build\r\n\r\n  Building CXX object CMakeFiles/cmTC_93ec4.dir/src.cxx.o\r\n\r\n  /usr/bin/g++ -DCMAKE_CXX_LINK_PIE_SUPPORTED -pthread -std=c++20 -o\r\n  CMakeFiles/cmTC_93ec4.dir/src.cxx.o -c\r\n  /home/runner/work/bitcoin-core-nightly/bitcoin-core-nightly/build/CMakeFiles/CMakeScratch/TryCompile-.raysb/src.cxx\r\n\r\n\r\n  Linking CXX executable cmTC_93ec4\r\n\r\n  /opt/ooce/bin/cmake -E cmake_link_script CMakeFiles/cmTC_93ec4.dir/link.txt\r\n  --verbose=1\r\n\r\n  g++: error: -pie is not supported in this configuration\r\n\r\n  /usr/bin/g++ -pthread -fPIE -pie CMakeFiles/cmTC_93ec4.dir/src.cxx.o -o\r\n  cmTC_93ec4\r\n\r\n  *** Error code 1\r\n\r\n  make: Fatal error: Command failed for target `cmTC_93ec4'\r\n\r\n  Current working directory\r\n  /home/runner/work/bitcoin-core-nightly/bitcoin-core-nightly/build/CMakeFiles/CMakeScratch/TryCompile-.raysb\r\n\r\n\r\n  *** Error code 1\r\n\r\n  make: Fatal error: Command failed for target `cmTC_93ec4/fast'\r\n\r\n-- Performing Test CXX_SUPPORTS__WERROR\r\n-- Performing Test CXX_SUPPORTS__WERROR - Success\r\n-- Setting build type to \"RelWithDebInfo\" as none was specified\r\n```\r\n\r\nThis one looks like its producing errors, but they are ignored and configuring continues? Is that a different bug?",
          "created_at": "2025-01-23T14:32:34Z"
        },
        {
          "user": "hebasto",
          "body": "> Is that a different bug?\r\n\r\nhttps://www.illumos.org/issues/15730\r\n\r\nUPD. This PR changes only flag presentation in the summary without actual changes in the build system.",
          "created_at": "2025-01-23T14:38:58Z"
        },
        {
          "user": "fanquake",
          "body": "> https://www.illumos.org/issues/15730\r\n\r\nSo is this a CMake bug then? I don't think our configure process should output `\"(Fatal) error\"` 3 different times and then carry on as if that's normal? I'm assuming anyone who sees it would be confused / report it as a bug. Side not, this would also make building on this platform with `-DWERROR` impossible, if #31665 went ahead.",
          "created_at": "2025-01-23T14:45:01Z"
        },
        {
          "user": "hebasto",
          "body": "> > https://www.illumos.org/issues/15730\r\n> \r\n> So is this a CMake bug then?\r\n\r\n1. Why a bug? A toolchain does not support PIE, and the script warns the user about that condition.\r\n\r\n2. This discussion seems unrelated to this PR changes and might be continued elsewhere, no?",
          "created_at": "2025-01-23T14:56:41Z"
        },
        {
          "user": "fanquake",
          "body": "> Why a bug?\r\n\r\nBecause CMake has a habit of trying to work around these kinds of issues internally, so when something like this pops up, it's something that they are not accomodating (and without looking at the code, it's unclear if that's a bug, or a concious  decision).\r\n\r\n> script warns the user about that condition.\r\n\r\nSure, I'm just not sure this is useful output. It's verbose compiler output, that also says `error` multiple times (not warning), and doesn't explain what anything means, or why it might/might not be a problem.\r\n\r\n> This discussion seems unrelated to this PR changes and might be continued elsewhere, no?\r\n\r\nSure, we can open another issue, or role it into #30771, given this is related to the same CMake functionality.",
          "created_at": "2025-01-23T15:07:18Z"
        },
        {
          "user": "hebasto",
          "body": "> > script warns the user about that condition.\r\n> \r\n> Sure, I'm just not sure this is useful output. It's verbose compiler output, that also says `error` multiple times (not warning), and doesn't explain what anything means, or why it might/might not be a problem.\r\n\r\n[Fixed](https://github.com/bitcoin/bitcoin/pull/31359#issuecomment-2610148447) in https://github.com/bitcoin/bitcoin/pull/31359.",
          "created_at": "2025-01-23T15:40:52Z"
        },
        {
          "user": "davidgumberg",
          "body": "Tested ACK https://github.com/bitcoin/bitcoin/pull/31724/commits/2083e9cf05ca64c12ec2aae42aac9c0f2054cd53\r\n\r\nLeft a non-blocking suggestion of an alternative approach, but I think this is a good solution to #31482 as-is.\r\n\r\n\r\n<details>\r\n\r\n<summary> On FreeBSD 14.2\r\n\r\n```console\r\n# freebsd-version\r\n14.2-RELEASE\r\n```\r\n\r\n</summary>\r\n\r\nmaster:\r\n\r\n```console\r\n# cmake -B build\r\nC++ compiler flags .................... -O2 -g -std=c++20 -fPIC -fdebug-prefix-map=/root/bitcoin-master/src=. -fmacro-prefix-map=/root/bitcoin-master/src=. $<$<COMPILE_LANG_AND_ID:CUDA,NVIDIA>:SHELL:-Xcompiler -pthread> $<$<AND:$<NOT:$<COMPILE_LANG_AND_ID:CUDA,NVIDIA>>,$<NOT:$<COMPILE_LANGUAGE:Swift>>>:-pthread> -Wall -Wextra -Wgnu -Wformat -Wformat-security -Wvla -Wshadow-field -Wthread-safety -Wloop-analysis -Wredundant-decls -Wunused-member-function -Wdate-time -Wconditional-uninitialized -Woverloaded-virtual -Wsuggest-override -Wimplicit-fallthrough -Wunreachable-code -Wdocumentation -Wself-assign -Wundef -Wno-unused-parameter -U_FORTIFY_SOURCE -D_FORTIFY_SOURCE=3 -Wstack-protector -fstack-protector-all -fcf-protection=full -fstack-clash-protection\r\n```\r\n\r\nOn this branch:\r\n\r\n```console\r\n# cmake -B build\r\nC++ compiler flags .................... -O2 -g -std=c++20 -fPIC -fdebug-prefix-map=/root/bitcoin-master/src=. -fmacro-prefix-map=/root/bitcoin-master/src=. -pthread -Wall -Wextra -Wgnu -Wformat -Wformat-security -Wvla -Wshadow-field -Wthread-safety -Wloop-analysis -Wredundant-decls -Wunused-member-function -Wdate-time -Wconditional-uninitialized -Woverloaded-virtual -Wsuggest-override -Wimplicit-fallthrough -Wunreachable-code -Wdocumentation -Wself-assign -Wundef -Wno-unused-parameter -U_FORTIFY_SOURCE -D_FORTIFY_SOURCE=3 -Wstack-protector -fstack-protector-all -fcf-protection=full -fstack-clash-protection\r\n```",
          "created_at": "2025-01-25T07:08:15Z"
        },
        {
          "user": "hebasto",
          "body": "> Fixes #31482.\r\n\r\nThe issue been fixed is assigned to the \"29.0\" milestone.\r\n\r\nShould the milestones for an issue and a PR with its fix be aligned?",
          "created_at": "2025-02-17T15:51:43Z"
        },
        {
          "user": "purpleKarrot",
          "body": "There are two general problems with printing a build summary at configure time:\r\n\r\n1. It is annoying visual clutter. The cmake configure log should contain status events and important warnings as well as errors. Detailed settings can be analyzed and modified in the cache editor such as `ccmake`. Currently, when using `ccmake`, this dreaded summary has to be dismissed with `e` after each configure run with `c`. This is because make treats the summary as a warning.\r\n\r\n2. There is no way to know all compile options at configure time. #31482 is just one example for showing that the exact settings that will be used for the build are not known until generate time. Trying to replace generator expressions with hardcoded constants is an endless effort but the more severe issue is that it turns the summary into an approximation. There is no guarantee that what you see in the summary actually matches the information used by the build system.\r\n\r\nThe best alternative to printing a summary at configure time, is to generate it into a file at generate time with [`file(GENERATE)`](https://cmake.org/cmake/help/latest/command/file.html#generate). This supports generator expressions.",
          "created_at": "2025-02-19T12:28:29Z"
        },
        {
          "user": "DrahtBot",
          "body": "<!--8ac04cdde196e94527acabf64b896448-->\nThere hasn't been much activity lately. What is the status here?\n\n[Finding reviewers](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#finding-reviewers) may take time. However, if the patch is no longer relevant, please close this pull request. If the author lost interest or time to work on this, please close it and mark it 'Up for grabs' with the label, so that it can be picked up in the future.\n",
          "created_at": "2025-08-19T00:45:04Z"
        },
        {
          "user": "maflcko",
          "body": "> The best alternative to printing a summary at configure time, is to generate it into a file at generate time with [`file(GENERATE)`](https://cmake.org/cmake/help/latest/command/file.html#generate). This supports generator expressions.\r\n\r\nI think there is value in printing a configure summary to stdout, so writing it only to a file could make it harder to quickly double-check if an option or compile flag has been applied.",
          "created_at": "2025-08-19T20:02:31Z"
        },
        {
          "user": "fanquake",
          "body": "I've closed #31482, as not sure making further changes to address this is worth it.",
          "created_at": "2025-11-20T17:21:15Z"
        }
      ]
    },
    {
      "number": 31723,
      "title": "qa: Facilitate debugging bitcoind inside functional tests",
      "body": "Facilitates debugging specific instances of bitcoind *in the context of Python tests, inside of an editor/IDE/debugger*.\r\n\r\nMakes bitcoind spin during startup, waiting for a debugger to be attached, so that breakpoints during process init can be debugged.\r\n\r\n### Example usage\r\n\r\n1. Generate build files with `-DENABLE_WAIT_FOR_DEBUGGER=ON` & build.\r\n   \r\n   ```\r\n   cmake -B build -DCMAKE_BUILD_TYPE=Debug -DENABLE_WAIT_FOR_DEBUGGER=ON && cmake --build build -j$(nproc)\r\n   ```\r\n\r\n2. Set breakpoints in the C++ code in your editor/IDE/debugger.\r\n\r\n3. Start a Python functional test with a debugger command such as:\r\n   - LLDB inside an already started Tmux pane (append ` -o continue` to the LLDB args to have the debugger continue automatically):\r\n     ```\r\n     ./build/test/functional/feature_loadblock.py --debug_runs 2 --debug_cmd \"tmux split-window -h lldb -p \\$PID\\$\"\r\n     ```\r\n   - Sublime Text Debugger, allows a running session to attach:\r\n     ```\r\n     ./build/test/functional/feature_loadblock.py --debug_runs 2 --debug_cmd \"subl --command \\\"debugger {\\\\\\\"action\\\\\\\": \\\\\\\"start\\\\\\\", \\\\\\\"configuration\\\\\\\": {\\\\\\\"name\\\\\\\": \\\\\\\"foo\\\\\\\", \\\\\\\"type\\\\\\\": \\\\\\\"lldb\\\\\\\", \\\\\\\"request\\\\\\\": \\\\\\\"attach\\\\\\\", \\\\\\\"program\\\\\\\": \\\\\\\"dummyprogram\\\\\\\", \\\\\\\"pid\\\\\\\": \\\\\\\"\\$PID\\$\\\\\\\"}}\\\"\"\r\n     ```\r\n   - Don't specify `--debug_cmd ...\\$PID\\$...`, instead have the test framework log which bitcoind PID you should manually attach to:\r\n     ```\r\n     ./build/test/functional/feature_loadblock.py --debug_runs 2\r\n     ```\r\n\r\n5. Experience how debugger hits breakpoints as the functional test executes RPCs.\r\n\r\nUsing `-debug_runs <RUN_INDEX>` often requires doing a dry-run of a functional test with `-ldebug` and examining the log to see which run index is the one we want to debug:\r\n```\r\n2025-...Z TestFramework.node0 (DEBUG): bitcoind started (run #1, node #0), waiting for RPC to come up\r\n``` \r\n\r\n### Alternative usage\r\n\r\nTweak functional test code to specify `wait_for_debugger` when (re)starting a node:\r\n\r\n```diff\r\n-        self.restart_node(0)\r\n+        self.restart_node(0, wait_for_debugger=True)\r\n```\r\nWhile it can be messy to modify files while moving between commits, and cumbersome inside of loops, it might be more straightforward than `-debug_runs <RUN_INDEX>` in a given case.\r\n\r\n### *Needed before merge*\r\n\r\n- [ ] Testing on Mac to confirm -waitfordebugger on the C++ side behaves as expected.",
      "state": "open",
      "user": "hodlinator",
      "created_at": "2025-01-23T13:18:06Z",
      "updated_at": "2026-01-03T19:30:27Z",
      "comments": 16,
      "url": "https://github.com/bitcoin/bitcoin/pull/31723",
      "labels": [
        "Tests"
      ],
      "comment_list": [
        {
          "user": "DrahtBot",
          "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/31723.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| Concept ACK | [l0rinc](https://github.com/bitcoin/bitcoin/pull/31723#pullrequestreview-3273781326) |\n\nIf your review is incorrectly listed, please copy-paste <code>&lt;!--meta-tag:bot-skip--&gt;</code> into the comment that the bot should ignore.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#33974](https://github.com/bitcoin/bitcoin/pull/33974) (cmake: Check dependencies after build option interaction by hebasto)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n<!--5faf32d7da4f0f540f40219e4f7537a3-->",
          "created_at": "2025-01-23T13:18:09Z"
        },
        {
          "user": "fanquake",
          "body": "> Makes bitcoind spin during startup, waiting for a debugger to be attached.\r\n\r\nCan you explain more? If you want to run under a debugger, then why not just start `bitcoind` under a debugger; why do we need to add this option?",
          "created_at": "2025-01-23T13:47:36Z"
        },
        {
          "user": "hodlinator",
          "body": "> Can you explain more? If you want to run under a debugger, then why not just start `bitcoind` under a debugger; why do we need to add this option?\r\n\r\nClarified PR description text and added example usage. But I'm curious to hear other ways of doing the same thing if there are any.",
          "created_at": "2025-01-23T13:55:34Z"
        },
        {
          "user": "maflcko",
          "body": "I think if you want to debug the start-up sequence specifically, it may be easier to do it outside the tests? Then anything else, if needed, can happen without patching Bitcoin Core source code itself.\r\n\r\n",
          "created_at": "2025-01-23T14:00:28Z"
        },
        {
          "user": "hodlinator",
          "body": "> I think if you want to debug the start-up sequence specifically, it may be easier to do it outside the tests? Then anything else, if needed, can happen without patching Bitcoin Core source code itself.\r\n\r\nThis is not about debugging the start-up sequence specifically, but rather debugging *from an early stage*. Maybe one has set 5 breakpoints, some of which are hit during *bitcoind* init, and some which are hit by re-running a Python test which calls a set of RPCs.",
          "created_at": "2025-01-23T14:19:09Z"
        },
        {
          "user": "fanquake",
          "body": "Ideally we wouldn't be adding debug code, to production binaries, to facilitate using an IDE.\r\n\r\nCan you configure your IDE to do something like the equivalent of using `gdb`/`lldb`, and `process attach --name bitcoind --waitfor`? So it just grabs bitcoind once it spins up?",
          "created_at": "2025-01-23T14:24:07Z"
        },
        {
          "user": "hodlinator",
          "body": "> Ideally we wouldn't be adding debug code, to production binaries, to facilitate using an IDE.\r\n\r\nAgree it should not be in production binaries, should be `#ifdef`ed away. Added as another reason for draft status.\r\n \r\n> Can you configure your IDE to do something like the equivalent of using `gdb`/`lldb`, and `process attach --name bitcoind --waitfor`? So it just grabs bitcoind once it spins up?\r\n\r\nI've never seen something like that in an IDE/editor, but I'll have a look, might exist a debugger console which allows that kind of thing.\r\n\r\nThis PR does however allow for attaching to a specific node instance of bitcoind if a Python tests runs several nodes at once. (I'm considering changing the index to refer to how many bitcoind-launches one has done, some tests just relaunch node 0 a bunch of times, and one might be interested in debugging it on the 3rd execution *Edit: this is now implemented*).",
          "created_at": "2025-01-23T14:37:44Z"
        },
        {
          "user": "yuvicc",
          "body": "Agree with @maflcko @fanquake, not sure if we want to add that to the production code.",
          "created_at": "2025-01-27T13:46:05Z"
        },
        {
          "user": "hodlinator",
          "body": "Added tentative `#ifdef` solution in latest push. CMake part could probably be improved since now I think the `#define` leaks into the CMake project's public interface, which should not be necessary.",
          "created_at": "2025-01-27T19:15:45Z"
        },
        {
          "user": "hodlinator",
          "body": "- Added CMake option `WAIT_FOR_DEBUGGER`.\r\n- Changed the Python logic from debugging specific nodes, to debugging specific node runs/executions, which is more specific.\r\n- Use `prctl()` on Linux to allow any process to attach to `bitcoind`. This removes the necessity to disable `kernel.yama.ptrace_scope` on some systems, which may be seen as decreasing security, but is compiled out unless `WAIT_FOR_DEBUGGER=ON`.\r\n- (Confirmed PR works on Windows).\r\n- (Rebased).",
          "created_at": "2025-02-13T08:05:32Z"
        },
        {
          "user": "maflcko",
          "body": "> > I think if you want to debug the start-up sequence specifically, it may be easier to do it outside the tests? Then anything else, if needed, can happen without patching Bitcoin Core source code itself.\r\n> \r\n> This is not about debugging the start-up sequence specifically, but rather debugging _from an early stage_. Maybe one has set 5 breakpoints, some of which are hit during _bitcoind_ init, and some which are hit by re-running a Python test which calls a set of RPCs.\r\n\r\nI'd still say it is easier to debug the init sequence separately than to start a new build with a new build flag for the edge case where someone wants to debug both in an IDE and also the init sequence , but no strong opinion.",
          "created_at": "2025-02-13T11:45:28Z"
        },
        {
          "user": "hodlinator",
          "body": "fanquake:\r\n\r\n> > Can you configure your IDE to do something like the equivalent of using `gdb`/`lldb`, and `process attach --name bitcoind --waitfor`? So it just grabs bitcoind once it spins up?\r\n> \r\n> I've never seen something like that in an IDE/editor, but I'll have a look, might exist a debugger console which allows that kind of thing.\r\n\r\nThe only debugging console I get with the IDE states \"No Active Debug Session\" when I try to input commands. :(\r\n\r\nmaflcko:\r\n\r\n> > This is not about debugging the start-up sequence specifically, but rather debugging _from an early stage_. Maybe one has set 5 breakpoints, some of which are hit during _bitcoind_ init, and some which are hit by re-running a Python test which calls a set of RPCs.\r\n> \r\n> I'd still say it is easier to debug the init sequence separately than to start a new build with a new build flag for the edge case where someone wants to debug both in an IDE and also the init sequence , but no strong opinion.\r\n\r\nMaybe part of this is down to me not getting used to using a Python debugger, breaking in Python at appropriate times and then attaching a C++ debugger to the new process. Being able to specify which bitcoind-executions one wants to debug still seems like a smoother workflow when testing the same scenario repeatedly.\r\n\r\nI recently used a version of this PR when digging into #31734. Being able to step through the code (with a panel for inspecting local variables and watches), as the Python test framework is issuing RPCs, in the safety of one's IDE, is nice. Knowing that bitcoind has *not* passed through one's breakpoints (unless there's some rare static initialization going on) helps build certainty about what unfamiliar code is involved in.\r\n\r\nGranted, using `--waitfor` straight in gdb/lldb would give definite certainty what code runs. But the IDE GUI would not be there. I know gdb has some kind of TUI, and there are probably commands for saving and restoring state. It just feels like operating the computer with my feet. Happy to be proven wrong though. Please shill your setups. :)",
          "created_at": "2025-02-13T15:49:27Z"
        },
        {
          "user": "hodlinator",
          "body": "Realized one could start a debugger session from the CLI:\r\n`$ subl --command \"debugger {\\\"action\\\": \\\"start\\\", \\\"configuration\\\": {\\\"name\\\": \\\"foo\\\", \\\"type\\\": \\\"lldb\\\", \\\"request\\\": \\\"launch\\\", \\\"program\\\": \\\"\\${project_path}/build/bin/bitcoind\\\", \\\"args\\\": [\\\"-noconnect\\\"]}}\"`\r\nor\r\n`$ kgx -- $(which lldb) -o run -- /home/hodlinator/bc/3/build/bin/bitcoind -noconnect`\r\n\r\nSo I've explored a variation of this which does not change the C++ side at all - https://github.com/hodlinator/bitcoin/tree/refs/heads/2025/09/launch_debugger. The approach is to launch the debugger from inside `TestNode` with the bitcoind command line as parameters. A stumbling block was that both debugger commands above exit immediately instead of running until bitcoind exits. Both document supporting `--wait` but Sublime Text requires passing in a file to be opened (`--wait dummyfile`) and the kgx Gnome Console has it marked as \"TODO\".\r\n\r\nThis lead me to create the `launch_and_wait.py` shim which simulates bitcoind process lifetime behavior. The shim has the following drawbacks:\r\n* Requires manually sending a HTTP GET request for it to exit. - Maybe there's some way for it to monitor PID-files and exit automatically based off that for most tests which don't mess around with that file.\r\n* While it could pass on environment variables (or in the case of Sublime Text have them specified through `configuration.env`), I don't think it's possible to pass through stderr/stdout since the debug launch commands exit quickly. - Maybe there's some way for it to monitor the node's stdout/stderr files and copy their contents to its own stdout/stderr, but it seems a bit messy.\r\n\r\nAttaching to the process seems less error prone. After having worked on the above I realized attaching the debugger could be automated, so added that as a second commit in this PR.\r\n\r\nIf reviewers insist I could continue exploring the launch_debugger route to see how monitoring PID-files (or just require something like `--wait dummyfile`) and replicating stdout/stderr contents pans out.",
          "created_at": "2025-09-25T09:53:42Z"
        },
        {
          "user": "hodlinator",
          "body": "Latest push adds 9d1de2e8b3c73edc44bb3f7578ec96c2b91c2dd8 to support modifying a functional test to make a specific node (re)start trigger attaching of a debugger. This may be a more natural alternative when humans read through functional test code and want to select a specific node instance to debug.\r\n\r\n(It also removes a header which caused a build failure on Alpine/musl, and adds helpful details in 2 commit messages).\r\n\r\nThere has been some feedback to see if we could avoid changing the functional test framework and move most of this feature to */contrib/*, so I might try to figure out alternative approaches.",
          "created_at": "2025-10-24T06:12:39Z"
        },
        {
          "user": "DrahtBot",
          "body": "<!--85328a0da195eb286784d51f73fa0af9-->\nðŸš§ At least one of the CI tasks failed.\n<sub>Task `lint`: https://github.com/bitcoin/bitcoin/actions/runs/20229750611/job/58069642887</sub>\n<sub>LLM reason (âœ¨ experimental): CI failure due to Python lint errors reported by ruff (unused import and an f-string issue) in the lint step.</sub>\n\n<details><summary>Hints</summary>\n\nTry to run the tests locally, according to the documentation. However, a CI failure may still\nhappen due to a number of reasons, for example:\n\n* Possibly due to a silent merge conflict (the changes in this pull request being\nincompatible with the current code in the target branch). If so, make sure to rebase on the latest\ncommit of the target branch.\n\n* A sanitizer issue, which can only be found by compiling with the sanitizer and running the\n  affected test.\n\n* An intermittent issue.\n\nLeave a comment here, if you need help tracking down a confusing failure.\n\n</details>\n\n",
          "created_at": "2025-12-15T11:03:17Z"
        },
        {
          "user": "hodlinator",
          "body": "Changes compared to f352bd9d246b20579b9b4ccec366bb694df5e051:\r\n* feature_debugging.py - Added stderr output upon failure when we expect to be able to attach. Switched to `subprocess.run(..., text=True)` in spirit of fab085c15f7221986f73af7e05e799edf3eadaf0.\r\n* Renamed CMake option `WAIT_FOR_DEBUGGER` -> `ENABLE_WAIT_FOR_DEBUGGER` to align convention with other options (also renamed `constexpr bool` in bitcoind.cpp from `WAIT_FOR_DEBUGGER_ENABLE` -> `WAIT_FOR_DEBUGGER_SUPPORT` to disambiguate).\r\n* Added config.ini support for `ENABLE_WAIT_FOR_DEBUGGER` and implemented `is_wait_for_debugger_compiled()` instead of custom parsing of CMakeCache.txt in feature_debugging.py.\r\n* Added comment in test_node.py explaining that functional test will continue executing even though a debugger has not been attached yet.\r\n* Switched from mentioning Gnome Console in commit message and developer-notes.md to using Tmux as an example.\r\n* Switched example test from feature_abortnode.py to feature_loadblock.py since the former causes a node to crash.\r\n* Made `--debug_cmd` without `--debug_runs` not enable it for all runs, but instead require modifying test code to specify `wait_for_debugger=True` or use `--debug_runs`.\r\n",
          "created_at": "2025-12-15T11:05:44Z"
        }
      ]
    },
    {
      "number": 31722,
      "title": "cmake: Copy `cov_tool_wrapper.sh.in` to the build tree",
      "body": "This PR ensures that `cov_tool_wrapper.sh.in` is available when invoking the `Coverage.cmake` script from any directory.\r\n\r\nHere is an example of usage on Ubuntu 24.10 with the default GCC 14.2.0:\r\n```\r\n$ cmake -B build -DCMAKE_BUILD_TYPE=Coverage -DCMAKE_CXX_FLAGS=\"-fprofile-update=atomic\" -DCMAKE_C_FLAGS=\"-fprofile-update=atomic\"\r\n$ cmake --build build -j $(nproc)\r\n$ cd ..\r\n$ cmake -DJOBS=$(nproc) -DLCOV_OPTS=\"--ignore-errors inconsistent,inconsistent\" -P bitcoin/build/Coverage.cmake\r\n```\r\n\r\nFixes https://github.com/bitcoin/bitcoin/issues/31638.",
      "state": "closed",
      "user": "hebasto",
      "created_at": "2025-01-23T10:51:17Z",
      "updated_at": "2025-02-13T09:36:10Z",
      "comments": 1,
      "url": "https://github.com/bitcoin/bitcoin/pull/31722",
      "labels": [
        "Bug",
        "Build system"
      ],
      "comment_list": [
        {
          "user": "DrahtBot",
          "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/31722.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| ACK | [theuni](https://github.com/bitcoin/bitcoin/pull/31722#pullrequestreview-2612746737) |\n\nIf your review is incorrectly listed, please react with ðŸ‘Ž to this comment and the bot will ignore it on the next update.\n",
          "created_at": "2025-01-23T10:51:21Z"
        }
      ]
    },
    {
      "number": 31719,
      "title": "miniscript: fixes #29098 by only use first k valid signatures",
      "body": "In issue #29098 a recommendation is not to use \"best (smallest) set of k signatures\".  So, this effort is to fall back to the original algorithm which only use the first k available signatures for satisfying a k-of-n multisig.  Otherwise, there will be timeout in unit test when we have 999-of-999 use case.\r\n\r\nProfiling has been done on Mac to confirm the most time consuming function is in internal::InputResult ProduceInput.\r\n\r\nFollowing tests will hit the affected code:\r\n\r\n- ctest --test-dir build\r\n\r\nor to be specific: \r\n% build/src/test/test_bitcoin --run_test=descriptor_tests\r\n% build/src/test/test_bitcoin --run_test=miniscript_tests\r\n\r\n- build/test/functional/test_runner.py --extended\r\n\r\nor to be specific:\r\nbuild/test/functional/test_runner.py test/functional/wallet_taproot.py --tmpdir /tmp\r\n\r\n- env -i HOME=\"$HOME\" PATH=\"$PATH\" USER=\"$USER\" bash -c 'MAKEJOBS=\"-j8\" FILE_ENV=\"./ci/test/00_setup_env_native_fuzz.sh\" ./ci/test_run_all.sh'\r\n\r\nTime enhancement comparision:\r\nFor original wallet_taproot.py test, it reduces the time from 10 seconds to 7 seconds on Apple M1 chipset (Sequoia 15.1.1).\r\n\r\n\r\n",
      "state": "closed",
      "user": "tnndbtc",
      "created_at": "2025-01-23T05:37:27Z",
      "updated_at": "2025-10-22T16:12:46Z",
      "comments": 9,
      "url": "https://github.com/bitcoin/bitcoin/pull/31719",
      "labels": [
        "Descriptors"
      ],
      "comment_list": [
        {
          "user": "DrahtBot",
          "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/31719.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| Concept NACK | [darosior](https://github.com/bitcoin/bitcoin/pull/31719#issuecomment-3432713975) |\n\nIf your review is incorrectly listed, please react with ðŸ‘Ž to this comment and the bot will ignore it on the next update.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nNo conflicts as of last run.\n",
          "created_at": "2025-01-23T05:37:29Z"
        },
        {
          "user": "tnndbtc",
          "body": "I'd like to add more comments on how to test this for people who is new to bitcoin project:\r\n\r\nTo cherry pick my fixes:\r\n% git remote add tnndbtc https://github.com/tnndbtc/bitcoin\r\n% git fetch tnndbtc\r\n% git cherry-pick 4d9c1b741d4eb29cf66e6cbe4dd8f64bef24c30e\r\n\r\nTo validate https://github.com/bitcoin/bitcoin/pull/28212\r\n% git remote add eriknylund https://github.com/eriknylund/bitcoin.git\r\n% git fetch eriknylund\r\n% git cherry-pick 387c12e0813a863bc9728777719acbafe7b12a34\r\n\r\nThe profiling results, notes can be found at https://github.com/tnndbtc/notes/blob/main/bitcoin/issues/28179/notes.txt ",
          "created_at": "2025-01-23T05:47:13Z"
        },
        {
          "user": "DrahtBot",
          "body": "<!--85328a0da195eb286784d51f73fa0af9-->\nðŸš§ At least one of the CI tasks failed.\n<sub>Debug: https://github.com/bitcoin/bitcoin/runs/36039588773</sub>\n\n<details><summary>Hints</summary>\n\nTry to run the tests locally, according to the documentation. However, a CI failure may still\nhappen due to a number of reasons, for example:\n\n* Possibly due to a silent merge conflict (the changes in this pull request being\nincompatible with the current code in the target branch). If so, make sure to rebase on the latest\ncommit of the target branch.\n\n* A sanitizer issue, which can only be found by compiling with the sanitizer and running the\n  affected test.\n\n* An intermittent issue.\n\nLeave a comment here, if you need help tracking down a confusing failure.\n\n</details>\n",
          "created_at": "2025-01-23T06:22:29Z"
        },
        {
          "user": "tnndbtc",
          "body": "@brunoerg  @eriknylund and @darosior : I have reproduced the issue on CI fuzz test and made the fix.  Now, it passed all checks.  Please review when you are free.  Thanks.\r\n\r\nCC: @hodlinator ",
          "created_at": "2025-01-30T22:43:07Z"
        },
        {
          "user": "tnndbtc",
          "body": "@hodlinator Appreciate your valuable comments and reviews.  I've made the changes accordingly so you can check them out one by one.\r\n\r\nAs for the choice \"_I think it would be good if this PR did one of either:\r\na) Directly included https://github.com/bitcoin/bitcoin/commit/387c12e0813a863bc9728777719acbafe7b12a34 from https://github.com/bitcoin/bitcoin/pull/28212, or\r\nb) Not mention https://github.com/bitcoin/bitcoin/commit/387c12e0813a863bc9728777719acbafe7b12a34/https://github.com/bitcoin/bitcoin/pull/28212 as much as it is doing - instead focusing on https://github.com/bitcoin/bitcoin/issues/29098._\", \r\nI prefer b) because I haven't done full code review for https://github.com/bitcoin/bitcoin/pull/28212 so I'd expect PR owner @eriknylund to focus on the original issue and address review questions by himself.  So, just removed the reference of it in PR description.\r\n\r\n\r\n\r\n",
          "created_at": "2025-03-07T04:20:48Z"
        },
        {
          "user": "sipa",
          "body": "@tnndbtc Have you considered my [suggestion](https://github.com/bitcoin/bitcoin/issues/29098#issuecomment-1860568169) to instead of just picking the first `k` signatures, keep using the existing algorithm, but stop trying things as soon as the optimal size is reached? I suspect that that will in practice have the same performance as first-k, but won't lose the optimality property the current algorithm has.",
          "created_at": "2025-03-07T15:11:04Z"
        },
        {
          "user": "tnndbtc",
          "body": "@sipa Yes, I considered your proposal and it would still make the proposed test to timeout. \r\n`self.do_test_k_of_n(999, 999)`\r\n\r\nI just responded your comment in the original thread [here](https://github.com/bitcoin/bitcoin/issues/29098#issuecomment-2706831776)",
          "created_at": "2025-03-07T16:03:39Z"
        },
        {
          "user": "maflcko",
          "body": "Please squash your commits according to https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#squashing-commits",
          "created_at": "2025-04-14T14:31:57Z"
        },
        {
          "user": "darosior",
          "body": "While it may be desirable, i don't think this is a priority (as demonstrated by the lack of reviewer interest). Concept NACK.",
          "created_at": "2025-10-22T14:39:16Z"
        }
      ]
    },
    {
      "number": 31718,
      "title": "Docs: fix typos in documentation files",
      "body": "",
      "state": "closed",
      "user": "wgyt",
      "created_at": "2025-01-23T03:52:41Z",
      "updated_at": "2025-01-24T10:39:43Z",
      "comments": 6,
      "url": "https://github.com/bitcoin/bitcoin/pull/31718",
      "labels": [
        "Docs"
      ],
      "comment_list": [
        {
          "user": "DrahtBot",
          "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/31718.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| ACK | [maflcko](https://github.com/bitcoin/bitcoin/pull/31718#issuecomment-2611875281) |\n\nIf your review is incorrectly listed, please react with ðŸ‘Ž to this comment and the bot will ignore it on the next update.\n",
          "created_at": "2025-01-23T03:52:44Z"
        },
        {
          "user": "DrahtBot",
          "body": "ðŸ“ Archived release notes are archived and should not be modified.",
          "created_at": "2025-01-23T03:52:47Z"
        },
        {
          "user": "DrahtBot",
          "body": "<!--85328a0da195eb286784d51f73fa0af9-->\nðŸš§ At least one of the CI tasks failed.\n<sub>Debug: https://github.com/bitcoin/bitcoin/runs/36036780342</sub>\n\n<details><summary>Hints</summary>\n\nTry to run the tests locally, according to the documentation. However, a CI failure may still\nhappen due to a number of reasons, for example:\n\n* Possibly due to a silent merge conflict (the changes in this pull request being\nincompatible with the current code in the target branch). If so, make sure to rebase on the latest\ncommit of the target branch.\n\n* A sanitizer issue, which can only be found by compiling with the sanitizer and running the\n  affected test.\n\n* An intermittent issue.\n\nLeave a comment here, if you need help tracking down a confusing failure.\n\n</details>\n",
          "created_at": "2025-01-23T03:58:30Z"
        },
        {
          "user": "maflcko",
          "body": "You can't modify a subtree either.\r\n\r\nAlso, please squash your commits according to https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#squashing-commits",
          "created_at": "2025-01-23T08:27:27Z"
        },
        {
          "user": "maflcko",
          "body": "lgtm ACK c32bc14f5505f289aa66ce7a3608cd799e457699",
          "created_at": "2025-01-23T09:29:49Z"
        },
        {
          "user": "maflcko",
          "body": "lgtm ACK 81b9800c87e96c83a49cabd1eddcbef210387da5",
          "created_at": "2025-01-24T07:48:27Z"
        }
      ]
    }
  ],
  "issues": [
    {
      "number": 31728,
      "title": "Bug: Non-Ranged Descriptors with Range [0,0] Trigger Unexpected Wallet Errors in `AddWalletDescriptor`",
      "body": "**Summary:**\n\nWhen attempting to add a **non-ranged** descriptor with a start/end range of `[0,0]` via `AddWalletDescriptor`, an error may appear:  \n```\nUpdateWalletDescriptor: new range must include current range = [0,0].\n```\nThis is unexpected for a non-ranged descriptor, as `[0,0]` should effectively mean â€œno range.â€ In some cases, changing the end to `1` (i.e. `[0,1]`) circumvents the issue, but that implies a single-index range rather than a truly non-ranged descriptor.\n\nFurther debugging revealed this seems tied to:\n1. **Multiple calls** to `AddWalletDescriptor` for the same descriptor.\n2. **Internal handling of descriptor ranges** (the wallet expects a valid range for ranged descriptors, but still enforces checks on `start/end` even if the descriptor is meant to be non-ranged).\n3. A possible **bug in `UpdateWalletDescriptor`** when it encounters repeated or zero-width ranges.\n\n**What was expected:**\n- Specifying `[0,0]` for a non-ranged descriptor (or not specifying a range at all) should *not* fail.\n- A truly non-ranged descriptor should not require these range checks.\n- `AddWalletDescriptor` should be idempotent\n\n**What actually happens:**\n- Repeatedly adding a descriptor (or calling it in a way that triggers `UpdateWalletDescriptor`) with `[0,0]` can cause the wallet to complain that the â€œnew range must include current range = [0,0]â€.\n\n**Why this matters:**\n- Non-ranged descriptor workflows should be consistent and should not require a dummy range.\n- The wallet code should either cleanly ignore range parameters for non-ranged descriptors or handle a `[0,0]` range gracefully.\n\n**Proposed fix or investigation:**\n- Review `AddWalletDescriptor` and `UpdateWalletDescriptor` logic to ensure zero-width (`[0,0]`) or absent ranges are handled properly for non-ranged descriptors.\n- Confirm if the internal code should treat `[0,0]` as a valid non-ranged descriptor or if that scenario should simply be disallowed/ignored in favor of no range parameters at all.\n- Add tests to cover repeatedly adding the same descriptor and verifying correct behavior for non-ranged descriptors.\n- Change the wallet::WalletDescriptor to have `std::optional<std::pair<start,end>>` to differentiate unranged v.s. empty ranged descriptors.\n\nThis appears to be a minor bug, but it can lead to confusion and error messages when using or experimenting with non-ranged descriptors in custom wallet workflows.",
      "state": "closed",
      "user": "JeremyRubin",
      "created_at": "2025-01-23T19:25:03Z",
      "updated_at": "2025-05-20T19:30:30Z",
      "comments": 6,
      "url": "https://github.com/bitcoin/bitcoin/issues/31728",
      "labels": [
        "Wallet"
      ],
      "comment_list": [
        {
          "user": "asklokesh",
          "body": "I've investigated this issue and have a fix for the uninitialized `subtype` variable in `LoadWalletFlags()`.\n\nThe bug occurs because `subtype` is being used for version compatibility checks but may remain uninitialized if the data stream doesn't contain subtype information.\n\n**Fix approach:**\n1. Initialize `subtype` with a safe default value (`DBWrapperSubType::UNKNOWN`) at declaration\n2. Ensure all code paths properly set `subtype` with explicit handling for cases where:\n   - The stream contains only flags with no subtype\n   - The subtype value is out of the valid range\n\nThis approach maintains backward compatibility while preventing potential undefined behavior when reading older wallet formats. I'll submit a PR with this fix shortly.",
          "created_at": "2025-03-04T02:23:42Z"
        },
        {
          "user": "Chand-ra",
          "body": "Hey @asklokesh, are you still working on this or can I chime in to help as well?",
          "created_at": "2025-03-09T17:00:32Z"
        },
        {
          "user": "furszy",
          "body": "> Hey [@asklokesh](https://github.com/asklokesh), are you still working on this or can I chime in to help as well?\n\nYou can tackle it. asklokesh comment is surely from chatGPT and makes no sense in our code. We should delete it.",
          "created_at": "2025-03-09T17:06:52Z"
        },
        {
          "user": "Eunovo",
          "body": "> > Hey [@asklokesh](https://github.com/asklokesh), are you still working on this or can I chime in to help as well?\n> \n> You can tackle it. asklokesh comment is surely from chatGPT and makes no sense in our code. We should delete it.\n\nOpened PR https://github.com/bitcoin/bitcoin/pull/32344 to close this. It's been a while since @Chand-ra indicated interest",
          "created_at": "2025-04-24T19:25:04Z"
        },
        {
          "user": "Chand-ra",
          "body": "> Opened PR [#32344](https://github.com/bitcoin/bitcoin/pull/32344) to close this. It's been a while since [@Chand-ra](https://github.com/Chand-ra) indicated interest\n\nYeah, feel free to tackle it, I just couldn't get around to doing it.",
          "created_at": "2025-04-25T15:48:43Z"
        },
        {
          "user": "JeremyRubin",
          "body": "to be fair, i'm pretty sure i dumped my notes on the issue into GPT after encountering it :(",
          "created_at": "2025-04-25T19:30:33Z"
        }
      ]
    },
    {
      "number": 31721,
      "title": "test: intermittent issue in p2p_1p1c_network.py ",
      "body": "Looks like this still happens: https://github.com/bitcoin/bitcoin/pull/31713#issuecomment-2609212276\n\nSo this is likely a non-timeout issue. Note that the test has immediate tx-relay (`self.noban_tx_relay`) enabled, so trickle delay should not be an issue.\n\n_Originally posted by @maflcko in https://github.com/bitcoin/bitcoin/issues/31701#issuecomment-2609226329_\n            ",
      "state": "closed",
      "user": "maflcko",
      "created_at": "2025-01-23T09:06:14Z",
      "updated_at": "2025-02-24T14:18:54Z",
      "comments": 3,
      "url": "https://github.com/bitcoin/bitcoin/issues/31721",
      "labels": [
        "CI failed"
      ],
      "comment_list": [
        {
          "user": "Sjors",
          "body": "Seeing it as well on my fork, especially (only?) in the test-each-commit job: https://github.com/Sjors/bitcoin/actions/runs/12987091010/job/36215271575?pr=50#step:6:49348",
          "created_at": "2025-01-27T12:36:35Z"
        },
        {
          "user": "mzumsande",
          "body": "I think that the following is happening:\n- Orphan is announced to node 1 by a python peer, but it doesn't send the parent tx.\n- submitpackage is executed on node 0, which will sequentially schedule `RelayTransaction`, first for the parent, then for the child.\n- Usually parent and child are put together in one inv, but if the node sends out an inv in between these two `RelayTransaction` calls, the inv for the child may arrive after the tx for the parent was received - since we now only do orphan resolution with announcers after #31397, this means we can't do it right away - we have to wait for the outstanding txrequest with the python peer to time out, ask node0 for the parent again. There is a 60s timeout for this - same as the `sync_mempool` timeout. \n\nThe failure can be reproduced by adding a small sleep in submitpackage after `BroadcastTransaction` (e.g. `1s`) to ensure the parent and child make it into different invs, and also reducing the sync_mempools timeout slightly (e.g. from `60s` to `55s`).  \n\nI'll open a fix.",
          "created_at": "2025-01-28T22:17:30Z"
        },
        {
          "user": "brunoerg",
          "body": "https://github.com/bitcoin/bitcoin/actions/runs/13498602529/job/37711361328?pr=31603#step:6:3286",
          "created_at": "2025-02-24T14:18:53Z"
        }
      ]
    },
    {
      "number": 31720,
      "title": "I have searched the existing issues",
      "body": "",
      "state": "closed",
      "user": "PaddyFlueckiger",
      "created_at": "2025-01-23T08:51:47Z",
      "updated_at": "2025-01-23T08:55:18Z",
      "comments": 0,
      "url": "https://github.com/bitcoin/bitcoin/issues/31720",
      "labels": []
    }
  ],
  "summary": {
    "pull_requests": 8,
    "issues": 3
  }
}