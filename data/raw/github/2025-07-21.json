{
  "source": "github",
  "repository": "bitcoin/bitcoin",
  "fetched_at": "2026-01-15T19:59:56.162426+00:00",
  "date": "2025-07-21",
  "pull_requests": [
    {
      "number": 33034,
      "title": "wallet: Store transactions in a separate sqlite table",
      "body": "The wallet uses SQLite as a key-value store even though SQLite is a powerful relational database engine. This causes us numerous headaches due to the need to serialize multiple fields together, and since record read from the database during loading can come in any order.\r\n\r\nNotably, for transactions, if we were able to load them in the transaction order assigned by the wallet, PRs like #27865 would be a bit simpler and easier to reason about.\r\n\r\nThis PR makes it possible for us to do that by storing transactions in a separate table. This table has a column for each field in `CWalletTx`, which lets us use a SQL statement like `SELECT * FROM transactions ORDER BY pos` which guarantees us the order in which the transactions are loaded into the wallet.\r\n\r\nThe eventual goal is to use SQLite as a relational database with tables that store our keys and other metadata that can reference each other so that the wallet doesn't just use the database as a storage mechanism. But that is still a work in progress.\r\n\r\nThis PR makes use of the last client opened features introduced in #32895 to determine when the old record style needs to be upgraded to the new transactions table. This should give us sufficient upgrade-downgrade-upgrade handling to not lose any funds.\r\n\r\nDepends on #32763, #32895, #32985, #33031, #33032, #33033",
      "state": "open",
      "user": "achow101",
      "created_at": "2025-07-21T22:52:54Z",
      "updated_at": "2026-01-14T15:03:55Z",
      "comments": 5,
      "url": "https://github.com/bitcoin/bitcoin/pull/33034",
      "labels": [
        "Wallet"
      ],
      "comment_list": [
        {
          "user": "DrahtBot",
          "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/33034.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| Concept ACK | [w0xlt](https://github.com/bitcoin/bitcoin/pull/33034#issuecomment-3110194893), [rkrux](https://github.com/bitcoin/bitcoin/pull/33034#issuecomment-3384679811) |\n\nIf your review is incorrectly listed, please copy-paste <code>&lt;!--meta-tag:bot-skip--&gt;</code> into the comment that the bot should ignore.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#33033](https://github.com/bitcoin/bitcoin/pull/33033) (wallet, sqlite: Encapsulate SQLite statements in a RAII class by achow101)\n* [#33032](https://github.com/bitcoin/bitcoin/pull/33032) (wallet, test: Replace MockableDatabase with in-memory SQLiteDatabase by achow101)\n* [#33008](https://github.com/bitcoin/bitcoin/pull/33008) (wallet: support bip388 policy with external signer by Sjors)\n* [#32985](https://github.com/bitcoin/bitcoin/pull/32985) (wallet: Always rewrite tx records during migration by achow101)\n* [#32895](https://github.com/bitcoin/bitcoin/pull/32895) (wallet: Prepare for future upgrades by recording versions of last client to open and decrypt by achow101)\n* [#32685](https://github.com/bitcoin/bitcoin/pull/32685) (wallet: Allow read-only database access for info and dump commands by PeterWrighten)\n* [#32636](https://github.com/bitcoin/bitcoin/pull/32636) (Split `CWallet::Create()` into `CreateNew` and `LoadExisting` by davidgumberg)\n* [#32489](https://github.com/bitcoin/bitcoin/pull/32489) (wallet: Add `exportwatchonlywallet` RPC to export a watchonly version of a wallet by achow101)\n* [#27865](https://github.com/bitcoin/bitcoin/pull/27865) (wallet: Track no-longer-spendable TXOs separately by achow101)\n* [#19461](https://github.com/bitcoin/bitcoin/pull/19461) (multiprocess: Add bitcoin-gui -ipcconnect option by ryanofsky)\n* [#19460](https://github.com/bitcoin/bitcoin/pull/19460) (multiprocess: Add bitcoin-wallet -ipcconnect option by ryanofsky)\n* [#10102](https://github.com/bitcoin/bitcoin/pull/10102) (Multiprocess bitcoin by ryanofsky)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n<!--5faf32d7da4f0f540f40219e4f7537a3-->\n### LLM Linter (‚ú® experimental)\n\n\n\nPossible typos and grammar issues:\n\n- \"a upgrade-downgrade-upgrade\" -> \"an upgrade-downgrade-upgrade\" [Incorrect article before a vowel-starting word \"upgrade\".]\n- \"LastClientFEatures\" -> \"LastClientFeatures\" [Typo / incorrect capitalization in identifier name within comment; should read \"Features\".]\n\n\n\n\nPossible places where named args for integral literals may be used (e.g. `func(x, /*named_arg=*/0)` in C++, and `func(x, named_arg=0)` in Python):\n\n- sqlite3_prepare_v2(&m_db, stmt_text.c_str(), -1, &m_stmt, nullptr) in src/wallet/sqlite.cpp\n- MockableSQLiteDatabase::MockableSQLiteDatabase() : SQLiteDatabase(fs::PathFromString(\"mock/\"), fs::PathFromString(\"mock/wallet.dat\"), DatabaseOptions(), SQLITE_OPEN_MEMORY) in src/wallet/test/util.cpp\n\n\n\n<sup>2026-01-03</sup>\n",
          "created_at": "2025-07-21T22:52:59Z"
        },
        {
          "user": "DrahtBot",
          "body": "<!--85328a0da195eb286784d51f73fa0af9-->\nüöß At least one of the CI tasks failed.\n<sub>Task `lint`: https://github.com/bitcoin/bitcoin/runs/46429203587</sub>\n<sub>LLM reason (‚ú® experimental): The CI failure is caused by Python lint errors due to unresolved 'self' references in test files.</sub>\n\n<details><summary>Hints</summary>\n\nTry to run the tests locally, according to the documentation. However, a CI failure may still\nhappen due to a number of reasons, for example:\n\n* Possibly due to a silent merge conflict (the changes in this pull request being\nincompatible with the current code in the target branch). If so, make sure to rebase on the latest\ncommit of the target branch.\n\n* A sanitizer issue, which can only be found by compiling with the sanitizer and running the\n  affected test.\n\n* An intermittent issue.\n\nLeave a comment here, if you need help tracking down a confusing failure.\n\n</details>\n\n",
          "created_at": "2025-07-22T00:40:33Z"
        },
        {
          "user": "w0xlt",
          "body": "Concept ACK\r\n",
          "created_at": "2025-07-23T21:15:06Z"
        },
        {
          "user": "rkrux",
          "body": "Concept ACK a25557a\r\n\r\nI have gone through the PR description and have skimmed over the commit messages as of now. At the outset, I find myself agreeing with the intent here. I am not aware of a strong enough reason to keep using SQLite as a KVS for all purposes, using its relational database properties for wallet transactions seem like a good start. \r\nI did notice some serialisation specifics of transaction properties in a couple previous PRs that I didn't fully understand why were required; it could be a lot cleaner and explicit in implementation if using SQLite as an RDBMS can avoid the need for doing those specific serialisations.",
          "created_at": "2025-10-09T08:14:48Z"
        },
        {
          "user": "DrahtBot",
          "body": "<!--85328a0da195eb286784d51f73fa0af9-->\nüöß At least one of the CI tasks failed.\n<sub>Task `test max 6 ancestor commits`: https://github.com/bitcoin/bitcoin/actions/runs/20110042688/job/57704599161</sub>\n<sub>LLM reason (‚ú® experimental): CMake build failed with exit code 2 during project compilation (gmake reported an error).</sub>\n\n<details><summary>Hints</summary>\n\nTry to run the tests locally, according to the documentation. However, a CI failure may still\nhappen due to a number of reasons, for example:\n\n* Possibly due to a silent merge conflict (the changes in this pull request being\nincompatible with the current code in the target branch). If so, make sure to rebase on the latest\ncommit of the target branch.\n\n* A sanitizer issue, which can only be found by compiling with the sanitizer and running the\n  affected test.\n\n* An intermittent issue.\n\nLeave a comment here, if you need help tracking down a confusing failure.\n\n</details>\n\n",
          "created_at": "2025-12-10T20:15:56Z"
        }
      ]
    },
    {
      "number": 33033,
      "title": "wallet, sqlite: Encapsulate SQLite statements in a RAII class",
      "body": "SQLite statements are C objects which can be long lived, so having them be initialized in a constructor, and cleanup everything in a destructor, makes the sqlite code cleaner and easier to read. This also lets us have the various functions needed to interact with sqlite statements be member functions.\r\n\r\nThis will be particularly useful in future work which makes use of more complicated SQL statements.",
      "state": "open",
      "user": "achow101",
      "created_at": "2025-07-21T22:43:08Z",
      "updated_at": "2026-01-03T04:31:31Z",
      "comments": 3,
      "url": "https://github.com/bitcoin/bitcoin/pull/33033",
      "labels": [],
      "comment_list": [
        {
          "user": "DrahtBot",
          "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/33033.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| Concept ACK | [rkrux](https://github.com/bitcoin/bitcoin/pull/33033#pullrequestreview-3404260829) |\n| Stale ACK | [w0xlt](https://github.com/bitcoin/bitcoin/pull/33033#pullrequestreview-3049382506), [vasild](https://github.com/bitcoin/bitcoin/pull/33033#pullrequestreview-3487577017) |\n\nIf your review is incorrectly listed, please copy-paste <code>&lt;!--meta-tag:bot-skip--&gt;</code> into the comment that the bot should ignore.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#33034](https://github.com/bitcoin/bitcoin/pull/33034) (wallet: Store transactions in a separate sqlite table by achow101)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n<!--5faf32d7da4f0f540f40219e4f7537a3-->\n### LLM Linter (‚ú® experimental)\n\n\n\nPossible places where named args for integral literals may be used (e.g. `func(x, /*named_arg=*/0)` in C++, and `func(x, named_arg=0)` in Python):\n\n- sqlite3_prepare_v2(&m_db, stmt_text.c_str(), -1, &m_stmt, nullptr) in src/wallet/sqlite.cpp\n\n\n\n<sup>2026-01-03</sup>\n",
          "created_at": "2025-07-21T22:43:12Z"
        },
        {
          "user": "DrahtBot",
          "body": "<!--85328a0da195eb286784d51f73fa0af9-->\nüöß At least one of the CI tasks failed.\n<sub>Task `previous releases, depends DEBUG`: https://github.com/bitcoin/bitcoin/runs/46428794695</sub>\n<sub>LLM reason (‚ú® experimental): The CI failure is caused by a static assertion failure in the sqlite.cpp file during compilation.</sub>\n\n<details><summary>Hints</summary>\n\nTry to run the tests locally, according to the documentation. However, a CI failure may still\nhappen due to a number of reasons, for example:\n\n* Possibly due to a silent merge conflict (the changes in this pull request being\nincompatible with the current code in the target branch). If so, make sure to rebase on the latest\ncommit of the target branch.\n\n* A sanitizer issue, which can only be found by compiling with the sanitizer and running the\n  affected test.\n\n* An intermittent issue.\n\nLeave a comment here, if you need help tracking down a confusing failure.\n\n</details>\n\n",
          "created_at": "2025-07-22T02:33:18Z"
        },
        {
          "user": "DrahtBot",
          "body": "<!--85328a0da195eb286784d51f73fa0af9-->\nüöß At least one of the CI tasks failed.\n<sub>Task `test max 6 ancestor commits`: https://github.com/bitcoin/bitcoin/actions/runs/20667709652/job/59343191929</sub>\n<sub>LLM reason (‚ú® experimental): Compilation failed: use of undeclared identifier 'blob' in wallet/sqlite.cpp causing build error.</sub>\n\n<details><summary>Hints</summary>\n\nTry to run the tests locally, according to the documentation. However, a CI failure may still\nhappen due to a number of reasons, for example:\n\n* Possibly due to a silent merge conflict (the changes in this pull request being\nincompatible with the current code in the target branch). If so, make sure to rebase on the latest\ncommit of the target branch.\n\n* A sanitizer issue, which can only be found by compiling with the sanitizer and running the\n  affected test.\n\n* An intermittent issue.\n\nLeave a comment here, if you need help tracking down a confusing failure.\n\n</details>\n\n",
          "created_at": "2026-01-02T23:36:01Z"
        }
      ]
    },
    {
      "number": 33032,
      "title": "wallet, test: Replace MockableDatabase with in-memory SQLiteDatabase",
      "body": "`MockableDatabase` was introduced for the tests to avoid tying non-database tests to a particular database type. However, since the only database type now is sqlite, and because the mockable behavior is no longer used by the tests, we can replace usage of the `MockabeDatabase` with a SQLite database that lives only in memory.\r\n\r\nThis is particularly useful for future work that has the wallet make use of SQLite's capabilities more, which are less conducive to having a separate mock database implementation.",
      "state": "open",
      "user": "achow101",
      "created_at": "2025-07-21T22:36:32Z",
      "updated_at": "2025-12-23T22:41:27Z",
      "comments": 3,
      "url": "https://github.com/bitcoin/bitcoin/pull/33032",
      "labels": [],
      "comment_list": [
        {
          "user": "DrahtBot",
          "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/33032.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| Concept ACK | [brunoerg](https://github.com/bitcoin/bitcoin/pull/33032#pullrequestreview-3053056674) |\n| Stale ACK | [PeterWrighten](https://github.com/bitcoin/bitcoin/pull/33032#issuecomment-3104700592), [rkrux](https://github.com/bitcoin/bitcoin/pull/33032#pullrequestreview-3054176313) |\n\nIf your review is incorrectly listed, please copy-paste <code>&lt;!--meta-tag:bot-skip--&gt;</code> into the comment that the bot should ignore.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#33034](https://github.com/bitcoin/bitcoin/pull/33034) (wallet: Store transactions in a separate sqlite table by achow101)\n* [#32685](https://github.com/bitcoin/bitcoin/pull/32685) (wallet: Allow read-only database access for info and dump commands by PeterWrighten)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n<!--5faf32d7da4f0f540f40219e4f7537a3-->\n### LLM Linter (‚ú® experimental)\n\n\n\nPossible places where named args for integral literals may be used (e.g. `func(x, /*named_arg=*/0)` in C++, and `func(x, named_arg=0)` in Python):\n\n- sqlite3_open_v2(m_file_path.c_str(), &m_db, flags, nullptr) in src/wallet/sqlite.cpp\n- SQLiteDatabase(fs::PathFromString(\"mock/\"), fs::PathFromString(\"mock/wallet.dat\"), DatabaseOptions(), SQLITE_OPEN_MEMORY) in src/wallet/test/util.cpp\n\n\n\n<sup>2025-12-22</sup>\n",
          "created_at": "2025-07-21T22:36:35Z"
        },
        {
          "user": "PeterWrighten",
          "body": "utACK 78897500676f7ab1b197da56c0a676efcb49ec41",
          "created_at": "2025-07-22T20:16:20Z"
        },
        {
          "user": "DrahtBot",
          "body": "<!--85328a0da195eb286784d51f73fa0af9-->\nüöß At least one of the CI tasks failed.\n<sub>Task `MSan, depends`: https://github.com/bitcoin/bitcoin/runs/46676643655</sub>\n<sub>LLM reason (‚ú® experimental): The CI failure is caused by a compilation error due to the use of the `-Werror` flag, which treats a warning about an unused private field as an error, preventing successful build.</sub>\n\n<details><summary>Hints</summary>\n\nTry to run the tests locally, according to the documentation. However, a CI failure may still\nhappen due to a number of reasons, for example:\n\n* Possibly due to a silent merge conflict (the changes in this pull request being\nincompatible with the current code in the target branch). If so, make sure to rebase on the latest\ncommit of the target branch.\n\n* A sanitizer issue, which can only be found by compiling with the sanitizer and running the\n  affected test.\n\n* An intermittent issue.\n\nLeave a comment here, if you need help tracking down a confusing failure.\n\n</details>\n\n",
          "created_at": "2025-07-24T20:16:44Z"
        }
      ]
    },
    {
      "number": 33031,
      "title": "wallet: Set descriptor cache upgraded flag for migrated wallets",
      "body": "#32597 set the descriptor cache upgraded flag for newly created wallets, but migrated wallets still did not have the flag set when they are migrated. For consistency, and to avoid an unnecessary upgrade, we should be setting this flag for migrated wallets.\r\n\r\nThe flag would end up being set anyways at the end of migration when the wallet is reloaded as it would perform the automatic upgrade at that time. However, this is unnecessary and we should just set it from the get go.\r\n\r\nThis PR also adds a couple tests to verify that the flag is being set, and that the upgrade is being performed.",
      "state": "closed",
      "user": "achow101",
      "created_at": "2025-07-21T22:33:04Z",
      "updated_at": "2025-09-23T19:27:54Z",
      "comments": 5,
      "url": "https://github.com/bitcoin/bitcoin/pull/33031",
      "labels": [
        "Wallet"
      ],
      "comment_list": [
        {
          "user": "DrahtBot",
          "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/33031.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| ACK | [rkrux](https://github.com/bitcoin/bitcoin/pull/33031#pullrequestreview-3078258502), [pablomartin4btc](https://github.com/bitcoin/bitcoin/pull/33031#pullrequestreview-3080735429), [cedwies](https://github.com/bitcoin/bitcoin/pull/33031#issuecomment-3288020105) |\n| Stale ACK | [w0xlt](https://github.com/bitcoin/bitcoin/pull/33031#pullrequestreview-3049159589) |\n\nIf your review is incorrectly listed, please react with üëé to this comment and the bot will ignore it on the next update.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#33230](https://github.com/bitcoin/bitcoin/pull/33230) (cli: Handle arguments that can be either JSON or string by achow101)\n* [#33034](https://github.com/bitcoin/bitcoin/pull/33034) (wallet: Store transactions in a separate sqlite table by achow101)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n<!--5faf32d7da4f0f540f40219e4f7537a3-->",
          "created_at": "2025-07-21T22:33:09Z"
        },
        {
          "user": "DrahtBot",
          "body": "<!--85328a0da195eb286784d51f73fa0af9-->\nüöß At least one of the CI tasks failed.\n<sub>Task `lint`: https://github.com/bitcoin/bitcoin/runs/46428278739</sub>\n<sub>LLM reason (‚ú® experimental): The CI failure is caused by lint errors due to undefined 'self' references in Python test files.</sub>\n\n<details><summary>Hints</summary>\n\nTry to run the tests locally, according to the documentation. However, a CI failure may still\nhappen due to a number of reasons, for example:\n\n* Possibly due to a silent merge conflict (the changes in this pull request being\nincompatible with the current code in the target branch). If so, make sure to rebase on the latest\ncommit of the target branch.\n\n* A sanitizer issue, which can only be found by compiling with the sanitizer and running the\n  affected test.\n\n* An intermittent issue.\n\nLeave a comment here, if you need help tracking down a confusing failure.\n\n</details>\n\n",
          "created_at": "2025-07-21T23:11:09Z"
        },
        {
          "user": "rkrux",
          "body": "I deleted my previous updated suggestion regarding importing `pysqlite3` because it is not considerably better than the current implementation.",
          "created_at": "2025-07-25T13:06:17Z"
        },
        {
          "user": "DrahtBot",
          "body": "<!--85328a0da195eb286784d51f73fa0af9-->\nüöß At least one of the CI tasks failed.\n<sub>Task `lint`: https://github.com/bitcoin/bitcoin/runs/47076642836</sub>\n<sub>LLM reason (‚ú® experimental): The CI failure was caused by an unfixable linting error detected by ruff due to an unnecessary semicolon in the Python code.</sub>\n\n<details><summary>Hints</summary>\n\nTry to run the tests locally, according to the documentation. However, a CI failure may still\nhappen due to a number of reasons, for example:\n\n* Possibly due to a silent merge conflict (the changes in this pull request being\nincompatible with the current code in the target branch). If so, make sure to rebase on the latest\ncommit of the target branch.\n\n* A sanitizer issue, which can only be found by compiling with the sanitizer and running the\n  affected test.\n\n* An intermittent issue.\n\nLeave a comment here, if you need help tracking down a confusing failure.\n\n</details>\n\n",
          "created_at": "2025-07-31T01:14:11Z"
        },
        {
          "user": "cedwies",
          "body": "re-ACK 88b0647",
          "created_at": "2025-09-13T10:13:57Z"
        }
      ]
    },
    {
      "number": 33030,
      "title": "test: check tx is final when there is no locktime",
      "body": "According to https://corecheck.dev/mutation/src/consensus/tx_verify.cpp, there is no proper test for the `tx.nLockTime == 0` check in the `IsFinalTx` function, which is understandable, since this check will only be useful for a specific case where the `nBlockHeight` (block height) is zero. Otherwise, the following check `if ((int64_t)tx.nLockTime < ((int64_t)tx.nLockTime < LOCKTIME_THRESHOLD ? (int64_t)nBlockHeight : nBlockTime))` would catch any of it. This PR adds a test case for it.",
      "state": "closed",
      "user": "brunoerg",
      "created_at": "2025-07-21T18:41:46Z",
      "updated_at": "2025-07-22T18:08:51Z",
      "comments": 5,
      "url": "https://github.com/bitcoin/bitcoin/pull/33030",
      "labels": [
        "Tests"
      ],
      "comment_list": [
        {
          "user": "DrahtBot",
          "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/33030.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| ACK | [maflcko](https://github.com/bitcoin/bitcoin/pull/33030#issuecomment-3102678470), [darosior](https://github.com/bitcoin/bitcoin/pull/33030#pullrequestreview-3042985591), [enirox001](https://github.com/bitcoin/bitcoin/pull/33030#issuecomment-3103441542), [achow101](https://github.com/bitcoin/bitcoin/pull/33030#issuecomment-3104091020) |\n\nIf your review is incorrectly listed, please react with üëé to this comment and the bot will ignore it on the next update.\n<!--5faf32d7da4f0f540f40219e4f7537a3-->",
          "created_at": "2025-07-21T18:41:51Z"
        },
        {
          "user": "brunoerg",
          "body": "> Makes sense. utACK [7180b82](https://github.com/bitcoin/bitcoin/commit/7180b82420c0f303140a93ca635f5ac806bea77d). Could add a comment explaining this to the test as it may not be immediately obvious to a reader.\r\n\r\nThank you, I just added a comment for this.",
          "created_at": "2025-07-22T13:04:10Z"
        },
        {
          "user": "maflcko",
          "body": "lgtm ACK 065e42976a70738770af256da810ddc1316a4496",
          "created_at": "2025-07-22T13:17:28Z"
        },
        {
          "user": "enirox001",
          "body": "lgtm\r\n\r\nACK 065e429: Valuable test case that explicitly demonstrates `IsFinalTx` behavior when nLockTime is 0",
          "created_at": "2025-07-22T15:36:40Z"
        },
        {
          "user": "achow101",
          "body": "ACK 065e42976a70738770af256da810ddc1316a4496",
          "created_at": "2025-07-22T17:49:58Z"
        }
      ]
    },
    {
      "number": 33029,
      "title": "net: make m_mempool optional in PeerManager",
      "body": "This PR is a continuation of ‚Üíhttps://github.com/bitcoin/bitcoin/pull/22850, to make m_mempool an optional pointer in PeerManager instead of a reference.\r\n\r\n some benefits, as mentioned here:https://github.com/bitcoin/bitcoin/pull/26247#issue-1396302764 are:\r\n\r\n1. m_mempool is already a pointer in other parts like:\r\nIn Chainstate:[ https://github.com/bitcoin/bitcoin/blob/master/src/validation.h#L532](https://github.com/bitcoin/bitcoin/blob/master/src/validation.h#L532)\r\nIn BlockAssembler:[ https://github.com/bitcoin/bitcoin/blob/master/src/node/miner.h#L168](https://github.com/bitcoin/bitcoin/blob/master/src/node/miner.h#L168)\r\nSo adding this to PeerManager improves consistency.\r\n2. Having m_mempool as a pointer also makes it easier to test scenarios where the mempool is not required.\r\n3. I'm not sure if `-nomempool` is still being considered, but if it is, then this pointer approach would be a necessary prerequisite.\r\n\r\nThere was a suggestion here ->  https://github.com/bitcoin/bitcoin/pull/26247#issuecomment-1271599738 to refactor/introduce helper functions like `RejectIncomingTxs` that would return `m_mempoo`l, but I‚Äôm not entirely sure about this approach.this wouldn't be ideal since in some call sites like` PushNodeVersion` and `NetMsgType::SENDTXRCNCL`, mempool isn‚Äôt needed at all.\r\n\r\nI'd like to continue working on this, and I'm looking for feedback on whether this is still relevant and which approach to go with. Should I follow the suggestion to add helper functions that return the m_mempool pointer, or should I stick with checking if m_mempool is null, or perhaps consider a different approach altogether?\r\n",
      "state": "open",
      "user": "naiyoma",
      "created_at": "2025-07-21T16:08:15Z",
      "updated_at": "2025-12-21T00:30:38Z",
      "comments": 5,
      "url": "https://github.com/bitcoin/bitcoin/pull/33029",
      "labels": [
        "P2P",
        "Needs rebase"
      ],
      "comment_list": [
        {
          "user": "DrahtBot",
          "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/33029.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\nA summary of reviews will appear here.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#33448](https://github.com/bitcoin/bitcoin/pull/33448) (net/rpc: Report inv information for debugging by ajtowns)\n* [#30277](https://github.com/bitcoin/bitcoin/pull/30277) ([DO NOT MERGE] Erlay: bandwidth-efficient transaction relay protocol (Full implementation) by sr-gi)\n* [#30116](https://github.com/bitcoin/bitcoin/pull/30116) (p2p: Fill reconciliation sets (Erlay) attempt 2 by sr-gi)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n<!--5faf32d7da4f0f540f40219e4f7537a3-->",
          "created_at": "2025-07-21T16:08:20Z"
        },
        {
          "user": "DrahtBot",
          "body": "<!--85328a0da195eb286784d51f73fa0af9-->\nüöß At least one of the CI tasks failed.\n<sub>Task `ARM, unit tests, no functional tests`: https://github.com/bitcoin/bitcoin/runs/46403303885</sub>\n<sub>LLM reason (‚ú® experimental): The CI failure is caused by a type mismatch error in p2p_handshake.cpp: cannot convert ‚ÄòCTxMemPool‚Äô to ‚ÄòCTxMemPool*‚Äô.</sub>\n\n<details><summary>Hints</summary>\n\nTry to run the tests locally, according to the documentation. However, a CI failure may still\nhappen due to a number of reasons, for example:\n\n* Possibly due to a silent merge conflict (the changes in this pull request being\nincompatible with the current code in the target branch). If so, make sure to rebase on the latest\ncommit of the target branch.\n\n* A sanitizer issue, which can only be found by compiling with the sanitizer and running the\n  affected test.\n\n* An intermittent issue.\n\nLeave a comment here, if you need help tracking down a confusing failure.\n\n</details>\n\n",
          "created_at": "2025-07-21T16:30:21Z"
        },
        {
          "user": "DrahtBot",
          "body": "<!--85328a0da195eb286784d51f73fa0af9-->\nüöß At least one of the CI tasks failed.\n<sub>Task `previous releases, depends DEBUG`: https://github.com/bitcoin/bitcoin/runs/46675117145</sub>\n<sub>LLM reason (‚ú® experimental): The CI failure is caused by a compilation error due to an incorrect argument type being passed to a function, specifically converting a CTxMemPool object to a pointer where a pointer is expected.</sub>\n\n<details><summary>Hints</summary>\n\nTry to run the tests locally, according to the documentation. However, a CI failure may still\nhappen due to a number of reasons, for example:\n\n* Possibly due to a silent merge conflict (the changes in this pull request being\nincompatible with the current code in the target branch). If so, make sure to rebase on the latest\ncommit of the target branch.\n\n* A sanitizer issue, which can only be found by compiling with the sanitizer and running the\n  affected test.\n\n* An intermittent issue.\n\nLeave a comment here, if you need help tracking down a confusing failure.\n\n</details>\n\n",
          "created_at": "2025-07-25T15:23:56Z"
        },
        {
          "user": "DrahtBot",
          "body": "<!--cf906140f33d8803c4a75a2196329ecb-->\nüêô This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n",
          "created_at": "2025-09-23T16:12:07Z"
        },
        {
          "user": "DrahtBot",
          "body": "<!--13523179cfe9479db18ec6c5d236f789-->\n‚åõ There hasn't been much activity lately and the patch still needs rebase. What is the status here?\n\n* Is it still relevant? ‚û°Ô∏è Please solve the conflicts to make it ready for review and to ensure the CI passes.\n* Is it no longer relevant? ‚û°Ô∏è Please close.\n* Did the author lose interest or time to work on this? ‚û°Ô∏è Please close it and mark it with one of the labels 'Up for grabs' or 'Insufficient Review', so that it can be picked up in the future.\n",
          "created_at": "2025-12-21T00:30:38Z"
        }
      ]
    },
    {
      "number": 33028,
      "title": "NOMERGE DEBUG WIP ignore",
      "body": "",
      "state": "closed",
      "user": "maflcko",
      "created_at": "2025-07-21T10:39:49Z",
      "updated_at": "2025-07-24T20:46:53Z",
      "comments": 2,
      "url": "https://github.com/bitcoin/bitcoin/pull/33028",
      "labels": [
        "CI failed"
      ],
      "comment_list": [
        {
          "user": "DrahtBot",
          "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/33028.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\nA summary of reviews will appear here.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nNo conflicts as of last run.\n<!--5faf32d7da4f0f540f40219e4f7537a3-->",
          "created_at": "2025-07-21T10:39:53Z"
        },
        {
          "user": "maflcko",
          "body": "this is just too difficult to reproduce",
          "created_at": "2025-07-24T20:26:06Z"
        }
      ]
    }
  ],
  "issues": [
    {
      "number": 33027,
      "title": "IP leak using bitcoin core",
      "body": "### Is there an existing issue for this?\n\n- [x] I have searched the existing issues\n\n### Current behaviour\n\nIs there any IP leak when I use bitcoin core ?\n1. Sync wallet \n2. Sending btc\n\n### Expected behaviour\n\nIP leak\n\n### Steps to reproduce\n\ncheck IP\n\n### Relevant log output\n\n_No response_\n\n### How did you obtain Bitcoin Core\n\nCompiled from source\n\n### What version of Bitcoin Core are you using?\n\n29\n\n### Operating system and version\n\nWin 11 x64\n\n### Machine specifications\n\n_No response_",
      "state": "closed",
      "user": "Username7823553",
      "created_at": "2025-07-21T07:04:01Z",
      "updated_at": "2025-07-21T07:14:26Z",
      "comments": 1,
      "url": "https://github.com/bitcoin/bitcoin/issues/33027",
      "labels": [
        "Wallet",
        "P2P",
        "Questions and Help"
      ],
      "comment_list": [
        {
          "user": "maflcko",
          "body": "Not sure what your question is, but Bitcoin Core connects to other P2P nodes. If you want to connect to them over tor, please refer to the existing docs, such as https://github.com/bitcoin/bitcoin/blob/master/doc/tor.md, or the config help.\n\n\nUsually the issue tracker is used to track technical issues related to the Bitcoin Core code base.\n\nGeneral bitcoin questions and/or support requests are best directed to the [Bitcoin StackExchange](https://bitcoin.stackexchange.com) or the `#bitcoin` IRC channel on Libera Chat, or one of the Bitcoin subreddits, or any other place that you feel is well suited.\n",
          "created_at": "2025-07-21T07:13:58Z"
        }
      ]
    }
  ],
  "summary": {
    "pull_requests": 7,
    "issues": 1
  }
}