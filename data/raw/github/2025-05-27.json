{
  "source": "github",
  "repository": "bitcoin/bitcoin",
  "fetched_at": "2026-01-15T19:46:02.050509+00:00",
  "date": "2025-05-27",
  "pull_requests": [
    {
      "number": 32624,
      "title": "fuzz: wallet: add target for `MigrateToDescriptor`",
      "body": "This PR adds fuzz coverage for the scriptpubkeyman migration (`MigrateToDescriptor`). Note that it's a test for the migration of the scriptpubkey manager, not for the whole migration process as tried in #29694, because:\r\n1) The wallet migration deals with DBs which is expensive for fuzzing (was getting around 3 exec/s);\r\n2) Mocking would require lots of refactors.\r\n\r\nThis target loads keys, HDChain (even inactive ones), watch only and might add tons of different scripts, then calls `MigrateToDescriptor`. It does not play with encrypted stuff because it would make the target super slow. Also, after the migration there are some assertions that would work as a regression test for https://github.com/bitcoin/bitcoin/pull/31452, for example.",
      "state": "open",
      "user": "brunoerg",
      "created_at": "2025-05-27T11:34:05Z",
      "updated_at": "2026-01-12T05:59:33Z",
      "comments": 8,
      "url": "https://github.com/bitcoin/bitcoin/pull/32624",
      "labels": [
        "Tests",
        "Fuzzing"
      ],
      "comment_list": [
        {
          "user": "DrahtBot",
          "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/32624.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| ACK | [marcofleon](https://github.com/bitcoin/bitcoin/pull/32624#issuecomment-3542072403) |\n| Approach ACK | [w0xlt](https://github.com/bitcoin/bitcoin/pull/32624#pullrequestreview-2872882290) |\n| Stale ACK | [maflcko](https://github.com/bitcoin/bitcoin/pull/32624#issuecomment-2981783017) |\n\nIf your review is incorrectly listed, please copy-paste <code>&lt;!--meta-tag:bot-skip--&gt;</code> into the comment that the bot should ignore.\n<!--5faf32d7da4f0f540f40219e4f7537a3-->",
          "created_at": "2025-05-27T11:34:08Z"
        },
        {
          "user": "brunoerg",
          "body": "08b574dde2c5f13a4c9dadcb9d8bded158c59623..5f2fb4dd333f8d1db27c78414afc84454e6ee4a5: Address https://github.com/bitcoin/bitcoin/pull/32624#discussion_r2109086986",
          "created_at": "2025-05-27T12:56:50Z"
        },
        {
          "user": "maflcko",
          "body": "lgtm ACK 6d29c9a6d1b4239a0844791d4a53599ae3a79cd0",
          "created_at": "2025-06-17T20:44:59Z"
        },
        {
          "user": "brunoerg",
          "body": "Force-pushed addressing https://github.com/bitcoin/bitcoin/pull/32624#discussion_r2466310562. Thanks, @marcofleon.",
          "created_at": "2025-10-27T17:16:58Z"
        },
        {
          "user": "brunoerg",
          "body": "There was one more case that I forgot to count in. We should consider the split chain support when verifying the result (`desc_spkms`). Force-pushed fixing it ([6ced804](https://github.com/bitcoin/bitcoin/commit/6ced804488d9eca4b3da8daa4e8c9145109b3384) to [6436ad7](https://github.com/bitcoin/bitcoin/commit/6436ad7f2f93774cb719c89965800b51f546420c)). ",
          "created_at": "2025-10-27T18:06:11Z"
        },
        {
          "user": "brunoerg",
          "body": "Force-pushed [6436ad7](https://github.com/bitcoin/bitcoin/commit/6436ad7f2f93774cb719c89965800b51f546420c) to [6227441](https://github.com/bitcoin/bitcoin/commit/6227441b782b50403571d3d97e8aa174c95fc511):\r\n\r\n- Added `PKHash` for `LoadWatchOnly`\r\n- Addressed https://github.com/bitcoin/bitcoin/pull/32624#discussion_r2521415641\r\n- Addressed https://github.com/bitcoin/bitcoin/pull/32624#discussion_r2521400460",
          "created_at": "2025-11-13T19:46:21Z"
        },
        {
          "user": "marcofleon",
          "body": "Nice, lgtm ACK 51917d94e657024cc0af8aa748a9d5d39a617e85",
          "created_at": "2025-11-17T14:17:46Z"
        },
        {
          "user": "brunoerg",
          "body": "@maflcko friendly review ping :)",
          "created_at": "2025-11-20T19:16:39Z"
        }
      ]
    },
    {
      "number": 32623,
      "title": "test: Add missing ipc subtree to lint",
      "body": "The subtree docs and lint checks list the subtrees in three places, making it hard to follow and update and easy to miss one.\r\n\r\nFix all issues by including the missing one and removing the list in one place.",
      "state": "closed",
      "user": "maflcko",
      "created_at": "2025-05-27T08:12:39Z",
      "updated_at": "2025-05-28T07:04:00Z",
      "comments": 5,
      "url": "https://github.com/bitcoin/bitcoin/pull/32623",
      "labels": [
        "Tests"
      ],
      "comment_list": [
        {
          "user": "DrahtBot",
          "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/32623.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| ACK | [hebasto](https://github.com/bitcoin/bitcoin/pull/32623#pullrequestreview-2871843422), [l0rinc](https://github.com/bitcoin/bitcoin/pull/32623#issuecomment-2913287986), [BrandonOdiwuor](https://github.com/bitcoin/bitcoin/pull/32623#pullrequestreview-2872073697), [davidgumberg](https://github.com/bitcoin/bitcoin/pull/32623#issuecomment-2913526219), [achow101](https://github.com/bitcoin/bitcoin/pull/32623#issuecomment-2913796673) |\n| Stale ACK | [TheCharlatan](https://github.com/bitcoin/bitcoin/pull/32623#pullrequestreview-2870565681) |\n\nIf your review is incorrectly listed, please react with ðŸ‘Ž to this comment and the bot will ignore it on the next update.\n<!--5faf32d7da4f0f540f40219e4f7537a3-->",
          "created_at": "2025-05-27T08:12:42Z"
        },
        {
          "user": "l0rinc",
          "body": "ACK fa2bf6bdb7e5f8940fe4bce1aaab29bf2e063b49",
          "created_at": "2025-05-27T12:29:34Z"
        },
        {
          "user": "l0rinc",
          "body": "ACK fa4b8b16c37830bf7ee1419aae94e99f294f0e9f",
          "created_at": "2025-05-27T16:52:36Z"
        },
        {
          "user": "davidgumberg",
          "body": "ACK https://github.com/bitcoin/bitcoin/pull/32623/commits/fa4b8b16c37830bf7ee1419aae94e99f294f0e9f",
          "created_at": "2025-05-27T18:25:42Z"
        },
        {
          "user": "achow101",
          "body": "ACK fa4b8b16c37830bf7ee1419aae94e99f294f0e9f",
          "created_at": "2025-05-27T19:42:32Z"
        }
      ]
    },
    {
      "number": 32621,
      "title": "contrib: utxo_to_sqlite.py: add option to store txid/spk as BLOBs",
      "body": "This PR is a late follow-up to https://github.com/bitcoin/bitcoin/pull/27432, introducing an option for the utxo-to-sqlite script to store the txid/scriptPubKey columns as bytes (= `BLOB` storage class in sqlite, see e.g. https://www.sqlite.org/datatype3.html in sqlite) rather than hex strings. This was proposed in earlier reviews (https://github.com/bitcoin/bitcoin/pull/27432#issuecomment-1516857024, https://github.com/bitcoin/bitcoin/pull/27432#issuecomment-1653739351) and has the obvious advantage of a significantly smaller size of the resulting database (and with that, faster conversion) and the avoidance of hex-to-bytes conversion for further processing of the data [1]. The rationale on why hex strings were chosen back then (and still stays the default, if only for compatibility reasons) is laid out in https://github.com/bitcoin/bitcoin/pull/27432#issuecomment-1516922824 [2].\r\n\r\nThe approach taken is introducing new parameters `--spk` and `--txid` which can either have the values \"hex\", \"raw\" (for scriptpubkey) and \"hex\", \"raw\", \"rawle\" (for txid). Thanks to ajtowns for providing this suggestion. Happy to take further inputs on naming and thoughts on future extensibility etc.\r\n\r\n[1] For a concrete example, I found that having these columns as bytes would be nice while working on a SwiftSync hints generator tool (https://github.com/theStack/swiftsync-hints-gen), which takes the result of the utxo-to-sqlite tool as input.\r\n[2] note that in contrast what I wrote back then, I think there is no ambiguity on byte-string-serialization of txids; they are ultimately just hash results and hence, they should be stored as such, and adding a big/little endian knob wouldn't make much sense. The drawback of not being able to immediately show txid-strings (as one would need to do the bytes-reversal step first, which is not possible in sqlite, see e.g. https://github.com/bitcoin/bitcoin/pull/24952#issuecomment-1165499803) still remains though.",
      "state": "open",
      "user": "theStack",
      "created_at": "2025-05-27T03:03:35Z",
      "updated_at": "2025-10-30T16:04:44Z",
      "comments": 7,
      "url": "https://github.com/bitcoin/bitcoin/pull/32621",
      "labels": [
        "Scripts and tools"
      ],
      "comment_list": [
        {
          "user": "DrahtBot",
          "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/32621.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| ACK | [w0xlt](https://github.com/bitcoin/bitcoin/pull/32621#pullrequestreview-2876776591) |\n| Approach ACK | [ajtowns](https://github.com/bitcoin/bitcoin/pull/32621#issuecomment-3468708041) |\n\nIf your review is incorrectly listed, please react with ðŸ‘Ž to this comment and the bot will ignore it on the next update.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#32116](https://github.com/bitcoin/bitcoin/pull/32116) (contrib: refactor: dedup deserialization routines in utxo-to-sqlite script by theStack)\n* [#31560](https://github.com/bitcoin/bitcoin/pull/31560) (rpc: allow writing UTXO set to a named pipe, introduce dump_to_sqlite.sh script by theStack)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n<!--5faf32d7da4f0f540f40219e4f7537a3-->\n### LLM Linter (âœ¨ experimental)\n\nPossible typos and grammar issues:\n\n- if --spk=raw, then scriptpubkey will be BLOB instead. -> If --spk=raw, then scriptpubkey will be BLOB instead. [sentence start should be capitalized]\n\nNo other typos were found.\n\n<sup>drahtbot_id_4_m</sup>\n",
          "created_at": "2025-05-27T03:03:37Z"
        },
        {
          "user": "ajtowns",
          "body": "> The approach taken is introducing a `-m`/`--mode` parameter which can either have the values \"hex\" (default) or \"bytes\". Happy to take suggestions on naming and thoughts on future extensibility etc.\r\n\r\nI wonder if separate options would be better, eg `--spk=raw --txid=raw`?\r\n \r\n> I think there is no ambiguity on byte-string-serialization of txids; they are ultimately just hash results and hence, they should be stored as such, and adding a big/little endian knob wouldn't make much sense.\r\n\r\nI think it will be surprising if `hex(txid)` gives \"reversed\" values so that just copy and pasting into block explorers doesn't work. If you did separate flags, you could consider `--txid=hex`, `--txid=raw` (same byte order as hex), and `--txid=rawhash` (same byte order as sha256 output) as separate options, maybe?\r\n\r\nHere's a patch: https://github.com/ajtowns/bitcoin/commit/d1fc5dff9afc2c05aa975fa7b29c029865d77507\r\n\r\nCould consider allowing `--spk=none --txid=none` to drop both fields for further space saving if you're just analysing the utxo set, not doing things with it (or `--txid=counter` to replace the actual txid with a counter that saves space but still lets you notice when utxos are from the same tx).\r\n\r\n> The drawback of not being able to immediately show txid-strings (as one would need to do the bytes-reversal step first, which is not possible in sqlite, see e.g. [#24952 (comment)](https://github.com/bitcoin/bitcoin/pull/24952#issuecomment-1165499803)) still remains though.\r\n\r\nSeems like you can get [addons](https://github.com/nalgeon/sqlean/blob/0.27.2/docs/text.md#text_reverse) for this, for whatever that's worth.",
          "created_at": "2025-05-27T04:40:40Z"
        },
        {
          "user": "theStack",
          "body": "@ajtowns: Thanks for your suggestions, I like the idea of having more flexibility and mostly agree with the naming. Took your patch (TIL about [argparse `choices`](https://docs.python.org/3/library/argparse.html#choices)) and adapted the functional test accordingly, to exercise all combinations of new options. As for txid format option naming, I think I'd intuitively prefer `raw` for storing them in the hash order, since that's AFAICT the most common txid byte-string serialization (I think I haven't encountered any counter-examples so far in the Bitcoin ecosystem) -- but then one would need to pick a good name for the \"reverse-hash\" byte-string serialization again. So maybe it's just fine :man_shrugging:  Personally, with the current naming, I'd only either wanted to use the combinations `--txid=hex --spk=hex` (i.e. the default, the only possible on master), or `--txid=rawhash --spk=raw`.\r\n\r\n> Could consider allowing --spk=none --txid=none to drop both fields for further space saving if you're just analysing the utxo set, not doing things with it (or --txid=counter to replace the actual txid with a counter that saves space but still lets you notice when utxos are from the same tx).\r\n\r\nPretty neat ideas, and potentially useful for e.g. dust (and other \"spam\") or output script type analysis. Will consider for further follow-ups.",
          "created_at": "2025-05-27T14:00:31Z"
        },
        {
          "user": "DrahtBot",
          "body": "<!--85328a0da195eb286784d51f73fa0af9-->\nðŸš§ At least one of the CI tasks failed.\n<sub>Task `lint`: https://github.com/bitcoin/bitcoin/runs/42967430443</sub>\n<sub>LLM reason (âœ¨ experimental): The CI failure is caused by a linting error due to a Python f-string missing placeholders.</sub>\n\n<details><summary>Hints</summary>\n\nTry to run the tests locally, according to the documentation. However, a CI failure may still\nhappen due to a number of reasons, for example:\n\n* Possibly due to a silent merge conflict (the changes in this pull request being\nincompatible with the current code in the target branch). If so, make sure to rebase on the latest\ncommit of the target branch.\n\n* A sanitizer issue, which can only be found by compiling with the sanitizer and running the\n  affected test.\n\n* An intermittent issue.\n\nLeave a comment here, if you need help tracking down a confusing failure.\n\n</details>\n\n",
          "created_at": "2025-05-27T14:06:55Z"
        },
        {
          "user": "ajtowns",
          "body": "> I think I'd intuitively prefer `raw` for storing them in the hash order, since that's AFAICT the most common txid byte-string serialization\r\n\r\nMaybe `raw` and `rawle` then? For future consideration `--spk=type` so that it only records whether the spk was p2pk, p2pkh, p2sh, p2wpkh, p2wsh, p2tr, p2a, or other would probably be interesting.",
          "created_at": "2025-05-27T23:15:48Z"
        },
        {
          "user": "theStack",
          "body": "> > I think I'd intuitively prefer `raw` for storing them in the hash order, since that's AFAICT the most common txid byte-string serialization\r\n> \r\n> Maybe `raw` and `rawle` then?\r\n\r\n`raw`/`rawle` are a decent alternative that I'd slightly prefer over `rawhash`/`raw`, yes! Force-pushed accordingly. I'm  fine with both though, so if other reviewers / potential users of that script feel strongly on `rawhash`/`raw`, I'm happy to revert.\r\n\r\n> For future consideration `--spk=type` so that it only records whether the spk was p2pk, p2pkh, p2sh, p2wpkh, p2wsh, p2tr, p2a, or other would probably be interesting.\r\n\r\nConcept ACK. I think there is room for some bike-shedding on details, like e.g. do we split up p2pk into uncompressed and compressed (or, god forbid, even hybrid?) or whether bare multisig should also be a category (if at all, then probably only with a very weak detection like \"first byte is in range OP_1...OP_16, last byte is OP_CHECKMULTISIG\", as implementing the [full detection as used in Solver](https://github.com/bitcoin/bitcoin/blob/88b22acc3d6faeb2c0860695783a2a082d4c8098/src/script/solver.cpp#L85-L105) seems overblown for a conversion script). But, something to discuss in another PR anyways.",
          "created_at": "2025-05-28T17:14:35Z"
        },
        {
          "user": "ajtowns",
          "body": "Conflicts with #32116 ; let's get that merged first?\r\n\r\nApproach ACK",
          "created_at": "2025-10-30T15:50:35Z"
        }
      ]
    }
  ],
  "issues": [
    {
      "number": 32625,
      "title": "Assertion failed: TxStateSerializedIndex(wtx.m_state) == TxStateSerializedIndex(state) (wallet/wallet.cpp: AddToWallet: 1094)",
      "body": "### Current behaviour\n\nBitcoin Core v27.0.0 crashes with an assertion failure in `wallet.cpp` at line 1094, related to `TxStateSerializedIndex(wtx.m_state) == TxStateSerializedIndex(state)`.\n\n### Configuration:\n\n  * `consolidatefeerate=0.00000000`\n  * `dbcache=450`\n  * `fallbackfee=0.00005`\n  * `limitancestorcount=1000`\n  * `maxmempool=100`\n  * `prune=10000`\n\n\n### Steps to reproduce\n\nI don't know. Maybe mine testnet coins for a couple of weeks using same wallet as used on another machine with a testnet faucet.\n\n### Docker log output\n\n```\n2025-05-27T11:46:16Z UpdateTip: new best=00000000001c57612f512babf82041a0d9c2d6e4b1a0c74d04b808c2d3fa7192 height=4393235 version=0x2709c000 log2_work=76.497972 tx=489057004 date='2025-05-22T21:08:49Z' progress=0.998809 cache=0.3MiB(375txo)\n2025-05-27T11:46:16Z UpdateTip: new best=000000000024d736011f8a195fd63f1a09c4cf928da2b838bd7237db5c044b5f height=4393236 version=0x239e2000 log2_work=76.497972 tx=489057042 date='2025-05-22T21:08:49Z' progress=0.998809 cache=0.3MiB(424txo)\n2025-05-27T11:46:16Z Assertion failed: TxStateSerializedIndex(wtx.m_state) == TxStateSerializedIndex(state) (wallet/wallet.cpp: AddToWallet: 1094)\nbitcoind-1 exited with code 0\n```\n\n### Last lines of debug.log (after another crash)\n```\n2025-05-27T12:02:34Z Saw new header hash=0000000000001826ceb2433889e822a2b7dc5efc15f2b61bdc1b0a1698a3589f height=4397230\n2025-05-27T12:02:34Z Saw new header hash=0000000000002ae0914a56975041b0a000befa58b6eabe016a5a084e1e9d4955 height=4397231\n2025-05-27T12:02:34Z Saw new header hash=0000000000000ddf423f571fb7ba312a779693556b7fcd3eff09448bb8f9352e height=4397232\n2025-05-27T12:02:34Z UpdateTip: new best=000000000017a49e8d34c7f73e6c3964c3aa1b128797f2577c0a040e95c51357 height=4393233 version=0x25960000 log2_work=76.497972 tx=489056854 date='2025-05-22T21:08:49Z' progress=0.998806 cache=0.3MiB(129txo)\n2025-05-27T12:02:34Z UpdateTip: new best=00000000001fa64baf3293e92ee629e2c47f2e3dc1784ae957791515bdd3eaca height=4393232 version=0x21cdc000 log2_work=76.497972 tx=489056822 date='2025-05-22T21:08:48Z' progress=0.998806 cache=0.3MiB(189txo)\n2025-05-27T12:02:34Z UpdateTip: new best=00000000002f4716f9b3801f256f51203f628162b5d7de73e739c4f22a577915 height=4393233 version=0x21786000 log2_work=76.497972 tx=489056890 date='2025-05-22T21:08:49Z' progress=0.998806 cache=0.3MiB(227txo)\n2025-05-27T12:02:34Z UpdateTip: new best=0000000000184e787cca19e8248e0ca0bb51b751aa3196060026388d8730eee0 height=4393234 version=0x25250000 log2_work=76.497972 tx=489056966 date='2025-05-22T21:08:49Z' progress=0.998806 cache=0.3MiB(329txo)\n2025-05-27T12:02:34Z [/data/.bitcoin/testnet3/] AddToWallet 7b0cda1920c9f430ae1997f64be847211c1a86f0cee8293682c14e1b8fff9f87  update Inactive (abandoned=0)\n2025-05-27T12:02:34Z [/data/.bitcoin/testnet3/] AddToWallet f06a93da2e6c03fbce5779a815117f6536d09b12db0e840408bcc83ef9251670  update Inactive (abandoned=0)\n2025-05-27T12:02:34Z [/data/.bitcoin/testnet3/] AddToWallet ecf4165cf73b287176f486edb769a419e26c502b66ea8510ad280562c842716c  update Inactive (abandoned=0)\n```\n\n### How did you obtain Bitcoin Core\n\nFrom Docker hub: https://hub.docker.com/r/lncm/bitcoind\n\n### What version of Bitcoin Core are you using?\n\nTried both v27.0.0 and v27.2.0\n",
      "state": "closed",
      "user": "azazar",
      "created_at": "2025-05-27T11:59:25Z",
      "updated_at": "2025-07-03T07:41:41Z",
      "comments": 4,
      "url": "https://github.com/bitcoin/bitcoin/issues/32625",
      "labels": [
        "Wallet"
      ],
      "comment_list": [
        {
          "user": "furszy",
          "body": "This was fixed in v29, specifically in #31757. Please try using the latest version.",
          "created_at": "2025-05-27T23:05:42Z"
        },
        {
          "user": "fanquake",
          "body": "> This was fixed in v29, specifically in https://github.com/bitcoin/bitcoin/pull/31757.\n\nIs that the right PR? Those changes are not in the 29.x branch (I can add them to #32589 if we want to backport).",
          "created_at": "2025-05-29T16:05:43Z"
        },
        {
          "user": "furszy",
          "body": "> Is that the right PR? Those changes are not in the 29.x branch (I can add them to [#32589](https://github.com/bitcoin/bitcoin/pull/32589) if we want to backport).\n\nHmm yes, I thought we had included it on 29.x in conjunction with [gui#864](https://github.com/bitcoin-core/gui/pull/864).. (these two issues combined cause the app to no longer open).",
          "created_at": "2025-05-29T17:46:43Z"
        },
        {
          "user": "furszy",
          "body": "can be closed.",
          "created_at": "2025-07-02T20:14:06Z"
        }
      ]
    },
    {
      "number": 32622,
      "title": ".",
      "body": ".",
      "state": "closed",
      "user": "ou-tai",
      "created_at": "2025-05-27T06:08:59Z",
      "updated_at": "2025-05-27T06:13:13Z",
      "comments": 0,
      "url": "https://github.com/bitcoin/bitcoin/issues/32622",
      "labels": []
    }
  ],
  "summary": {
    "pull_requests": 3,
    "issues": 2
  }
}