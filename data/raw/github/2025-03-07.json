{
  "source": "github",
  "repository": "bitcoin/bitcoin",
  "fetched_at": "2026-01-15T19:22:53.097770+00:00",
  "date": "2025-03-07",
  "pull_requests": [
    {
      "number": 32019,
      "title": "cmake: Check for `makensis` and `zip` tools before using them for optional `deploy` targets",
      "body": "For `x86_64-w64-mingw32` and `*-apple-darwin` targets, the optional `deploy` target requires dedicated tools: `makensis` and `zip`, respectively.\r\n\r\nThis PR introduces a uniform checks for those tools when attempting to build the `deploy` target, ensuring they are not required for configuring and building any other targets.\r\n\r\nHere is an example of workflow for `x86_64-w64-mingw32`:\r\n```\r\n$ # `nsis` is not installed\r\n$ cmake -B build -G \"GNU Makefiles\" --toolchain depends/x86_64-w64-mingw32/toolchain.cmake\r\n$ cmake --build build -j $(nproc)\r\n$ cmake --build build -t deploy\r\n\r\nError: NSIS not found.\r\nPlease install NSIS and/or ensure that its executable is accessible to the find_program() command‚Äî\r\nfor example, by setting the MAKENSIS_EXECUTABLE variable or another relevant CMake variable.\r\nThen re-run cmake to regenerate the build system.\r\n\r\nBuilt target deploy\r\n$ sudo apt install nsis\r\n$ cmake -B build\r\n$ cmake --build build -t deploy\r\n...\r\n[100%] Generating bitcoin-win64-setup.exe\r\n[100%] Built target deploy\r\n```\r\n\r\nFixes https://github.com/bitcoin/bitcoin/issues/32018.",
      "state": "closed",
      "user": "hebasto",
      "created_at": "2025-03-07T16:23:34Z",
      "updated_at": "2025-03-18T09:17:42Z",
      "comments": 17,
      "url": "https://github.com/bitcoin/bitcoin/pull/32019",
      "labels": [
        "Build system"
      ],
      "comment_list": [
        {
          "user": "DrahtBot",
          "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/32019.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| ACK | [hodlinator](https://github.com/bitcoin/bitcoin/pull/32019#issuecomment-2721696648), [fanquake](https://github.com/bitcoin/bitcoin/pull/32019#pullrequestreview-2693581701) |\n| Stale ACK | [laanwj](https://github.com/bitcoin/bitcoin/pull/32019#pullrequestreview-2668929872), [mabu44](https://github.com/bitcoin/bitcoin/pull/32019#issuecomment-2708461024) |\n\nIf your review is incorrectly listed, please react with üëé to this comment and the bot will ignore it on the next update.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#31375](https://github.com/bitcoin/bitcoin/pull/31375) (multiprocess: Add bitcoin wrapper executable by ryanofsky)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n",
          "created_at": "2025-03-07T16:23:38Z"
        },
        {
          "user": "mabu44",
          "body": "tACK deea0988720aab65b3cc6d80b50bbf0d537adb24\r\n\r\nGot same result as @hodlinator on Debian.",
          "created_at": "2025-03-08T19:35:40Z"
        },
        {
          "user": "fanquake",
          "body": "Now that `nsis` is required, the docs about installing `nsis` in `build-windows.md` should be updated.",
          "created_at": "2025-03-09T15:29:57Z"
        },
        {
          "user": "hebasto",
          "body": "> Now that `nsis` is required, the docs about installing `nsis` in `build-windows.md` should be updated.\r\n\r\nThanks for pointing this out!\r\n\r\nSince the `deploy` target is optional, the NSIS tool shouldn't be a strict requirement for a successful configuration.\r\n\r\nI've reworked this PR so that the error message \"Error: NSIS not found\" is only printed when attempting to build the `deploy` target.",
          "created_at": "2025-03-09T16:33:53Z"
        },
        {
          "user": "fanquake",
          "body": "> the NSIS tool shouldn't be a strict requirement for a successful configuration.\n\nThen the same should be done for macOS and zip, otherwise it's still inconsistent.",
          "created_at": "2025-03-09T16:48:12Z"
        },
        {
          "user": "hebasto",
          "body": "> > the NSIS tool shouldn't be a strict requirement for a successful configuration.\r\n> \r\n> Then the same should be done for macOS and zip, otherwise it's still inconsistent.\r\n\r\nSure thing! Added.\r\n\r\nThe PR description has been updated.",
          "created_at": "2025-03-09T19:15:48Z"
        },
        {
          "user": "hebasto",
          "body": "> re-ACK [0ecd2e0](https://github.com/bitcoin/bitcoin/commit/0ecd2e0748bdbfc12af1fc100862a1a6f046c2c9)\r\n> \r\n> Good that nsis and zip could be made optional unless deploying.\r\n> \r\n> Only re-tested Windows-side, but Mac side diff looks equivalent.\r\n> \r\n> Without nsis:\r\n> \r\n> ```shell\r\n> /mnt/c/Users/hodlinator/bitcoin$ cmake --build build --target deploy\r\n> Error: NSIS not found\r\n> Built target deploy\r\n> ```\r\n> \r\n> I needed to re-run `cmake -B build --toolchain depends/x86_64-w64-mingw32/toolchain.cmake` for the build to pick up that makensis was available. It would be good if we could invalidate the cache upon failure\r\n\r\nI had exactly the same idea while working on this implementation (also see a discussion in https://github.com/bitcoin/bitcoin/issues/31942).  But the configuration step should be re-run after installing a dependency to let the `deploy` target choose another implementation.\r\n\r\nPerhaps @purpleKarrot could suggest a better approach?\r\n\r\n> or indicate in the error message that one has to regenerate the build config.\r\n\r\nAgree. Mind suggesting a wording for the error message?",
          "created_at": "2025-03-10T13:29:52Z"
        },
        {
          "user": "hodlinator",
          "body": "> > or indicate in the error message that one has to regenerate the build config.\r\n> \r\n> Agree. Mind suggesting a wording for the error message?\r\n\r\nFelt I was going out on a limb using the term \"build config\", was thinking something like:\r\n```\r\nError: NSIS not found. Install it (make it available to find_program()) and regenerate the build config.\r\n```",
          "created_at": "2025-03-10T13:38:37Z"
        },
        {
          "user": "hebasto",
          "body": "Addressed the feedback from @hodlinator. Thank you!",
          "created_at": "2025-03-10T15:00:11Z"
        },
        {
          "user": "Sjors",
          "body": "Tested on macOS 15.3.1 that `cmake --build build --target deploy` still works. It's impossible (?) to test the missing condition, because`/usr/bin/zip` comes with the OS and not even `sudo` can delete it. Seems fine to check though, because who knows what Apple does in their next OS upgrade. And I guess this also covers cross and guix compiling?",
          "created_at": "2025-03-10T15:17:07Z"
        },
        {
          "user": "Sjors",
          "body": "Oh this code path isn't used at all when building natively? E.g. on macOS I can do `ZIP_EXECUTABLE=$HOME/temp/zip2 cmake --build build --target deploy` which doesn't fail.",
          "created_at": "2025-03-10T15:25:56Z"
        },
        {
          "user": "hebasto",
          "body": "> Oh this code path isn't used at all when building natively?\r\n\r\nCorrect.",
          "created_at": "2025-03-10T15:56:04Z"
        },
        {
          "user": "laanwj",
          "body": "Tested windows path without NSIS\r\n```\r\n$ ninja -j4\r\n[224/224] Linking CXX executable src/test/test_bitcoin.exe (successful build)\r\n$ ninja deploy\r\n[1/1] cd /home/user/src/bitcoin-windows/build && /usr/bin/cmake -E echo && /usr/bin/cm... -E echo \"Then re-run cmake to regenerate the build system.\" && /usr/bin/cmake -E echo\r\n\r\nError: NSIS not found.\r\nPlease install NSIS and/or ensure that its executable is accessible to the find_program() command‚Äî\r\nfor example, by setting the MAKENSIS_EXECUTABLE variable or another relevant CMake variable.\r\nThen re-run cmake to regenerate the build system.\r\n```\r\nConfiguration and build succeeds, but deploy fails with a message. This is the expected behavior.",
          "created_at": "2025-03-10T15:58:15Z"
        },
        {
          "user": "purpleKarrot",
          "body": "> Perhaps @purpleKarrot could suggest a better approach?\r\n\r\nCPack?",
          "created_at": "2025-03-10T21:51:30Z"
        },
        {
          "user": "hebasto",
          "body": "> > Perhaps @purpleKarrot could suggest a better approach?\r\n> \r\n> CPack?\r\n\r\nhttps://github.com/bitcoin/bitcoin/blob/dbc89b604c4dae9702f1ff08abd4ed144a5fcb76/cmake/module/Maintenance.cmake#L47-L48 :)",
          "created_at": "2025-03-11T18:17:23Z"
        },
        {
          "user": "hebasto",
          "body": "The recent [feedback](https://github.com/bitcoin/bitcoin/pull/32019#discussion_r1988501276) regarding verbosity has been addressed.\r\n\r\nAll error messages about a missed optional executable are now consistent.\r\n\r\nRebased on top of bitcoin/bitcoin#31161.",
          "created_at": "2025-03-13T11:25:17Z"
        },
        {
          "user": "hodlinator",
          "body": "re-ACK 1f9b2e150ce5aa192226d2daae73f7d678c47d65\r\n\r\nWe're back to an exact copy of 0ecd2e0748bdbfc12af1fc100862a1a6f046c2c9, only rebased, which I [previously ACKed](https://github.com/bitcoin/bitcoin/pull/32019#pullrequestreview-2670874014).\r\n\r\nIf you retouch and have remaining patience I would still prefer:\r\n```\r\nError: NSIS not found\r\nSatisfy the dependency and re-run CMake to regenerate the build system.\r\n```\r\n\r\nTried to figure out a way to get `cmake` to return an error code after printing the error, but without success.",
          "created_at": "2025-03-13T15:38:40Z"
        }
      ]
    },
    {
      "number": 32017,
      "title": "doc: warn against having qt6 installed on macOS",
      "body": "Document #31009 in time for the v29 release.",
      "state": "closed",
      "user": "Sjors",
      "created_at": "2025-03-07T10:02:52Z",
      "updated_at": "2025-03-08T11:30:16Z",
      "comments": 2,
      "url": "https://github.com/bitcoin/bitcoin/pull/32017",
      "labels": [
        "Docs"
      ],
      "comment_list": [
        {
          "user": "DrahtBot",
          "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/32017.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| ACK | [hebasto](https://github.com/bitcoin/bitcoin/pull/32017#pullrequestreview-2667531271), [achow101](https://github.com/bitcoin/bitcoin/pull/32017#issuecomment-2707860813) |\n\nIf your review is incorrectly listed, please react with üëé to this comment and the bot will ignore it on the next update.\n",
          "created_at": "2025-03-07T10:02:55Z"
        },
        {
          "user": "achow101",
          "body": "ACK d79dab0fa999002a0c5b70c1688240e2a5032ce1\r\n\r\nDid not test whether it actually is an issue, but seems plausible.",
          "created_at": "2025-03-08T01:20:31Z"
        }
      ]
    },
    {
      "number": 32015,
      "title": "net: replace manual reference counting of CNode with shared_ptr",
      "body": "Before this change the code used to count references to `CNode` objects manually via `CNode::nRefCount`. Unneeded `CNode`s were scheduled for deletion by putting them in `CConnman::m_nodes_disconnected` and were deleted after their reference count reached zero. Deleting consists of calling `PeerManager::FinalizeNode()` and destroying the `CNode` object.\r\n\r\nReplace this scheme with `std::shared_ptr`. This simplifies the code and removes:\r\n`CNode::nRefCount`\r\n`CNode::GetRefCount()`\r\n`CNode::AddRef()`\r\n`CNode::Release()`\r\n`CConnman::m_nodes_disconnected`\r\n`CConnman::NodesSnapshot`\r\n\r\nNow creating a snapshot of `CConnman::m_nodes` is done by simply copying it (under the mutex).\r\n\r\nCall `PeerManager::FinalizeNode()` from the destructor of `CNode`, which is called when the reference count reaches 0.\r\n\r\nThis removes brittle code and replaces it by a code from the standard library which is more robust. All the below are possible with the manual reference counting and not possible with `shared_ptr`:\r\n* Use an object without adding a reference to it\r\n* Add too many references to an object, mismatch the add/remove by having more \"add\"\r\n* Forget to reduce the reference count, mismatch the add/remove by having less \"remove\"\r\n* Go with negative reference count by mistakenly having too many \"remove\"\r\n* Destroy an object while there are references to it\r\n\r\nThere is zero learning curve for the average C++ programmer who knows how `shared_ptr` works. Not so much with the manual reference counting because one has to learn about `AddRef()`, `Release()`, check and maintain where are they called and their relationship with `m_nodes_disconnected`.\r\n\r\n---\r\n\r\nThis has some history in https://github.com/bitcoin/bitcoin/pull/28222 and https://github.com/bitcoin/bitcoin/pull/10738. See below https://github.com/bitcoin/bitcoin/pull/32015#issuecomment-2717384152 and https://github.com/bitcoin/bitcoin/pull/32015#issuecomment-2717860925.\r\n\r\n---\r\n\r\nPossible followup: change `ProcessMessages()` and `SendMessages()` to take `CNode&`: https://github.com/bitcoin/bitcoin/pull/32015#discussion_r2088731770",
      "state": "open",
      "user": "vasild",
      "created_at": "2025-03-07T09:53:01Z",
      "updated_at": "2025-12-05T10:44:56Z",
      "comments": 55,
      "url": "https://github.com/bitcoin/bitcoin/pull/32015",
      "labels": [
        "P2P",
        "Needs rebase"
      ]
    },
    {
      "number": 32014,
      "title": "ci: Do not try to install for fuzz builds",
      "body": "This PR is a follow-up to https://github.com/bitcoin/bitcoin/pull/31844 and extends the changes from fb0546b1c5ebb858605bef4c9fa001782e0ab213 to all fuzz builds in the CI.\r\n\r\nFixes https://github.com/bitcoin/bitcoin/issues/32001.",
      "state": "closed",
      "user": "hebasto",
      "created_at": "2025-03-07T08:06:00Z",
      "updated_at": "2025-03-07T14:57:55Z",
      "comments": 4,
      "url": "https://github.com/bitcoin/bitcoin/pull/32014",
      "labels": [
        "Tests"
      ],
      "comment_list": [
        {
          "user": "DrahtBot",
          "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/32014.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| ACK | [dergoegge](https://github.com/bitcoin/bitcoin/pull/32014#pullrequestreview-2667265203) |\n\nIf your review is incorrectly listed, please react with üëé to this comment and the bot will ignore it on the next update.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#28710](https://github.com/bitcoin/bitcoin/pull/28710) (Remove the legacy wallet and BDB dependency by achow101)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n",
          "created_at": "2025-03-07T08:06:03Z"
        },
        {
          "user": "Sjors",
          "body": "Is it possible to open a PR to the QA repo that demonstrates that this actually fixes the problem?\r\n\r\nWhere in the CMake code is `$GOAL` processed?\r\n\r\nI see this in the CI code:\r\n\r\n```sh\r\nbash -c \"cmake --build . $MAKEJOBS --target all $GOAL\" \r\n```\r\n\r\nBut after that I lost track.",
          "created_at": "2025-03-07T10:12:27Z"
        },
        {
          "user": "hebasto",
          "body": "> Where in the CMake code is `$GOAL` processed?\r\n> \r\n> I see this in the CI code:\r\n> \r\n> ```shell\r\n> bash -c \"cmake --build . $MAKEJOBS --target all $GOAL\" \r\n> ```\r\n> \r\n> But after that I lost track.\r\n\r\nThis is the only place.",
          "created_at": "2025-03-07T11:12:01Z"
        },
        {
          "user": "marcofleon",
          "body": "> Is it possible to open a PR to the QA repo that demonstrates that this actually fixes the problem?\r\n\r\nTrying it here:\r\nhttps://github.com/bitcoin-core/qa-assets/pull/219",
          "created_at": "2025-03-07T11:12:32Z"
        }
      ]
    },
    {
      "number": 32011,
      "title": "Docs: fix typos in documentation files",
      "body": "",
      "state": "closed",
      "user": "wgyt",
      "created_at": "2025-03-07T02:11:41Z",
      "updated_at": "2025-03-09T16:44:54Z",
      "comments": 5,
      "url": "https://github.com/bitcoin/bitcoin/pull/32011",
      "labels": [
        "Docs"
      ],
      "comment_list": [
        {
          "user": "DrahtBot",
          "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/32011.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| ACK | [jonatack](https://github.com/bitcoin/bitcoin/pull/32011#issuecomment-2707893667), [mabu44](https://github.com/bitcoin/bitcoin/pull/32011#issuecomment-2708412062), [maflcko](https://github.com/bitcoin/bitcoin/pull/32011#issuecomment-2708875507) |\n| Stale ACK | [rkrux](https://github.com/bitcoin/bitcoin/pull/32011#pullrequestreview-2667264633) |\n\nIf your review is incorrectly listed, please react with üëé to this comment and the bot will ignore it on the next update.\n",
          "created_at": "2025-03-07T02:11:46Z"
        },
        {
          "user": "DrahtBot",
          "body": "<!--85328a0da195eb286784d51f73fa0af9-->\nüöß At least one of the CI tasks failed.\n<sub>Debug: https://github.com/bitcoin/bitcoin/runs/38350828258</sub>\n\n<details><summary>Hints</summary>\n\nTry to run the tests locally, according to the documentation. However, a CI failure may still\nhappen due to a number of reasons, for example:\n\n* Possibly due to a silent merge conflict (the changes in this pull request being\nincompatible with the current code in the target branch). If so, make sure to rebase on the latest\ncommit of the target branch.\n\n* A sanitizer issue, which can only be found by compiling with the sanitizer and running the\n  affected test.\n\n* An intermittent issue.\n\nLeave a comment here, if you need help tracking down a confusing failure.\n\n</details>\n",
          "created_at": "2025-03-07T03:05:18Z"
        },
        {
          "user": "jonatack",
          "body": "ACK 5601bab4f8b01fdef7a54c9e397d513217ab1c1f",
          "created_at": "2025-03-08T02:02:55Z"
        },
        {
          "user": "mabu44",
          "body": "crACK 5601bab4f8b01fdef7a54c9e397d513217ab1c1f",
          "created_at": "2025-03-08T17:41:23Z"
        },
        {
          "user": "maflcko",
          "body": "lgtm ACK 5601bab4f8b01fdef7a54c9e397d513217ab1c1f",
          "created_at": "2025-03-09T14:09:40Z"
        }
      ]
    }
  ],
  "issues": [
    {
      "number": 32018,
      "title": "cmake: `makensis` isn't checked-for before use",
      "body": "Autotools would warn that we wouldn't be able to build the Windows installer if it was missing. Currently, we don't check if it's available at all, and just fail when we first try to use it. This differs from the macOS deploy target, where we do check that `zip` is available, and fail to configure if it isn't.",
      "state": "closed",
      "user": "fanquake",
      "created_at": "2025-03-07T11:38:01Z",
      "updated_at": "2025-03-18T09:10:47Z",
      "comments": 0,
      "url": "https://github.com/bitcoin/bitcoin/issues/32018",
      "labels": [
        "Build system"
      ]
    },
    {
      "number": 32016,
      "title": "test: `p2p_message_capture.py` fails with GCC 13-15 & undefined sanitizer",
      "body": "Using Fedora 41:\n```bash\n# gcc (GCC) 15.1.1 20250521 (Red Hat 15.1.1-2)\n\ndnf install git cmake gcc-c++ make python3 libevent-devel boost-devel sqlite-devel zeromq-devel systemtap-sdt-devel ccache\ngit clone https://github.com/bitcoin/bitcoin\ncd bitcoin\ncmake -B build -DSANITIZERS=undefined\ncmake --build build\n./build/test/functional/test_runner.py p2p_message_capture.py\n```\n\n```bash\n./build/test/functional/test_runner.py p2p_message_capture.py\n<snip>\nstdout:\n2025-06-24T13:21:52.543212Z TestFramework (INFO): PRNG seed is: 7493633970328004406\n2025-06-24T13:21:52.545101Z TestFramework (INFO): Initializing test directory /tmp/test_runner_‚Çø_üèÉ_20250624_132152/p2p_message_capture_0\n2025-06-24T13:21:52.970276Z TestFramework (INFO): Stopping nodes\n\n\nstderr:\nTraceback (most recent call last):\n  File \"/root/bitcoin/build/test/functional/p2p_message_capture.py\", line 72, in <module>\n    MessageCaptureTest(__file__).main()\n    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^\n  File \"/root/bitcoin/test/functional/test_framework/test_framework.py\", line 214, in main\n    exit_code = self.shutdown()\n  File \"/root/bitcoin/test/functional/test_framework/test_framework.py\", line 376, in shutdown\n    self.stop_nodes()\n    ~~~~~~~~~~~~~~~^^\n  File \"/root/bitcoin/test/functional/test_framework/test_framework.py\", line 625, in stop_nodes\n    node.wait_until_stopped()\n    ~~~~~~~~~~~~~~~~~~~~~~~^^\n  File \"/root/bitcoin/test/functional/test_framework/test_node.py\", line 460, in wait_until_stopped\n    self.wait_until(lambda: self.is_node_stopped(**kwargs), timeout=timeout)\n    ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/root/bitcoin/test/functional/test_framework/test_node.py\", line 862, in wait_until\n    return wait_until_helper_internal(test_function, timeout=timeout, timeout_factor=self.timeout_factor, check_interval=check_interval)\n  File \"/root/bitcoin/test/functional/test_framework/util.py\", line 314, in wait_until_helper_internal\n    if predicate():\n       ~~~~~~~~~^^\n  File \"/root/bitcoin/test/functional/test_framework/test_node.py\", line 460, in <lambda>\n    self.wait_until(lambda: self.is_node_stopped(**kwargs), timeout=timeout)\n                            ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^\n  File \"/root/bitcoin/test/functional/test_framework/test_node.py\", line 445, in is_node_stopped\n    raise AssertionError(\"Unexpected stderr {} != {}\".format(stderr, expected_stderr))\nAssertionError: Unexpected stderr /root/bitcoin/src/streams.cpp:85:24: runtime error: null pointer passed as argument 1, which is declared to never be null != \n[node 0] Cleaning up leftover process\n```",
      "state": "open",
      "user": "fanquake",
      "created_at": "2025-03-07T09:59:55Z",
      "updated_at": "2025-10-30T10:17:10Z",
      "comments": 3,
      "url": "https://github.com/bitcoin/bitcoin/issues/32016",
      "labels": [
        "Tests",
        "Upstream"
      ],
      "comment_list": [
        {
          "user": "dergoegge",
          "body": "Maybe related: https://github.com/bitcoin/bitcoin/issues/28761",
          "created_at": "2025-03-07T13:27:18Z"
        },
        {
          "user": "instagibbs",
          "body": "I'm seeing this on 13.3.0 fwiw ",
          "created_at": "2025-03-27T19:36:27Z"
        },
        {
          "user": "maflcko",
          "body": "> Maybe related: [#28761](https://github.com/bitcoin/bitcoin/issues/28761)\n\nYeah, it is the same one. It was fixed upstream in the standard as of this year, see https://www.open-std.org/JTC1/SC22/WG14/www/docs/n3466.pdf",
          "created_at": "2025-03-27T21:07:33Z"
        }
      ]
    },
    {
      "number": 32013,
      "title": "Check if the wallet already contains the descriptor GetDescriptorScriptPubKeyMan",
      "body": "### Is there an existing issue for this?\n\n- [x] I have searched the existing issues\n\n### Current behaviour\n\nIn importdescriptors rpc call when we try import descriptor address we are internally calling ProcessDescriptorImport() method which checking\n\n`            // Check if the wallet already contains the descriptor\n            auto existing_spk_manager = wallet.GetDescriptorScriptPubKeyMan(w_desc);\n            if (existing_spk_manager) {\n                if (!existing_spk_manager->CanUpdateToWalletDescriptor(w_desc, error)) {\n                    throw JSONRPCError(RPC_INVALID_PARAMETER, error);\n                }\n            }`\n\nand below we have \n\n`            // Add descriptor to the wallet\n            auto spk_manager = wallet.AddWalletDescriptor(w_desc, keys, label, desc_internal);\n            if (spk_manager == nullptr) {\n                throw JSONRPCError(RPC_WALLET_ERROR, strprintf(\"Could not add descriptor '%s'\", descriptor));\n            }`\n\nbut in AddWalletDescriptor method again we are checking \n`    auto spk_man = GetDescriptorScriptPubKeyMan(desc);`\n\nBy calling twice we are facing lot of delay when we import address.\n\n> 2025-01-24T03:26:28Z [wt_wallet] ProcessDescriptorImport: GetDescriptorScriptPubKeyMan time 619 milliseconds \n2025-01-24T03:26:28Z [wt_wallet] ProcessDescriptorImport: AddWalletDescriptor time 33 milliseconds \n2025-01-24T03:26:28Z [wt_wallet] operator(): ProcessDescriptorImport time 653 milliseconds \n\nI've made some improvement like using only GetDescriptorScriptPubKeyMan method it is bit faster. Kindly verify this issue so I can create Pull request.\n\n### Expected behaviour\n\nGetDescriptorScriptPubKeyMan  method should be called only once in the importdescriptor call.\n\n### Steps to reproduce\n\n1. call importdescriptors()\n\n[GetDescriptor_time_1.txt](https://github.com/user-attachments/files/19122453/GetDescriptor_time_1.txt)\n\n[Improved_getdescriptor.txt](https://github.com/user-attachments/files/19122456/Improved_getdescriptor.txt)\n\n2. Add debug logs \n`            auto startTime = std::chrono::steady_clock::now();\n            const UniValue result = ProcessDescriptorImport(*pwallet, request, timestamp);\n            auto endTime = std::chrono::steady_clock::now();\n            auto duratioMilliseconds = std::chrono::duration_cast<std::chrono::milliseconds>(endTime-startTime).count();\n            pwallet->WalletLogPrintf(\"%s: ProcessDescriptorImport time %d milliseconds \\n\", __func__, duratioMilliseconds);`\n\n`\n           auto startTime = std::chrono::steady_clock::now();\n            // Check if the wallet already contains the descriptor\n             auto existing_spk_manager = wallet.GetDescriptorScriptPubKeyMan(w_desc);\n            if (existing_spk_manager) {\n                 if (!existing_spk_manager->CanUpdateToWalletDescriptor(w_desc, error)) {\n                     throw JSONRPCError(RPC_INVALID_PARAMETER, error);\n                 }\n             }\n            auto endTime = std::chrono::steady_clock::now();\n            auto duratioMilliseconds = std::chrono::duration_cast<std::chrono::milliseconds>(endTime-startTime).count();\n            pwallet->WalletLogPrintf(\"%s: GetDescriptorScriptPubKeyMantime %d milliseconds \\n\", __func__, duratioMilliseconds);`\n`\n\n` auto startTime = std::chrono::steady_clock::now();\n            // Add descriptor to the wallet\n            auto spk_manager = wallet.AddWalletDescriptor(w_desc, keys, label, desc_internal);\n            if (spk_manager == nullptr) {\n                throw JSONRPCError(RPC_WALLET_ERROR, strprintf(\"Could not add descriptor '%s'\", descriptor));\n            }\n\n            auto endTime = std::chrono::steady_clock::now();\n            auto duratioMilliseconds = std::chrono::duration_cast<std::chrono::milliseconds>(endTime-startTime).count();\n            wallet.WalletLogPrintf(\"%s: AddWalletDescriptor time %d milliseconds \\n\", __func__, duratioMilliseconds);`\n\n### Relevant log output\n\n_No response_\n\n### How did you obtain Bitcoin Core\n\nCompiled from source\n\n### What version of Bitcoin Core are you using?\n\nmaster\n\n### Operating system and version\n\nwsl ubuntu 22.04 LTS\n\n### Machine specifications\n\n_No response_",
      "state": "closed",
      "user": "saikiran57",
      "created_at": "2025-03-07T07:46:32Z",
      "updated_at": "2025-03-21T15:15:04Z",
      "comments": 2,
      "url": "https://github.com/bitcoin/bitcoin/issues/32013",
      "labels": [
        "Wallet"
      ],
      "comment_list": [
        {
          "user": "achow101",
          "body": "If you believe you have a useful change, please just open a PR. There's no need to ask permission to do so, and doing code review in an issue is painful.",
          "created_at": "2025-03-07T16:23:37Z"
        },
        {
          "user": "maflcko",
          "body": "Let's move the discussion to the pull request",
          "created_at": "2025-03-21T15:15:02Z"
        }
      ]
    },
    {
      "number": 32012,
      "title": "test: No unit test covers BIP342 tapscript signatures",
      "body": "The following change does not make any unit test fail:\n\n```diff\ndiff --git i/src/script/interpreter.cpp w/src/script/interpreter.cpp\nindex a35306b693..d9c119ae77 100644\n--- i/src/script/interpreter.cpp\n+++ w/src/script/interpreter.cpp\n@@ -1484,7 +1484,7 @@ bool SignatureHashSchnorr(uint256& hash_out, ScriptExecutionData& execdata, cons\n         // key_version is not used and left uninitialized.\n         break;\n     case SigVersion::TAPSCRIPT:\n-        ext_flag = 1;\n+        ext_flag = 42;\n         // key_version must be 0 for now, representing the current version of\n         // 32-byte public keys in the tapscript signature opcode execution.\n         // An upgradable public key version (with a size not 32-byte) may\n```\n\nThis is because, despite BIP342 [claiming](https://github.com/bitcoin/bips/blob/master/bip-0342.mediawiki#examples) that ‚ÄúThe Taproot (BIP341) test vectors also contain examples for Tapscript execution.‚Äù, it does not seem to be the case.\n\nA similar change to `SigVersion::TAPROOT` branch causes test failures in `script_tests/bip341_keypath_test_vectors` as expected. Functional tests fail as expected in any case.",
      "state": "closed",
      "user": "jirijakes",
      "created_at": "2025-03-07T04:13:56Z",
      "updated_at": "2025-03-30T10:44:57Z",
      "comments": 7,
      "url": "https://github.com/bitcoin/bitcoin/issues/32012",
      "labels": [
        "Tests"
      ],
      "comment_list": [
        {
          "user": "brunoerg",
          "body": "Hi, @jirijakes. I've tried to reproduce it but the unit test fails when running it with this mutation.\n\nWithout the change:\n```sh\n‚ûú  bitcoin-core-dev git:(master) ‚úó DIR_UNIT_TEST_DATA=qa-assets/unit_test_data ./build/bin/test_bitcoin --run_test=script_tests\nRunning 19 test cases...\n\n*** No errors detected\n```\n\nWith the change:\n```sh\n‚ûú  bitcoin-core-dev git:(master) ‚úó DIR_UNIT_TEST_DATA=qa-assets/unit_test_data ./build/bin/test_bitcoin --run_test=script_tests\nRunning 19 test cases...\ntest/script_tests.cpp:1582: error: in \"script_tests/script_assets_test\": check ret has failed\ntest/script_tests.cpp:1582: error: in \"script_tests/script_assets_test\": check ret has failed\ntest/script_tests.cpp:1582: error: in \"script_tests/script_assets_test\": check ret has failed\ntest/script_tests.cpp:1582: error: in \"script_tests/script_assets_test\": check ret has failed\ntest/script_tests.cpp:1582: error: in \"script_tests/script_assets_test\": check ret has failed\ntest/script_tests.cpp:1582: error: in \"script_tests/script_assets_test\": check ret has failed\ntest/script_tests.cpp:1582: error: in \"script_tests/script_assets_test\": check ret has failed\ntest/script_tests.cpp:1582: error: in \"script_tests/script_assets_test\": check ret has failed\ntest/script_tests.cpp:1582: error: in \"script_tests/script_assets_test\": check ret has failed\n...\n```",
          "created_at": "2025-03-19T12:53:42Z"
        },
        {
          "user": "Chand-ra",
          "body": "> Hi, [@jirijakes](https://github.com/jirijakes). I've tried to reproduce it but the unit test fails when running it with this mutation.\n\nHmm, I seem to be able to reproduce the bug with the following:\n\n```\n$ git diff\n diff --git a/src/script/interpreter.cpp b/src/script/interpreter.cpp\nindex a35306b693..d9c119ae77 100644\n--- a/src/script/interpreter.cpp\n+++ b/src/script/interpreter.cpp\n@@ -1484,7 +1484,7 @@ bool SignatureHashSchnorr(uint256& hash_out, ScriptExecutionData& execdata, cons\n         // key_version is not used and left uninitialized.\n         break;\n     case SigVersion::TAPSCRIPT:\n-        ext_flag = 1;\n+        ext_flag = 42;\n         // key_version must be 0 for now, representing the current version of\n         // 32-byte public keys in the tapscript signature opcode execution.\n         // An upgradable public key version (with a size not 32-byte) may\n\n$ sudo cmake --build build --parallel 12\n[  0%] Generating bitcoin-build-info.h\n[  0%] Built target secp256k1_precomputed\n[  1%] Built target crc32c\n[  2%] Built target univalue\n[  5%] Built target bitcoin_crypto\n[  5%] Building CXX object src/CMakeFiles/bitcoin_consensus.dir/script/interpreter.cpp.o\n[ 16%] Built target unitester\n.\n.\n.\n[ 74%] Built target bitcoind\n[100%] Built target test_bitcoin\n\n$ ./build/bin/test_bitcoin --run_test=script_tests\nRunning 19 test cases...\n\n*** No errors detected\n```\nDoing the following change:\n```\n$ git diff\ndiff --git a/src/script/interpreter.cpp b/src/script/interpreter.cpp\nindex a35306b693..3c95d89187 100644\n--- a/src/script/interpreter.cpp\n+++ b/src/script/interpreter.cpp\n@@ -1480,7 +1480,7 @@ bool SignatureHashSchnorr(uint256& hash_out, ScriptExecutionData& execdata, cons\n     uint8_t ext_flag, key_version;\n     switch (sigversion) {\n     case SigVersion::TAPROOT:\n-        ext_flag = 0;\n+        ext_flag = 1;\n         // key_version is not used and left uninitialized.\n         break;\n```\n\nDoes produce the following error though:\n\n```\nRunning 19 test cases...\n./test/script_tests.cpp(1689): error: in \"script_tests/bip341_keypath_test_vectors\": check HexStr(signature) == input[\"expected\"][\"witness\"][0].get_str() has failed [ee46ac94633f9f18540147b9c6481e06261afef228655c4c7b6bef994470bf80f65903da6d503195fdbf9e1ae574fa513ef1135fb0f36ffc264e55b95e83a26403 != ed7c1647cb97379e76892be0cacff57ec4a7102aa24296ca39af7541246d8ff14d38958d4cc1e2e478e4d4a764bbfd835b16d4e314b72937b29833060b87276c03]\n./test/script_tests.cpp(1700): error: in \"script_tests/bip341_keypath_test_vectors\": check HexStr(sighash) == input[\"intermediary\"][\"sigHash\"].get_str() has failed [1ef56c28e4b7e596c8c8a7deec429eb23e823f6c8a16fc1799f0063505701cc1 != 2514a6272f85cfa0f45eb907fcb0d121b808ed37c6ea160a5a9046ed5526d555]\n./test/script_tests.cpp(1689): error: in \"script_tests/bip341_keypath_test_vectors\": check HexStr(signature) == input[\"expected\"][\"witness\"][0].get_str() has failed [5847f2545965ce44f7a0ed5ef77959c0470a32454298df1818ea358395e1373417b5dde924b5c8204bbb35f3d8d767070bc7a6655e35ab5a4192f518cd33594783 != 052aedffc554b41f52b521071793a6b88d6dbca9dba94cf34c83696de0c1ec35ca9c5ed4ab28059bd606a4f3a657eec0bb96661d42921b5f50a95ad33675b54f83]\n.\n.\n.\n*** 14 failures are detected in the test module \"Bitcoin Core Test Suite\"\n```\n",
          "created_at": "2025-03-19T17:52:14Z"
        },
        {
          "user": "willcl-ark",
          "body": "I also cannot reproduce OP:\n\n```bash\nwill@ubuntu in ‚Ä¶/src/core/bitcoin on ÓÇ† master [$!?] via ‚ñ≥ v3.31.6 : üêç (core)\n$ git diff -p | cat\ndiff --git a/src/script/interpreter.cpp b/src/script/interpreter.cpp\nindex a35306b6935..d2904fb3f14 100644\n--- a/src/script/interpreter.cpp\n+++ b/src/script/interpreter.cpp\n@@ -1480,7 +1480,7 @@ bool SignatureHashSchnorr(uint256& hash_out, ScriptExecutionData& execdata, cons\n     uint8_t ext_flag, key_version;\n     switch (sigversion) {\n     case SigVersion::TAPROOT:\n-        ext_flag = 0;\n+        ext_flag = 42;\n         // key_version is not used and left uninitialized.\n         break;\n     case SigVersion::TAPSCRIPT:\n\nwill@ubuntu in ‚Ä¶/src/core/bitcoin on ÓÇ† master [$!?] via ‚ñ≥ v3.31.6 : üêç (core)\n$ cmake --build build -j17\n[  0%] Generating bitcoin-build-info.h\n[  0%] Built target exhaustive_tests\n[  0%] Built target secp256k1_precomputed\n[  0%] Built target crc32c\n[  1%] Built target bitcoin_cli\n[  2%] Built target univalue\n[  5%] Built target minisketch\n[  6%] Built target secp256k1\n[  6%] Built target noverify_tests\n[  8%] Built target bitcoin_consensus\n[  8%] Built target tests\n[ 12%] Built target bitcoin_crypto\n[ 23%] Built target unitester\n[ 23%] Built target object\n[ 24%] Built target ctime_tests\n[ 32%] Built target test_util\n[ 35%] Built target leveldb\n[ 35%] Built target generate_build_info\n[ 35%] Built target bitcoin_clientversion\n[ 41%] Built target bitcoin_util\n[ 50%] Built target bitcoin_common\n[ 50%] Built target bitcoin-cli\n[ 50%] Built target bitcoin-tx\n[ 51%] Built target bitcoin-util\n[ 56%] Built target bitcoin_wallet\n[ 56%] Built target bitcoin-wallet\n[ 73%] Built target bitcoin_node\n[ 73%] Built target bitcoind\n[100%] Built target test_bitcoin\n\nwill@ubuntu in ‚Ä¶/src/core/bitcoin on ÓÇ† master [$!?] via ‚ñ≥ v3.31.6 : üêç (core)\n$ ./build/bin/test_bitcoin --run_test=script_tests\nRunning 19 test cases...\n../../../src/test/script_tests.cpp(1689): error: in \"script_tests/bip341_keypath_test_vectors\": check HexStr(signature) == input[\"expected\"][\"witness\"][0].get_str() has failed [fae8e7e3ab84b11f775b62100481ccdaf520a628fc2d2837d308bd93da357af0b707df9292413b574be23e784832cf5cdc565747c7ae15f33a5ac55e21c3f6ef03 != ed7c1647cb97379e76892be0cacff57ec4a7102aa24296ca39af7541246d8ff14d38958d4cc1e2e478e4d4a764bbfd835b16d4e314b72937b29833060b87276c03]\n../../../src/test/script_tests.cpp(1700): error: in \"script_tests/bip341_keypath_test_vectors\": check HexStr(sighash) == input[\"intermediary\"][\"sigHash\"].get_str() has failed [9d6ff1701d2e63eee442eb44ac276a57ae8d2aa5659e5191347c6d7104a325da != 2514a6272f85cfa0f45eb907fcb0d121b808ed37c6ea160a5a9046ed5526d555]\n../../../src/test/script_tests.cpp(1689): error: in \"script_tests/bip341_keypath_test_vectors\": check HexStr(signature) == input[\"expected\"][\"witness\"][0].get_str() has failed [c61b3ba1ff376bc2ba40e91ff108697b9e9500590fe71f59a2b2b38037547c0e32cee0522b9e9caf456c4befc8e6e37502fc14daf3ce48cb8b19f9aa9588481583 != 052aedffc554b41f52b521071793a6b88d6dbca9dba94cf34c83696de0c1ec35ca9c5ed4ab28059bd606a4f3a657eec0bb96661d42921b5f50a95ad33675b54f83]\n../../../src/test/script_tests.cpp(1700): error: in \"script_tests/bip341_keypath_test_vectors\": check HexStr(sighash) == input[\"intermediary\"][\"sigHash\"].get_str() has failed [d8a506a504823d0efed689179e10d9e3b39c4f8d8786a47c0c67d9646be04ecf != 325a644af47e8a5a2591cda0ab0723978537318f10e6a63d4eed783b96a71a4d]\n../../../src/test/script_tests.cpp(1689): error: in \"script_tests/bip341_keypath_test_vectors\": check HexStr(signature) == input[\"expected\"][\"witness\"][0].get_str() has failed [86ea29da1f03effff0c07c978a80ddc6b39cfeccdd6e0ca653143737e63dc48396ea9e9d0ffbf3a65d31d907d7180fb2af1aeda2f11c45cb0e97dcf892f9aa2a01 != ff45f742a876139946a149ab4d9185574b98dc919d2eb6754f8abaa59d18b025637a3aa043b91817739554f4ed2026cf8022dbd83e351ce1fabc272841d2510a01]\n../../../src/test/script_tests.cpp(1700): error: in \"script_tests/bip341_keypath_test_vectors\": check HexStr(sighash) == input[\"intermediary\"][\"sigHash\"].get_str() has failed [f820312567c01b25ac539cf5b41211b0c1c6a909ca88d3eee9d40bff2f26d7b2 != bf013ea93474aa67815b1b6cc441d23b64fa310911d991e713cd34c7f5d46669]\n../../../src/test/script_tests.cpp(1689): error: in \"script_tests/bip341_keypath_test_vectors\": check HexStr(signature) == input[\"expected\"][\"witness\"][0].get_str() has failed [ecb8015cc1c011a06477057e8231bbad668df8d4b0c91e89a8abc6456c87634535238ffa9c91478ee489475fcd58ee9fbfef6cc88b3dce45b59901bfcc5982d6 != b4010dd48a617db09926f729e79c33ae0b4e94b79f04a1ae93ede6315eb3669de185a17d2b0ac9ee09fd4c64b678a0b61a0a86fa888a273c8511be83bfd6810f]\n../../../src/test/script_tests.cpp(1700): error: in \"script_tests/bip341_keypath_test_vectors\": check HexStr(sighash) == input[\"intermediary\"][\"sigHash\"].get_str() has failed [92944e08dc8418331db8fcd5bb2e3d9bd47fc9964fa645a2f5d9b63bc8b0ed49 != 4f900a0bae3f1446fd48490c2958b5a023228f01661cda3496a11da502a7f7ef]\n../../../src/test/script_tests.cpp(1689): error: in \"script_tests/bip341_keypath_test_vectors\": check HexStr(signature) == input[\"expected\"][\"witness\"][0].get_str() has failed [ab59cab477b194e0fd525ce154cb4065c68910543362741c510bc985d3181ab44da832b19d7e304633a0a1d426646e6da6858eac841c2a1f6a444c720292a26702 != a3785919a2ce3c4ce26f298c3d51619bc474ae24014bcdd31328cd8cfbab2eff3395fa0a16fe5f486d12f22a9cedded5ae74feb4bbe5351346508c5405bcfee002]\n../../../src/test/script_tests.cpp(1700): error: in \"script_tests/bip341_keypath_test_vectors\": check HexStr(sighash) == input[\"intermediary\"][\"sigHash\"].get_str() has failed [2ba8f7c285cac54d811eecdd8889cf41197fcd987a42714c85d980de6497b320 != 15f25c298eb5cdc7eb1d638dd2d45c97c4c59dcaec6679cfc16ad84f30876b85]\n../../../src/test/script_tests.cpp(1689): error: in \"script_tests/bip341_keypath_test_vectors\": check HexStr(signature) == input[\"expected\"][\"witness\"][0].get_str() has failed [2e504ddeac339bc97144f6e50906d0233ca059900764062cc762323e4417d6e7da3edfe7c3a2a200beecab40b40a3df73ed14614796ffedfc2aaceee506e618c82 != ea0c6ba90763c2d3a296ad82ba45881abb4f426b3f87af162dd24d5109edc1cdd11915095ba47c3a9963dc1e6c432939872bc49212fe34c632cd3ab9fed429c482]\n../../../src/test/script_tests.cpp(1700): error: in \"script_tests/bip341_keypath_test_vectors\": check HexStr(sighash) == input[\"intermediary\"][\"sigHash\"].get_str() has failed [e97f631b34d19a868bd624ab53a0facc7dba92492222e4b358307b7ad4a62c8f != cd292de50313804dabe4685e83f923d2969577191a3e1d2882220dca88cbeb10]\n../../../src/test/script_tests.cpp(1689): error: in \"script_tests/bip341_keypath_test_vectors\": check HexStr(signature) == input[\"expected\"][\"witness\"][0].get_str() has failed [afef7b48f4945f4df089d699cb58329e5092d2da52bb44fd007e72f14f420f4696ecdf2a740ab92d8a0339c09a4731a88ba6e2e9fbb51f1f05f95f99ba463e3b81 != bbc9584a11074e83bc8c6759ec55401f0ae7b03ef290c3139814f545b58a9f8127258000874f44bc46db7646322107d4d86aec8e73b8719a61fff761d75b5dd981]\n../../../src/test/script_tests.cpp(1700): error: in \"script_tests/bip341_keypath_test_vectors\": check HexStr(sighash) == input[\"intermediary\"][\"sigHash\"].get_str() has failed [b9fdf60d666cd26f852be0de20975d358a294de07fcc029f6bba48f389aa3b44 != cccb739eca6c13a8a89e6e5cd317ffe55669bbda23f2fd37b0f18755e008edd2]\n\n*** 14 failures are detected in the test module \"Bitcoin Core Test Suite\"\n```\n\nI think unless we can get exact reproduction steps this can probably be closed.",
          "created_at": "2025-03-19T21:32:43Z"
        },
        {
          "user": "sipa",
          "body": "@Chand-ra The taproot script unit tests are largely, and don't live in this repository. You need to clone the QA assets repository (https://github.com/bitcoin-core/qa-assets) and then specify the location of its `unit_test_data` directory in the `DIR_UNIT_TEST_DATA` environment variable when running the unit test binary.",
          "created_at": "2025-03-19T21:37:17Z"
        },
        {
          "user": "Chand-ra",
          "body": "> [@Chand-ra](https://github.com/Chand-ra) The taproot script unit tests are largely, and don't live in this repository. You need to clone the QA assets repository (https://github.com/bitcoin-core/qa-assets) and then specify the location of its `unit_test_data` directory in the `DIR_UNIT_TEST_DATA` environment variable when running the unit test binary.\n\nYou're right, cloning the qa-asserts repo and executing the following command:\n\n`$ DIR_UNIT_TEST_DATA=./qa-assets/unit_test_data ./build/bin/test_bitcoin --run_test=script_tests`\n\ndoes lead to the same errors as those mentioned by @willcl-ark and @brunoerg . \n\nThe issue can probably be closed as a false positive.",
          "created_at": "2025-03-20T13:01:20Z"
        },
        {
          "user": "maflcko",
          "body": "related to https://github.com/bitcoin/bitcoin/pull/31576 ?",
          "created_at": "2025-03-20T15:02:11Z"
        },
        {
          "user": "jirijakes",
          "body": "Thank everybody for checking.\n\nOriginally, I was running the test without `qa-assets`, only using `./build/bin/test_bitcoin --run_test=script_tests`. To my understanding, that uses only the attached `bip341_wallet_vectors.json`, which is the test vector from the BIP (it does not cover tapscript).\n\nWhat I did not verify was running with `qa-assets`. As others have reported, using `qa-assets` correctly raises errors after the modification.\n\nI believe the BIP's test vectors should also cover tapscript but that is for another discussion.\n\nThanks again and I am closing this.",
          "created_at": "2025-03-30T10:44:56Z"
        }
      ]
    }
  ],
  "summary": {
    "pull_requests": 5,
    "issues": 4
  }
}