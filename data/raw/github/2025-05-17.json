{
  "source": "github",
  "repository": "bitcoin/bitcoin",
  "fetched_at": "2026-01-15T19:43:13.665529+00:00",
  "date": "2025-05-17",
  "pull_requests": [
    {
      "number": 32545,
      "title": "Replace cluster linearization algorithm with SFL",
      "body": "Part of cluster mempool: #30289.\r\n\r\nThis replaces the cluster linearization algorithm introduced in #30126 and #30286 (a combination of LIMO with candidate-set search), with a completely different algorithm: [spanning-forest linearization](https://delvingbitcoin.org/t/spanning-forest-cluster-linearization/1419/1), which appears to have much better performance for hard clusters. See [this post](https://delvingbitcoin.org/t/how-to-linearize-your-cluster/303/68) for a comparison between various linearization algorithms, and [this post](https://delvingbitcoin.org/t/how-to-linearize-your-cluster/303/73) for benchmarks comparing them. Replaying historical mempool data on it shows that it can effectively linearize every observed cluster up to 64 transactions optimally within tens of microseconds, though pathological examples can be created which take longer.\r\n\r\nThe algorithm is effectively a very specialized version of the [simplex algorithm](https://en.wikipedia.org/wiki/Simplex_algorithm) to the problem of finding high-feerate topological subsets of clusters, but modified to find all consecutive such subsets concurrently rather than just the first one. See the post above for how it is related.\r\n\r\nIt represents the cluster as partitioned into a set of chunks, each with a spanning tree of its internal dependencies connecting the transactions. Randomized improvements are made by selecting dependencies to add and remove to these spanning trees, merging and splitting chunks, until no more improvements are possible, or a computation budget is reached. Like simplex, it does not necessarily make progress in every step, and thus has no upper bound on its runtime to find optimal, but randomization makes long runtimes very unlikely, and additionally makes it hard to adversarially construct clusters in which the algorithm reliably makes bad choices.\r\n\r\n",
      "state": "closed",
      "user": "sipa",
      "created_at": "2025-05-17T23:24:56Z",
      "updated_at": "2025-12-19T15:14:54Z",
      "comments": 44,
      "url": "https://github.com/bitcoin/bitcoin/pull/32545",
      "labels": [
        "Mempool"
      ]
    },
    {
      "number": 32544,
      "title": "scripted-diff: test: remove 'descriptors=True' argument for `createwallet` calls",
      "body": "Descriptor wallets are already created by default [since v23.0](https://github.com/bitcoin/bitcoin/blob/7710a31f0cb69a04529f39840196826d0b9770ab/doc/release-notes/release-notes-23.0.md?plain=1#L171), but since the recent legacy wallet removal the `descriptors` parameter *must* be True for the `createwallet` RPC (see commit 9f04e02ffaee0fe64027dc56c7bea3885254321a), i.e. still passing it wouldn't contain any information for test readers anymore. So simply drop them in the functional tests in order to reduce code bloat. The only exception is calls to older versions, which happens in `wallet_backwards_compatibility.py` and is explicitly excluded in the scripted diff.",
      "state": "closed",
      "user": "theStack",
      "created_at": "2025-05-17T16:37:17Z",
      "updated_at": "2025-07-31T19:15:35Z",
      "comments": 5,
      "url": "https://github.com/bitcoin/bitcoin/pull/32544",
      "labels": [
        "Refactoring",
        "CI failed"
      ],
      "comment_list": [
        {
          "user": "DrahtBot",
          "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/32544.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| ACK | [Sjors](https://github.com/bitcoin/bitcoin/pull/32544#issuecomment-2890031213), [maflcko](https://github.com/bitcoin/bitcoin/pull/32544#issuecomment-2890062931) |\n| Concept ACK | [1440000bytes](https://github.com/bitcoin/bitcoin/pull/32544#issuecomment-2888488756) |\n\nIf your review is incorrectly listed, please react with ðŸ‘Ž to this comment and the bot will ignore it on the next update.\n<!--5faf32d7da4f0f540f40219e4f7537a3-->",
          "created_at": "2025-05-17T16:37:19Z"
        },
        {
          "user": "1440000bytes",
          "body": "Concept ACK \r\n\r\nThe argument `descriptors` could also be removed from `createwallet` RPC.",
          "created_at": "2025-05-17T16:47:38Z"
        },
        {
          "user": "DrahtBot",
          "body": "<!--85328a0da195eb286784d51f73fa0af9-->\nðŸš§ At least one of the CI tasks failed.\n<sub>Task `CentOS, depends, gui`: https://github.com/bitcoin/bitcoin/runs/42411027184</sub>\n<sub>LLM reason (âœ¨ experimental): The CI failed because the `AddressBookTests::addressBookTests()` test failed, resulting in an assertion mismatch.\n</sub>\n\n<details><summary>Hints</summary>\n\nTry to run the tests locally, according to the documentation. However, a CI failure may still\nhappen due to a number of reasons, for example:\n\n* Possibly due to a silent merge conflict (the changes in this pull request being\nincompatible with the current code in the target branch). If so, make sure to rebase on the latest\ncommit of the target branch.\n\n* A sanitizer issue, which can only be found by compiling with the sanitizer and running the\n  affected test.\n\n* An intermittent issue.\n\nLeave a comment here, if you need help tracking down a confusing failure.\n\n</details>\n\n",
          "created_at": "2025-05-17T17:23:47Z"
        },
        {
          "user": "Sjors",
          "body": "ACK 86de8c1668005304b2c630ca2ad4a8ca8e348e90\r\n\r\n> The argument `descriptors` could also be removed from `createwallet` RPC.\r\n\r\nUnfortunately not, as long as we support positional arguments. We can ignore it though.",
          "created_at": "2025-05-19T08:02:35Z"
        },
        {
          "user": "maflcko",
          "body": "lgtm ACK 86de8c1668005304b2c630ca2ad4a8ca8e348e90\r\n\r\nci failure is obviously intermittent and unrelated",
          "created_at": "2025-05-19T08:13:13Z"
        }
      ]
    },
    {
      "number": 32543,
      "title": "kernel: Remove dependency on clientversion",
      "body": "Including a Bitcoin-Core specific version does not make sense if used by external applications.\r\n",
      "state": "closed",
      "user": "sedited",
      "created_at": "2025-05-17T15:46:36Z",
      "updated_at": "2025-11-24T01:27:01Z",
      "comments": 10,
      "url": "https://github.com/bitcoin/bitcoin/pull/32543",
      "labels": [
        "Validation"
      ],
      "comment_list": [
        {
          "user": "DrahtBot",
          "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/32543.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| Concept ACK | [fjahr](https://github.com/bitcoin/bitcoin/pull/32543#issuecomment-2890904040), [fanquake](https://github.com/bitcoin/bitcoin/pull/32543#issuecomment-2891088686) |\n| Stale ACK | [Sjors](https://github.com/bitcoin/bitcoin/pull/32543#issuecomment-2890264852) |\n\nIf your review is incorrectly listed, please react with ðŸ‘Ž to this comment and the bot will ignore it on the next update.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#30342](https://github.com/bitcoin/bitcoin/pull/30342) (kernel, logging: Pass Logger instances to kernel objects by ryanofsky)\n* [#30214](https://github.com/bitcoin/bitcoin/pull/30214) (refactor: Improve assumeutxo state representation by ryanofsky)\n* [#28690](https://github.com/bitcoin/bitcoin/pull/28690) (build: Introduce internal kernel library by TheCharlatan)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n<!--5faf32d7da4f0f540f40219e4f7537a3-->",
          "created_at": "2025-05-17T15:46:39Z"
        },
        {
          "user": "Sjors",
          "body": "utACK d316a75f1fb807f5384ec9d4ed0b8aad6df7ed5f\r\n\r\nThis causes the version to be missing from some of the \"Please report this issue here\" messages. But if someone is running a node, rather than some kernel based application, they can easily find its version when reporting the bug.",
          "created_at": "2025-05-19T09:16:15Z"
        },
        {
          "user": "fjahr",
          "body": "Concept ACK",
          "created_at": "2025-05-19T12:53:19Z"
        },
        {
          "user": "fanquake",
          "body": "Concept ACK",
          "created_at": "2025-05-19T13:43:05Z"
        },
        {
          "user": "sedited",
          "body": "Rebased 946d794919b640a3e5f78e853b3291f6711aa98b -> 88d8bc9a1cc0aa8177424d411fe876aaca47e466 ([kernelRmClientversion_0](https://github.com/TheCharlatan/bitcoin/tree/kernelRmClientversion_0) -> [kernelRmClientversion_1](https://github.com/TheCharlatan/bitcoin/tree/kernelRmClientversion_1), [compare](https://github.com/TheCharlatan/bitcoin/compare/kernelRmClientversion_0..kernelRmClientversion_1))\r\n\r\n* Fixed conflict with #33077",
          "created_at": "2025-08-07T20:12:57Z"
        },
        {
          "user": "sedited",
          "body": "Updated 88d8bc9a1cc0aa8177424d411fe876aaca47e466 -> 04bc2bb530f9e8cc4dd8321be5811a9760624e53 ([kernelRmClientversion_1](https://github.com/TheCharlatan/bitcoin/tree/kernelRmClientversion_1) -> [kernelRmClientversion_2](https://github.com/TheCharlatan/bitcoin/tree/kernelRmClientversion_2), [compare](https://github.com/TheCharlatan/bitcoin/compare/kernelRmClientversion_1..kernelRmClientversion_2))\r\n\r\n* Addressed @maflcko's [comment](https://github.com/bitcoin/bitcoin/pull/32543#discussion_r2095321637), consistently applying `STR_INTERNAL_BUG`.\r\n\r\nMoving this to draft, since I think @maflcko's [comment](https://github.com/bitcoin/bitcoin/pull/32543#discussion_r2096016006) should be addressed properly.",
          "created_at": "2025-08-07T20:20:21Z"
        },
        {
          "user": "hodlinator",
          "body": "How about having an externally defined software/package name+version string as an input to kernel that can still be defined by Bitcoin Core to get the same behavior as on master? It could default to empty or be a requirement for users of kernel.\r\n\r\nThen again, I agree with https://github.com/bitcoin/bitcoin/pull/32543#discussion_r2096016006 that having at least the commit hash would be okay.",
          "created_at": "2025-11-06T09:51:59Z"
        },
        {
          "user": "sedited",
          "body": "> How about having an externally defined software/package name+version string as an input to kernel that can still be defined by Bitcoin Core to get the same behavior as on master\r\n\r\nI recently discussed retaining the version information as a \"product name\" and then having separate versioning for the bitcoin kernel header. Not sure yet about that approach though.  Including just the commit hash sounds like a reasonable trade off.",
          "created_at": "2025-11-06T10:05:56Z"
        },
        {
          "user": "sedited",
          "body": "Closing this. Will pick it up again as part of a larger directional push to handle versioning in the kernel.",
          "created_at": "2025-11-13T14:31:16Z"
        },
        {
          "user": "Sakzz1994",
          "body": " ðŸ‘Ž",
          "created_at": "2025-11-24T01:08:08Z"
        }
      ]
    },
    {
      "number": 32541,
      "title": "index: store per-block transaction locations for efficient lookups",
      "body": "Currently, electrs and other indexers map between an address/scripthash to the list of the relevant transactions.\r\n\r\nHowever, in order to fetch those transactions from bitcoind, electrs relies on reading the whole block and post-filtering for a specific transaction[^1]. Other indexers use a `txindex` to fetch a transaction using its txid [^2][^3][^4].\r\n\r\nThe above approach has significant storage and CPU overhead, since the `txid` is a pseudo-random 32-byte value.\r\n\r\nThis PR is adding support for using the transaction's position within its block to be able to fetch it directly using [REST API](https://github.com/bitcoin/bitcoin/blob/master/doc/REST-interface.md), using the following HTTP request (to fetch the `N`-th transaction from `BLOCKHASH`):\r\n\r\n```\r\nGET /rest/txfromblock/BLOCKHASH-N.bin\r\n```\r\n\r\nIf binary response format is used, the transaction data will be read directly from the storage and sent back to the client, without any deserialization overhead.\r\n\r\nThe resulting index is much smaller (allowing it to be cached in RAM):\r\n```\r\n$ du -sh indexes/locations/ indexes/txindex/\r\n2.5G\tindexes/locations/\r\n57G\tindexes/txindex/\r\n```\r\n\r\nThe new index is using the following DB schema:\r\n\r\n```c++\r\nstruct DBKey {\r\n    uint256 hash;   // blockhash\r\n    uint32_t row;   // allow splitting one block's transactions into multiple DB rows\r\n};\r\n\r\nstruct DBValue {\r\n    FlatFilePos block_pos;          // file id + offset of the block\r\n    std::vector<uint32_t> offsets;  // a list of transaction offsets within the block\r\n};\r\n```\r\n\r\nFor example, when fetching the 5000th transaction of [block #90005](https://mempool.space/block/000000000000000000017bfd05b5fa367a424c4a565a4baf7950d9e8605df8ec) using `ab -k -c 1 -n 100000`, enabled `locationsindex` improves the performance [~19x (2.574ms â†’ 0.136ms)](https://github.com/bitcoin/bitcoin/pull/32541#issuecomment-3250323045). \r\n\r\nI am working on a proof-of-concept indexer (https://github.com/romanz/bindex-rs) which is using https://github.com/bitcoin/bitcoin/pull/32540 & https://github.com/bitcoin/bitcoin/pull/32541 - please let me know if there are any questions/comments/concerns :)\r\n\r\n[^1]: https://github.com/romanz/electrs/blob/master/doc/schema.md\r\n[^2]: https://github.com/Blockstream/electrs/blob/new-index/doc/schema.md#txstore\r\n[^3]: https://github.com/spesmilo/electrumx/blob/master/docs/HOWTO.rst#prerequisites\r\n[^4]: https://github.com/cculianu/Fulcrum/blob/master/README.md#requirements\r\n\r\n",
      "state": "closed",
      "user": "romanz",
      "created_at": "2025-05-17T07:27:58Z",
      "updated_at": "2025-10-19T14:57:49Z",
      "comments": 39,
      "url": "https://github.com/bitcoin/bitcoin/pull/32541",
      "labels": [
        "UTXO Db and Indexes",
        "Needs rebase"
      ]
    },
    {
      "number": 32540,
      "title": "rest: fetch spent transaction outputs by blockhash",
      "body": "Today, it is possible to fetch a block's spent prevouts in order to build an external index by using the `/rest/block/BLOCKHASH.json` endpoint. However, its performance is low due to JSON serialization overhead.\r\n\r\nWe can significantly optimize it by adding a new [REST API](https://github.com/bitcoin/bitcoin/blob/master/doc/REST-interface.md) endpoint, using a binary response format (returning a collection of spent txout lists, one per each block transaction):\r\n\r\n```\r\n$ BLOCKHASH=00000000000000000002a7c4c1e48d76c5a37902165a270156b7a8d72728a054\r\n\r\n$ ab -k -c 1 -n 100 http://localhost:8332/rest/block/$BLOCKHASH.json\r\nDocument Length:        13278152 bytes\r\nRequests per second:    3.53 [#/sec] (mean)\r\nTime per request:       283.569 [ms] (mean)\r\n\r\n$ ab -k -c 1 -n 10000 http://localhost:8332/rest/spenttxouts/$BLOCKHASH.bin\r\nDocument Length:        195591 bytes\r\nRequests per second:    254.47 [#/sec] (mean)\r\nTime per request:       3.930 [ms] (mean)\r\n```\r\n\r\nCurrently, this PR is being used and tested by Bindex[^1].\r\n\r\nThis PR would allow to improve the performance of external indexers such as electrs[^2], ElectrumX[^3], Fulcrum[^4] and Blockbook[^5].\r\n\r\n[^1]: https://github.com/romanz/bindex-rs\r\n[^2]: https://github.com/romanz/electrs (also [blockstream.info](https://github.com/Blockstream/electrs) and [mempool.space](https://github.com/mempool/electrs) forks)\r\n[^3]: https://github.com/spesmilo/electrumx\r\n[^4]: https://github.com/cculianu/Fulcrum\r\n[^5]: https://github.com/trezor/blockbook\r\n",
      "state": "closed",
      "user": "romanz",
      "created_at": "2025-05-17T07:27:02Z",
      "updated_at": "2025-06-30T13:12:46Z",
      "comments": 15,
      "url": "https://github.com/bitcoin/bitcoin/pull/32540",
      "labels": [
        "RPC/REST/ZMQ"
      ],
      "comment_list": [
        {
          "user": "DrahtBot",
          "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/32540.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| ACK | [maflcko](https://github.com/bitcoin/bitcoin/pull/32540#issuecomment-2975395180), [TheCharlatan](https://github.com/bitcoin/bitcoin/pull/32540#pullrequestreview-2930966893), [achow101](https://github.com/bitcoin/bitcoin/pull/32540#pullrequestreview-2968023538) |\n| Concept ACK | [adyshimony](https://github.com/bitcoin/bitcoin/pull/32540#issuecomment-2899720171) |\n| Stale ACK | [tapcrafter](https://github.com/bitcoin/bitcoin/pull/32540#pullrequestreview-2848945630) |\n\nIf your review is incorrectly listed, please react with ðŸ‘Ž to this comment and the bot will ignore it on the next update.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nNo conflicts as of last run.\n<!--5faf32d7da4f0f540f40219e4f7537a3-->",
          "created_at": "2025-05-17T07:27:05Z"
        },
        {
          "user": "romanz",
          "body": "Force-pushed to fix a typo in commit description.",
          "created_at": "2025-05-17T15:47:34Z"
        },
        {
          "user": "yancyribbens",
          "body": "Nice.  I wonder about just adding a content-type like option so that the api endpoint is the same but you simply say if you want binary or json content returned?  Maybe there's other endpoints that it could then be applied to as well..",
          "created_at": "2025-05-17T18:42:59Z"
        },
        {
          "user": "romanz",
          "body": "> Nice. \r\n\r\nThanks :)\r\n\r\n> I wonder about just adding a content-type like option so that the api endpoint is the same but you simply say if you want binary or json content returned? Maybe there's other endpoints that it could then be applied to as well.\r\n\r\nGood idea - would it be OK to implement it in a separate PR?\r\n\r\n",
          "created_at": "2025-05-18T09:06:34Z"
        },
        {
          "user": "yancyribbens",
          "body": "> Good idea - would it be OK to implement it in a separate PR?\r\n\r\nSure, as you wish.  I'm no authority :)",
          "created_at": "2025-05-18T13:50:00Z"
        },
        {
          "user": "adyshimony",
          "body": "tACK \r\n\r\nhttps://github.com/romanz/bitcoin/commit/8cb0465defdf96a86b7485ff098d2ba70843e942\r\n\r\n\r\n\r\n\r\n\r\n<details><summary>Test</summary>\r\n<p>\r\n\r\n\r\n```\r\n$ ab -k -c 1 -n 100 http://localhost:8332/rest/spenttxouts/00000000000000000002a7c4c1e48d76c5a37902165a270156b7a8d72728a054.bin\r\nThis is ApacheBench, Version 2.3 <$Revision: 1903618 $>\r\nCopyright 1996 Adam Twiss, Zeus Technology Ltd, http://www.zeustech.net/\r\nLicensed to The Apache Software Foundation, http://www.apache.org/\r\n\r\nBenchmarking localhost (be patient).....done\r\n\r\n\r\nServer Software:        \r\nServer Hostname:        localhost\r\nServer Port:            8332\r\n\r\nDocument Path:          /rest/spenttxouts/00000000000000000002a7c4c1e48d76c5a37902165a270156b7a8d72728a054.bin\r\nDocument Length:        195591 bytes\r\n\r\nConcurrency Level:      1\r\nTime taken for tests:   0.444 seconds\r\nComplete requests:      100\r\nFailed requests:        0\r\nKeep-Alive requests:    100\r\nTotal transferred:      19569800 bytes\r\nHTML transferred:       19559100 bytes\r\nRequests per second:    225.09 [#/sec] (mean)\r\nTime per request:       4.443 [ms] (mean)\r\nTime per request:       4.443 [ms] (mean, across all concurrent requests)\r\nTransfer rate:          43016.55 [Kbytes/sec] received\r\n\r\nConnection Times (ms)\r\n              min  mean[+/-sd] median   max\r\nConnect:        0    0   0.0      0       0\r\nProcessing:     3    4   1.3      4       7\r\nWaiting:        3    4   1.3      4       7\r\nTotal:          3    4   1.3      4       7\r\n\r\nPercentage of the requests served within a certain time (ms)\r\n  50%      4\r\n  66%      5\r\n  75%      6\r\n  80%      6\r\n  90%      7\r\n  95%      7\r\n  98%      7\r\n  99%      7\r\n 100%      7 (longest request)\r\n\r\n\r\n\r\n\r\n\r\n\r\n```\r\n\r\n\r\nOn my machine there is a significant improvement , well done.\r\n\r\n```\r\n$ ab -k -c 1 -n 100 http://localhost:8332/rest/block/00000000000000000002a7c4c1e48d76c5a37902165a270156b7a8d72728a054.json\r\nThis is ApacheBench, Version 2.3 <$Revision: 1903618 $>\r\nCopyright 1996 Adam Twiss, Zeus Technology Ltd, http://www.zeustech.net/\r\nLicensed to The Apache Software Foundation, http://www.apache.org/\r\n\r\nBenchmarking localhost (be patient).....done\r\n\r\n\r\nServer Software:        \r\nServer Hostname:        localhost\r\nServer Port:            8332\r\n\r\nDocument Path:          /rest/block/00000000000000000002a7c4c1e48d76c5a37902165a270156b7a8d72728a054.json\r\nDocument Length:        13278152 bytes\r\n\r\nConcurrency Level:      1\r\nTime taken for tests:   33.053 seconds\r\nComplete requests:      100\r\nFailed requests:        0\r\nKeep-Alive requests:    100\r\nTotal transferred:      1327825300 bytes\r\nHTML transferred:       1327815200 bytes\r\nRequests per second:    3.03 [#/sec] (mean)\r\nTime per request:       330.530 [ms] (mean)\r\nTime per request:       330.530 [ms] (mean, across all concurrent requests)\r\nTransfer rate:          39231.07 [Kbytes/sec] received\r\n\r\nConnection Times (ms)\r\n              min  mean[+/-sd] median   max\r\nConnect:        0    0   0.0      0       0\r\nProcessing:   308  331  17.5    327     396\r\nWaiting:      297  315  16.7    310     386\r\nTotal:        308  331  17.5    327     396\r\n\r\nPercentage of the requests served within a certain time (ms)\r\n  50%    327\r\n  66%    334\r\n  75%    337\r\n  80%    339\r\n  90%    345\r\n  95%    377\r\n  98%    396\r\n  99%    396\r\n 100%    396 (longest request)\r\n\r\n\r\n```\r\n\r\n\r\n</p>\r\n</details> ",
          "created_at": "2025-05-22T02:26:30Z"
        },
        {
          "user": "romanz",
          "body": "> Not sure we should export a custom binary format for undo data like this.\r\n\r\nIn my opinion, using a binary format allows us to achieve significantly better performance when building [an external index](https://bit.ly/bindex-slides) (compared to using `/rest/block/HASH.json`). \r\n\r\nI have followed the example of the `/rest/getutxos/` endpoint, which also uses binary encoding when it returns a `std::vector<CCoin> outs`:\r\nhttps://github.com/bitcoin/bitcoin/blob/d2c9fc84e17120f186a54ef92bab76ea7e8d31b5/src/rest.cpp#L906\r\n\r\n\r\n\r\n",
          "created_at": "2025-05-22T15:58:42Z"
        },
        {
          "user": "romanz",
          "body": "> At least there should be a JSON option?\r\n\r\nSounds good, added in https://github.com/bitcoin/bitcoin/pull/32540/commits/9d7e23e2f505ce6cbe830fc607cf203b1a48ba0d:\r\n\r\nTested with:\r\n```sh\r\ncurl -s http://localhost:8332/rest/spenttxouts/00000000000034a32d25a4df37018194645cd62bf311b04ce322da9d800d4576.json | jq .\r\n```\r\n```json\r\n[\r\n  [],\r\n  [\r\n    {\r\n      \"value\": 19.9,\r\n      \"scriptPubKey\": {\r\n        \"asm\": \"OP_DUP OP_HASH160 9f1c396fc47b5e8127d8fca2cbe0da12fb65b18b OP_EQUALVERIFY OP_CHECKSIG\",\r\n        \"desc\": \"addr(1FWJFZiX8v1y6Mf14bzT2qTjzKgJ948gTN)#n6pdnxnu\",\r\n        \"hex\": \"76a9149f1c396fc47b5e8127d8fca2cbe0da12fb65b18b88ac\",\r\n        \"address\": \"1FWJFZiX8v1y6Mf14bzT2qTjzKgJ948gTN\",\r\n        \"type\": \"pubkeyhash\"\r\n      }\r\n    }\r\n  ],\r\n  [\r\n    {\r\n      \"value\": 1.13,\r\n      \"scriptPubKey\": {\r\n        \"asm\": \"OP_DUP OP_HASH160 63ecfce5e3b086c6b4c9a8f68b64c70eaf4f579e OP_EQUALVERIFY OP_CHECKSIG\",\r\n        \"desc\": \"addr(1A7MoCV1q8L6K2k6sJLnPFDJSR3kmiyubF)#k7amcrpk\",\r\n        \"hex\": \"76a91463ecfce5e3b086c6b4c9a8f68b64c70eaf4f579e88ac\",\r\n        \"address\": \"1A7MoCV1q8L6K2k6sJLnPFDJSR3kmiyubF\",\r\n        \"type\": \"pubkeyhash\"\r\n      }\r\n    }\r\n  ],\r\n  [\r\n    {\r\n      \"value\": 0.129,\r\n      \"scriptPubKey\": {\r\n        \"asm\": \"OP_DUP OP_HASH160 7c78cf144b8bf68372403cf5690aa49560275423 OP_EQUALVERIFY OP_CHECKSIG\",\r\n        \"desc\": \"addr(1CM9WjjPScLSfQaYXq9YY5VgqUh6bP87rw)#nrcg7jla\",\r\n        \"hex\": \"76a9147c78cf144b8bf68372403cf5690aa4956027542388ac\",\r\n        \"address\": \"1CM9WjjPScLSfQaYXq9YY5VgqUh6bP87rw\",\r\n        \"type\": \"pubkeyhash\"\r\n      }\r\n    }\r\n  ]\r\n]\r\n```\r\n",
          "created_at": "2025-05-22T15:58:48Z"
        },
        {
          "user": "yancyribbens",
          "body": "> would it be OK to implement it in a separate PR?\r\n\r\n\r\nI was thinking it might be not ideal to have this endpoint in addition to adding a content-type.  Unless the plan is to deprecate this after content type is added?  Maybe that's what is meant by the two conflicting types mentioned https://github.com/bitcoin/bitcoin/issues/32583#issuecomment-2901076206",
          "created_at": "2025-05-24T13:10:34Z"
        },
        {
          "user": "yancyribbens",
          "body": "> I was thinking it might be not ideal to have this endpoint in addition to adding a content-type. Unless the plan is to deprecate this after content type is added? Maybe that's what is meant by the two conflicting types mentioned https://github.com/bitcoin/bitcoin/issues/32583#issuecomment-2901076206\r\n\r\nPlease disregard",
          "created_at": "2025-05-24T14:12:41Z"
        },
        {
          "user": "maflcko",
          "body": "review ACK 1e2b26e4f8498a08072104b12759d91ef8b410db ðŸ‘¤\r\n\r\n<details><summary>Show signature</summary>\r\n\r\nSignature:\r\n\r\n```\r\nuntrusted comment: signature from minisign secret key on empty file; verify via: minisign -Vm \"${path_to_any_empty_file}\" -P RWTRmVTMeKV5noAMqVlsMugDDCyyTSbA3Re5AkUrhvLVln0tSaFWglOw -x \"${path_to_this_whole_four_line_signature_blob}\"\r\nRUTRmVTMeKV5npGrKx1nqXCw5zeVHdtdYURB/KlyA/LMFgpNCs+SkW9a8N95d+U4AP1RJMi+krxU1A3Yux4bpwZNLvVBKy0wLgM=\r\ntrusted comment: review ACK 1e2b26e4f8498a08072104b12759d91ef8b410db ðŸ‘¤\r\numcSMyJu+op/g4YObmcufkFh2Q/WLwQJSqCZJWjqXxYHLJJ8sJUi5i8pxOkmKaAisZihoMJKWGgqClMx/SwBCg==\r\n```\r\n\r\n</details>\r\n",
          "created_at": "2025-05-26T07:00:21Z"
        },
        {
          "user": "maflcko",
          "body": "Only change since my previous review is removing the cast.\r\n\r\nre-ACK d4e212e8a69ea118acb6caa1a7efe64a77bdfdd2 ðŸš˜\r\n\r\n<details><summary>Show signature</summary>\r\n\r\nSignature:\r\n\r\n```\r\nuntrusted comment: signature from minisign secret key on empty file; verify via: minisign -Vm \"${path_to_any_empty_file}\" -P RWTRmVTMeKV5noAMqVlsMugDDCyyTSbA3Re5AkUrhvLVln0tSaFWglOw -x \"${path_to_this_whole_four_line_signature_blob}\"\r\nRUTRmVTMeKV5npGrKx1nqXCw5zeVHdtdYURB/KlyA/LMFgpNCs+SkW9a8N95d+U4AP1RJMi+krxU1A3Yux4bpwZNLvVBKy0wLgM=\r\ntrusted comment: re-ACK d4e212e8a69ea118acb6caa1a7efe64a77bdfdd2 ðŸš˜\r\nVxfR7wSBgPaQX1vc+ro41f4+N2bwayfQpgVJ9S5SISkZPNToHtNZY3B+nnVzO87DK6EV+ID3Kdx4kTA7FdM2DA==\r\n```\r\n\r\n</details>\r\n",
          "created_at": "2025-06-09T14:17:07Z"
        },
        {
          "user": "romanz",
          "body": "Many thanks!\r\nAdded a release note in https://github.com/bitcoin/bitcoin/pull/32540/commits/c48846ec4169f749d28da05de849c43a488c3a70 - please let me know if it's OK :)",
          "created_at": "2025-06-15T18:21:13Z"
        },
        {
          "user": "maflcko",
          "body": "re-ACK c48846ec4169f749d28da05de849c43a488c3a70 ðŸ“¶\r\n\r\n<details><summary>Show signature</summary>\r\n\r\nSignature:\r\n\r\n```\r\nuntrusted comment: signature from minisign secret key on empty file; verify via: minisign -Vm \"${path_to_any_empty_file}\" -P RWTRmVTMeKV5noAMqVlsMugDDCyyTSbA3Re5AkUrhvLVln0tSaFWglOw -x \"${path_to_this_whole_four_line_signature_blob}\"\r\nRUTRmVTMeKV5npGrKx1nqXCw5zeVHdtdYURB/KlyA/LMFgpNCs+SkW9a8N95d+U4AP1RJMi+krxU1A3Yux4bpwZNLvVBKy0wLgM=\r\ntrusted comment: re-ACK c48846ec4169f749d28da05de849c43a488c3a70 ðŸ“¶\r\nuGe86fOs2dFzU1UXO6ZFgLrq+AbqZ4rMcAlNYGwHYl6XqYjtam3F0q+pLXgYCFaqe9RI9XDXx/yPlH7m7HZXCA==\r\n```\r\n\r\n</details>\r\n",
          "created_at": "2025-06-16T07:26:03Z"
        },
        {
          "user": "romanz",
          "body": "Many thanks!",
          "created_at": "2025-06-28T06:18:00Z"
        }
      ]
    }
  ],
  "issues": [
    {
      "number": 32542,
      "title": "test: Running thread * was not suspended. False leaks are possible.",
      "body": "Related to the discussion in #32538. Our `test_bitcoin` binary will output this warning when compiled with `address` sanitzer:\n```bash\n# clang version 20.1.3 (Fedora 20.1.3-1.fc43)\ncmake -B build -DCMAKE_C_COMPILER=clang -DCMAKE_CXX_COMPILER=clang++ -DSANITIZERS=address\ncmake --build build\n./build/bin/test_bitcoin \nRunning 655 test cases...\n==72451==Running thread 72090 was not suspended. False leaks are possible.\n\n*** No errors detected\n```\n\nHowever I couldn't get`ctest` to output the same warning. i.e running:\n```bash\nctest --test-dir build -j20 --extra-verbose --debug | grep \"False leaks\"\n```\n\ndoes not produce the same warning.\n\nIf sanitizers are producing warnings, that output should be emitted, if not cause a test failure (if unsuppressed).\nI'd also think that running `ctest` vs running `test_bitcoin` directly, should generally result in the same output, otherwise if sanitizers are producing warnings, or other relevant output, that is currently being \"hidden\" by `ctest`.",
      "state": "open",
      "user": "fanquake",
      "created_at": "2025-05-17T10:19:54Z",
      "updated_at": "2025-05-17T12:53:42Z",
      "comments": 2,
      "url": "https://github.com/bitcoin/bitcoin/issues/32542",
      "labels": [
        "Tests"
      ],
      "comment_list": [
        {
          "user": "hebasto",
          "body": "> ... I'd also think that running `ctest` vs running `test_bitcoin` directly, should generally result in the same output, otherwise if sanitizers are producing warnings, or other relevant output, that is currently being \"hidden\" by `ctest`.\n\ncc @purpleKarrot ",
          "created_at": "2025-05-17T10:53:53Z"
        },
        {
          "user": "purpleKarrot",
          "body": "CTest is instructed to pass some arguments to `test_bitcoin`: https://github.com/bitcoin/bitcoin/blob/7710a31f0cb69a04529f39840196826d0b9770ab/src/test/CMakeLists.txt#L193-L195\n\nMaybe that is the reason? That being said, CTest has builtin support for memory checking using sanitizers.",
          "created_at": "2025-05-17T12:53:40Z"
        }
      ]
    }
  ],
  "summary": {
    "pull_requests": 5,
    "issues": 1
  }
}