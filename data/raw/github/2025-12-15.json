{
  "source": "github",
  "repository": "bitcoin/bitcoin",
  "fetched_at": "2026-01-15T20:39:54.529612+00:00",
  "date": "2025-12-15",
  "pull_requests": [
    {
      "number": 34079,
      "title": "kernel: Remove non-kernel module includes",
      "body": "Found these while attempting to isolate the kernel library sources into their own repository. There still is no mechanism for preventing including headers into the kernel library that don't belong to kernel modules, but it is also fairly straight forward to correct manually for now. However, the changes here might be incomplete.",
      "state": "closed",
      "user": "sedited",
      "created_at": "2025-12-15T21:30:55Z",
      "updated_at": "2026-01-15T14:32:17Z",
      "comments": 11,
      "url": "https://github.com/bitcoin/bitcoin/pull/34079",
      "labels": [
        "Validation"
      ],
      "comment_list": [
        {
          "user": "DrahtBot",
          "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/34079.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| ACK | [hebasto](https://github.com/bitcoin/bitcoin/pull/34079#pullrequestreview-3601679761), [maflcko](https://github.com/bitcoin/bitcoin/pull/34079#pullrequestreview-3603291664), [janb84](https://github.com/bitcoin/bitcoin/pull/34079#pullrequestreview-3604016224) |\n| Stale ACK | [musaHaruna](https://github.com/bitcoin/bitcoin/pull/34079#pullrequestreview-3583494177) |\n\nIf your review is incorrectly listed, please copy-paste <code>&lt;!--meta-tag:bot-skip--&gt;</code> into the comment that the bot should ignore.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#33779](https://github.com/bitcoin/bitcoin/pull/33779) (ci, iwyu: Fix warnings in `src/kernel` and treat them as errors by hebasto)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n<!--5faf32d7da4f0f540f40219e4f7537a3-->",
          "created_at": "2025-12-15T21:31:02Z"
        },
        {
          "user": "DrahtBot",
          "body": "<!--85328a0da195eb286784d51f73fa0af9-->\nðŸš§ At least one of the CI tasks failed.\n<sub>Task `tidy`: https://github.com/bitcoin/bitcoin/actions/runs/20248118058/job/58133590667</sub>\n<sub>LLM reason (âœ¨ experimental): IWYU check failed (include/dependency issues detected) causing the CI to fail.</sub>\n\n<details><summary>Hints</summary>\n\nTry to run the tests locally, according to the documentation. However, a CI failure may still\nhappen due to a number of reasons, for example:\n\n* Possibly due to a silent merge conflict (the changes in this pull request being\nincompatible with the current code in the target branch). If so, make sure to rebase on the latest\ncommit of the target branch.\n\n* A sanitizer issue, which can only be found by compiling with the sanitizer and running the\n  affected test.\n\n* An intermittent issue.\n\nLeave a comment here, if you need help tracking down a confusing failure.\n\n</details>\n\n",
          "created_at": "2025-12-15T22:09:09Z"
        },
        {
          "user": "hebasto",
          "body": "Concept ACK.",
          "created_at": "2025-12-15T22:42:31Z"
        },
        {
          "user": "hebasto",
          "body": "@sedited \r\n\r\nCould you please elaborate on the motivation for the last commit? Is it intended to avoid `#include <interfaces/...>` in kernel sources?",
          "created_at": "2025-12-16T11:36:43Z"
        },
        {
          "user": "sedited",
          "body": "> Could you please elaborate on the motivation for the last commit? Is it intended to avoid #include <interfaces/...> in kernel sources?\r\n\r\nYes, interfaces in turn include a bunch of stuff that should not belong in the library. I elaborated a bit in the commit message.",
          "created_at": "2025-12-16T11:48:23Z"
        },
        {
          "user": "sedited",
          "body": "Rebased 0f757542416b75690c68145964b9094a558f4d38 -> 065639200505035428df01584ff43172c4b2dd90 ([kernelPruneHeaders_0](https://github.com/TheCharlatan/bitcoin/tree/kernelPruneHeaders_0) -> [kernelPruneHeaders_1](https://github.com/TheCharlatan/bitcoin/tree/kernelPruneHeaders_1), [compare](https://github.com/TheCharlatan/bitcoin/compare/kernelPruneHeaders_0..kernelPruneHeaders_1))\r\n\r\n* Fixed conflict with #30214",
          "created_at": "2025-12-16T16:36:06Z"
        },
        {
          "user": "sedited",
          "body": "Updated 065639200505035428df01584ff43172c4b2dd90 -> 26c475c08e350ba383cea3e8da9cc1191b24fc11 ([kernelPruneHeaders_1](https://github.com/TheCharlatan/bitcoin/tree/kernelPruneHeaders_1) -> [kernelPruneHeaders_2](https://github.com/TheCharlatan/bitcoin/tree/kernelPruneHeaders_2), [compare](https://github.com/TheCharlatan/bitcoin/compare/kernelPruneHeaders_1..kernelPruneHeaders_2))\r\n\r\n* Addressed @janb84's [comment_1](https://github.com/bitcoin/bitcoin/pull/34079#discussion_r2626416456), [comment_2](https://github.com/bitcoin/bitcoin/pull/34079#discussion_r2628339958), expanding the include changes with complete iwyu suggestions.",
          "created_at": "2025-12-19T20:25:35Z"
        },
        {
          "user": "sedited",
          "body": "Re https://github.com/bitcoin/bitcoin/pull/34079#pullrequestreview-3601031588\r\n\r\n> In that case, we could enforce IWYU checks on the touched files:\r\n\r\nSome of them contain broken suggestions. I.e. applying all of core_read's suggestions:\r\n```\r\n2025-12-19T20:41:14.3277108Z /home/admin/actions-runner/_work/_temp/src/core_read.cpp should add these lines:\r\n2025-12-19T20:41:14.3277343Z class CBlock;\r\n2025-12-19T20:41:14.3277458Z class CBlockHeader;\r\n2025-12-19T20:41:14.3277529Z \r\n2025-12-19T20:41:14.3277667Z /home/admin/actions-runner/_work/_temp/src/core_read.cpp should remove these lines:\r\n2025-12-19T20:41:14.3277902Z - #include <primitives/block.h>  // lines 7-7\r\n```\r\nWill lead to a compilation error.\r\n\r\n",
          "created_at": "2025-12-20T11:35:32Z"
        },
        {
          "user": "hebasto",
          "body": "> Re [#34079 (review)](https://github.com/bitcoin/bitcoin/pull/34079#pullrequestreview-3601031588)\r\n> \r\n> > In that case, we could enforce IWYU checks on the touched files:\r\n> \r\n> Some of them contain broken suggestions. I.e. applying all of core_read's suggestions:\r\n> \r\n> ```\r\n> 2025-12-19T20:41:14.3277108Z /home/admin/actions-runner/_work/_temp/src/core_read.cpp should add these lines:\r\n> 2025-12-19T20:41:14.3277343Z class CBlock;\r\n> 2025-12-19T20:41:14.3277458Z class CBlockHeader;\r\n> 2025-12-19T20:41:14.3277529Z \r\n> 2025-12-19T20:41:14.3277667Z /home/admin/actions-runner/_work/_temp/src/core_read.cpp should remove these lines:\r\n> 2025-12-19T20:41:14.3277902Z - #include <primitives/block.h>  // lines 7-7\r\n> ```\r\n> \r\n> Will lead to a compilation error.\r\n\r\nSounds like an IWYU bug. [This](https://github.com/hebasto/bitcoin/commits/pr34079/1220.alt/) branch contains `IWYU pragma: keep` to workaround it.",
          "created_at": "2025-12-20T16:36:09Z"
        },
        {
          "user": "sedited",
          "body": "Updated 26c475c08e350ba383cea3e8da9cc1191b24fc11 -> fb4e9cc3f20ebf80249ac879fa9d71e526e7c4cc ([kernelPruneHeaders_2](https://github.com/TheCharlatan/bitcoin/tree/kernelPruneHeaders_2) -> [kernelPruneHeaders_3](https://github.com/TheCharlatan/bitcoin/tree/kernelPruneHeaders_3), [compare](https://github.com/TheCharlatan/bitcoin/compare/kernelPruneHeaders_2..kernelPruneHeaders_3))\r\n\r\n* Addressed @hebasto's [comment](https://github.com/bitcoin/bitcoin/pull/34079#pullrequestreview-3601031588), added touched files to the iwyu enforcement list and clean up both headers and implementation for each module.\r\n* Addressed @hebasto's [comment](https://github.com/bitcoin/bitcoin/pull/34079#discussion_r2637033403), fixed formatting in the include list.",
          "created_at": "2025-12-20T21:08:53Z"
        },
        {
          "user": "sedited",
          "body": "Updated fb4e9cc3f20ebf80249ac879fa9d71e526e7c4cc -> d3a479cb077d9a9a4451dc4ecb43fe0daf94f172 ([kernelPruneHeaders_3](https://github.com/TheCharlatan/bitcoin/tree/kernelPruneHeaders_3) -> [kernelPruneHeaders_4](https://github.com/TheCharlatan/bitcoin/tree/kernelPruneHeaders_4), [compare](https://github.com/TheCharlatan/bitcoin/compare/kernelPruneHeaders_3..kernelPruneHeaders_4))\r\n\r\n* Ran clang-format-diff as requested by @hebasto.",
          "created_at": "2025-12-21T09:26:12Z"
        }
      ]
    },
    {
      "number": 34077,
      "title": "refactor: Use an enum for `Autofile::seek` wrapper",
      "body": "The `int origin` argument of the `seek` method has no meaning to those without domain specific knowledge as to how `FILE` works. The only way for a caller to understand what this is doing is to enter the method body. This enum makes it clear as to what the `origin` argument represents at the expense of the Unix-specific options, which were unused anyway.",
      "state": "open",
      "user": "rustaceanrob",
      "created_at": "2025-12-15T12:26:08Z",
      "updated_at": "2025-12-29T11:15:37Z",
      "comments": 5,
      "url": "https://github.com/bitcoin/bitcoin/pull/34077",
      "labels": [
        "Refactoring"
      ],
      "comment_list": [
        {
          "user": "DrahtBot",
          "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/34077.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| Concept NACK | [sedited](https://github.com/bitcoin/bitcoin/pull/34077#issuecomment-3655921671) |\n| Concept ACK | [l0rinc](https://github.com/bitcoin/bitcoin/pull/34077#issuecomment-3656911176) |\n\nIf your review is incorrectly listed, please copy-paste <code>&lt;!--meta-tag:bot-skip--&gt;</code> into the comment that the bot should ignore.\n<!--5faf32d7da4f0f540f40219e4f7537a3-->",
          "created_at": "2025-12-15T12:26:16Z"
        },
        {
          "user": "DrahtBot",
          "body": "<!--85328a0da195eb286784d51f73fa0af9-->\nðŸš§ At least one of the CI tasks failed.\n<sub>Task `Windows-cross to x86_64, ucrt`: https://github.com/bitcoin/bitcoin/actions/runs/20232125325/job/58077489869</sub>\n<sub>LLM reason (âœ¨ experimental): C++ compile error: invalid conversion from int to SeekFrom in streams_findbyte.cpp causing bench_bitcoin build failure.</sub>\n\n<details><summary>Hints</summary>\n\nTry to run the tests locally, according to the documentation. However, a CI failure may still\nhappen due to a number of reasons, for example:\n\n* Possibly due to a silent merge conflict (the changes in this pull request being\nincompatible with the current code in the target branch). If so, make sure to rebase on the latest\ncommit of the target branch.\n\n* A sanitizer issue, which can only be found by compiling with the sanitizer and running the\n  affected test.\n\n* An intermittent issue.\n\nLeave a comment here, if you need help tracking down a confusing failure.\n\n</details>\n\n",
          "created_at": "2025-12-15T12:45:53Z"
        },
        {
          "user": "sedited",
          "body": "Tending towards Concept NACK as it is right now. I think it is fine to leak those types to the developer. The developer is already required to learn about FILE-specific error codes (e.g. for fclose), and internal behaviour of member functions such as truncate and commit. The docstring also states that it is just a wrapper around fseek.",
          "created_at": "2025-12-15T14:25:23Z"
        },
        {
          "user": "l0rinc",
          "body": "I tend towards a Concept ACK, I don't like it when we're leaking abstractions. Saying that most of us are already familiar with obfuscated code isn't a good reason in my opinion to keep - especially since the enum kept the original names, just made the inputs bounded - which is a big win already.",
          "created_at": "2025-12-15T17:57:41Z"
        },
        {
          "user": "rustaceanrob",
          "body": "Would there be use in a broader refactor of this type to use `util::Result` and specify an enum for `fclose` as well?",
          "created_at": "2025-12-29T11:15:37Z"
        }
      ]
    },
    {
      "number": 34075,
      "title": "fees: Introduce Mempool Based Fee Estimation to reduce overestimation",
      "body": "This PR is another attempt to fix #27995 using a better approach.\r\n\r\nFor background and motivation, see #27995 and the discussion in the Delving Bitcoin post [Mempool Based Fee Estimation on Bitcoin Core](https://delvingbitcoin.org/t/mempool-based-fee-estimation-on-bitcoin-core/703)\r\nThis PR is currently limited to using the mempool only to lower what is recommended by the Block Policy Estimator.\r\nAccurate and safe fee estimation using the mempool is challenging. There are open questions about how to prevent mempool games that are theoretically possible for miners [(a variant of the Finney attack)](https://delvingbitcoin.org/t/mempool-based-fee-estimation-on-bitcoin-core/703/6)\r\n\r\nThis is one of the reasons I opted to use the mempool only to lower the Block Policy Estimator, which itself is not gameable, and therefore this mechanism is not susceptible to this attack.\r\n\r\nThe underlying assumption here is that, with the current tools and work done to make RBF and CPFP feasible and guarantee (TRUC transaction relay, ephemeral anchors, cluster size 2 package rbf), it is safer to underestimate rather than overestimate.\r\nWe now assume it is relatively easy to fee-bump later if a transaction does not confirm, whereas once a fee is overestimated there is no way to recover from that.\r\n\r\nAnother open question when using the mempool for fee estimation is how to account for incoming transaction inflow.\r\n[Bitcoin Augur](https://github.com/block/bitcoin-augur) does this by using past inflow plus a constant expected inflow to predict future inflow. I find this unconvincing for fee estimation and potentially prone to more overestimation, as past conditions are not always representative of the future. See my [review of the Augur fee rate estimator and open questions](https://github.com/block/bitcoin-augur/issues/3).\r\n\r\nThis PR uses a much simpler approach based on current user behavior, similar to the widely used method employed by mempool.space: looking at the top block of the mempool and selecting a percentile feerate depending on whether the user is economical or conservative.\r\n\r\nEmpirical data from both myself and Clara Shikhelman shows that the 75th percentile feerate for economical users and the 50th percentile feerate for conservative users provide positive confirmation guarantees, hence this is what is used in this PR.\r\n\r\nParallel research by RenÃ© Pickhardt and his student suggests that using the [average fee per byte of the block template performs well](https://delvingbitcoin.org/t/mempool-based-fee-estimation-on-bitcoin-core/703/12).\r\n\r\nAll of these are constants that can be adjusted, there is parallel work exploring these constants and running benchmarks across fee estimators to find a sweet spot.\r\n\r\nSee also work in LND, the [LND Budget Sweeper](https://delvingbitcoin.org/t/lnds-deadline-aware-budget-sweeper/1512), which applies this idea successfully. Their approach is to estimate fees initially with bitcoind, then increment gradually as the confirmation deadline approaches, using a fixed fee budget.\r\n\r\nHistorical data indicates that by doing only the approach in this PR, we are able to [reduce overestimation quite significantly (~29%)](https://delvingbitcoin.org/t/mempool-based-fee-estimation-on-bitcoin-core/703/8).\r\n\r\nThis is particularly useful in scenarios where the Block Policy Estimator recommends a high feerate while the mempool is empty.\r\n<img width=\"1800\" height=\"1090\" alt=\"56f3ba26c0184521c42bb82ec9d8c9f2224d4f8e\" src=\"https://github.com/user-attachments/assets/c035c40c-8ece-42a7-b290-d29f1ac9bf4d\" />\r\n\r\nAs seen in the image above, there is only one remaining unfixed case: when there is a sudden inflow of transactions and the feerate rises, the Block Policy Estimator takes time to reflect this. In that case, users will continue to see a low feerate estimate until it slowly updates. From the historical data linked above, [this occurs about ~26% of the time](https://delvingbitcoin.org/t/mempool-based-fee-estimation-on-bitcoin-core/703/8)).\r\n\r\nOverall, we observe a **73% success rate with 0% overestimation, and 26% underestimation** with this approach.\r\n\r\nThis PR also includes refactors that enable this work. Rather than splitting the PR and implementing changes incrementally, I opted for an end-to-end implementation:\r\n\r\n### 1. Refactors\r\n\r\n* Separation of feerate format from the fee estimate mode enumerator (separation of concerns, as they are semantically distinct)\r\n* Move logging after fee estimation estimateSmartFee from the wallet to the Block Policy Estimator internal method (also separation of concerns and avoiding leaking fee estimator internals). This change also comes with updating `createTransactionInternal` to log only the fee and its source (fee estimator, fallback fee, etc.), which is more appropriate.\r\n* Separate the fee estimate mode enum from the fee source enumerator (separation of concerns, as they are semantically distinct). This introduces a minor breaking change: the wallet RPCs now return fee *source* instead of fee *reason*, which is more accurate. Let me know if we prefer to keep the field name unchanged while returning the fee source.\r\n* Move the `StringForReason` enum from `common` to the Block Policy Estimator (also separation of concerns)\r\n* Various test file updates and renames for improved accuracy\r\n* Update Block Policy Estimator unit tests to be independent of the mempool and the validation interface\r\n\r\n### 2. Introduce Mempool-Based Fee Estimator and Fee Estimator Manager\r\n\r\n* Introduce a new abstract fee estimator base class that all fee estimators must implement\r\n\r\n* Introduce `FeeRateEstimateResult` as the response type, containing metadata and avoiding the use of out-parameters. This is easily extensible and makes future changes less invasive, as method signatures do not need to change.\r\n\r\n* Add `FeeEstimatorType` enum to identify different fee estimators\r\n\r\n* Make `CBlockPolicyEstimator` derive from the new fee estimator base class\r\n\r\n* Add `FeeRateEstimatorManager`, responsible for managing all fee estimators\r\n\r\n* Update the node context to store a `unique_ptr` to `FeeRateEstimatorManager` instead of `CBlockPolicyEstimator`\r\n\r\n* Update `CBlockPolicyEstimator` to no longer subscribe directly to the validation interface; instead, `FeeRateEstimatorManager` subscribes and forwards relevant notifications\r\n\r\n* Add a percentile calculation function that takes the chunk feerates of a block template and returns feerate percentiles; this can also be reused by the `getblockstats` RPC\r\n\r\n* Add a mempool fee estimator that generates a block template when called, calculates a percentile feerate, and returns the 75th percentile for economical mode or the 50th percentile for conservative mode\r\n\r\n* Add caching to the mempool estimator so that new estimates are generated only every 7 seconds, assuming enough [transactions have propagated](https://bitcoin.stackexchange.com/questions/125776/how-long-does-it-take-for-a-transaction-to-propagate-through-the-network/125777#125777) to make a meaningful difference.\r\n  This heuristic will likely be replaced by requesting block templates via the general-purpose block template cache proposed here: [https://github.com/bitcoin/bitcoin/issues/33389](https://github.com/bitcoin/bitcoin/issues/33389)\r\n\r\n* Update `MempoolTransactionRemovedForBlock` to return the actual block transactions as well\r\n\r\n* Track the weight of block transactions and evicted transactions after each block connection\r\n  This data is tracked for the last 6 mined blocks. A mempool feerate estimate is returned only when the average ratio of mempool transaction weight evicted due to `BLOCK` reasons to block transaction weight is greater than 75%. This heuristic provides rough confidence that the nodeâ€™s mempool matches that of the majority of the hashrate. The 75% threshold is arbitrary and can be adjusted.\r\n\r\nThere is a caveat when transactions in the local mempool are consistently not mined by the network, as described in #27995 (e.g., due to filtering).\r\nAccounting for these transactions during fee estimation is not necessary, as they should be evicted from the mempool itself (see #33510). Handling this again within fee estimation would be redundant.\r\n\r\n* Persist statistics for the 6 most recent blocks to disk during periodic flushes and shutdown, so this data is available after restarts\r\n* Expose this data to users when running `estimatesmartfee` with verbosity > 2\r\n\r\n<details>\r\n<summary>see example output</summary>\r\n\r\n```\r\nbitcoin-cli estimatesmartfee 1 \"conservative\" 2\r\n```\r\n\r\n```\r\n{\r\n  \"feerate\": 0.00002133,\r\n  \"errors\": [],\r\n  \"blocks\": 2,\r\n  \"mempool_health_statistics\": [\r\n    {\r\n      \"block_height\": 927953,\r\n      \"block_weight\": 3991729,\r\n      \"mempool_txs_weight\": 3942409,\r\n      \"ratio\": 0.987644451815241\r\n    },\r\n    ...\r\n  ]\r\n}\r\n```\r\n\r\n</details>",
      "state": "open",
      "user": "ismaelsadeeq",
      "created_at": "2025-12-15T11:53:35Z",
      "updated_at": "2026-01-14T10:39:21Z",
      "comments": 7,
      "url": "https://github.com/bitcoin/bitcoin/pull/34075",
      "labels": [
        "TX fees and policy"
      ],
      "comment_list": [
        {
          "user": "DrahtBot",
          "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/34075.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\nA summary of reviews will appear here.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#33421](https://github.com/bitcoin/bitcoin/pull/33421) (node: add  `BlockTemplateCache` by ismaelsadeeq)\n* [#33199](https://github.com/bitcoin/bitcoin/pull/33199) (fees: enable `CBlockPolicyEstimator` return sub 1 sat/vb fee rate estimates by ismaelsadeeq)\n* [#32427](https://github.com/bitcoin/bitcoin/pull/32427) ((RFC) kernel: Replace leveldb-based BlockTreeDB with flat-file based store by sedited)\n* [#32138](https://github.com/bitcoin/bitcoin/pull/32138) (wallet, rpc: remove settxfee and paytxfee by polespinasa)\n* [#31382](https://github.com/bitcoin/bitcoin/pull/31382) (kernel: Flush in ChainstateManager destructor by sedited)\n* [#28690](https://github.com/bitcoin/bitcoin/pull/28690) (build: Introduce internal kernel library by sedited)\n* [#24539](https://github.com/bitcoin/bitcoin/pull/24539) (Add a \"tx output spender\" index by sstone)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n<!--5faf32d7da4f0f540f40219e4f7537a3-->\n### LLM Linter (âœ¨ experimental)\n\n\n\nPossible places where named args for integral literals may be used (e.g. `func(x, /*named_arg=*/0)` in C++, and `func(x, named_arg=0)` in Python):\n\n- std::accumulate(block_txs.begin() + 1, block_txs.end(), 0u, ...) in src/policy/fees/mempool_estimator.cpp\n- std::accumulate(txs_removed_for_block.begin(), txs_removed_for_block.end(), 0u, ...) in src/policy/fees/mempool_estimator.cpp\n\n\n\n\nPossible places where comparison-specific test macros should replace generic comparisons:\n\n- test/functional/feature_fee_estimation.py: \n  snippet: \"assert block_stat['block_weight']\" -> recommendation: replace with a comparison helper such as assert_greater_than(block_stat['block_weight'], 0)\n- test/functional/feature_fee_estimation.py: \n  snippet: \"assert block_stat['mempool_txs_weight']\" -> recommendation: replace with a comparison helper such as assert_greater_than(block_stat['mempool_txs_weight'], 0)\n\nNo other added Python lines contain bare assert comparisons that should be replaced with the provided test helpers.\n\n\n\n<sup>2026-01-12</sup>\n",
          "created_at": "2025-12-15T11:53:44Z"
        },
        {
          "user": "gmaxwell",
          "body": "I think this is a good idea, especially if it there was a 'very conservative' that just didn't use this.\r\n\r\n> Accounting for these transactions during fee estimation is not necessary, as they should be evicted from the mempool itself\r\n\r\nI don't agree here-- rather time based expiration should probably be eliminated over time.  If there really is a censored transaction then we want nodes to work on getting it mined, and not just give up if the censors manage to control the blocks for a long time.\r\n\r\nAlso two weeks is already long time to allow a non-minable transaction to distort fee estimates.  And it's a short time for low rate confirmation-- there have been times in history when transactions weren't confirmed for months after their initial announcement (though those were also at time so far where size based expiration would have eliminated them).\r\n\r\nSo I suggest instead that *future work* (not this PR) could improve the estimator by excluding from considerations transactions that should have been mined according to our template but weren't for more than a threshold number of blocks, perhaps 6 or something like that.\r\n\r\nSuch code could also be used to log/warn the user that there is either ongoing censorship or that their node's policy appears to be less restrictive than the network.\r\n\r\nBut in any case it doesn't need to be done immediate to make use of this kind of estimator.\r\n\r\n> Overall, we observe a 73% success rate with 0% overestimation, and 26% underestimation with this approach.\r\n\r\nOne thing to keep in mind is that if this approach is widely used the success rate will probably change.  It might make sense to initially deploy with more conservative settings (/defaults) and slowly increase them to avoid causing an abrupt change.\r\n",
          "created_at": "2025-12-15T23:01:56Z"
        },
        {
          "user": "ismaelsadeeq",
          "body": "> I don't agree here; rather, time-based expiration should probably be eliminated over time. If there really is a censored transaction, then we want nodes to continue working to get it mined, not just give up if censors manage to control blocks for a long time.\r\n\r\nIndeed. In the context of censorship, we would want to keep such transactions if they are incentive compatible. However, there may also be legitimate reasons miners deliberately exclude them for example, a legacy node that is unaware of a soft fork that invalidates a certain spend (e.g., post-quantum).\r\n\r\nHence as you also mentioned, I would like to see the direction of #33510, leaning toward deferring this improvement to future work.\r\n\r\n> Especially if there were a â€œvery conservativeâ€ option that simply didnâ€™t use this. One thing to keep in mind is that if this approach is widely used, the success rate will probably change. It might make sense to initially deploy with more conservative settings (or defaults) and slowly increase them to avoid causing an abrupt change.\r\n\r\nI considered this and even had a branch that added an option to `estimatesmartfee` to force block-policy-only behavior.\r\n\r\nHowever, the users this targets are those running `bitcoind` with default settings and trusting developers to make sane default choices. Iâ€™ve seen this scenario before with previous conservative defaults: complaints and issues accumulated over time, eventually leading us to [switch block policy the default to economical](https://github.com/bitcoin/bitcoin/pull/30275), which provided a significant reduction in overestimation and better accuracy.\r\n\r\nFWIW, I also did some research over a short block interval to get a sense of what Bitcoin core wallet users uses for feerate estimation, and I find that the majority of Bitcoin Core wallet users (that I was able to fingerprints) are not using the block-policy estimator, weâ€™ve seen self-hosted users [1](https://github.com/decred/dcrdex/pull/3046) [2](https://github.com/btcpayserver/btcpayserver/pull/5490) switch approaches in the past, Iâ€™ve also personally spoken to large Bitcoin services that rely on third party but want this feature.  \r\nIt seems to me enabling this by default feels like the better direction, IMHO.",
          "created_at": "2025-12-16T15:39:16Z"
        },
        {
          "user": "gmaxwell",
          "body": "I think enabling it by default probably makes sense, that particular sub comment was more about having a ready way to choose not to use it when transacting.\r\n\r\nAs far as the initial defaults I think there I meant that that it shouldn't target too close to the bottom of the mempool as even if that currently gets high success that may not be true after wide deployment.  Though on reflection I'm not sure that thats true as this only lowers feerates, so other people using this should only increase your odds of success while using it.",
          "created_at": "2025-12-17T14:57:03Z"
        },
        {
          "user": "ismaelsadeeq",
          "body": "@brunoerg friendly ping for a mutation score and un-killed mutants ðŸ”ª \r\n\r\n\r\n--- \r\nI will fix the issues brought up by @DrahtBot soon.",
          "created_at": "2026-01-08T16:40:50Z"
        },
        {
          "user": "brunoerg",
          "body": "> @brunoerg friendly ping for a mutation score and un-killed mutants ðŸ”ª \n> \n> \n> \n> \n> \n> --- \n> \n> I will fix the issues brought up by @DrahtBot soon.\n\nI'm running it. ",
          "created_at": "2026-01-08T17:00:36Z"
        },
        {
          "user": "DrahtBot",
          "body": "<!--85328a0da195eb286784d51f73fa0af9-->\nðŸš§ At least one of the CI tasks failed.\n<sub>Task `32 bit ARM`: https://github.com/bitcoin/bitcoin/actions/runs/20899189424/job/60042443886</sub>\n<sub>LLM reason (âœ¨ experimental): Compilation failed due to a dangling reference error in mempool_estimator.cpp, treated as an error by -Werror.</sub>\n\n<details><summary>Hints</summary>\n\nTry to run the tests locally, according to the documentation. However, a CI failure may still\nhappen due to a number of reasons, for example:\n\n* Possibly due to a silent merge conflict (the changes in this pull request being\nincompatible with the current code in the target branch). If so, make sure to rebase on the latest\ncommit of the target branch.\n\n* A sanitizer issue, which can only be found by compiling with the sanitizer and running the\n  affected test.\n\n* An intermittent issue.\n\nLeave a comment here, if you need help tracking down a confusing failure.\n\n</details>\n\n",
          "created_at": "2026-01-11T18:53:37Z"
        }
      ]
    }
  ],
  "issues": [
    {
      "number": 34076,
      "title": "tapscript with time-locked musig2",
      "body": "### Is there an existing issue for this?\n\n- [x] I have searched the existing issues\n\n### Current behaviour\n\nTrying to import descriptor with time-locked musig fragment in tapscript returns:\n```\nerror code: -5\nerror message:\nInvalid musig() expression\n```\n\n### Expected behaviour\n\nImport should work.\n\n### Steps to reproduce\n\ntry `getdescriptorinfo` with following BIP-388 policy:\n\n`tr(musig(@0,@1,@2)/**,{and_v(v:pk(musig(@0,@1)/**),older(12960)),{and_v(v:pk(musig(@0,@2)/**),older(12960)),and_v(v:pk(musig(@1,@2)/**),older(12960))}})`\n\nwhich translates (for example) to following descriptor:\n\n```\ntr(musig([a471be2d/88h/1h/0h]tpubDCyTVDMyRxsEeAf7KLPRfUZkSCCjsZPqZoM2Ay3FqtH55CxvTchpK2DSbTgVRziFGesGGibdsfC4BktGNUMwb4VjGwu2KuzDCp9A97rVH8q,[0f056943/88h/1h/0h]tpubDD8WTkCBJwj5WHR8S1gr2y64LcFSwEic38zGRKEuHXUUPRacZyTREJp9vZ5fayGVqEzzBacffrkK1g4CJRA5PgXE7MkrsLcUWbeixkLaNM6,[6b69e5e9/88h/1h/0h]tpubDCMSPy71rEscssSimZNZ3S1Z2aguLeeLbguzDUXJVfwiCxuAE88omLcd95895x9au5Tw81bCuPhNcmSCzp2Yz13EReNHduoFKc4f1VNs7VG)/<0;1>/*,{and_v(v:pk(musig([6b69e5e9/88h/1h/0h]tpubDCMSPy71rEscssSimZNZ3S1Z2aguLeeLbguzDUXJVfwiCxuAE88omLcd95895x9au5Tw81bCuPhNcmSCzp2Yz13EReNHduoFKc4f1VNs7VG,[a471be2d/88h/1h/0h]tpubDCyTVDMyRxsEeAf7KLPRfUZkSCCjsZPqZoM2Ay3FqtH55CxvTchpK2DSbTgVRziFGesGGibdsfC4BktGNUMwb4VjGwu2KuzDCp9A97rVH8q)/<0;1>/*),older(12960)),{and_v(v:pk(musig([6b69e5e9/88h/1h/0h]tpubDCMSPy71rEscssSimZNZ3S1Z2aguLeeLbguzDUXJVfwiCxuAE88omLcd95895x9au5Tw81bCuPhNcmSCzp2Yz13EReNHduoFKc4f1VNs7VG,[0f056943/88h/1h/0h]tpubDD8WTkCBJwj5WHR8S1gr2y64LcFSwEic38zGRKEuHXUUPRacZyTREJp9vZ5fayGVqEzzBacffrkK1g4CJRA5PgXE7MkrsLcUWbeixkLaNM6)/<0;1>/*),older(12960)),and_v(v:pk(musig([a471be2d/88h/1h/0h]tpubDCyTVDMyRxsEeAf7KLPRfUZkSCCjsZPqZoM2Ay3FqtH55CxvTchpK2DSbTgVRziFGesGGibdsfC4BktGNUMwb4VjGwu2KuzDCp9A97rVH8q,[0f056943/88h/1h/0h]tpubDD8WTkCBJwj5WHR8S1gr2y64LcFSwEic38zGRKEuHXUUPRacZyTREJp9vZ5fayGVqEzzBacffrkK1g4CJRA5PgXE7MkrsLcUWbeixkLaNM6)/<0;1>/*),older(12960))}})\n```\n\n(imo) error is caused by the first leaf where `expr` after split is missing terminating parentheses of musig expression https://github.com/bitcoin/bitcoin/blob/2210feb4466eff1455468f0a25045fce4b89c55d/src/script/descriptor.cpp#L1844-L1847\n\nOR use below patch to add test case to musig functional tests:\n\n```\nSubject: [PATCH] test\n---\nIndex: test/functional/wallet_musig.py\nIDEA additional info:\nSubsystem: com.intellij.openapi.diff.impl.patch.CharsetEP\n<+>UTF-8\n===================================================================\ndiff --git a/test/functional/wallet_musig.py b/test/functional/wallet_musig.py\n--- a/test/functional/wallet_musig.py\t(revision 2210feb4466eff1455468f0a25045fce4b89c55d)\n+++ b/test/functional/wallet_musig.py\t(date 1765796643152)\n@@ -236,6 +236,7 @@\n         self.do_test(\"tr(H,{pk(musig/*), pk(same keys different musig/*)})\", \"tr($H,{pk(musig($0,$1,$2)/<0;1>/*),pk(musig($1,$2)/0/*)})\", scriptpath=True)\n         self.do_test(\"tr(musig/*,{pk(partial keys diff musig-1/*),pk(partial keys diff musig-2/*)})}\", \"tr(musig($0,$1,$2)/<3;4>/*,{pk(musig($0,$1)/<5;6>/*),pk(musig($1,$2)/7/*)})\")\n         self.do_test(\"tr(musig/*,{pk(partial keys diff musig-1/*),pk(partial keys diff musig-2/*)})} script-path\", \"tr(musig($0,$1,$2)/<3;4>/*,{pk(musig($0,$1)/<5;6>/*),pk(musig($1,$2)/7/*)})\", scriptpath=True, nosign_wallets=[0])\n+        self.do_test(\"time-locked musig\", \"tr(musig($0,$1,$2)/<0;1>/*,{and_v(v:pk(musig($0,$1)/<0;1>/*),older(12960)),{and_v(v:pk(musig($0,$2)/<0;1>/*),older(12960)),and_v(v:pk(musig($1,$2)/<0;1>/*),older(12960))}})\", scriptpath=True)\n \n \n if __name__ == '__main__':\n```\n\n### Relevant log output\n\n_No response_\n\n### How did you obtain Bitcoin Core\n\nCompiled from source\n\n### What version of Bitcoin Core are you using?\n\nmaster@2210feb4466eff1455468f0a25045fce4b89c55d\n\n### Operating system and version\n\nLinux ... 6.14.0-37-generic #37~24.04.1-Ubuntu ... x86_64 x86_64 x86_64 GNU/Linux\n\n### Machine specifications\n\n_No response_",
      "state": "open",
      "user": "scgbckbone",
      "created_at": "2025-12-15T12:14:26Z",
      "updated_at": "2026-01-15T09:07:55Z",
      "comments": 2,
      "url": "https://github.com/bitcoin/bitcoin/issues/34076",
      "labels": [
        "Wallet",
        "Descriptors"
      ],
      "comment_list": [
        {
          "user": "scgbckbone",
          "body": "> (imo) error is caused by the first leaf where `expr` after split is missing terminating parentheses of musig expression\n\nactually it is not after split... `ParsePubkey` parameter `sp` already lacks terminating `)` of musig expression, therefore `split.size()` is 1",
          "created_at": "2025-12-15T13:32:24Z"
        },
        {
          "user": "achow101",
          "body": "Looks like [`ParseKeyEnd`](https://github.com/bitcoin/bitcoin/blob/41bf8f2d5eceaac72b98c1791f5fc368b3af90cb/src/script/miniscript.h#L1751) is looking for the next `)` which is incorrect when there is a `musig()` as the key.",
          "created_at": "2025-12-16T02:32:17Z"
        }
      ]
    }
  ],
  "summary": {
    "pull_requests": 3,
    "issues": 1
  }
}