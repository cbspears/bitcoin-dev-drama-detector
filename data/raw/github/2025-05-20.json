{
  "source": "github",
  "repository": "bitcoin/bitcoin",
  "fetched_at": "2026-01-15T19:44:23.926027+00:00",
  "date": "2025-05-20",
  "pull_requests": [
    {
      "number": 32575,
      "title": "refactor: Split multithreaded case out of CheckInputScripts",
      "body": "This topic has been motivated by my work on batch validation and a related conversation just happened here: https://github.com/bitcoin/bitcoin/pull/32467#discussion_r2098305199 \r\n\r\n`CheckInputScripts` currently only does what its name implies if there is no multithreading usage for validation. If there are worker threads available the function instead only creates the checks and puts them into a vector. Aside from some shared pre-checks the multithreaded code path is much simpler compared to the rest. This dual use makes the function hard to grasp and its naming confusing. So this PR is splitting the single thread case from the multithread. This results in more LOC but the result is much clearer.",
      "state": "open",
      "user": "fjahr",
      "created_at": "2025-05-20T20:52:49Z",
      "updated_at": "2025-12-04T12:07:51Z",
      "comments": 11,
      "url": "https://github.com/bitcoin/bitcoin/pull/32575",
      "labels": [
        "Refactoring"
      ],
      "comment_list": [
        {
          "user": "DrahtBot",
          "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/32575.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| Concept ACK | [theuni](https://github.com/bitcoin/bitcoin/pull/32575#issuecomment-2895813848), [sedited](https://github.com/bitcoin/bitcoin/pull/32575#issuecomment-2895950866), [stickies-v](https://github.com/bitcoin/bitcoin/pull/32575#issuecomment-2897442292) |\n\nIf your review is incorrectly listed, please copy-paste <code>&lt;!--meta-tag:bot-skip--&gt;</code> into the comment that the bot should ignore.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#32317](https://github.com/bitcoin/bitcoin/pull/32317) (kernel: Separate UTXO set access from validation functions by sedited)\n* [#29843](https://github.com/bitcoin/bitcoin/pull/29843) (policy: Allow non-standard scripts with -acceptnonstdtxn=1 (test nets only) by ajtowns)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n<!--5faf32d7da4f0f540f40219e4f7537a3-->\n### LLM Linter (‚ú® experimental)\n\nPossible typos and grammar issues:\n\n- \"Note that we may set state.reason to NOT_STANDARD for extra soft-fork flags in flags, block-checking callers should probably reset it to CONSENSUS in such cases.\" -> \"Note that we may set state.reason to NOT_STANDARD for extra soft-fork flags; block-checking callers should probably reset it to CONSENSUS in such cases.\" [Replace the comma splice with a semicolon to fix the run-on sentence and clarify that two related but separate ideas are being stated.]\n\n<sup>drahtbot_id_5_m</sup>\n",
          "created_at": "2025-05-20T20:52:52Z"
        },
        {
          "user": "theuni",
          "body": "Concept ACK. Anything to clean this up :)\r\n\r\nSee also #32317 which moves some of this functionality around similarly.",
          "created_at": "2025-05-20T20:57:04Z"
        },
        {
          "user": "fjahr",
          "body": "Cleaned up the comments so this should be ready for more detailed feedback, ~~but expect a rebase once https://github.com/bitcoin/bitcoin/pull/32467 is merged.~~",
          "created_at": "2025-05-20T21:49:56Z"
        },
        {
          "user": "sedited",
          "body": "Concept ACK",
          "created_at": "2025-05-20T22:12:27Z"
        },
        {
          "user": "stickies-v",
          "body": "Concept ACK",
          "created_at": "2025-05-21T10:28:43Z"
        },
        {
          "user": "theuni",
          "body": "Ready for rebase.",
          "created_at": "2025-05-22T18:29:24Z"
        },
        {
          "user": "fjahr",
          "body": "> Ready for rebase.\r\n\r\nDone, ready for review :)",
          "created_at": "2025-05-22T20:21:11Z"
        },
        {
          "user": "fjahr",
          "body": "> An alternative would be to make CCheckQueueControl work with 0 worker threads (maybe it already does?) and just always use it. That would completely unify the approach here.\r\n\r\nYeah, that does work basically out of the box. I tested it with this minimal change on top of the changes here: https://github.com/fjahr/bitcoin/commit/320b9a967f88ece5b98779948c47493ad7717da2 However I don't favor that approach at the moment since there seems to be a lot of overhead when using checkqueue with a single thread and a lot of docs would need to be changed accordingly as well. Just logically you wouldn't think about using a queue when you just have a single thread, so while it would definitely simplify the code in `ConnectBlock`, I am not sure it's a bigger win than the other approaches discussed here, given that it may cause irritation in other places and a performance penalty. I am happy to be convinced of this approach though if I overlooked something.\r\n\r\nI have now pushed here an updated version that addresses both the suggestions from @theuni and @mzumsande .",
          "created_at": "2025-06-19T22:00:21Z"
        },
        {
          "user": "fjahr",
          "body": "Silent merged conflict was resolved with the last push but the CI still fails with some problem fetching the qa-assets repo, seems to be a github issue since I also see it in master, retrying one more time with close/re-open to see if it works again now.",
          "created_at": "2025-10-11T20:44:55Z"
        },
        {
          "user": "fjahr",
          "body": "Turning it off and on again finally worked :p",
          "created_at": "2025-10-13T17:41:35Z"
        },
        {
          "user": "sedited",
          "body": "Looking at this patch, I am asking myself why we're keeping the single threaded / no checkqueue case in the first place. This seems to introduce a vector of jobs for both cases now, so maybe we could just create a queue without any workers?",
          "created_at": "2025-11-30T22:04:51Z"
        }
      ]
    },
    {
      "number": 32573,
      "title": "ci: Avoid && dropping errors",
      "body": "In bash, `&&` will ignore errexit. This can lead to silently ignoring errors. Compare the output of:\r\n\r\n```\r\n$ bash -c 'set -xe;   false && false   ; true; echo $?'\r\n+ false\r\n+ true\r\n+ echo 0\r\n0\r\n```\r\n\r\nIn theory this could be fixed by using a subshell:\r\n\r\n```\r\n$ bash -c 'set -xe; ( false && false ) ; true; echo $?'\r\n+ false\r\n```\r\n\r\nHowever, it is easier to just remove the `&&`.\r\n\r\nThis was introduced in  commit faa807bdf8c3002a28005b4765604f518a6f2736",
      "state": "closed",
      "user": "maflcko",
      "created_at": "2025-05-20T19:49:17Z",
      "updated_at": "2025-06-05T08:16:40Z",
      "comments": 5,
      "url": "https://github.com/bitcoin/bitcoin/pull/32573",
      "labels": [
        "Tests"
      ],
      "comment_list": [
        {
          "user": "DrahtBot",
          "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/32573.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| ACK | [janb84](https://github.com/bitcoin/bitcoin/pull/32573#pullrequestreview-2857038264), [hebasto](https://github.com/bitcoin/bitcoin/pull/32573#pullrequestreview-2857077463), [laanwj](https://github.com/bitcoin/bitcoin/pull/32573#pullrequestreview-2857276533) |\n\nIf your review is incorrectly listed, please react with üëé to this comment and the bot will ignore it on the next update.\n<!--5faf32d7da4f0f540f40219e4f7537a3-->",
          "created_at": "2025-05-20T19:49:21Z"
        },
        {
          "user": "maflcko",
          "body": "> Could this approach be forced by a linter?\r\n\r\nI don't know how, because `( a && b )` is used and is fine. My preference would be to just stop using bash, but writing this one in Python or Rust will bloat the code. :man_shrugging: ",
          "created_at": "2025-05-21T10:27:41Z"
        },
        {
          "user": "laanwj",
          "body": "> My preference would be to just stop using bash\r\n\r\nYes.\r\n\r\n> but writing this one in Python or Rust will bloat the code. ü§∑‚Äç‚ôÇÔ∏è\r\n\r\nThat's good and bad, i mean bloated code that is straightforward to review might be preferable to a one-line magic incantation that has all kinds of unintuitive, hidden oopses.",
          "created_at": "2025-05-21T11:06:31Z"
        },
        {
          "user": "janb84",
          "body": "> > My preference would be to just stop using bash\r\n> \r\n> Yes.\r\n> \r\n> > but writing this one in Python or Rust will bloat the code. ü§∑‚Äç‚ôÇÔ∏è\r\n> \r\n> That's good and bad, i mean bloated code that is straightforward to review might be preferable to a one-line magic incantation that has all kinds of unintuitive, hidden oopses.\r\n\r\nI second this ! ",
          "created_at": "2025-05-21T11:08:50Z"
        },
        {
          "user": "maflcko",
          "body": "Ok, done in https://github.com/bitcoin/bitcoin/pull/32680",
          "created_at": "2025-06-05T08:16:39Z"
        }
      ]
    },
    {
      "number": 32572,
      "title": "doc: Remove stale sections in dev notes",
      "body": "This removes sections that I've been collecting as stale or overly redundant over the years. The rationale for each removal is in the commit message.",
      "state": "closed",
      "user": "maflcko",
      "created_at": "2025-05-20T16:51:55Z",
      "updated_at": "2025-07-22T23:03:27Z",
      "comments": 5,
      "url": "https://github.com/bitcoin/bitcoin/pull/32572",
      "labels": [
        "Docs"
      ],
      "comment_list": [
        {
          "user": "DrahtBot",
          "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/32572.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| ACK | [janb84](https://github.com/bitcoin/bitcoin/pull/32572#pullrequestreview-2868906114), [yuvicc](https://github.com/bitcoin/bitcoin/pull/32572#issuecomment-2948151373), [glozow](https://github.com/bitcoin/bitcoin/pull/32572#pullrequestreview-2914665505) |\n| Stale ACK | [1440000bytes](https://github.com/bitcoin/bitcoin/pull/32572#pullrequestreview-2855148437) |\n\nIf your review is incorrectly listed, please react with üëé to this comment and the bot will ignore it on the next update.\n<!--5faf32d7da4f0f540f40219e4f7537a3-->",
          "created_at": "2025-05-20T16:51:58Z"
        },
        {
          "user": "maflcko",
          "body": "> I see the benefit of not duplicating linter code in developer notes. However it's quite annoying to find out about linter failures only after pushing.\r\n> \r\n> The developer notes could point to the incantation to run all the linters in a container.\r\n\r\nThe lint CI should always run and complete within 60 seconds after pushing. If not, please let me know.\r\n\r\nYour note makes sense. I'll consider it in the next doc update, which moves stuff around.",
          "created_at": "2025-05-21T14:31:27Z"
        },
        {
          "user": "yuvicc",
          "body": "ACK fac00d4ed361e5e8c8989b2bb5a4a22dd54e2c72\r\n\r\nThanks for the cleanup. The minor suggestion regarding linter instructions is noted and can be addressed in the future update.",
          "created_at": "2025-06-06T05:33:04Z"
        },
        {
          "user": "glozow",
          "body": "> The developer notes could point to the incantation to run all the linters in a container.\r\n\r\nAssuming I understand you correctly, that does exist here https://github.com/bitcoin/bitcoin/tree/master/test/lint#test-runner",
          "created_at": "2025-06-10T19:22:49Z"
        },
        {
          "user": "l0rinc",
          "body": "Please see the follow-up, removing the corresponding TOC entries: https://github.com/bitcoin/bitcoin/pull/33040",
          "created_at": "2025-07-22T23:03:27Z"
        }
      ]
    },
    {
      "number": 32569,
      "title": "refactor: remove dump.h/cpp, wallet_bdb_parser.cpp",
      "body": "This PR removes the following deprecated legacy wallet files:\r\n\r\n- `src/wallet/dump.cpp`\r\n- `src/wallet/dump.h`\r\n- `src/wallet/test/fuzz/wallet_bdb_parse.cpp`\r\n- `Their associated references and usages`\r\n\r\nThese files were originally part of the legacy BerkeleyDB wallet backend and are no longer used in current functionality. They were retained for backward compatibility but are now fully obsolete due to ongoing deprecation tracked in #28710.\r\n\r\n### Motivation\r\n\r\n- These files are no longer compiled or referenced in the build.\r\n- Their removal reduces dead code and maintenance burden.\r\n- This improves developer experience by simplifying the wallet codebase and removing distractions during review and navigation.\r\n\r\n### Testing\r\n\r\n- The build completes successfully.\r\n- All existing unit and functional tests pass.\r\n\r\n### Reference\r\n\r\nRefs #28710.\r\n",
      "state": "closed",
      "user": "vicjuma",
      "created_at": "2025-05-20T14:12:17Z",
      "updated_at": "2025-05-20T14:39:40Z",
      "comments": 3,
      "url": "https://github.com/bitcoin/bitcoin/pull/32569",
      "labels": [
        "Refactoring",
        "CI failed"
      ],
      "comment_list": [
        {
          "user": "DrahtBot",
          "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/32569.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\nA summary of reviews will appear here.\n<!--5faf32d7da4f0f540f40219e4f7537a3-->",
          "created_at": "2025-05-20T14:12:20Z"
        },
        {
          "user": "DrahtBot",
          "body": "<!--85328a0da195eb286784d51f73fa0af9-->\nüöß At least one of the CI tasks failed.\n<sub>Task `previous releases, depends DEBUG`: https://github.com/bitcoin/bitcoin/runs/42560825482</sub>\n<sub>LLM reason (‚ú® experimental): The CI failure is due to build errors related to unrecognized compiler options.\n</sub>\n\n<details><summary>Hints</summary>\n\nTry to run the tests locally, according to the documentation. However, a CI failure may still\nhappen due to a number of reasons, for example:\n\n* Possibly due to a silent merge conflict (the changes in this pull request being\nincompatible with the current code in the target branch). If so, make sure to rebase on the latest\ncommit of the target branch.\n\n* A sanitizer issue, which can only be found by compiling with the sanitizer and running the\n  affected test.\n\n* An intermittent issue.\n\nLeave a comment here, if you need help tracking down a confusing failure.\n\n</details>\n\n",
          "created_at": "2025-05-20T14:18:10Z"
        },
        {
          "user": "maflcko",
          "body": "Please no AI slop",
          "created_at": "2025-05-20T14:18:38Z"
        }
      ]
    },
    {
      "number": 32568,
      "title": "depends: use \"mkdir -p\" when installing xproto",
      "body": "It looks like the mkdir detection in xproto is broken on Alpine. Ensure we always use `mkdir -p`.\r\n\r\nFixes #32494.",
      "state": "closed",
      "user": "fanquake",
      "created_at": "2025-05-20T11:27:14Z",
      "updated_at": "2025-06-05T13:52:22Z",
      "comments": 14,
      "url": "https://github.com/bitcoin/bitcoin/pull/32568",
      "labels": [
        "Build system"
      ],
      "comment_list": [
        {
          "user": "DrahtBot",
          "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/32568.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| ACK | [hebasto](https://github.com/bitcoin/bitcoin/pull/32568#pullrequestreview-2854723778), [janb84](https://github.com/bitcoin/bitcoin/pull/32568#pullrequestreview-2860431537), [willcl-ark](https://github.com/bitcoin/bitcoin/pull/32568#pullrequestreview-2892672240) |\n\nIf your review is incorrectly listed, please react with üëé to this comment and the bot will ignore it on the next update.\n<!--5faf32d7da4f0f540f40219e4f7537a3-->",
          "created_at": "2025-05-20T11:27:17Z"
        },
        {
          "user": "fanquake",
          "body": "> In that case, why not guide all build scripts with $($(package)_autoconf) MKDIR_P=\"mkdir -p\"?\r\n\r\nNot sure what you mean, but I'm not planning on changing things globally to work around a single broken package on a single OS.",
          "created_at": "2025-05-20T12:58:12Z"
        },
        {
          "user": "hebasto",
          "body": "> > In that case, why not guide all build scripts with $($(package)_autoconf) MKDIR_P=\"mkdir -p\"?\r\n> \r\n> Not sure what you mean, but I'm not planning on changing things globally...\r\n\r\nI mean nothing like that, but to configure the `xproto` package's build system with the [documented](https://www.gnu.org/savannah-checkouts/gnu/autoconf/manual/autoconf-2.72/html_node/Particular-Programs.html) variable.\r\n",
          "created_at": "2025-05-20T13:03:45Z"
        },
        {
          "user": "fanquake",
          "body": "`MKDIRPROG` is also documented. What's the difference?",
          "created_at": "2025-05-20T13:05:55Z"
        },
        {
          "user": "hebasto",
          "body": "> `MKDIRPROG` is also documented.\r\n\r\nMind sharing a link please?",
          "created_at": "2025-05-20T13:22:16Z"
        },
        {
          "user": "fanquake",
          "body": "It's documented in the install script.",
          "created_at": "2025-05-20T13:29:08Z"
        },
        {
          "user": "willcl-ark",
          "body": "Concept ACK.\r\n\r\nTested successfully @ d730249 using\r\n\r\n```bash\r\n$ docker run -it alpine:latest\r\n\r\n# On the guest\r\n$ apk update\r\n$ apk add git\r\n$ git clone https://github.com/bitcoin/bitcoin --depth=1\r\n$ git fetch origin pull/32568/head:pr-32568\r\n$ git checkout pr-32568\r\n$ apk add bash build-base cmake curl m4 make patch\r\n$ apk add bison linux-headers ninja-build pkgconf python3 xz\r\n$ make -C depends -j14\r\n```\r\n\r\nNo strong opinion from me on `MKDIRPROG` vs `MKDIR_P`.",
          "created_at": "2025-05-20T13:48:03Z"
        },
        {
          "user": "fanquake",
          "body": "Guix Build:\r\n```bash\r\nc07d19f1279ac1255fff06fff094eea425aa2d228b2cf4fef8ffa366fac344dc  guix-build-df9ebbf659d5/output/aarch64-linux-gnu/SHA256SUMS.part\r\n7a20ba73e966048d991d3d274c2a97575d47473befefe17e850760bc48cbbd9b  guix-build-df9ebbf659d5/output/aarch64-linux-gnu/bitcoin-df9ebbf659d5-aarch64-linux-gnu-debug.tar.gz\r\nbf70710e4308ec852471510d9f6ddc301c0c083c74d49c208e935d8b72e26e1b  guix-build-df9ebbf659d5/output/aarch64-linux-gnu/bitcoin-df9ebbf659d5-aarch64-linux-gnu.tar.gz\r\n00fc3a52592fe07adfb67484bacbb5b9249d00b2902a1e2a66dd5e2f80a8826d  guix-build-df9ebbf659d5/output/arm-linux-gnueabihf/SHA256SUMS.part\r\n5723df0fdb0211a067bea0bac544fa6a7e7f4ddf66dc0d881588ba820b49d20f  guix-build-df9ebbf659d5/output/arm-linux-gnueabihf/bitcoin-df9ebbf659d5-arm-linux-gnueabihf-debug.tar.gz\r\ncd896cafd744f12f3583fc1cfef70441ea3228693501fd1ca910cd61c0253981  guix-build-df9ebbf659d5/output/arm-linux-gnueabihf/bitcoin-df9ebbf659d5-arm-linux-gnueabihf.tar.gz\r\na19e9497847667ceebcd766cce9b15a843c6c6cd439059e7b5d8b14ae6136d87  guix-build-df9ebbf659d5/output/arm64-apple-darwin/SHA256SUMS.part\r\ndbe32996dae88a0079a9d46a026913d881bf8d8411703c3fa0856dd53dad2d82  guix-build-df9ebbf659d5/output/arm64-apple-darwin/bitcoin-df9ebbf659d5-arm64-apple-darwin-codesigning.tar.gz\r\nffaf37757024beb6f3f321ab18d48c87c5c599eeb8db2fe101124f544d46efa0  guix-build-df9ebbf659d5/output/arm64-apple-darwin/bitcoin-df9ebbf659d5-arm64-apple-darwin-unsigned.tar.gz\r\n87f7c982493547d39e54dc41a981df8ad994d315beea2d5bd39ead074ec56d61  guix-build-df9ebbf659d5/output/arm64-apple-darwin/bitcoin-df9ebbf659d5-arm64-apple-darwin-unsigned.zip\r\n302a02a715fa2015c097b0c8bbe376822e8760f0a440adae9f1cc1df013667d1  guix-build-df9ebbf659d5/output/dist-archive/bitcoin-df9ebbf659d5.tar.gz\r\n8ea9d874be0bfec1771d82f77a5501f4033a2d84ab54e940f229ccdf2aba8032  guix-build-df9ebbf659d5/output/powerpc64-linux-gnu/SHA256SUMS.part\r\ne07fda0b01dc65d2ad667f57c571daa62245b593f44c40b51e5f40d77ed52fe0  guix-build-df9ebbf659d5/output/powerpc64-linux-gnu/bitcoin-df9ebbf659d5-powerpc64-linux-gnu-debug.tar.gz\r\ndbcf034a85aeb2ee22c304cbd7cc9adcf907e9c779160a71f9b713f43d312a8c  guix-build-df9ebbf659d5/output/powerpc64-linux-gnu/bitcoin-df9ebbf659d5-powerpc64-linux-gnu.tar.gz\r\n4fcdcf55c92a5a1b18d1d93cc29371e1a85d00738533ebd6eaa32461cf42a381  guix-build-df9ebbf659d5/output/riscv64-linux-gnu/SHA256SUMS.part\r\n9d729d04f3417df6e60952329dedfee786feb09baf155fbc6a2e5f58d75b5c2f  guix-build-df9ebbf659d5/output/riscv64-linux-gnu/bitcoin-df9ebbf659d5-riscv64-linux-gnu-debug.tar.gz\r\n791e404b46601de2a79ab032fd2a74376e895173de0f30bc73e32d7c9e6f41e8  guix-build-df9ebbf659d5/output/riscv64-linux-gnu/bitcoin-df9ebbf659d5-riscv64-linux-gnu.tar.gz\r\n93adb2b7cc67b0600d535420e324a29c0bae71c8308251c52fcb82e10bac0264  guix-build-df9ebbf659d5/output/x86_64-apple-darwin/SHA256SUMS.part\r\n25c076c485ba28be1dfccb13f3217a9b3c56e2ed6cf9ee5140b03feb10d8aec5  guix-build-df9ebbf659d5/output/x86_64-apple-darwin/bitcoin-df9ebbf659d5-x86_64-apple-darwin-codesigning.tar.gz\r\n977f9d0122d936a2c97bc6c92d89a31eab8ad34b8408a57f17448bc77f373a97  guix-build-df9ebbf659d5/output/x86_64-apple-darwin/bitcoin-df9ebbf659d5-x86_64-apple-darwin-unsigned.tar.gz\r\n37bd4dafb2866cf326412030c542d1c63036ad453a48f1cac0ad355a8b6ab5cc  guix-build-df9ebbf659d5/output/x86_64-apple-darwin/bitcoin-df9ebbf659d5-x86_64-apple-darwin-unsigned.zip\r\nf674955d6902cfba397365558b0a0bbacd91bc661229fc2da21108504e89b552  guix-build-df9ebbf659d5/output/x86_64-linux-gnu/SHA256SUMS.part\r\n01e48f177e1112a0318a42f0702784cc8674d9f8249e490f2e856ce65a1c4f83  guix-build-df9ebbf659d5/output/x86_64-linux-gnu/bitcoin-df9ebbf659d5-x86_64-linux-gnu-debug.tar.gz\r\nabf48f8b214df8dc62f54e804f65f074a2e16810c30ec18059558551d44801c8  guix-build-df9ebbf659d5/output/x86_64-linux-gnu/bitcoin-df9ebbf659d5-x86_64-linux-gnu.tar.gz\r\nc73a2345dd6ed14d52656ad40ba1e742dba0de9cccfad21e26865f9849bd55de  guix-build-df9ebbf659d5/output/x86_64-w64-mingw32/SHA256SUMS.part\r\n26c2ed79b7a6c18c10c445590fed94c3e38875b5a630766e7af924a1354c02e4  guix-build-df9ebbf659d5/output/x86_64-w64-mingw32/bitcoin-df9ebbf659d5-win64-codesigning.tar.gz\r\n9dd980745361847e8862c502e22db78354f09336905e7053aff2994378be5472  guix-build-df9ebbf659d5/output/x86_64-w64-mingw32/bitcoin-df9ebbf659d5-win64-debug.zip\r\nfcff8780dffac5a8e8b434a948d05ca4fe8527d4cca26cb39a1c0e8b1cd5299b  guix-build-df9ebbf659d5/output/x86_64-w64-mingw32/bitcoin-df9ebbf659d5-win64-setup-unsigned.exe\r\nf6a67d38010f0d9ab21d1a3eea05f233c637d8cefb5201a70075967d132212ad  guix-build-df9ebbf659d5/output/x86_64-w64-mingw32/bitcoin-df9ebbf659d5-win64-unsigned.zip\r\n```",
          "created_at": "2025-05-20T16:39:42Z"
        },
        {
          "user": "willcl-ark",
          "body": "Mismatching hashes on my build:\r\n\r\n```\r\nsrc/core/bitcoin on ÓÇ† alpine_MKDIRPROG:refs/pull/32568/head [$] via ‚ñ≥ v3.31.6 via üêç v3.12.10 via ‚ùÑÔ∏è  impure (nix-shell-env) took 1h13m42s\r\n‚ùØ find guix-build-$(git rev-parse --short=12 HEAD)/output/ -type f -print0 | env LC_ALL=C sort -z | xargs -r0 sha256sum\r\n\r\ncb7dbe6112cdd38db9757af64cd4e617cdced8a6525db8a1469f3f35d29de9f6  guix-build-df9ebbf659d5/output/aarch64-linux-gnu/SHA256SUMS.part\r\na0b2b6c3fd30ae9aa7667b99f0ac2fe7d59725fff6fef547bd73f2cc5b50b1b3  guix-build-df9ebbf659d5/output/aarch64-linux-gnu/bitcoin-df9ebbf659d5-aarch64-linux-gnu-debug.tar.gz\r\n3015b81d14d9339a9fddf7b7feb8b36c6fcaeb3247dec38baece958fc24065c7  guix-build-df9ebbf659d5/output/aarch64-linux-gnu/bitcoin-df9ebbf659d5-aarch64-linux-gnu.tar.gz\r\nd5333d546d6e2b6a696cbce2220ec217f835166d7a0c088634e6e268a96ba300  guix-build-df9ebbf659d5/output/arm-linux-gnueabihf/SHA256SUMS.part\r\n68031430cdcd6a2de5cb8ea523665367983b99c85825eefcbc2f6c8a630b099f  guix-build-df9ebbf659d5/output/arm-linux-gnueabihf/bitcoin-df9ebbf659d5-arm-linux-gnueabihf-debug.tar.gz\r\n99fbf0cd4e14abc0553d5ba7644646aa1d2b0cfa539c049dfb4ee868e6bf167c  guix-build-df9ebbf659d5/output/arm-linux-gnueabihf/bitcoin-df9ebbf659d5-arm-linux-gnueabihf.tar.gz\r\n8e2de487121792ba21e66b8671904a9d593da83c83416b2addc278b5d1da21c8  guix-build-df9ebbf659d5/output/arm64-apple-darwin/SHA256SUMS.part\r\n35728ce72fcfe5fa77b5fa7b228ae6bd001a8e55c7ae4cb21fe30b0ef73aba4c  guix-build-df9ebbf659d5/output/arm64-apple-darwin/bitcoin-df9ebbf659d5-arm64-apple-darwin-codesigning.tar.gz\r\n3606445152cede8ac6a2417965b59be17b45856855e64e4505840d898ae5a311  guix-build-df9ebbf659d5/output/arm64-apple-darwin/bitcoin-df9ebbf659d5-arm64-apple-darwin-unsigned.tar.gz\r\n07a6e43006d91392777037692dd3333ca76f875a0fce31fb3766d2999b7b1e7d  guix-build-df9ebbf659d5/output/arm64-apple-darwin/bitcoin-df9ebbf659d5-arm64-apple-darwin-unsigned.zip\r\n302a02a715fa2015c097b0c8bbe376822e8760f0a440adae9f1cc1df013667d1  guix-build-df9ebbf659d5/output/dist-archive/bitcoin-df9ebbf659d5.tar.gz\r\n7c41454b941cb247aa869319c7fe3821a356715babdba688cc90fbf8a73dd924  guix-build-df9ebbf659d5/output/powerpc64-linux-gnu/SHA256SUMS.part\r\nb5320e48ee7f21da24d9fe09df65a876da3a4a368695524d7cf78b4f07aea80e  guix-build-df9ebbf659d5/output/powerpc64-linux-gnu/bitcoin-df9ebbf659d5-powerpc64-linux-gnu-debug.tar.gz\r\n517eb21687c6047e53301c97d77c414caa56bd5ed7cdcfaf23f188e91a0a76e7  guix-build-df9ebbf659d5/output/powerpc64-linux-gnu/bitcoin-df9ebbf659d5-powerpc64-linux-gnu.tar.gz\r\n368d640618ef05cc4278886a39e706a25bc1f008039443a8540d91dd98372ac7  guix-build-df9ebbf659d5/output/riscv64-linux-gnu/SHA256SUMS.part\r\nfc2bdca01aa55f57bc3038ade9b59f514beb2a4fb9e5a82f75680cd2e4c5035e  guix-build-df9ebbf659d5/output/riscv64-linux-gnu/bitcoin-df9ebbf659d5-riscv64-linux-gnu-debug.tar.gz\r\n844bbea570fa22992aef28ba9c369164ead2b5b6d9223be23ba66444e857708f  guix-build-df9ebbf659d5/output/riscv64-linux-gnu/bitcoin-df9ebbf659d5-riscv64-linux-gnu.tar.gz\r\ndcc4c3ff5984c2216d6b5b6e5bdc20651d808f605fb3ef3b895277bc620aafe9  guix-build-df9ebbf659d5/output/x86_64-apple-darwin/SHA256SUMS.part\r\n793aedb951a9f1ba2df5c51ff2306e3c6f55334957457cb1a2ec064d559a73e4  guix-build-df9ebbf659d5/output/x86_64-apple-darwin/bitcoin-df9ebbf659d5-x86_64-apple-darwin-codesigning.tar.gz\r\nb830e5cf029ae6366be15af11f1772a812531c61fde71836c22a33eef5ed8db7  guix-build-df9ebbf659d5/output/x86_64-apple-darwin/bitcoin-df9ebbf659d5-x86_64-apple-darwin-unsigned.tar.gz\r\n36ad6470cf4d0c580f564c2cf11d6adba90d543529fbf7360e19c283979736af  guix-build-df9ebbf659d5/output/x86_64-apple-darwin/bitcoin-df9ebbf659d5-x86_64-apple-darwin-unsigned.zip\r\nb37096b3a3d59f275a0f5135aba1166046f5b4bb5d129439308e4c2d339462ed  guix-build-df9ebbf659d5/output/x86_64-linux-gnu/SHA256SUMS.part\r\n410ad822e7b74648c5005d13780c00f9c018b42ff36c94a7cd169166d8168938  guix-build-df9ebbf659d5/output/x86_64-linux-gnu/bitcoin-df9ebbf659d5-x86_64-linux-gnu-debug.tar.gz\r\n3908e6b44103343751b1e8df25360f3e1b959b67188a62ef6ac897e039b7bc3d  guix-build-df9ebbf659d5/output/x86_64-linux-gnu/bitcoin-df9ebbf659d5-x86_64-linux-gnu.tar.gz\r\n59fcd11af18f578dff44e65dd2407782547a13c10df26130985ef863b4e1d61a  guix-build-df9ebbf659d5/output/x86_64-w64-mingw32/SHA256SUMS.part\r\neeaa6d3a977e46d9c36c1e254737daff0624520b34f5d77e8e94c1f0c527b1e3  guix-build-df9ebbf659d5/output/x86_64-w64-mingw32/bitcoin-df9ebbf659d5-win64-codesigning.tar.gz\r\n5d5543c1ca0556d7eb0ddd9200beeabd502879c24ba2035077e22e0d20ee55c4  guix-build-df9ebbf659d5/output/x86_64-w64-mingw32/bitcoin-df9ebbf659d5-win64-debug.zip\r\nfcff8780dffac5a8e8b434a948d05ca4fe8527d4cca26cb39a1c0e8b1cd5299b  guix-build-df9ebbf659d5/output/x86_64-w64-mingw32/bitcoin-df9ebbf659d5-win64-setup-unsigned.exe\r\nd6bf58025866ef957499604c30709f1cda5c372bae215599ade0d7eefe726bea  guix-build-df9ebbf659d5/output/x86_64-w64-mingw32/bitcoin-df9ebbf659d5-win64-unsigned.zip\r\n```",
          "created_at": "2025-05-20T19:59:05Z"
        },
        {
          "user": "willcl-ark",
          "body": "ok I just did a lazy rebuild of x86_64 only and got the same hashes again:\r\n\r\n```\r\n‚ùØ find guix-build-$(git rev-parse --short=12 HEAD)/output/ -type f -print0 | env LC_ALL=C sort -z | xargs -r0 sha256sum\r\n302a02a715fa2015c097b0c8bbe376822e8760f0a440adae9f1cc1df013667d1  guix-build-df9ebbf659d5/output/dist-archive/bitcoin-df9ebbf659d5.tar.gz\r\nb37096b3a3d59f275a0f5135aba1166046f5b4bb5d129439308e4c2d339462ed  guix-build-df9ebbf659d5/output/x86_64-linux-gnu/SHA256SUMS.part\r\n410ad822e7b74648c5005d13780c00f9c018b42ff36c94a7cd169166d8168938  guix-build-df9ebbf659d5/output/x86_64-linux-gnu/bitcoin-df9ebbf659d5-x86_64-linux-gnu-debug.tar.gz\r\n3908e6b44103343751b1e8df25360f3e1b959b67188a62ef6ac897e039b7bc3d  guix-build-df9ebbf659d5/output/x86_64-linux-gnu/bitcoin-df9ebbf659d5-x86_64-linux-gnu.tar.gz\r\n```\r\n\r\nI guess I'll do a full run and see if everything matches my first run",
          "created_at": "2025-05-22T09:40:33Z"
        },
        {
          "user": "willcl-ark",
          "body": "OK a second full guix build got the same hashes as my first:\r\n\r\n```\r\nsrc/core/worktree-alpine-MKDIRPROG on ÓÇ† alpine_MKDIRPROG:refs/pull/32568/head [$] via ‚ñ≥ v3.31.6 via üêç v3.12.10 via ‚ùÑÔ∏è  impure (nix-shell-env) took 1h31m29s\r\n‚ùØ find guix-build-$(git rev-parse --short=12 HEAD)/output/ -type f -print0 | env LC_ALL=C sort -z | xargs -r0 sha256sum\r\ncb7dbe6112cdd38db9757af64cd4e617cdced8a6525db8a1469f3f35d29de9f6  guix-build-df9ebbf659d5/output/aarch64-linux-gnu/SHA256SUMS.part\r\na0b2b6c3fd30ae9aa7667b99f0ac2fe7d59725fff6fef547bd73f2cc5b50b1b3  guix-build-df9ebbf659d5/output/aarch64-linux-gnu/bitcoin-df9ebbf659d5-aarch64-linux-gnu-debug.tar.gz\r\n3015b81d14d9339a9fddf7b7feb8b36c6fcaeb3247dec38baece958fc24065c7  guix-build-df9ebbf659d5/output/aarch64-linux-gnu/bitcoin-df9ebbf659d5-aarch64-linux-gnu.tar.gz\r\nd5333d546d6e2b6a696cbce2220ec217f835166d7a0c088634e6e268a96ba300  guix-build-df9ebbf659d5/output/arm-linux-gnueabihf/SHA256SUMS.part\r\n68031430cdcd6a2de5cb8ea523665367983b99c85825eefcbc2f6c8a630b099f  guix-build-df9ebbf659d5/output/arm-linux-gnueabihf/bitcoin-df9ebbf659d5-arm-linux-gnueabihf-debug.tar.gz\r\n99fbf0cd4e14abc0553d5ba7644646aa1d2b0cfa539c049dfb4ee868e6bf167c  guix-build-df9ebbf659d5/output/arm-linux-gnueabihf/bitcoin-df9ebbf659d5-arm-linux-gnueabihf.tar.gz\r\n8e2de487121792ba21e66b8671904a9d593da83c83416b2addc278b5d1da21c8  guix-build-df9ebbf659d5/output/arm64-apple-darwin/SHA256SUMS.part\r\n35728ce72fcfe5fa77b5fa7b228ae6bd001a8e55c7ae4cb21fe30b0ef73aba4c  guix-build-df9ebbf659d5/output/arm64-apple-darwin/bitcoin-df9ebbf659d5-arm64-apple-darwin-codesigning.tar.gz\r\n3606445152cede8ac6a2417965b59be17b45856855e64e4505840d898ae5a311  guix-build-df9ebbf659d5/output/arm64-apple-darwin/bitcoin-df9ebbf659d5-arm64-apple-darwin-unsigned.tar.gz\r\n07a6e43006d91392777037692dd3333ca76f875a0fce31fb3766d2999b7b1e7d  guix-build-df9ebbf659d5/output/arm64-apple-darwin/bitcoin-df9ebbf659d5-arm64-apple-darwin-unsigned.zip\r\n302a02a715fa2015c097b0c8bbe376822e8760f0a440adae9f1cc1df013667d1  guix-build-df9ebbf659d5/output/dist-archive/bitcoin-df9ebbf659d5.tar.gz\r\n7c41454b941cb247aa869319c7fe3821a356715babdba688cc90fbf8a73dd924  guix-build-df9ebbf659d5/output/powerpc64-linux-gnu/SHA256SUMS.part\r\nb5320e48ee7f21da24d9fe09df65a876da3a4a368695524d7cf78b4f07aea80e  guix-build-df9ebbf659d5/output/powerpc64-linux-gnu/bitcoin-df9ebbf659d5-powerpc64-linux-gnu-debug.tar.gz\r\n517eb21687c6047e53301c97d77c414caa56bd5ed7cdcfaf23f188e91a0a76e7  guix-build-df9ebbf659d5/output/powerpc64-linux-gnu/bitcoin-df9ebbf659d5-powerpc64-linux-gnu.tar.gz\r\n368d640618ef05cc4278886a39e706a25bc1f008039443a8540d91dd98372ac7  guix-build-df9ebbf659d5/output/riscv64-linux-gnu/SHA256SUMS.part\r\nfc2bdca01aa55f57bc3038ade9b59f514beb2a4fb9e5a82f75680cd2e4c5035e  guix-build-df9ebbf659d5/output/riscv64-linux-gnu/bitcoin-df9ebbf659d5-riscv64-linux-gnu-debug.tar.gz\r\n844bbea570fa22992aef28ba9c369164ead2b5b6d9223be23ba66444e857708f  guix-build-df9ebbf659d5/output/riscv64-linux-gnu/bitcoin-df9ebbf659d5-riscv64-linux-gnu.tar.gz\r\ndcc4c3ff5984c2216d6b5b6e5bdc20651d808f605fb3ef3b895277bc620aafe9  guix-build-df9ebbf659d5/output/x86_64-apple-darwin/SHA256SUMS.part\r\n793aedb951a9f1ba2df5c51ff2306e3c6f55334957457cb1a2ec064d559a73e4  guix-build-df9ebbf659d5/output/x86_64-apple-darwin/bitcoin-df9ebbf659d5-x86_64-apple-darwin-codesigning.tar.gz\r\nb830e5cf029ae6366be15af11f1772a812531c61fde71836c22a33eef5ed8db7  guix-build-df9ebbf659d5/output/x86_64-apple-darwin/bitcoin-df9ebbf659d5-x86_64-apple-darwin-unsigned.tar.gz\r\n36ad6470cf4d0c580f564c2cf11d6adba90d543529fbf7360e19c283979736af  guix-build-df9ebbf659d5/output/x86_64-apple-darwin/bitcoin-df9ebbf659d5-x86_64-apple-darwin-unsigned.zip\r\nb37096b3a3d59f275a0f5135aba1166046f5b4bb5d129439308e4c2d339462ed  guix-build-df9ebbf659d5/output/x86_64-linux-gnu/SHA256SUMS.part\r\n410ad822e7b74648c5005d13780c00f9c018b42ff36c94a7cd169166d8168938  guix-build-df9ebbf659d5/output/x86_64-linux-gnu/bitcoin-df9ebbf659d5-x86_64-linux-gnu-debug.tar.gz\r\n3908e6b44103343751b1e8df25360f3e1b959b67188a62ef6ac897e039b7bc3d  guix-build-df9ebbf659d5/output/x86_64-linux-gnu/bitcoin-df9ebbf659d5-x86_64-linux-gnu.tar.gz\r\n59fcd11af18f578dff44e65dd2407782547a13c10df26130985ef863b4e1d61a  guix-build-df9ebbf659d5/output/x86_64-w64-mingw32/SHA256SUMS.part\r\neeaa6d3a977e46d9c36c1e254737daff0624520b34f5d77e8e94c1f0c527b1e3  guix-build-df9ebbf659d5/output/x86_64-w64-mingw32/bitcoin-df9ebbf659d5-win64-codesigning.tar.gz\r\n5d5543c1ca0556d7eb0ddd9200beeabd502879c24ba2035077e22e0d20ee55c4  guix-build-df9ebbf659d5/output/x86_64-w64-mingw32/bitcoin-df9ebbf659d5-win64-debug.zip\r\nfcff8780dffac5a8e8b434a948d05ca4fe8527d4cca26cb39a1c0e8b1cd5299b  guix-build-df9ebbf659d5/output/x86_64-w64-mingw32/bitcoin-df9ebbf659d5-win64-setup-unsigned.exe\r\nd6bf58025866ef957499604c30709f1cda5c372bae215599ade0d7eefe726bea  guix-build-df9ebbf659d5/output/x86_64-w64-mingw32/bitcoin-df9ebbf659d5-win64-unsigned.zip\r\n```",
          "created_at": "2025-05-23T11:35:07Z"
        },
        {
          "user": "fanquake",
          "body": "@willcl-ark Thanks for circling back around. We can follow up with the build env leakage.",
          "created_at": "2025-06-03T19:19:47Z"
        },
        {
          "user": "fanquake",
          "body": "Backported to `29.x` in #32589.",
          "created_at": "2025-06-03T19:27:27Z"
        },
        {
          "user": "fanquake",
          "body": "Backported to `28.x` in #32684.",
          "created_at": "2025-06-05T13:52:20Z"
        }
      ]
    },
    {
      "number": 32567,
      "title": "subprocess: Backport upstream changes",
      "body": "A list of the backported PRs:\r\n- https://github.com/arun11299/cpp-subprocess/pull/119\r\n\r\nThe following PRs were skipped for backporting:\r\n- https://github.com/arun11299/cpp-subprocess/pull/118 because there is no changes in the header code.\r\n\r\nRequired for https://github.com/bitcoin/bitcoin/pull/32566.",
      "state": "closed",
      "user": "hebasto",
      "created_at": "2025-05-20T10:56:27Z",
      "updated_at": "2025-05-21T12:33:40Z",
      "comments": 5,
      "url": "https://github.com/bitcoin/bitcoin/pull/32567",
      "labels": [],
      "comment_list": [
        {
          "user": "DrahtBot",
          "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/32567.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| ACK | [laanwj](https://github.com/bitcoin/bitcoin/pull/32567#pullrequestreview-2857235239) |\n\nIf your review is incorrectly listed, please react with üëé to this comment and the bot will ignore it on the next update.\n<!--5faf32d7da4f0f540f40219e4f7537a3-->",
          "created_at": "2025-05-20T10:56:30Z"
        },
        {
          "user": "hebasto",
          "body": "cc @laanwj ",
          "created_at": "2025-05-20T10:56:38Z"
        },
        {
          "user": "fanquake",
          "body": "Can't this just go in with #32566? Why does it need it's own PR?",
          "created_at": "2025-05-20T11:03:55Z"
        },
        {
          "user": "hebasto",
          "body": "> Can't this just go in with #32566? Why does it need it's own PR?\r\n\r\nIt would be easier to track backports.",
          "created_at": "2025-05-20T11:11:23Z"
        },
        {
          "user": "laanwj",
          "body": "The change is important for #32566 because the functional test was failing for the wallet notification, due to the extra space ending up in the output of `echo`.\r\n\r\ni don't particularly mind how it ends up in the repository.",
          "created_at": "2025-05-21T10:39:31Z"
        }
      ]
    }
  ],
  "issues": [
    {
      "number": 32574,
      "title": "subprocess: `sh -c 'echo err 1>&2 && false'` must return `1`",
      "body": "On OpenIndiana:\n```\n./test/system_tests.cpp(54): error: in \"system_tests/run_command\": check what.find(tfm::format(\"RunCommandParseJSON error: process(%s) returned\", command)) != std::string::npos has failed\n./test/system_tests.cpp(55): error: in \"system_tests/run_command\": check what.find(expected) != std::string::npos has failed\n```\n\nSame on [OmniOS](https://github.com/hebasto/bitcoin-core-nightly/actions/runs/15121791773/job/42505618501):\n```\n./test/system_tests.cpp(54): error: in \"system_tests/run_command\": check what.find(tfm::format(\"RunCommandParseJSON error: process(%s) returned\", command)) != std::string::npos has failed\n./test/system_tests.cpp(55): error: in \"system_tests/run_command\": check what.find(expected) != std::string::npos has failed\n```",
      "state": "open",
      "user": "hebasto",
      "created_at": "2025-05-20T20:07:00Z",
      "updated_at": "2025-05-23T19:26:27Z",
      "comments": 2,
      "url": "https://github.com/bitcoin/bitcoin/issues/32574",
      "labels": [
        "Tests"
      ],
      "comment_list": [
        {
          "user": "hebasto",
          "body": "The underlying issue is not specific to illumos.\n\nWith the following patch:\n```diff\n--- a/src/test/system_tests.cpp\n+++ b/src/test/system_tests.cpp\n@@ -67,7 +67,7 @@ BOOST_AUTO_TEST_CASE(run_command)\n         const std::string expected{\"err\"};\n         BOOST_CHECK_EXCEPTION(RunCommandParseJSON(command), std::runtime_error, [&](const std::runtime_error& e) {\n             const std::string what(e.what());\n-            BOOST_CHECK(what.find(strprintf(\"RunCommandParseJSON error: process(%s) returned\", command)) != std::string::npos);\n+            BOOST_CHECK(what.find(strprintf(\"RunCommandParseJSON error: process(%s) returned 1\", command)) != std::string::npos);\n             BOOST_CHECK(what.find(expected) != std::string::npos);\n             return true;\n         });\n```\n\nit becomes evident that the command `sh -c 'echo err 1>&2 && false'` does not exit with status `1`.",
          "created_at": "2025-05-23T05:58:29Z"
        },
        {
          "user": "ryanofsky",
          "body": "> The underlying issue is not specific to illumos.\n\nI couldn't find an explanation of the underlying issue, but looking at this more, I think I maybe understand the problem. The test code that is failing looks like:\n\n```c++\n    49          // Return non-zero exit code, with error message for stderr\n    50          const std::string command{\"sh -c 'echo err 1>&2 && false'\"};\n    51          const std::string expected{\"err\"};\n    52          BOOST_CHECK_EXCEPTION(RunCommandParseJSON(command), std::runtime_error, [&](const std::runtime_error& e) {\n    53              const std::string what(e.what());\n    54              BOOST_CHECK(what.find(strprintf(\"RunCommandParseJSON error: process(%s) returned\", command)) != std::string::npos);\n    55              BOOST_CHECK(what.find(expected) != std::string::npos);\n    56              return true;\n    57          });\n```\n\nAnd the specific checks that are failing are on line 54 and 55 as reported initially.\n\nWhat the test is trying to do here is execute the command `sh -c 'echo err 1>&2 && false` on the current system.\n\nThen line 54 is checking trying to look for the [RunCommandParseJSON error](https://github.com/bitcoin/bitcoin/blob/master/src/common/run_command.cpp#L41) thrown when the command returns a nonzero exit code. Apparently this check is failing because on illumos the command returns a 0 exit code?\n\nAnd line 55 is checking for the string \"err\" somewhere in the same error message. But that check also fails for the same reason.\n\nThe fact that these BOOST_CHECK statements are failing inside the BOOST_CHECK_EXCEPTION check for a std::runtime_error exception probably indicates that some std::runtime_error exception is being thrown, so it is probably just the one thrown when the command returns [invalid json](https://github.com/bitcoin/bitcoin/blob/2df824f4e62b6bc569044819cd64f66f3839ba13/src/common/run_command.cpp#L42)\n\nThe test seems pretty broken currently, so not surprising that it returns inconsistent results on different operating systems.\n\nBecause we are not enabling the subprocess module's shell option, the subprocess module is attempting to parse the command line `sh -c 'echo err 1>&2 && false'` itself. And it looks like it does that [pretty poorly](https://github.com/bitcoin/bitcoin/blob/2df824f4e62b6bc569044819cd64f66f3839ba13/src/util/subprocess.h#L316-L334) splitting the command up into an argv array consisting of `[\"sh\", \"-c\", \"'echo\", \"err\", \"1>&2\", \"&&\", \"false'\"]` arguments. On linux, because `'echo` is not a valid shell script, the bash shell returns exit code 2 and error message ``err: -c: line 1: unexpected EOF while looking for matching `''``. The reason why the bash message begins with \"err\" is that bash interprets the trailing arguments \"'echo\", \"err\", \"1>&2\", ... as $0, $1, $2, .... arguments to the bash script, so it treating \"err\" as $0 as the name of the script it thinks it is executing and using that script name in its error message.\n\nSo that explains why the test is passing on linux with bash, even if its not checking for a particularly meaningful condition.\n\nIt is unclear what exactly is causing the behavior on illumos, but my guess would be that illumos shell might be just treating `sh -c \"'echo\" \"err\" \"1>&2\" \"&&\" \"false'\"` as an echo command and returning success and not bothering to complain that the `'echo` quote is unterminated.\n\nIn any case, I couldn't think of any way to fix this test to use RunCommandParseJSON to run a command printing to stderr on linux, because the split function splits on spaces and tabs and it's hard to write a shell script that doesn't include spaces or tabs.\n\nWe could change RunCommandParseJSON to actually execute full shell commands as was done in 4837fdc1569d58541fb310251b969ae160907e6e from #32577. But ultimately the best approach for our use-case might be to avoid even more joining and splitting and unnecessary use of shell and just make RunCommandParseJSON take an `vector<string>` array that it can pass to the subprocess library, instead of passing any string that needs to be parsed\n\n\n\n\n",
          "created_at": "2025-05-23T19:23:02Z"
        }
      ]
    },
    {
      "number": 32571,
      "title": "build: error when building for test coverage",
      "body": "### Is there an existing issue for this?\n\n- [x] I have searched the existing issues\n\n### Current behaviour\n\nWhen trying to compile it for test coverage, I'm getting the following error:\n```\ngenhtml: ERROR: cannot read /Users/brunogarcia/projects/bitcoin-core-dev/build_cov/src/CMakeFiles/bitcoin-cli.dir/span.h\nProcessing file CMakeFiles/bitcoin-cli.dir/span.h\nCMake Error at build_cov/Coverage.cmake:46 (execute_process):\n  execute_process failed command indexes:\n\n    1: \"Child return code: 2\"\n```\n\n### Expected behaviour\n\nSuccessful build for test coverage\n\n### Steps to reproduce\n\n```sh\ncmake -B build_cov -DCMAKE_BUILD_TYPE=Coverage \ncmake --build build_cov\ncmake -P build_cov/Coverage.cmake\n```\n\nSame from `developer-notes.md`\n\n### Relevant log output\n\n```sh\n...\nFinished .info-file creation\nDeleting all .da files in src and subdirectories\nDone.\nCombining tracefiles.\nReading tracefile test_bitcoin_filtered.info\nWriting data to test_bitcoin_filtered.info\nSummary coverage rate:\n  lines......: 63.7% (98724 of 155052 lines)\n  functions..: 61.0% (107273 of 175800 functions)\n  branches...: no data found\nCombining tracefiles.\nReading tracefile baseline_filtered.info\nReading tracefile test_bitcoin_filtered.info\nWriting data to test_bitcoin_coverage.info\nSummary coverage rate:\n  lines......: 61.3% (98724 of 160966 lines)\n  functions..: 59.5% (107273 of 180241 functions)\n  branches...: no data found\nReading data file test_bitcoin_coverage.info\nFound 2062 entries.\nFound common filename prefix \"/Users/brunogarcia/projects/bitcoin-core-dev/build_cov/src\"\nWriting .css and .png files.\nGenerating output.\ngenhtml: ERROR: cannot read /Users/brunogarcia/projects/bitcoin-core-dev/build_cov/src/CMakeFiles/bitcoin-cli.dir/span.h\nProcessing file CMakeFiles/bitcoin-cli.dir/span.h\nCMake Error at build_cov/Coverage.cmake:46 (execute_process):\n  execute_process failed command indexes:\n\n    1: \"Child return code: 2\"\n```\n\n### How did you obtain Bitcoin Core\n\nCompiled from source\n\n### What version of Bitcoin Core are you using?\n\nmaster@0f9baba0fb6e55612f0b4b8d36f6deebe35b8a5f\n\n### Operating system and version\n\nMacOS Sonoma 14.3\n\n### Machine specifications\n\n```\nHomebrew clang version 18.1.8\nTarget: arm64-apple-darwin23.3.0\nThread model: posix\nInstalledDir: /opt/homebrew/opt/llvm@18/bin\n```",
      "state": "closed",
      "user": "brunoerg",
      "created_at": "2025-05-20T16:39:17Z",
      "updated_at": "2025-05-20T16:59:36Z",
      "comments": 2,
      "url": "https://github.com/bitcoin/bitcoin/issues/32571",
      "labels": [],
      "comment_list": [
        {
          "user": "hebasto",
          "body": "What if you were to use the instructions from https://github.com/bitcoin/bitcoin/blob/master/doc/developer-notes.md#using-llvmclang-toolchain?",
          "created_at": "2025-05-20T16:55:17Z"
        },
        {
          "user": "brunoerg",
          "body": "It worked, sorry, missed that. Thank you.",
          "created_at": "2025-05-20T16:59:36Z"
        }
      ]
    },
    {
      "number": 32570,
      "title": "[RPC] deriveaddresses pk(descriptor) returns p2pkh address",
      "body": "### Current behaviour\n\nWhile trying to extract the public key from a descriptor I might have walked into this bug. My thought was passing a pk(xpub) descriptor would return either an error or a pubkey to push instead it returned the p2pkh address. This is IMO inconsistent and frankly not very useful because the PK is behind the hash.\n\nNote there are both pk and pkh types.\n\n```\n[bitcoin@qrsnaps0 ~]$ bitcoin-cli deriveaddresses \"pk([deadbeef/48'/0'/0'/2']xpub ... /0/*)#deadbeef\" 0\n[\n  \"1address...\"\n]\n```\n\n### Expected behaviour\n\nError or return compressed pubkey",
      "state": "closed",
      "user": "portlandhodl",
      "created_at": "2025-05-20T16:12:53Z",
      "updated_at": "2025-05-20T17:26:25Z",
      "comments": 1,
      "url": "https://github.com/bitcoin/bitcoin/issues/32570",
      "labels": [],
      "comment_list": [
        {
          "user": "portlandhodl",
          "body": "Closing, incorrect version",
          "created_at": "2025-05-20T17:26:23Z"
        }
      ]
    }
  ],
  "summary": {
    "pull_requests": 6,
    "issues": 3
  }
}