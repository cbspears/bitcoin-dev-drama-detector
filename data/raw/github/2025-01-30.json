{
  "source": "github",
  "repository": "bitcoin/bitcoin",
  "fetched_at": "2026-01-15T19:13:27.020917+00:00",
  "date": "2025-01-30",
  "pull_requests": [
    {
      "number": 31768,
      "title": "test: check `scanning` field from `getwalletinfo`",
      "body": "During a rescan, check that `getwalletinfo` returns properly information (the scanning field) about it.",
      "state": "closed",
      "user": "brunoerg",
      "created_at": "2025-01-30T19:01:06Z",
      "updated_at": "2025-02-17T21:24:00Z",
      "comments": 5,
      "url": "https://github.com/bitcoin/bitcoin/pull/31768",
      "labels": [
        "Tests"
      ],
      "comment_list": [
        {
          "user": "DrahtBot",
          "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/31768.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| ACK | [maflcko](https://github.com/bitcoin/bitcoin/pull/31768#issuecomment-2634283850), [arejula27](https://github.com/bitcoin/bitcoin/pull/31768#issuecomment-2637800811), [BrandonOdiwuor](https://github.com/bitcoin/bitcoin/pull/31768#pullrequestreview-2609296885), [Prabhat1308](https://github.com/bitcoin/bitcoin/pull/31768#pullrequestreview-2609887988), [achow101](https://github.com/bitcoin/bitcoin/pull/31768#issuecomment-2657972899) |\n\nIf your review is incorrectly listed, please react with ðŸ‘Ž to this comment and the bot will ignore it on the next update.\n",
          "created_at": "2025-01-30T19:01:09Z"
        },
        {
          "user": "maflcko",
          "body": "lgtm ACK bb0879ddabc8b3a7253bc774d23b842937d18015",
          "created_at": "2025-02-04T15:17:02Z"
        },
        {
          "user": "arejula27",
          "body": "ACK [`bb0879d`](https://github.com/bitcoin/bitcoin/pull/31768/commits/bb0879ddabc8b3a7253bc774d23b842937d18015)\r\n\r\nThe test looks good as it improves the verification of an RPC call field. However, the verified field produces different values depending on the scan situation:  \r\n\r\n> \"scanning\" : {                          (json object) current scanning details, or false if no scan is in progress>\r\n>  &nbsp;&nbsp;&nbsp;&nbsp;\"duration\" : n,                       (numeric) elapsed seconds since scan start\r\n>  &nbsp;&nbsp;&nbsp;&nbsp;\"progress\" : n                        (numeric) scanning progress percentage [0.0, 1.0]\r\n  },\r\n\r\nI believe this PR would be more complete if it also verified the `false` caseâ€”for example, when importing the `p2pkh` descriptor for the first time (around line 108).  \r\n",
          "created_at": "2025-02-05T19:09:15Z"
        },
        {
          "user": "achow101",
          "body": "ACK bb0879ddabc8b3a7253bc774d23b842937d18015",
          "created_at": "2025-02-14T00:14:43Z"
        },
        {
          "user": "janb84",
          "body": "Post-merge ACK [bb0879d](https://github.com/bitcoin/bitcoin/commit/bb0879ddabc8b3a7253bc774d23b842937d18015)\r\n\r\nSmall improvement suggestion; also testing that the progress is between 0 and 1.\r\n``` python\r\nprogress = wallet_info[\"scanning\"][\"progress\"]\r\nassert_approx(progress,0,1)\r\n```\r\n",
          "created_at": "2025-02-14T11:03:58Z"
        }
      ]
    },
    {
      "number": 31767,
      "title": "logging: Ensure -debug=0/none behaves consistently with -nodebug",
      "body": "Previously, -nodebug cleared all prior -debug configurations in the command line while allowing subsequent debug options to be applied.\r\nHowever, -debug=0 and -debug=none completely disabled debugging, even for categories specified afterward.\r\n    \r\nThis commit ensures consistency by making -debug=0 and -debug=none behave like -nodebug: they now clear previously set debug configurations but do not disable debugging for categories specified later.\r\n\r\nSee https://github.com/bitcoin/bitcoin/pull/30529#discussion_r1930956563",
      "state": "closed",
      "user": "danielabrozzoni",
      "created_at": "2025-01-30T17:04:24Z",
      "updated_at": "2025-02-13T13:40:20Z",
      "comments": 1,
      "url": "https://github.com/bitcoin/bitcoin/pull/31767",
      "labels": [],
      "comment_list": [
        {
          "user": "DrahtBot",
          "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/31767.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| ACK | [hodlinator](https://github.com/bitcoin/bitcoin/pull/31767#pullrequestreview-2608732876), [ryanofsky](https://github.com/bitcoin/bitcoin/pull/31767#pullrequestreview-2612274487), [maflcko](https://github.com/bitcoin/bitcoin/pull/31767#pullrequestreview-2614664083) |\n\nIf your review is incorrectly listed, please react with ðŸ‘Ž to this comment and the bot will ignore it on the next update.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#30529](https://github.com/bitcoin/bitcoin/pull/30529) (Fix -norpcwhitelist, -norpcallowip, and similar corner case behavior by ryanofsky)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n",
          "created_at": "2025-01-30T17:04:27Z"
        }
      ]
    },
    {
      "number": 31766,
      "title": "leveldb: pull upstream C++23 changes",
      "body": "Cherry-picks two commits from upstream (https://github.com/google/leveldb/commit/302786e211d1f2e6fd260261f642d03a91e5922c, https://github.com/google/leveldb/commit/e829478c6a3a55d8e5c1227e2678dcc18d518609), which remove the usage of `std::aligned_storage/std::aligned_union`. \r\n\r\nNote the first cherry-pick is not clean, because due to Google tooling issues, it accidently contained a revert of the prior two commits. See https://github.com/google/leveldb/pull/1249 for more details.\r\n\r\nAlso see https://issues.chromium.org/issues/388068052, although note that they [reverted the roll to latest leveldb](https://issues.chromium.org/issues/388068052#comment9). I'm guessing due to the acidental reversion issue above.",
      "state": "closed",
      "user": "fanquake",
      "created_at": "2025-01-30T14:01:28Z",
      "updated_at": "2025-03-20T09:13:13Z",
      "comments": 6,
      "url": "https://github.com/bitcoin/bitcoin/pull/31766",
      "labels": [],
      "comment_list": [
        {
          "user": "DrahtBot",
          "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/31766.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| ACK | [darosior](https://github.com/bitcoin/bitcoin/pull/31766#pullrequestreview-2696569585), [dergoegge](https://github.com/bitcoin/bitcoin/pull/31766#pullrequestreview-2698577016), [l0rinc](https://github.com/bitcoin/bitcoin/pull/31766#issuecomment-2736826828) |\n\nIf your review is incorrectly listed, please react with ðŸ‘Ž to this comment and the bot will ignore it on the next update.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nNo conflicts as of last run.\n",
          "created_at": "2025-01-30T14:01:32Z"
        },
        {
          "user": "DrahtBot",
          "body": "<!--85328a0da195eb286784d51f73fa0af9-->\nðŸš§ At least one of the CI tasks failed.\n<sub>Debug: https://github.com/bitcoin/bitcoin/runs/36420557428</sub>\n\n<details><summary>Hints</summary>\n\nTry to run the tests locally, according to the documentation. However, a CI failure may still\nhappen due to a number of reasons, for example:\n\n* Possibly due to a silent merge conflict (the changes in this pull request being\nincompatible with the current code in the target branch). If so, make sure to rebase on the latest\ncommit of the target branch.\n\n* A sanitizer issue, which can only be found by compiling with the sanitizer and running the\n  affected test.\n\n* An intermittent issue.\n\nLeave a comment here, if you need help tracking down a confusing failure.\n\n</details>\n",
          "created_at": "2025-01-30T15:00:25Z"
        },
        {
          "user": "victorvianna",
          "body": "FYI the upstream PR landed",
          "created_at": "2025-01-30T17:48:56Z"
        },
        {
          "user": "fanquake",
          "body": "Updated now that the changes have landed upstream in https://github.com/bitcoin-core/leveldb-subtree/pull/47.",
          "created_at": "2025-03-07T17:10:39Z"
        },
        {
          "user": "l0rinc",
          "body": "I have first compared every modified file completely against the latest versions of https://github.com/google/leveldb/blob/main/util/env_posix.cc, https://github.com/google/leveldb/blob/main/util/env_windows.cc and https://github.com/google/leveldb/blob/main/util/no_destructor.h, but realized we're too far behind.\r\n\r\n<details>\r\n<summary>Full diff</summary>\r\n\r\n```patch\r\ndiff --git a/src/leveldb/util/env_posix.cc b/src/leveldb/util/env_posix.cc\r\nindex 86571059ba..25399f9745 100644\r\n--- a/src/leveldb/util/env_posix.cc\r\n+++ b/src/leveldb/util/env_posix.cc\r\n@@ -4,9 +4,10 @@\r\n \r\n #include <dirent.h>\r\n #include <fcntl.h>\r\n-#include <pthread.h>\r\n #include <sys/mman.h>\r\n+#ifndef __Fuchsia__\r\n #include <sys/resource.h>\r\n+#endif\r\n #include <sys/stat.h>\r\n #include <sys/time.h>\r\n #include <sys/types.h>\r\n@@ -42,14 +43,14 @@ namespace {\r\n // Set by EnvPosixTestHelper::SetReadOnlyMMapLimit() and MaxOpenFiles().\r\n int g_open_read_only_file_limit = -1;\r\n \r\n-// Up to 4096 mmap regions for 64-bit binaries; none for 32-bit.\r\n-constexpr const int kDefaultMmapLimit = (sizeof(void*) >= 8) ? 4096 : 0;\r\n+// Up to 1000 mmap regions for 64-bit binaries; none for 32-bit.\r\n+constexpr const int kDefaultMmapLimit = (sizeof(void*) >= 8) ? 1000 : 0;\r\n \r\n // Can be set using EnvPosixTestHelper::SetReadOnlyMMapLimit().\r\n int g_mmap_limit = kDefaultMmapLimit;\r\n \r\n // Common flags defined for all posix open operations\r\n-#if HAVE_O_CLOEXEC\r\n+#if defined(HAVE_O_CLOEXEC)\r\n constexpr const int kOpenBaseFlags = O_CLOEXEC;\r\n #else\r\n constexpr const int kOpenBaseFlags = 0;\r\n@@ -72,7 +73,14 @@ Status PosixError(const std::string& context, int error_number) {\r\n class Limiter {\r\n  public:\r\n   // Limit maximum number of resources to |max_acquires|.\r\n-  Limiter(int max_acquires) : acquires_allowed_(max_acquires) {}\r\n+  Limiter(int max_acquires)\r\n+      :\r\n+#if !defined(NDEBUG)\r\n+        max_acquires_(max_acquires),\r\n+#endif  // !defined(NDEBUG)\r\n+        acquires_allowed_(max_acquires) {\r\n+    assert(max_acquires >= 0);\r\n+  }\r\n \r\n   Limiter(const Limiter&) = delete;\r\n   Limiter operator=(const Limiter&) = delete;\r\n@@ -85,15 +93,35 @@ class Limiter {\r\n \r\n     if (old_acquires_allowed > 0) return true;\r\n \r\n-    acquires_allowed_.fetch_add(1, std::memory_order_relaxed);\r\n+    int pre_increment_acquires_allowed =\r\n+        acquires_allowed_.fetch_add(1, std::memory_order_relaxed);\r\n+\r\n+    // Silence compiler warnings about unused arguments when NDEBUG is defined.\r\n+    (void)pre_increment_acquires_allowed;\r\n+    // If the check below fails, Release() was called more times than acquire.\r\n+    assert(pre_increment_acquires_allowed < max_acquires_);\r\n+\r\n     return false;\r\n   }\r\n \r\n   // Release a resource acquired by a previous call to Acquire() that returned\r\n   // true.\r\n-  void Release() { acquires_allowed_.fetch_add(1, std::memory_order_relaxed); }\r\n+  void Release() {\r\n+    int old_acquires_allowed =\r\n+        acquires_allowed_.fetch_add(1, std::memory_order_relaxed);\r\n+\r\n+    // Silence compiler warnings about unused arguments when NDEBUG is defined.\r\n+    (void)old_acquires_allowed;\r\n+    // If the check below fails, Release() was called more times than acquire.\r\n+    assert(old_acquires_allowed < max_acquires_);\r\n+  }\r\n \r\n  private:\r\n+#if !defined(NDEBUG)\r\n+  // Catches an excessive number of Release() calls.\r\n+  const int max_acquires_;\r\n+#endif  // !defined(NDEBUG)\r\n+\r\n   // The number of available resources.\r\n   //\r\n   // This is a counter and is not tied to the invariants of any other class, so\r\n@@ -108,7 +136,7 @@ class Limiter {\r\n class PosixSequentialFile final : public SequentialFile {\r\n  public:\r\n   PosixSequentialFile(std::string filename, int fd)\r\n-      : fd_(fd), filename_(filename) {}\r\n+      : fd_(fd), filename_(std::move(filename)) {}\r\n   ~PosixSequentialFile() override { close(fd_); }\r\n \r\n   Status Read(size_t n, Slice* result, char* scratch) override {\r\n@@ -135,8 +163,6 @@ class PosixSequentialFile final : public SequentialFile {\r\n     return Status::OK();\r\n   }\r\n \r\n-  virtual std::string GetName() const override { return filename_; }\r\n-\r\n  private:\r\n   const int fd_;\r\n   const std::string filename_;\r\n@@ -197,8 +223,6 @@ class PosixRandomAccessFile final : public RandomAccessFile {\r\n     return status;\r\n   }\r\n \r\n-  virtual std::string GetName() const override { return filename_; }\r\n-\r\n  private:\r\n   const bool has_permanent_fd_;  // If false, the file is opened on every read.\r\n   const int fd_;                 // -1 if has_permanent_fd_ is false.\r\n@@ -218,7 +242,7 @@ class PosixMmapReadableFile final : public RandomAccessFile {\r\n   // over the ownership of the region.\r\n   //\r\n   // |mmap_limiter| must outlive this instance. The caller must have already\r\n-  // aquired the right to use one mmap region, which will be released when this\r\n+  // acquired the right to use one mmap region, which will be released when this\r\n   // instance is destroyed.\r\n   PosixMmapReadableFile(std::string filename, char* mmap_base, size_t length,\r\n                         Limiter* mmap_limiter)\r\n@@ -243,8 +267,6 @@ class PosixMmapReadableFile final : public RandomAccessFile {\r\n     return Status::OK();\r\n   }\r\n \r\n-  virtual std::string GetName() const override { return filename_; }\r\n-\r\n  private:\r\n   char* const mmap_base_;\r\n   const size_t length_;\r\n@@ -325,7 +347,7 @@ class PosixWritableFile final : public WritableFile {\r\n       return status;\r\n     }\r\n \r\n-    return SyncFd(fd_, filename_, false);\r\n+    return SyncFd(fd_, filename_);\r\n   }\r\n \r\n  private:\r\n@@ -360,7 +382,7 @@ class PosixWritableFile final : public WritableFile {\r\n     if (fd < 0) {\r\n       status = PosixError(dirname_, errno);\r\n     } else {\r\n-      status = SyncFd(fd, dirname_, true);\r\n+      status = SyncFd(fd, dirname_);\r\n       ::close(fd);\r\n     }\r\n     return status;\r\n@@ -372,7 +394,7 @@ class PosixWritableFile final : public WritableFile {\r\n   //\r\n   // The path argument is only used to populate the description string in the\r\n   // returned Status if an error occurs.\r\n-  static Status SyncFd(int fd, const std::string& fd_path, bool syncing_dir) {\r\n+  static Status SyncFd(int fd, const std::string& fd_path) {\r\n #if HAVE_FULLFSYNC\r\n     // On macOS and iOS, fsync() doesn't guarantee durability past power\r\n     // failures. fcntl(F_FULLFSYNC) is required for that purpose. Some\r\n@@ -392,11 +414,6 @@ class PosixWritableFile final : public WritableFile {\r\n     if (sync_success) {\r\n       return Status::OK();\r\n     }\r\n-    // Do not crash if filesystem can't fsync directories\r\n-    // (see https://github.com/bitcoin/bitcoin/pull/10000)\r\n-    if (syncing_dir && errno == EINVAL) {\r\n-      return Status::OK();\r\n-    }\r\n     return PosixError(fd_path, errno);\r\n   }\r\n \r\n@@ -437,8 +454,6 @@ class PosixWritableFile final : public WritableFile {\r\n     return Basename(filename).starts_with(\"MANIFEST\");\r\n   }\r\n \r\n-  virtual std::string GetName() const override { return filename_; }\r\n-\r\n   // buf_[0, pos_ - 1] contains data to be written to fd_.\r\n   char buf_[kWritableFileBufferSize];\r\n   size_t pos_;\r\n@@ -600,7 +615,7 @@ class PosixEnv : public Env {\r\n     return Status::OK();\r\n   }\r\n \r\n-  Status DeleteFile(const std::string& filename) override {\r\n+  Status RemoveFile(const std::string& filename) override {\r\n     if (::unlink(filename.c_str()) != 0) {\r\n       return PosixError(filename, errno);\r\n     }\r\n@@ -614,7 +629,7 @@ class PosixEnv : public Env {\r\n     return Status::OK();\r\n   }\r\n \r\n-  Status DeleteDir(const std::string& dirname) override {\r\n+  Status RemoveDir(const std::string& dirname) override {\r\n     if (::rmdir(dirname.c_str()) != 0) {\r\n       return PosixError(dirname, errno);\r\n     }\r\n@@ -741,7 +756,7 @@ class PosixEnv : public Env {\r\n   // Instances are constructed on the thread calling Schedule() and used on the\r\n   // background thread.\r\n   //\r\n-  // This structure is thread-safe beacuse it is immutable.\r\n+  // This structure is thread-safe because it is immutable.\r\n   struct BackgroundWorkItem {\r\n     explicit BackgroundWorkItem(void (*function)(void* arg), void* arg)\r\n         : function(function), arg(arg) {}\r\n@@ -770,6 +785,10 @@ int MaxOpenFiles() {\r\n   if (g_open_read_only_file_limit >= 0) {\r\n     return g_open_read_only_file_limit;\r\n   }\r\n+#ifdef __Fuchsia__\r\n+  // Fuchsia doesn't implement getrlimit.\r\n+  g_open_read_only_file_limit = 50;\r\n+#else\r\n   struct ::rlimit rlim;\r\n   if (::getrlimit(RLIMIT_NOFILE, &rlim)) {\r\n     // getrlimit failed, fallback to hard-coded default.\r\n@@ -780,6 +799,7 @@ int MaxOpenFiles() {\r\n     // Allow use of 20% of available file descriptors for read-only files.\r\n     g_open_read_only_file_limit = rlim.rlim_cur / 5;\r\n   }\r\n+#endif\r\n   return g_open_read_only_file_limit;\r\n }\r\n \r\n@@ -906,4 +926,4 @@ Env* Env::Default() {\r\n   return env_container.env();\r\n }\r\n \r\n-}  // namespace leveldb\r\n+}  // namespace leveldb\r\n\\ No newline at end of file\r\ndiff --git a/src/leveldb/util/env_windows.cc b/src/leveldb/util/env_windows.cc\r\nindex 0a48c3fb52..4b68efdd33 100644\r\n--- a/src/leveldb/util/env_windows.cc\r\n+++ b/src/leveldb/util/env_windows.cc\r\n@@ -33,10 +33,6 @@\r\n #include \"util/mutexlock.h\"\r\n #include \"util/windows_logger.h\"\r\n \r\n-#if defined(DeleteFile)\r\n-#undef DeleteFile\r\n-#endif  // defined(DeleteFile)\r\n-\r\n namespace leveldb {\r\n \r\n namespace {\r\n@@ -118,7 +114,14 @@ class ScopedHandle {\r\n class Limiter {\r\n  public:\r\n   // Limit maximum number of resources to |max_acquires|.\r\n-  Limiter(int max_acquires) : acquires_allowed_(max_acquires) {}\r\n+  Limiter(int max_acquires)\r\n+      :\r\n+#if !defined(NDEBUG)\r\n+        max_acquires_(max_acquires),\r\n+#endif  // !defined(NDEBUG)\r\n+        acquires_allowed_(max_acquires) {\r\n+    assert(max_acquires >= 0);\r\n+  }\r\n \r\n   Limiter(const Limiter&) = delete;\r\n   Limiter operator=(const Limiter&) = delete;\r\n@@ -137,9 +140,22 @@ class Limiter {\r\n \r\n   // Release a resource acquired by a previous call to Acquire() that returned\r\n   // true.\r\n-  void Release() { acquires_allowed_.fetch_add(1, std::memory_order_relaxed); }\r\n+  void Release() {\r\n+    int old_acquires_allowed =\r\n+        acquires_allowed_.fetch_add(1, std::memory_order_relaxed);\r\n+\r\n+    // Silence compiler warnings about unused arguments when NDEBUG is defined.\r\n+    (void)old_acquires_allowed;\r\n+    // If the check below fails, Release() was called more times than acquire.\r\n+    assert(old_acquires_allowed < max_acquires_);\r\n+  }\r\n \r\n  private:\r\n+#if !defined(NDEBUG)\r\n+  // Catches an excessive number of Release() calls.\r\n+  const int max_acquires_;\r\n+#endif  // !defined(NDEBUG)\r\n+\r\n   // The number of available resources.\r\n   //\r\n   // This is a counter and is not tied to the invariants of any other class, so\r\n@@ -177,8 +193,6 @@ class WindowsSequentialFile : public SequentialFile {\r\n     return Status::OK();\r\n   }\r\n \r\n-  std::string GetName() const override { return filename_; }\r\n-\r\n  private:\r\n   const ScopedHandle handle_;\r\n   const std::string filename_;\r\n@@ -194,7 +208,7 @@ class WindowsRandomAccessFile : public RandomAccessFile {\r\n   Status Read(uint64_t offset, size_t n, Slice* result,\r\n               char* scratch) const override {\r\n     DWORD bytes_read = 0;\r\n-    OVERLAPPED overlapped = {};\r\n+    OVERLAPPED overlapped = {0};\r\n \r\n     overlapped.OffsetHigh = static_cast<DWORD>(offset >> 32);\r\n     overlapped.Offset = static_cast<DWORD>(offset);\r\n@@ -211,8 +225,6 @@ class WindowsRandomAccessFile : public RandomAccessFile {\r\n     return Status::OK();\r\n   }\r\n \r\n-  std::string GetName() const override { return filename_; }\r\n-\r\n  private:\r\n   const ScopedHandle handle_;\r\n   const std::string filename_;\r\n@@ -244,8 +256,6 @@ class WindowsMmapReadableFile : public RandomAccessFile {\r\n     return Status::OK();\r\n   }\r\n \r\n-  std::string GetName() const override { return filename_; }\r\n-\r\n  private:\r\n   char* const mmap_base_;\r\n   const size_t length_;\r\n@@ -315,8 +325,6 @@ class WindowsWritableFile : public WritableFile {\r\n     return Status::OK();\r\n   }\r\n \r\n-  std::string GetName() const override { return filename_; }\r\n-\r\n  private:\r\n   Status FlushBuffer() {\r\n     Status status = WriteUnbuffered(buf_, pos_);\r\n@@ -387,9 +395,8 @@ class WindowsEnv : public Env {\r\n     *result = nullptr;\r\n     DWORD desired_access = GENERIC_READ;\r\n     DWORD share_mode = FILE_SHARE_READ;\r\n-    auto wFilename = toUtf16(filename);\r\n-    ScopedHandle handle = ::CreateFileW(\r\n-        wFilename.c_str(), desired_access, share_mode,\r\n+    ScopedHandle handle = ::CreateFileA(\r\n+        filename.c_str(), desired_access, share_mode,\r\n         /*lpSecurityAttributes=*/nullptr, OPEN_EXISTING, FILE_ATTRIBUTE_NORMAL,\r\n         /*hTemplateFile=*/nullptr);\r\n     if (!handle.is_valid()) {\r\n@@ -405,9 +412,8 @@ class WindowsEnv : public Env {\r\n     *result = nullptr;\r\n     DWORD desired_access = GENERIC_READ;\r\n     DWORD share_mode = FILE_SHARE_READ;\r\n-    auto wFilename = toUtf16(filename);\r\n     ScopedHandle handle =\r\n-        ::CreateFileW(wFilename.c_str(), desired_access, share_mode,\r\n+        ::CreateFileA(filename.c_str(), desired_access, share_mode,\r\n                       /*lpSecurityAttributes=*/nullptr, OPEN_EXISTING,\r\n                       FILE_ATTRIBUTE_READONLY,\r\n                       /*hTemplateFile=*/nullptr);\r\n@@ -427,7 +433,7 @@ class WindowsEnv : public Env {\r\n     }\r\n \r\n     ScopedHandle mapping =\r\n-        ::CreateFileMappingW(handle.get(),\r\n+        ::CreateFileMappingA(handle.get(),\r\n                              /*security attributes=*/nullptr, PAGE_READONLY,\r\n                              /*dwMaximumSizeHigh=*/0,\r\n                              /*dwMaximumSizeLow=*/0,\r\n@@ -452,9 +458,8 @@ class WindowsEnv : public Env {\r\n                          WritableFile** result) override {\r\n     DWORD desired_access = GENERIC_WRITE;\r\n     DWORD share_mode = 0;  // Exclusive access.\r\n-    auto wFilename = toUtf16(filename);\r\n-    ScopedHandle handle = ::CreateFileW(\r\n-        wFilename.c_str(), desired_access, share_mode,\r\n+    ScopedHandle handle = ::CreateFileA(\r\n+        filename.c_str(), desired_access, share_mode,\r\n         /*lpSecurityAttributes=*/nullptr, CREATE_ALWAYS, FILE_ATTRIBUTE_NORMAL,\r\n         /*hTemplateFile=*/nullptr);\r\n     if (!handle.is_valid()) {\r\n@@ -470,9 +475,8 @@ class WindowsEnv : public Env {\r\n                            WritableFile** result) override {\r\n     DWORD desired_access = FILE_APPEND_DATA;\r\n     DWORD share_mode = 0;  // Exclusive access.\r\n-    auto wFilename = toUtf16(filename);\r\n-    ScopedHandle handle = ::CreateFileW(\r\n-        wFilename.c_str(), desired_access, share_mode,\r\n+    ScopedHandle handle = ::CreateFileA(\r\n+        filename.c_str(), desired_access, share_mode,\r\n         /*lpSecurityAttributes=*/nullptr, OPEN_ALWAYS, FILE_ATTRIBUTE_NORMAL,\r\n         /*hTemplateFile=*/nullptr);\r\n     if (!handle.is_valid()) {\r\n@@ -485,16 +489,14 @@ class WindowsEnv : public Env {\r\n   }\r\n \r\n   bool FileExists(const std::string& filename) override {\r\n-    auto wFilename = toUtf16(filename);\r\n-    return GetFileAttributesW(wFilename.c_str()) != INVALID_FILE_ATTRIBUTES;\r\n+    return GetFileAttributesA(filename.c_str()) != INVALID_FILE_ATTRIBUTES;\r\n   }\r\n \r\n   Status GetChildren(const std::string& directory_path,\r\n                      std::vector<std::string>* result) override {\r\n     const std::string find_pattern = directory_path + \"\\\\*\";\r\n-    WIN32_FIND_DATAW find_data;\r\n-    auto wFind_pattern = toUtf16(find_pattern);\r\n-    HANDLE dir_handle = ::FindFirstFileW(wFind_pattern.c_str(), &find_data);\r\n+    WIN32_FIND_DATAA find_data;\r\n+    HANDLE dir_handle = ::FindFirstFileA(find_pattern.c_str(), &find_data);\r\n     if (dir_handle == INVALID_HANDLE_VALUE) {\r\n       DWORD last_error = ::GetLastError();\r\n       if (last_error == ERROR_FILE_NOT_FOUND) {\r\n@@ -506,12 +508,11 @@ class WindowsEnv : public Env {\r\n       char base_name[_MAX_FNAME];\r\n       char ext[_MAX_EXT];\r\n \r\n-      auto find_data_filename = toUtf8(find_data.cFileName);\r\n-      if (!_splitpath_s(find_data_filename.c_str(), nullptr, 0, nullptr, 0,\r\n-                        base_name, ARRAYSIZE(base_name), ext, ARRAYSIZE(ext))) {\r\n+      if (!_splitpath_s(find_data.cFileName, nullptr, 0, nullptr, 0, base_name,\r\n+                        ARRAYSIZE(base_name), ext, ARRAYSIZE(ext))) {\r\n         result->emplace_back(std::string(base_name) + ext);\r\n       }\r\n-    } while (::FindNextFileW(dir_handle, &find_data));\r\n+    } while (::FindNextFileA(dir_handle, &find_data));\r\n     DWORD last_error = ::GetLastError();\r\n     ::FindClose(dir_handle);\r\n     if (last_error != ERROR_NO_MORE_FILES) {\r\n@@ -520,25 +521,22 @@ class WindowsEnv : public Env {\r\n     return Status::OK();\r\n   }\r\n \r\n-  Status DeleteFile(const std::string& filename) override {\r\n-    auto wFilename = toUtf16(filename);\r\n-    if (!::DeleteFileW(wFilename.c_str())) {\r\n+  Status RemoveFile(const std::string& filename) override {\r\n+    if (!::DeleteFileA(filename.c_str())) {\r\n       return WindowsError(filename, ::GetLastError());\r\n     }\r\n     return Status::OK();\r\n   }\r\n \r\n   Status CreateDir(const std::string& dirname) override {\r\n-    auto wDirname = toUtf16(dirname);\r\n-    if (!::CreateDirectoryW(wDirname.c_str(), nullptr)) {\r\n+    if (!::CreateDirectoryA(dirname.c_str(), nullptr)) {\r\n       return WindowsError(dirname, ::GetLastError());\r\n     }\r\n     return Status::OK();\r\n   }\r\n \r\n-  Status DeleteDir(const std::string& dirname) override {\r\n-    auto wDirname = toUtf16(dirname);\r\n-    if (!::RemoveDirectoryW(wDirname.c_str())) {\r\n+  Status RemoveDir(const std::string& dirname) override {\r\n+    if (!::RemoveDirectoryA(dirname.c_str())) {\r\n       return WindowsError(dirname, ::GetLastError());\r\n     }\r\n     return Status::OK();\r\n@@ -546,8 +544,7 @@ class WindowsEnv : public Env {\r\n \r\n   Status GetFileSize(const std::string& filename, uint64_t* size) override {\r\n     WIN32_FILE_ATTRIBUTE_DATA file_attributes;\r\n-    auto wFilename = toUtf16(filename);\r\n-    if (!::GetFileAttributesExW(wFilename.c_str(), GetFileExInfoStandard,\r\n+    if (!::GetFileAttributesExA(filename.c_str(), GetFileExInfoStandard,\r\n                                 &file_attributes)) {\r\n       return WindowsError(filename, ::GetLastError());\r\n     }\r\n@@ -561,9 +558,7 @@ class WindowsEnv : public Env {\r\n   Status RenameFile(const std::string& from, const std::string& to) override {\r\n     // Try a simple move first. It will only succeed when |to| doesn't already\r\n     // exist.\r\n-    auto wFrom = toUtf16(from);\r\n-    auto wTo = toUtf16(to);\r\n-    if (::MoveFileW(wFrom.c_str(), wTo.c_str())) {\r\n+    if (::MoveFileA(from.c_str(), to.c_str())) {\r\n       return Status::OK();\r\n     }\r\n     DWORD move_error = ::GetLastError();\r\n@@ -572,7 +567,7 @@ class WindowsEnv : public Env {\r\n     // succeed when |to| does exist. When writing to a network share, we may not\r\n     // be able to change the ACLs. Ignore ACL errors then\r\n     // (REPLACEFILE_IGNORE_MERGE_ERRORS).\r\n-    if (::ReplaceFileW(wTo.c_str(), wFrom.c_str(), /*lpBackupFileName=*/nullptr,\r\n+    if (::ReplaceFileA(to.c_str(), from.c_str(), /*lpBackupFileName=*/nullptr,\r\n                        REPLACEFILE_IGNORE_MERGE_ERRORS,\r\n                        /*lpExclude=*/nullptr, /*lpReserved=*/nullptr)) {\r\n       return Status::OK();\r\n@@ -592,9 +587,8 @@ class WindowsEnv : public Env {\r\n   Status LockFile(const std::string& filename, FileLock** lock) override {\r\n     *lock = nullptr;\r\n     Status result;\r\n-    auto wFilename = toUtf16(filename);\r\n-    ScopedHandle handle = ::CreateFileW(\r\n-        wFilename.c_str(), GENERIC_READ | GENERIC_WRITE, FILE_SHARE_READ,\r\n+    ScopedHandle handle = ::CreateFileA(\r\n+        filename.c_str(), GENERIC_READ | GENERIC_WRITE, FILE_SHARE_READ,\r\n         /*lpSecurityAttributes=*/nullptr, OPEN_ALWAYS, FILE_ATTRIBUTE_NORMAL,\r\n         nullptr);\r\n     if (!handle.is_valid()) {\r\n@@ -634,11 +628,10 @@ class WindowsEnv : public Env {\r\n       return Status::OK();\r\n     }\r\n \r\n-    wchar_t wtmp_path[MAX_PATH];\r\n-    if (!GetTempPathW(ARRAYSIZE(wtmp_path), wtmp_path)) {\r\n+    char tmp_path[MAX_PATH];\r\n+    if (!GetTempPathA(ARRAYSIZE(tmp_path), tmp_path)) {\r\n       return WindowsError(\"GetTempPath\", ::GetLastError());\r\n     }\r\n-    std::string tmp_path = toUtf8(std::wstring(wtmp_path));\r\n     std::stringstream ss;\r\n     ss << tmp_path << \"leveldbtest-\" << std::this_thread::get_id();\r\n     *result = ss.str();\r\n@@ -649,8 +642,7 @@ class WindowsEnv : public Env {\r\n   }\r\n \r\n   Status NewLogger(const std::string& filename, Logger** result) override {\r\n-    auto wFilename = toUtf16(filename);\r\n-    std::FILE* fp = _wfopen(wFilename.c_str(), L\"w\");\r\n+    std::FILE* fp = std::fopen(filename.c_str(), \"wN\");\r\n     if (fp == nullptr) {\r\n       *result = nullptr;\r\n       return WindowsError(filename, ::GetLastError());\r\n@@ -689,7 +681,7 @@ class WindowsEnv : public Env {\r\n   // Instances are constructed on the thread calling Schedule() and used on the\r\n   // background thread.\r\n   //\r\n-  // This structure is thread-safe beacuse it is immutable.\r\n+  // This structure is thread-safe because it is immutable.\r\n   struct BackgroundWorkItem {\r\n     explicit BackgroundWorkItem(void (*function)(void* arg), void* arg)\r\n         : function(function), arg(arg) {}\r\n@@ -706,31 +698,6 @@ class WindowsEnv : public Env {\r\n       GUARDED_BY(background_work_mutex_);\r\n \r\n   Limiter mmap_limiter_;  // Thread-safe.\r\n-\r\n-  // Converts a Windows wide multi-byte UTF-16 string to a UTF-8 string.\r\n-  // See http://utf8everywhere.org/#windows\r\n-  std::string toUtf8(const std::wstring& wstr) {\r\n-    if (wstr.empty()) return std::string();\r\n-    int size_needed = WideCharToMultiByte(\r\n-        CP_UTF8, 0, &wstr[0], (int)wstr.size(), NULL, 0, NULL, NULL);\r\n-    std::string strTo(size_needed, 0);\r\n-    WideCharToMultiByte(CP_UTF8, 0, &wstr[0], (int)wstr.size(), &strTo[0],\r\n-                        size_needed, NULL, NULL);\r\n-    return strTo;\r\n-  }\r\n-\r\n-  // Converts a UTF-8 string to a Windows UTF-16 multi-byte wide character\r\n-  // string.\r\n-  // See http://utf8everywhere.org/#windows\r\n-  std::wstring toUtf16(const std::string& str) {\r\n-    if (str.empty()) return std::wstring();\r\n-    int size_needed =\r\n-        MultiByteToWideChar(CP_UTF8, 0, &str[0], (int)str.size(), NULL, 0);\r\n-    std::wstring strTo(size_needed, 0);\r\n-    MultiByteToWideChar(CP_UTF8, 0, &str[0], (int)str.size(), &strTo[0],\r\n-                        size_needed);\r\n-    return strTo;\r\n-  }\r\n };\r\n \r\n // Return the maximum number of concurrent mmaps.\r\n@@ -849,4 +816,4 @@ Env* Env::Default() {\r\n   return env_container.env();\r\n }\r\n \r\n-}  // namespace leveldb\r\n+}  // namespace leveldb\r\n\\ No newline at end of file\r\ndiff --git a/src/leveldb/util/no_destructor.h b/src/leveldb/util/no_destructor.h\r\nindex c28a107313..1836d2029c 100644\r\n--- a/src/leveldb/util/no_destructor.h\r\n+++ b/src/leveldb/util/no_destructor.h\r\n@@ -16,35 +16,35 @@ namespace leveldb {\r\n // This is intended for use with function-level static variables.\r\n template <typename InstanceType>\r\n class NoDestructor {\r\n- public:\r\n-  template <typename... ConstructorArgTypes>\r\n-  explicit NoDestructor(ConstructorArgTypes&&... constructor_args) {\r\n-    static_assert(sizeof(instance_storage_) >= sizeof(InstanceType),\r\n-                  \"instance_storage_ is not large enough to hold the instance\");\r\n-    static_assert(std::is_standard_layout_v<NoDestructor<InstanceType>>);\r\n-    static_assert(\r\n-        offsetof(NoDestructor, instance_storage_) % alignof(InstanceType) == 0,\r\n-        \"instance_storage_ does not meet the instance's alignment requirement\");\r\n-    static_assert(\r\n-        alignof(NoDestructor<InstanceType>) % alignof(InstanceType) == 0,\r\n-        \"instance_storage_ does not meet the instance's alignment requirement\");\r\n-    new (instance_storage_)\r\n-        InstanceType(std::forward<ConstructorArgTypes>(constructor_args)...);\r\n-  }\r\n-\r\n-  ~NoDestructor() = default;\r\n-\r\n-  NoDestructor(const NoDestructor&) = delete;\r\n-  NoDestructor& operator=(const NoDestructor&) = delete;\r\n-\r\n-  InstanceType* get() {\r\n-    return reinterpret_cast<InstanceType*>(&instance_storage_);\r\n-  }\r\n-\r\n- private:\r\n-  alignas(InstanceType) char instance_storage_[sizeof(InstanceType)];\r\n+public:\r\n+    template <typename... ConstructorArgTypes>\r\n+    explicit NoDestructor(ConstructorArgTypes&&... constructor_args) {\r\n+        static_assert(sizeof(instance_storage_) >= sizeof(InstanceType),\r\n+                      \"instance_storage_ is not large enough to hold the instance\");\r\n+        static_assert(std::is_standard_layout_v<NoDestructor<InstanceType>>);\r\n+        static_assert(\r\n+            offsetof(NoDestructor, instance_storage_) % alignof(InstanceType) == 0,\r\n+            \"instance_storage_ does not meet the instance's alignment requirement\");\r\n+        static_assert(\r\n+            alignof(NoDestructor<InstanceType>) % alignof(InstanceType) == 0,\r\n+            \"instance_storage_ does not meet the instance's alignment requirement\");\r\n+        new (instance_storage_)\r\n+            InstanceType(std::forward<ConstructorArgTypes>(constructor_args)...);\r\n+    }\r\n+\r\n+    ~NoDestructor() = default;\r\n+\r\n+    NoDestructor(const NoDestructor&) = delete;\r\n+    NoDestructor& operator=(const NoDestructor&) = delete;\r\n+\r\n+    InstanceType* get() {\r\n+        return reinterpret_cast<InstanceType*>(&instance_storage_);\r\n+    }\r\n+\r\n+private:\r\n+    alignas(InstanceType) char instance_storage_[sizeof(InstanceType)];\r\n };\r\n \r\n }  // namespace leveldb\r\n \r\n-#endif  // STORAGE_LEVELDB_UTIL_NO_DESTRUCTOR_H_\r\n+#endif  // STORAGE_LEVELDB_UTIL_NO_DESTRUCTOR_H_\r\n\\ No newline at end of file\r\n```\r\n\r\n</details>\r\n\r\nAfter that I have compared the modified codeparts only against latest and they match exactly.\r\n\r\nBuild failure is [known](https://github.com/bitcoin/bitcoin/issues/32085) and unrelated.\r\nBuild and tests are passing locally for a rebased version against latest `master`.\r\n\r\nACK c8fab356171a0e283d5716647e3243c04810ac51\r\n\r\nedit: running a full `reindex-chainstate` for a rebased version to validate the change",
          "created_at": "2025-03-19T14:22:01Z"
        },
        {
          "user": "l0rinc",
          "body": "`reindex-chainstate` finished successfully\r\n\r\n<details>\r\n<summary>Details</summary>\r\n\r\n```bash\r\nCOMMITS=\"5e934ebc82ca239cd98eed1689f7cdc2c672a9ae\"; \\\r\nSTOP_HEIGHT=888000; DBCACHE=5000; \\\r\nC_COMPILER=gcc; CXX_COMPILER=g++; \\\r\ngit fetch --all -q && (for c in $COMMITS; do git log -1 --oneline $c || exit 1; done) && \\\r\nhyperfine \\\r\n  --export-json \"/mnt/my_storage/rdx-${COMMITS// /-}-${STOP_HEIGHT}-${DBCACHE}-${C_COMPILER}.json\" \\\r\n  --runs 1 \\\r\n  --parameter-list COMMIT ${COMMITS// /,} \\\r\n  --prepare \"killall bitcoind || true; rm -f /mnt/my_storage/BitcoinData/debug.log; git checkout {COMMIT}; git clean -fxd; git reset --hard; cmake -B build -DCMAKE_BUILD_TYPE=Release -DENABLE_WALLET=OFF -DCMAKE_C_COMPILER=$C_COMPILER -DCMAKE_CXX_COMPILER=$CXX_COMPILER && cmake --build build -j$(nproc) --target bitcoind && ./build/bin/bitcoind -datadir=/mnt/my_storage/BitcoinData -stopatheight=$STOP_HEIGHT -dbcache=10000 -printtoconsole=0 || true\" \\\r\n  --cleanup \"cp /mnt/my_storage/BitcoinData/debug.log /mnt/my_storage/logs/debug-{COMMIT}-$(date +%s).log || true\" \\\r\n  \"COMPILER=$C_COMPILER COMMIT={COMMIT} ./build/bin/bitcoind -datadir=/mnt/my_storage/BitcoinData -stopatheight=$STOP_HEIGHT -dbcache=$DBCACHE -blocksonly -reindex-chainstate -connect=0 -printtoconsole=0\"\r\n\r\n5e934ebc82 (l0rinc/detached179) ci: remove -Wno-error=deprecated-declarations from ASAN\r\nBenchmark 1: COMPILER=gcc COMMIT=5e934ebc82ca239cd98eed1689f7cdc2c672a9ae ./build/bin/bitcoind -datadir=/mnt/my_storage/BitcoinData -stopatheight=888000 -dbcache=5000 -blocksonly -reindex-chainstate -connect=0 -printtoconsole=0\r\n  Time (abs â‰¡):        24720.986 s               [User: 22604.063 s, System: 1067.193 s]\r\n```\r\n\r\n</details>",
          "created_at": "2025-03-20T09:13:12Z"
        }
      ]
    },
    {
      "number": 31765,
      "title": "cmake: Install man pages for configured targets only",
      "body": "Fixes https://github.com/bitcoin/bitcoin/issues/31762.",
      "state": "closed",
      "user": "hebasto",
      "created_at": "2025-01-30T13:14:08Z",
      "updated_at": "2025-02-13T16:33:57Z",
      "comments": 5,
      "url": "https://github.com/bitcoin/bitcoin/pull/31765",
      "labels": [
        "Build system"
      ],
      "comment_list": [
        {
          "user": "DrahtBot",
          "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/31765.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| ACK | [stickies-v](https://github.com/bitcoin/bitcoin/pull/31765#pullrequestreview-2605507226) |\n| Concept ACK | [BrandonOdiwuor](https://github.com/bitcoin/bitcoin/pull/31765#pullrequestreview-2602730166) |\n\nIf your review is incorrectly listed, please react with ðŸ‘Ž to this comment and the bot will ignore it on the next update.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#31844](https://github.com/bitcoin/bitcoin/pull/31844) (cmake: add a component for each binary by theuni)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n",
          "created_at": "2025-01-30T13:14:12Z"
        },
        {
          "user": "theuni",
          "body": "Considering that in order to hook up `COMPONENTS` usage, we'd need to add an `install()` line for each as opposed to our current `installable_targets` approach, I'm not sure that `install_manpage` is the right abstraction.\r\n\r\nInstead, I think we're going to want an `add_install()` or so, right?\r\n\r\nFor ex:\r\n\r\nInstead of:\r\n```CMake\r\nlist(APPEND installable_targets bitcoind)\r\n...\r\ninstall(TARGETS ${installable_targets}\r\n  RUNTIME DESTINATION ${CMAKE_INSTALL_BINDIR}\r\n)\r\n```\r\n\r\nWe'll want:\r\n```CMake\r\nadd_install(\r\n  TARGETS bitcoind\r\n  COMPONENT bitcoind\r\n  HAS_MANPAGE\r\n)\r\n```\r\n\r\nThen `add_install()` contains the `if(INSTALL_MAN)` logic (and sets `RUNTIME DESTINATION`)?",
          "created_at": "2025-02-11T17:01:58Z"
        },
        {
          "user": "theuni",
          "body": "> Considering that in order to hook up `COMPONENTS` usage, we'd need to add an `install()` line for each as opposed to our current `installable_targets` approach, I'm not sure that `install_manpage` is the right abstraction.\r\n> \r\n> Instead, I think we're going to want an `add_install()` or so, right?\r\n\r\nSee [this branch](https://github.com/theuni/bitcoin/commits/cmake-install-components/) for an alternative which adds `install_binary_component` as described above. Imo it's more thorough/correct.",
          "created_at": "2025-02-11T20:19:31Z"
        },
        {
          "user": "fanquake",
          "body": "Close this given #31844 (which also solves #31745)? Or, it'd be good if you could comment either here or there on the alternative approach.",
          "created_at": "2025-02-13T11:37:39Z"
        },
        {
          "user": "fanquake",
          "body": "Closing given the concept ACK in the other thread.",
          "created_at": "2025-02-13T16:33:57Z"
        }
      ]
    },
    {
      "number": 31764,
      "title": "cmake: Generate man pages at install time",
      "body": "This PR enables the man pages to be generated on the fly during installation.\r\n\r\nAs the GNU help2man tool is required to generate man pages, the `INSTALL_MAN` build option is disabled by default.\r\n\r\nAddresses this comment:https://github.com/bitcoin/bitcoin/blob/809d7e763cc9bdfff3288860a1c530460c76ffff/src/CMakeLists.txt#L456\r\n\r\nFixes https://github.com/bitcoin/bitcoin/issues/31762.",
      "state": "closed",
      "user": "hebasto",
      "created_at": "2025-01-30T12:33:24Z",
      "updated_at": "2025-01-30T13:38:51Z",
      "comments": 5,
      "url": "https://github.com/bitcoin/bitcoin/pull/31764",
      "labels": [
        "Build system"
      ],
      "comment_list": [
        {
          "user": "DrahtBot",
          "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/31764.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\nA summary of reviews will appear here.\n",
          "created_at": "2025-01-30T12:33:28Z"
        },
        {
          "user": "hebasto",
          "body": "cc @theuni, as the author of the TODO [comment](https://github.com/bitcoin/bitcoin/blob/809d7e763cc9bdfff3288860a1c530460c76ffff/src/CMakeLists.txt#L456).",
          "created_at": "2025-01-30T12:38:03Z"
        },
        {
          "user": "sedited",
          "body": "Do the release process docs need any changes from this?",
          "created_at": "2025-01-30T12:53:53Z"
        },
        {
          "user": "hebasto",
          "body": "This approach is not applicable for general cross-compilation scenarios :man_facepalming: ",
          "created_at": "2025-01-30T13:15:07Z"
        },
        {
          "user": "fanquake",
          "body": "One other side-effect of this change would be that someone cloning a tag would no-longer get the manpages. Maybe this doesn't matter, but would be good to mention.",
          "created_at": "2025-01-30T13:38:50Z"
        }
      ]
    },
    {
      "number": 31763,
      "title": "Pass custom DEP_OPTS and CONFIG_FLAGS to guix-build",
      "body": "This allows building deterministic binaries with multiprocess like so:\r\n\r\n```sh\r\nDEP_OPTS=\"MULTIPROCESS=1\" contrib/guix/guix-build\r\n```\r\n\r\nAdditionally custom options can be passed to `cmake -B` using `CONFIG_FLAGS`. Example (turns off external signer support, the rest is default):\r\n\r\n```sh\r\nCONFIG_FLAGS=\"-DENABLE_EXTERNAL_SIGNER=OFF -DREDUCE_EXPORTS=ON -DBUILD_BENCH=OFF -DBUILD_GUI_TESTS=OFF -DBUILD_FUZZ_BINARY=OFF\" contrib/guix/guix-build\r\n```\r\n\r\nThe `CONFIG_FLAGS` is less useful in practice, because:\r\n\r\n1. Some options will cause the Guix build to fail, e.g. because the packaging step assumes their presence.\r\n2. Some options are already indirectly controlled though `DEP_OPTS`",
      "state": "closed",
      "user": "Sjors",
      "created_at": "2025-01-30T11:45:18Z",
      "updated_at": "2025-02-03T17:22:22Z",
      "comments": 5,
      "url": "https://github.com/bitcoin/bitcoin/pull/31763",
      "labels": [],
      "comment_list": [
        {
          "user": "DrahtBot",
          "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/31763.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\nA summary of reviews will appear here.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nNo conflicts as of last run.\n",
          "created_at": "2025-01-30T11:45:21Z"
        },
        {
          "user": "DrahtBot",
          "body": "<!--85328a0da195eb286784d51f73fa0af9-->\nðŸš§ At least one of the CI tasks failed.\n<sub>Debug: https://github.com/bitcoin/bitcoin/runs/36413011811</sub>\n\n<details><summary>Hints</summary>\n\nTry to run the tests locally, according to the documentation. However, a CI failure may still\nhappen due to a number of reasons, for example:\n\n* Possibly due to a silent merge conflict (the changes in this pull request being\nincompatible with the current code in the target branch). If so, make sure to rebase on the latest\ncommit of the target branch.\n\n* A sanitizer issue, which can only be found by compiling with the sanitizer and running the\n  affected test.\n\n* An intermittent issue.\n\nLeave a comment here, if you need help tracking down a confusing failure.\n\n</details>\n",
          "created_at": "2025-01-30T12:28:27Z"
        },
        {
          "user": "Sjors",
          "body": "A couple fights with bash and the linter later... (ok `${DEP_OPTS:+\"$DEP_OPTS\"}` instead of just `$DEP_OPTS`, fine)",
          "created_at": "2025-01-31T18:27:32Z"
        },
        {
          "user": "fanquake",
          "body": "~0. The benefit here seems limited, as the project has no need for these options in its release process. Outside of that, anyone wanting to do a \"custom\" release build, is likely already modifying the source, so can change the script for their own needs. As mentioned in the PR description, arbitrary changes to the CMake config, also don't really make sense, because they will cause failures for various reasons (i.e disabling the GUI would then cause failures at the packaging steps), and if you need to make other source changes to prevent the build failures, you should just make the config changes to the Guix script (unless the plan is to have a build that fails, but still produces binaries, but I also don't think that's something we'd want to support).",
          "created_at": "2025-02-03T12:05:36Z"
        },
        {
          "user": "maflcko",
          "body": "It seems a bit confusing to leak the env into guix, which may then cause non-determinism, compiling the same source commit id. It seems simpler to just create a commit with your modifications to the config.",
          "created_at": "2025-02-03T16:02:34Z"
        }
      ]
    },
    {
      "number": 31761,
      "title": ".",
      "body": "Updated the copyright year to 2025 in the LICENSE file",
      "state": "closed",
      "user": "maximevtush",
      "created_at": "2025-01-30T10:06:07Z",
      "updated_at": "2025-02-07T18:29:10Z",
      "comments": 1,
      "url": "https://github.com/bitcoin/bitcoin/pull/31761",
      "labels": [],
      "comment_list": [
        {
          "user": "DrahtBot",
          "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/31761.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\nA summary of reviews will appear here.\n",
          "created_at": "2025-01-30T10:06:12Z"
        }
      ]
    }
  ],
  "issues": [
    {
      "number": 31762,
      "title": "build: cmake installs empty manpages for non-configured targets",
      "body": "### Is there an existing issue for this?\n\n- [x] I have searched the existing issues\n\n### Current behaviour\n\nWhen configuring cmake with a subset of targets (e.g. kernel-only), a blanket `cmake --install` will still install the placeholder manpages files for all other targets.\n\nFor example:\n\n```\ncmake -B build -DBUILD_KERNEL_LIB=ON -DBUILD_BENCH=OFF -DBUILD_DAEMON=OFF -DBUILD_CLI=OFF -DBUILD_GUI=OFF -DBUILD_FUZZ_BINARY=OFF -DBUILD_TESTS=OFF -DBUILD_TX=OFF -DBUILD_UTIL=OFF -DBUILD_UTIL_CHAINSTATE=OFF -DBUILD_WALLET_TOOL=OFF -DENABLE_WALLET=OFF\ncmake --build build -j\ncmake --install build\n```\n\nyields:\n```\n% cmake --install build\n-- Install configuration: \"RelWithDebInfo\"\n-- Installing: /usr/local/lib/pkgconfig/libbitcoinkernel.pc\n-- Installing: /usr/local/lib/libbitcoinkernel.dylib\n-- Up-to-date: /usr/local/share/man/man1\n-- Installing: /usr/local/share/man/man1/bitcoin-util.1\n-- Installing: /usr/local/share/man/man1/bitcoin-tx.1\n-- Installing: /usr/local/share/man/man1/bitcoin-wallet.1\n-- Installing: /usr/local/share/man/man1/bitcoin-qt.1\n-- Installing: /usr/local/share/man/man1/bitcoin-cli.1\n-- Installing: /usr/local/share/man/man1/bitcoind.1\n```\n\nThe manpages are just placeholders:\n\n```\n% cat /usr/local/share/man/man1/bitcoin-util.1\n.TH BITCOIN-UTIL \"1\"\n.SH NAME\nbitcoin-util \\- manual page for bitcoin-util\n\nThis is a placeholder file. Please follow the instructions in \\fIcontrib/devtools/README.md\\fR to generate the manual pages after a release.\n```\n\nThis can be avoided by specifying the component, e.g. `cmake --install build --component Kernel`, but that shouldn't be necessary.\n\n### Expected behaviour\n\nThe manpages of non-configured targets should not be installed.\n\n### Steps to reproduce\n\nDescribed under \"current behaviour\".\n\n### Relevant log output\n\n_No response_\n\n### How did you obtain Bitcoin Core\n\nCompiled from source\n\n### What version of Bitcoin Core are you using?\n\n809d7e763cc9bdfff3288860a1c530460c76ffff\n\n### Operating system and version\n\nmacOS 14.3\n\n### Machine specifications\n\n_No response_",
      "state": "closed",
      "user": "stickies-v",
      "created_at": "2025-01-30T10:38:47Z",
      "updated_at": "2025-02-14T13:19:19Z",
      "comments": 0,
      "url": "https://github.com/bitcoin/bitcoin/issues/31762",
      "labels": [
        "Build system"
      ]
    }
  ],
  "summary": {
    "pull_requests": 7,
    "issues": 1
  }
}