{
  "source": "github",
  "repository": "bitcoin/bitcoin",
  "fetched_at": "2026-01-15T19:20:38.489588+00:00",
  "date": "2025-02-21",
  "pull_requests": [
    {
      "number": 31930,
      "title": "doc: Update translation generation instructions",
      "body": "This is a follow-up of #31731.\r\n\r\nTechnically this change [fixes](https://github.com/bitcoin/bitcoin/pull/31731#discussion_r1928888001) the preset configuration execution failure as it needs multiprocess to be enabled, so we disable it using `-DWITH_MULTIPROCESS=OFF`.\r\n\r\nThis code will need to be updated by removing `-DWITH_MULTIPROCESS=OFF` in https://github.com/bitcoin/bitcoin/pull/31741.",
      "state": "closed",
      "user": "pablomartin4btc",
      "created_at": "2025-02-21T18:53:48Z",
      "updated_at": "2025-02-27T14:05:35Z",
      "comments": 4,
      "url": "https://github.com/bitcoin/bitcoin/pull/31930",
      "labels": [
        "Docs"
      ],
      "comment_list": [
        {
          "user": "DrahtBot",
          "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/31930.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| ACK | [ryanofsky](https://github.com/bitcoin/bitcoin/pull/31930#pullrequestreview-2645641106) |\n\nIf your review is incorrectly listed, please react with üëé to this comment and the bot will ignore it on the next update.\n",
          "created_at": "2025-02-21T18:53:51Z"
        },
        {
          "user": "ryanofsky",
          "body": "Reviewing ba3bb09a12d77b467aec8833e316ee4b5e45ee75\r\n\r\nIMO, it would be simpler and more consistent to just update instructions like:\r\n\r\n```diff\r\n-cmake --preset dev-mode -DWITH_USDT=OFF\r\n+cmake --preset dev-mode -DWITH_USDT=OFF -DWITH_MULTIPROCESS=OFF\r\n```\r\n\r\nIt is true that files in `src/ipc/` may contained translated `_()` strings in the future, but I don't think they do right now. In the longer term, the suggestion to use depends should not be needed, because #31741 should allow easily building `src/ipc/` code without depends. #31741 also removes the `WITH_MULTIPROCESS` option and replaces it with an `ENABLE_IPC` option, and #31802 replaces depends `MULTIPROCESS` option with a `NO_MULTIPROCESS` options, so these instructions will need to be updated in the future anyway, and I think it would be best to keep them simple and not involve the depends system if not needed.\r\n",
          "created_at": "2025-02-26T13:45:07Z"
        },
        {
          "user": "pablomartin4btc",
          "body": "_Updates_:\r\n- Addressed @ryanofsky's feedback and updated the code with his suggestion (Thanks for the review!).",
          "created_at": "2025-02-26T17:22:38Z"
        },
        {
          "user": "pablomartin4btc",
          "body": "> I think after #31741 we should be able to drop the extra argument.\r\n\r\nI thought we'd need to replace it by `-DENABLE_IPC=OFF` (as it will be `ON` in `CMakePresets.json`) and I was getting errors of missing config files (`CapnProtoConfig.cmake` & `capnproto-config.cmake`) when I run the instructions in #31741, but the problem was that I needed to install the Cap'n Proto for multiprocess (as in the documentation), so your statement is correct, I'm updating this PR's description accordingly. Thanks!",
          "created_at": "2025-02-26T22:12:31Z"
        }
      ]
    },
    {
      "number": 31929,
      "title": "http: Make server shutdown more robust",
      "body": "- Log HTTP request pointers to be able to discover which one is stuck.\r\n- Instead of hanging indefinitely, use timeouts and abort when HTTP connections take unreasonably long to close.\r\n- Ensure we always free libevent HTTP.\r\n\r\nShould help debug #31894.",
      "state": "open",
      "user": "hodlinator",
      "created_at": "2025-02-21T15:32:53Z",
      "updated_at": "2025-12-19T08:55:05Z",
      "comments": 7,
      "url": "https://github.com/bitcoin/bitcoin/pull/31929",
      "labels": [
        "RPC/REST/ZMQ"
      ],
      "comment_list": [
        {
          "user": "DrahtBot",
          "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/31929.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\nA summary of reviews will appear here.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#32061](https://github.com/bitcoin/bitcoin/pull/32061) (Replace libevent with our own HTTP and socket-handling implementation by pinheadmz)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n<!--5faf32d7da4f0f540f40219e4f7537a3-->",
          "created_at": "2025-02-21T15:33:01Z"
        },
        {
          "user": "fanquake",
          "body": "```bash\r\nAssertion failed: (evb), function WriteReply, file httpserver.cpp, line 682.\r\nError processing input \"/Users/runner/work/bitcoin/bitcoin/ci/scratch/qa-assets/fuzz_corpora/http_request/83149a7e3abd937c7bc67fa55b9a4fc9338e3d8c\"\r\n\r\n‚ö†Ô∏è Failure generated from target with exit code 1: ['/Users/runner/work/bitcoin/bitcoin/ci/scratch/build-aarch64-apple-darwin23.6.0/src/test/fuzz/fuzz', PosixPath('/Users/runner/work/bitcoin/bitcoin/ci/scratch/qa-assets/fuzz_corpora/http_request')]\r\n```",
          "created_at": "2025-02-21T15:49:31Z"
        },
        {
          "user": "DrahtBot",
          "body": "<!--85328a0da195eb286784d51f73fa0af9-->\nüöß At least one of the CI tasks failed.\n<sub>Debug: https://github.com/bitcoin/bitcoin/runs/37612857743</sub>\n\n<details><summary>Hints</summary>\n\nTry to run the tests locally, according to the documentation. However, a CI failure may still\nhappen due to a number of reasons, for example:\n\n* Possibly due to a silent merge conflict (the changes in this pull request being\nincompatible with the current code in the target branch). If so, make sure to rebase on the latest\ncommit of the target branch.\n\n* A sanitizer issue, which can only be found by compiling with the sanitizer and running the\n  affected test.\n\n* An intermittent issue.\n\nLeave a comment here, if you need help tracking down a confusing failure.\n\n</details>\n",
          "created_at": "2025-02-21T17:05:25Z"
        },
        {
          "user": "laanwj",
          "body": "From what i remember this was *extrememly* hard to get right with libevent (or at least our use of it), without leaking anything or running into race conditions. There have been a few tries to fix the behavior over the years, but they all were different compromises, adding ever more compexity, and often introducing new problems.\r\n\r\nAs it seems to be where things are heading anyway (#32061) maybe it's better to focus on replacing libevent and its webserver framework wholesale.\r\n",
          "created_at": "2025-03-18T10:28:01Z"
        },
        {
          "user": "hodlinator",
          "body": "Thank you for providing your perspective @laanwj!\r\n\r\nIn working on this PR, I've also gained an [appreciation for getting rid of libevent](https://github.com/bitcoin/bitcoin/issues/31894#issuecomment-2678077496). However, I'm not sure when that will happen, maybe not until post-30.0. In the meantime we are seeing issues on CI such as #31894 ([analysis](https://github.com/bitcoin/bitcoin/issues/31894#issuecomment-2666012863)).\r\n\r\nWhat this PR is doing is adding our own request ids to track which HTTP request never finishes. When we have stuck HTTP requests, it also makes us abort the process with a clear error after 10min30s instead of waiting for the test framework to time out after 40min. On top of that it also fixes an intermittent leak, right after we've joined on the thread that is the only one to sometimes perform deletion.\r\n\r\nHave come across #26742 and #19420 while working on this, so have seen some of the struggle.\r\n\r\nDon't have an overall grasp on how frequent issues like 31894 are on CI (or in the wild), it's fair that that frequency should influence the priority of this compared to other work.",
          "created_at": "2025-03-18T14:46:30Z"
        },
        {
          "user": "hodlinator",
          "body": "Spent some time revisiting and polishing this since 24558c2cf18210f46d6e2fadf0c5c5912f4b8e10.\r\n* Rebased on latest master.\r\n* Dropped the comment changes from 1350087f9a as verifying them is added work and I'm not sure they were 100% correct.\r\n* Dropped the introduction of our own request ids in 24558c2cf1.\r\n* Merged the the remaining log message on HTTP connection close from 1350087f9a + now log request pointers instead of ids in 028301e775, \"http: Include request ptr in initial message and log close + reply\". (+moved it first in the PR).\r\n* Combined `HTTPRequestTracker`s `CountActiveConnections()` and `WaitUntilEmpty()`.\r\n* Added reproducer-script to commit message of memory leak fix aa11ee5ccf.",
          "created_at": "2025-10-14T20:55:49Z"
        },
        {
          "user": "hodlinator",
          "body": "Was worried that libevent would clean up the memory leak I thought was fixed by aa11ee5ccfcedf3fb44e7722ecdeb3cdaa92fd51 later during shutdown, so verified that that libevent does no such thing using Valgrind: https://github.com/bitcoin/bitcoin/compare/master...hodlinator:bitcoin:2025/02/stop_http_robust.valgrind",
          "created_at": "2025-10-15T08:12:22Z"
        }
      ]
    },
    {
      "number": 31928,
      "title": "ci: Fix filtering out Qt-generated files from `compile_commands.json`",
      "body": "This PR:\r\n1. Adjusts the regex for Qt-generated files to match the CMake build directory structure.\r\n2. Moves the filtering command to run before `clang-tidy`, ensuring that Qt-generated files are not needlessly processed.\r\n\r\nFixes https://github.com/bitcoin/bitcoin/issues/31801.",
      "state": "closed",
      "user": "hebasto",
      "created_at": "2025-02-21T13:32:36Z",
      "updated_at": "2025-02-21T16:42:29Z",
      "comments": 2,
      "url": "https://github.com/bitcoin/bitcoin/pull/31928",
      "labels": [
        "Tests"
      ],
      "comment_list": [
        {
          "user": "DrahtBot",
          "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/31928.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| ACK | [maflcko](https://github.com/bitcoin/bitcoin/pull/31928#issuecomment-2674686213) |\n\nIf your review is incorrectly listed, please react with üëé to this comment and the bot will ignore it on the next update.\n",
          "created_at": "2025-02-21T13:32:42Z"
        },
        {
          "user": "maflcko",
          "body": "ACK d82dc1041524e8402d201d32c9143233b5ec1baf üöÇ\r\n\r\n<details><summary>Show signature</summary>\r\n\r\nSignature:\r\n\r\n```\r\nuntrusted comment: signature from minisign secret key on empty file; verify via: minisign -Vm \"${path_to_any_empty_file}\" -P RWTRmVTMeKV5noAMqVlsMugDDCyyTSbA3Re5AkUrhvLVln0tSaFWglOw -x \"${path_to_this_whole_four_line_signature_blob}\"\r\nRUTRmVTMeKV5npGrKx1nqXCw5zeVHdtdYURB/KlyA/LMFgpNCs+SkW9a8N95d+U4AP1RJMi+krxU1A3Yux4bpwZNLvVBKy0wLgM=\r\ntrusted comment: ACK d82dc1041524e8402d201d32c9143233b5ec1baf üöÇ\r\nVxeXCGLGGD5Mokc9xIUZQZRwrg91hsJUs6+zbThTAgoIarCrQx8s0lJ9WQaCwte6blo2y+lyqFbwQZEKXjVKAw==\r\n```\r\n\r\n</details>\r\n\r\n",
          "created_at": "2025-02-21T14:23:54Z"
        }
      ]
    },
    {
      "number": 31925,
      "title": "contrib: update `utxo_to_sqlite` tool documentation and comment",
      "body": "I noticed couple discrepancies in the documentation and comments of `utxo_to_sqlite` tool while using it, this PR fixes them. More details in the commit messages.\r\n",
      "state": "closed",
      "user": "rkrux",
      "created_at": "2025-02-21T11:30:03Z",
      "updated_at": "2025-02-21T16:02:45Z",
      "comments": 1,
      "url": "https://github.com/bitcoin/bitcoin/pull/31925",
      "labels": [
        "Scripts and tools"
      ],
      "comment_list": [
        {
          "user": "DrahtBot",
          "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/31925.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| ACK | [theStack](https://github.com/bitcoin/bitcoin/pull/31925#pullrequestreview-2632798422) |\n\nIf your review is incorrectly listed, please react with üëé to this comment and the bot will ignore it on the next update.\n",
          "created_at": "2025-02-21T11:30:13Z"
        }
      ]
    },
    {
      "number": 31923,
      "title": "refactor: use original log string when no suspicious chars found",
      "body": "We have to make sure that logged messages don't contain non-printable characters.\r\nUntil now we've sanitized these messages by recreating them every time, even though we expect most lines to be already normalized.\r\nThis PR splits out the happy path by identifying the suspicious characters, and if none were found, use the original string, otherwise reconstruct the new string with escaped characters.\r\nThis makes the most common path simpler to reason about.\r\n\r\n<details>\r\n<summary>Details</summary>\r\n\r\n\r\nFor normal messages this results in a [~2x speedup](https://github.com/bitcoin/bitcoin/commit/a445c688ab0740495a4565496703ed14aa77ed52.patch), but the goal of the change is rather making sure that the case we encounter most often (printable values that don't need sanitization) aren't recreated every time (i.e. they're simpler to reason about).\r\n\r\n<details>\r\n<summary>C compiler ............................ AppleClang 16.0.0.16000026</summary>\r\n\r\n> build/src/bench/bench_bitcoin -filter='LogEscapeMessage.+' --min-time=10000\r\n\r\n> Before:\r\n\r\n|               ns/op |                op/s |    err% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------:|:----------\r\n|              216.10 |        4,627,429.03 |    0.2% |     10.81 | `LogEscapeMessageNormal`\r\n|              328.77 |        3,041,669.54 |    0.7% |     10.97 | `LogEscapeMessageSuspicious`\r\n\r\n> After\r\n\r\n|               ns/op |                op/s |    err% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------:|:----------\r\n|              106.54 |        9,386,391.31 |    0.2% |     11.01 | `LogEscapeMessageNormal`\r\n|              335.58 |        2,979,947.73 |    0.3% |     10.96 | `LogEscapeMessageSuspicious`\r\n\r\n</details>\r\n\r\nNote that this part of the code is called even with `-printtoconsole=0`.\r\n\r\n</details>",
      "state": "closed",
      "user": "l0rinc",
      "created_at": "2025-02-21T10:55:47Z",
      "updated_at": "2025-04-17T20:09:18Z",
      "comments": 12,
      "url": "https://github.com/bitcoin/bitcoin/pull/31923",
      "labels": [
        "Refactoring"
      ],
      "comment_list": [
        {
          "user": "DrahtBot",
          "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/31923.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\nA summary of reviews will appear here.\n",
          "created_at": "2025-02-21T10:55:52Z"
        },
        {
          "user": "dergoegge",
          "body": "Does this result in an end-to-end performance improvement? (e.g. in IBD)",
          "created_at": "2025-02-21T11:05:32Z"
        },
        {
          "user": "fanquake",
          "body": "https://github.com/bitcoin/bitcoin/actions/runs/13458258095/job/37607048581?pr=31923:\r\n```bash\r\n  65/139 Test   #9: bench_sanity_check_high_priority .....***Failed   78.91 sec\r\nRunning with -sanity-check option, output is being suppressed as benchmark results will be useless.\r\n/home/runner/work/_temp/src/logging.cpp:337:30: runtime error: implicit conversion from type 'char' of value -20 (8-bit, signed) to type 'unsigned char' changed the value to 236 (8-bit, unsigned)\r\n    #0 0x5596549396a8 in BCLog::LogEscapeMessage(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char>> const&) /home/runner/work/_temp/build-asan/src/util/./logging.cpp:337:30\r\n    #1 0x559653466a72 in LogEscapeMessageSuspicious(ankerl::nanobench::Bench&)::$_0::operator()() const /home/runner/work/_temp/build-asan/src/bench/./bench/logging.cpp:94:29\r\n    #2 0x559653466a72 in ankerl::nanobench::Bench& ankerl::nanobench::Bench::run<LogEscapeMessageSuspicious(ankerl::nanobench::Bench&)::$_0>(LogEscapeMessageSuspicious(ankerl::nanobench::Bench&)::$_0&&) /home/runner/work/_temp/build-asan/src/bench/./bench/nanobench.h:1221:13\r\n    #3 0x559653464ac5 in LogEscapeMessageSuspicious(ankerl::nanobench::Bench&) /home/runner/work/_temp/build-asan/src/bench/./bench/logging.cpp:92:40\r\n    #4 0x5596532f85b6 in std::function<void (ankerl::nanobench::Bench&)>::operator()(ankerl::nanobench::Bench&) const /usr/lib/gcc/x86_64-linux-gnu/13/../../../../include/c++/13/bits/std_function.h:591:9\r\n    #5 0x5596532f85b6 in benchmark::BenchRunner::RunAll(benchmark::Args const&) /home/runner/work/_temp/build-asan/src/bench/./bench/bench.cpp:153:13\r\n    #6 0x5596532e4ca5 in main /home/runner/work/_temp/build-asan/src/bench/./bench/bench_bitcoin.cpp:150:9\r\n    #7 0x7f19fe68c1c9  (/lib/x86_64-linux-gnu/libc.so.6+0x2a1c9) (BuildId: 42c84c92e6f98126b3e2230ebfdead22c235b667)\r\n    #8 0x7f19fe68c28a in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x2a28a) (BuildId: 42c84c92e6f98126b3e2230ebfdead22c235b667)\r\n    #9 0x5596531f77d4 in _start (/home/runner/work/_temp/build-asan/src/bench/bench_bitcoin+0xbc97d4) (BuildId: 1f5859276d30b7f56abe5f57c08a08bc76f1aeb6)\r\n\r\nSUMMARY: UndefinedBehaviorSanitizer: implicit-integer-sign-change /home/runner/work/_temp/src/logging.cpp:337:30 \r\n```",
          "created_at": "2025-02-21T17:46:41Z"
        },
        {
          "user": "maflcko",
          "body": "Trying to access https://corecheck.dev/bitcoin/bitcoin/pulls/31923 gives me \r\n\r\n```\r\nThis function has crashed\r\n\r\nAn unhandled error in the function code triggered the following message:\r\n\r\nLambdaTimeout\r\n```\r\n\r\ncc @m3dwards ",
          "created_at": "2025-02-24T09:10:31Z"
        },
        {
          "user": "maflcko",
          "body": "Tend toward nack for now, as explained in the previous comments: https://github.com/bitcoin/bitcoin/pull/31923#issuecomment-2674257449 and https://github.com/bitcoin/bitcoin/pull/31923#pullrequestreview-2636342094\r\n\r\nGiven the added benchmarks, optimization seems to be the goal of this pull request. However, without a visible end-to-end improvement in any scenario (except in the added micro-bench), I fail to see why two benchmarks should be added and why the code should be changed.",
          "created_at": "2025-02-25T07:43:23Z"
        },
        {
          "user": "maflcko",
          "body": "Looking at https://corecheck.dev/bitcoin/bitcoin/pulls/31923 it seems that the `LogWith*` benchmarks are not shown at all? Looks like a bug where the list is truncated?",
          "created_at": "2025-02-25T07:50:11Z"
        },
        {
          "user": "l0rinc",
          "body": "The code is reducing useless work therefore is also closer to how we'd likely write the code from scratch now.\r\nIt's basically a refactor that simplifies the happy path, with the side-effect of also being faster.\r\n\r\n> as explained in the previous comments: https://github.com/bitcoin/bitcoin/pull/31923#issuecomment-2674257449 and https://github.com/bitcoin/bitcoin/pull/31923#pullrequestreview-2636342094\r\n\r\nOne was a question (~I'm still measuring it, but don't expect to have any scenario where IBD is faster because of this, in the same way as most other refactors also don't have that~ finished measuring it, the log writings don't show up as a measurable part of IBD, it's more like a refactoring with minor speedup as a side-effect), the other is a comment about an old state.\r\n",
          "created_at": "2025-02-25T12:18:59Z"
        },
        {
          "user": "m3dwards",
          "body": "> Trying to access https://corecheck.dev/bitcoin/bitcoin/pulls/31923 gives me\r\n\r\nShould be sorted",
          "created_at": "2025-02-25T19:50:02Z"
        },
        {
          "user": "l0rinc",
          "body": "@maflcko, I've reorganized the PR as a refactor where the happy path is now easier to reason about (i.e. no change to the incoming string most of the time) - where the speed gain is just a side-effect of the simpler path taken (it's why the benchmarks are now `PriorityLevel::LOW`).\r\n\r\nPlease let me know if this fits better with the priorities.",
          "created_at": "2025-03-09T16:57:15Z"
        },
        {
          "user": "maflcko",
          "body": "> I've reorganized the PR as a refactor\r\n\r\nI'd say my nack still holds. I don't see the need for adding redundant and questionable benchmarks for refactors. If this was a requirement or even desired for every single refactor of any function, the bench binary would tend to have a number of benchmarks equal to the number of   functions in the whole codebase.",
          "created_at": "2025-03-27T11:51:27Z"
        },
        {
          "user": "l0rinc",
          "body": "I've removed the benchmark and update the description, let me know if this seems better.",
          "created_at": "2025-03-27T12:24:09Z"
        },
        {
          "user": "maflcko",
          "body": "No strong opinion, but I don't see the point. This splits code that was nicely contained over three places, makes it verbose and harder to understand with no visible end-to-end benefit.",
          "created_at": "2025-04-17T20:04:36Z"
        }
      ]
    }
  ],
  "issues": [
    {
      "number": 31927,
      "title": "Unable to generate coverage report using lcov on MacOs 15.3.1",
      "body": "### Is there an existing issue for this?\n\n- [x] I have searched the existing issues\n\n### Current behaviour\n\nWhile trying to get a coverage report , the report generation fails complaining of duplicate function definitions.\n\n### Expected behaviour\n\nGenerate a coverage report for the branch.\n\n### Steps to reproduce\n\n```\ncmake -B build -DCMAKE_BUILD_TYPE=Coverage\ncmake --build build\ncmake -P build/Coverage.cmake\n```\n\n### Relevant log output\n\n```\nCapturing coverage data from src\ngeninfo cmd: '/opt/homebrew/Cellar/lcov/2.3/bin/geninfo src --toolname lcov --output-filename baseline.info --initial --gcov-tool /Users/prabhatverma/projects/bitcoin/build/cov_tool_wrapper.sh'\nFound LLVM gcov version 16.0.0, which emulates gcov version 4.2.0\nUsing intermediate gcov format\nRecording 'internal' directories:\n        /Users/prabhatverma/projects/bitcoin/build/src\n        src\nWriting temporary data to /tmp/geninfo_datI48l\nScanning src for .gcno files ...\nFound 401 graph files in src\nusing: chunkSize: 1, nchunks:401, intervalLength:20\nlcov: WARNING: (gcov) GCOV did not produce any data for /Users/prabhatverma/projects/bitcoin/build/src/secp256k1/src/CMakeFiles/secp256k1_precomputed.dir/precomputed_ecmult.c.gcno\n        (use \"lcov --ignore-errors gcov,gcov ...\" to suppress this warning)\nlcov: WARNING: (gcov) GCOV did not produce any data for /Users/prabhatverma/projects/bitcoin/build/src/secp256k1/src/CMakeFiles/secp256k1_precomputed.dir/precomputed_ecmult_gen.c.gcno\nMessage summary:\n  1 error message:\n    inconsistent: 1\n  2 warning messages:\n    gcov: 2\nlcov: ERROR: (inconsistent) \"/Users/prabhatverma/projects/bitcoin/src/secp256k1/src/scalar_impl.h\":67: duplicate function 'secp256k1_scalar_split_lambda' starts on line 67 but previous definition started on 142 while capturing from src/secp256k1/src/CMakeFiles/exhaustive_tests.dir/tests_exhaustive.c.gcno.\n        (use \"lcov --ignore-errors inconsistent ...\" to bypass this error)\nCMake Error at build/CoverageInclude.cmake:45 (execute_process):\n  execute_process failed command indexes:\n\n    1: \"Child return code: 1\"\n\nCall Stack (most recent call first):\n  build/Coverage.cmake:5 (include)\n```\n\n### How did you obtain Bitcoin Core\n\nCompiled from source\n\n### What version of Bitcoin Core are you using?\n\nmaster@5b8fd7c\n\n### Operating system and version\n\nMacOs Sequoia 15.3.1\n\n### Machine specifications\n\n_No response_",
      "state": "closed",
      "user": "Prabhat1308",
      "created_at": "2025-02-21T12:39:18Z",
      "updated_at": "2025-04-02T06:15:19Z",
      "comments": 3,
      "url": "https://github.com/bitcoin/bitcoin/issues/31927",
      "labels": [
        "Tests"
      ],
      "comment_list": [
        {
          "user": "maflcko",
          "body": "This is a known issue. While I don't have macOS, some reported that it was working with clang/llvm tooling.\n\nYou can try `-DCMAKE_C_COMPILER='clang' -DCMAKE_CXX_COMPILER='clang++'  -DCMAKE_CXX_FLAGS='-fprofile-instr-generate -fcoverage-mapping'` and `llvm-cov`/`llvm-profdata` and see if that works for you.",
          "created_at": "2025-02-21T13:12:54Z"
        },
        {
          "user": "maflcko",
          "body": "If it works for you, feel free to update the `doc/developer-notes.md` to mention it. Also, I wonder it it could make sense to add a CMakePreset for a clang coverage build based on the flags?",
          "created_at": "2025-02-21T14:29:17Z"
        },
        {
          "user": "jonatack",
          "body": "Reproduced the issue on macOS 15.3.1 arm64 m1 max.",
          "created_at": "2025-02-22T18:32:17Z"
        }
      ]
    },
    {
      "number": 31924,
      "title": ".",
      "body": ".",
      "state": "closed",
      "user": "lotican",
      "created_at": "2025-02-21T11:21:39Z",
      "updated_at": "2025-02-21T12:32:35Z",
      "comments": 0,
      "url": "https://github.com/bitcoin/bitcoin/issues/31924",
      "labels": [
        "Feature"
      ]
    },
    {
      "number": 31922,
      "title": "Fuzzing Bitcoin Core with clang-16",
      "body": "### Is there an existing issue for this?\n\n- [x] I have searched the existing issues\n\n### Current behaviour\n\nbuilding fails during linking CXX executable bitcoin-wallet\n```\n[ 27%] Building CXX object src/util/CMakeFiles/bitcoin_util.dir/__/sync.cpp.o                                                                                            \n[ 27%] Linking CXX static library libbitcoin_util.a                                                                                                                      \n[ 27%] Built target bitcoin_util                                                                                                                                         \n[ 27%] Building C object src/secp256k1/src/CMakeFiles/secp256k1_precomputed.dir/precomputed_ecmult.c.o                                                                   \n[ 27%] Building C object src/secp256k1/src/CMakeFiles/secp256k1_precomputed.dir/precomputed_ecmult_gen.c.o                                                               \n[ 27%] Built target secp256k1_precomputed                                                                                                                                \n[ 28%] Building C object src/secp256k1/src/CMakeFiles/secp256k1.dir/secp256k1.c.o                                                                                        \n[ 28%] Linking C static library ../lib/libsecp256k1.a                                                                                                                    \n[ 28%] Built target secp256k1                                                                                                                                            \n[ 28%] Building CXX object src/CMakeFiles/bitcoin-wallet.dir/bitcoin-wallet.cpp.o                                                                                        \n[ 28%] Building CXX object src/CMakeFiles/bitcoin-wallet.dir/init/bitcoin-wallet.cpp.o                                                                                   \n[ 28%] Building CXX object src/CMakeFiles/bitcoin-wallet.dir/wallet/wallettool.cpp.o                                                                                     \n[ 28%] Linking CXX executable bitcoin-wallet                                                                                                                             \n/usr/bin/ld: libbitcoin_common.a(bloom.cpp.o): undefined reference to symbol 'exp@@GLIBC_2.29'                                                                           \n/usr/bin/ld: /lib/x86_64-linux-gnu/libm.so.6: error adding symbols: DSO missing from command line                                                                        \nclang: error: linker command failed with exit code 1 (use -v to see invocation)                                                                                          \ngmake[2]: *** [src/CMakeFiles/bitcoin-wallet.dir/build.make:138: src/bitcoin-wallet] Error 1                                                                             \ngmake[1]: *** [CMakeFiles/Makefile2:650: src/CMakeFiles/bitcoin-wallet.dir/all] Error 2                                                                                  \ngmake: *** [Makefile:146: all] Error 2\n```\n\n### Expected behaviour\n\nsuccessful fuzz build.\n\n### Steps to reproduce\n\nUsing master branch:\n\n`cmake -DCMAKE_C_COMPILER=/usr/bin/clang-16 -DCMAKE_CXX_COMPILER=/usr/bin/clang-16 --preset=libfuzzer`\n\nNote here I am using clang-16 because the project fails to even begin the build process due to an error: `uint256.h:133:19: error: call to consteval function 'util::ConstevalHexDigit' is not a constant expression`.  After finding the issue: https://github.com/bitcoin/bitcoin/issues/30947 I set the compiler to clang-16 which begins the build process but fails 28% through.\n\n### Relevant log output\n\n_No response_\n\n### How did you obtain Bitcoin Core\n\nCompiled from source\n\n### What version of Bitcoin Core are you using?\n\nmaster@5b8fd7c3a6b8c9c6a9481d340c3bcc67e74993c3\n\n### Operating system and version\n\nDebian GNU/Linux 12 (bookworm)\n\n### Machine specifications\n\n_No response_",
      "state": "closed",
      "user": "yancyribbens",
      "created_at": "2025-02-21T03:15:17Z",
      "updated_at": "2025-02-24T16:06:31Z",
      "comments": 2,
      "url": "https://github.com/bitcoin/bitcoin/issues/31922",
      "labels": [],
      "comment_list": [
        {
          "user": "maflcko",
          "body": "> [ 28%] Linking CXX executable bitcoin-wallet\n\nThere is no such executable in the fuzz build target. When using cmake, you will have to delete the build folder before configuring. Otherwise the build could be stale.\n\nAlso, your system has clang-19 available to use, see https://packages.debian.org/bookworm/clang-19\n\n\nWhat are the exact steps to reproduce?\n\nI can't reproduce this locally with:\n\n```\nrm -rf ./bld-fzz && cmake -DCMAKE_C_COMPILER=/usr/bin/clang-16 -DCMAKE_CXX_COMPILER=/usr/bin/clang++-16 -DSANITIZERS=fuzzer -DBUILD_FOR_FUZZING=ON -B ./bld-fzz && cmake --build ./bld-fzz -j $(nproc)\n```\n\nNor with\n\n```\nrm -rf ./bld-fzz && cmake -DCMAKE_C_COMPILER=/usr/bin/clang-19 -DCMAKE_CXX_COMPILER=/usr/bin/clang++-19 --preset=libfuzzer  -B ./bld-fzz && cmake --build ./bld-fzz -j $(nproc)",
          "created_at": "2025-02-21T08:25:19Z"
        },
        {
          "user": "yancyribbens",
          "body": "> What are the exact steps to reproduce?\n\nFollowing the docs here: https://github.com/bitcoin/bitcoin/blob/master/doc/fuzzing.md. `cmake --preset=libfuzzer` was fine, it was the next `cmake --build build_fuzz` that was failing.\n\nLooks like nuking `./bld-fzz` did the trick.  Should have thought to try a fresh checkout.  Thanks!",
          "created_at": "2025-02-21T22:38:29Z"
        }
      ]
    }
  ],
  "summary": {
    "pull_requests": 5,
    "issues": 3
  }
}