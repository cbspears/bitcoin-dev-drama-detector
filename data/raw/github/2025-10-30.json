{
  "source": "github",
  "repository": "bitcoin/bitcoin",
  "fetched_at": "2026-01-15T20:27:14.447374+00:00",
  "date": "2025-10-30",
  "pull_requests": [
    {
      "number": 33750,
      "title": "doc: document fingerprinting risk when operating node on multiple networks",
      "body": "Operating a Bitcoin node across multiple networks poses some fingerprinting risk. [0] Currently, this is not clear from the documentation and may be causing direct harm to users who are unaware of this. \r\n\r\nThe included documentation change indicates this risk factor but also notes that operating a node across multiple networks does provide an important benefit (increases the cost of eclipse and partitioning attacks) and is thus not discouraged outright. \r\n\r\nThe i2p documentation did not include a privacy recommendations section, so that is added as well.\r\n\r\n[0] https://delvingbitcoin.org/t/fingerprinting-nodes-via-addr-requests/1786\r\n",
      "state": "closed",
      "user": "da1sychain",
      "created_at": "2025-10-30T21:55:49Z",
      "updated_at": "2025-11-12T15:00:23Z",
      "comments": 3,
      "url": "https://github.com/bitcoin/bitcoin/pull/33750",
      "labels": [
        "Docs"
      ],
      "comment_list": [
        {
          "user": "DrahtBot",
          "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/33750.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| ACK | [danielabrozzoni](https://github.com/bitcoin/bitcoin/pull/33750#pullrequestreview-3409743891), [rkrux](https://github.com/bitcoin/bitcoin/pull/33750#pullrequestreview-3447791811), [mzumsande](https://github.com/bitcoin/bitcoin/pull/33750#pullrequestreview-3448401470), [glozow](https://github.com/bitcoin/bitcoin/pull/33750#pullrequestreview-3453781768) |\n| Concept ACK | [jonatack](https://github.com/bitcoin/bitcoin/pull/33750#pullrequestreview-3406173039) |\n\nIf your review is incorrectly listed, please react with üëé to this comment and the bot will ignore it on the next update.\n<!--5faf32d7da4f0f540f40219e4f7537a3-->",
          "created_at": "2025-10-30T21:55:54Z"
        },
        {
          "user": "darosior",
          "body": "> See #33498.\r\n\r\nThis is only one such vector. It's good to have a warning until we can be reasonably confident that it's not trivially possible to link two different network addresses of a node. I am also skeptical we could ever reach this level of confidence.",
          "created_at": "2025-10-31T20:04:24Z"
        },
        {
          "user": "da1sychain",
          "body": "Good catch and thank you for the review @danielabrozzoni!! I'll go ahead and fix that.",
          "created_at": "2025-11-04T20:47:53Z"
        }
      ]
    },
    {
      "number": 33749,
      "title": "test: ipc: resolve symlinks in `which capnp`",
      "body": "On Fedora, `/bin/` and `/usr/bin` are symlinked, and on one of my boxes (although I could not reproduce this behavior in a docker container), `/bin` comes before `/usr/bin` in `$PATH`, so `which capnp` reports `/bin/capnp`, and `capnp_dir` is set to `/include`, and the test fails:\r\n\r\n```console\r\n$ ./build/test/functional/interface_ipc.py\r\n2025-10-30T20:43:43.753812Z TestFramework (INFO): PRNG seed is: 8370468257027235753\r\n2025-10-30T20:43:43.754163Z TestFramework (INFO): Initializing test directory /tmp/bitcoin_func_test_b9kjzj2a\r\nterminate called after throwing an instance of 'kj::ExceptionImpl'\r\n  what():  mp/proxy.capnp:6: failed: Import failed: /capnp/c++.capnp\r\nAborted (core dumped)\r\n```\r\n\r\nThis changes the functional test to resolve any symlinks in the `capnp` binary path reported by `which`.",
      "state": "closed",
      "user": "davidgumberg",
      "created_at": "2025-10-30T21:34:53Z",
      "updated_at": "2025-10-31T16:35:49Z",
      "comments": 3,
      "url": "https://github.com/bitcoin/bitcoin/pull/33749",
      "labels": [
        "Tests"
      ],
      "comment_list": [
        {
          "user": "DrahtBot",
          "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/33749.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| ACK | [TheCharlatan](https://github.com/bitcoin/bitcoin/pull/33749#pullrequestreview-3402951597), [ryanofsky](https://github.com/bitcoin/bitcoin/pull/33749#pullrequestreview-3405061095) |\n\nIf your review is incorrectly listed, please react with üëé to this comment and the bot will ignore it on the next update.\n<!--5faf32d7da4f0f540f40219e4f7537a3-->",
          "created_at": "2025-10-30T21:34:59Z"
        },
        {
          "user": "Sjors",
          "body": "I tested that it doesn't interfere with my macOS setup (`/opt/homebrew/bin/capnp`).",
          "created_at": "2025-10-31T11:35:53Z"
        },
        {
          "user": "fanquake",
          "body": "cc @ryanofsky ",
          "created_at": "2025-10-31T15:43:14Z"
        }
      ]
    },
    {
      "number": 33747,
      "title": "contrib: shell completions for bitcoin wrapper executable",
      "body": "<!--\r\n*** Please remove the following help text before submitting: ***\r\n\r\nPull requests without a rationale and clear improvement may be closed\r\nimmediately.\r\n\r\nGUI-related pull requests should be opened against\r\nhttps://github.com/bitcoin-core/gui\r\nfirst. See CONTRIBUTING.md\r\n-->\r\n\r\n<!--\r\nPlease provide clear motivation for your patch and explain how it improves\r\nBitcoin Core user experience or Bitcoin Core developer experience\r\nsignificantly:\r\n\r\n* Any test improvements or new tests that improve coverage are always welcome.\r\n* All other changes should have accompanying unit tests (see `src/test/`) or\r\n  functional tests (see `test/`). Contributors should note which tests cover\r\n  modified code. If no tests exist for a region of modified code, new tests\r\n  should accompany the change.\r\n* Bug fixes are most welcome when they come with steps to reproduce or an\r\n  explanation of the potential issue as well as reasoning for the way the bug\r\n  was fixed.\r\n* Features are welcome, but might be rejected due to design or scope issues.\r\n  If a feature is based on a lot of dependencies, contributors should first\r\n  consider building the system outside of Bitcoin Core, if possible.\r\n* Refactoring changes are only accepted if they are required for a feature or\r\n  bug fix or otherwise improve developer experience significantly. For example,\r\n  most \"code style\" refactoring changes require a thorough explanation why they\r\n  are useful, what downsides they have and why they *significantly* improve\r\n  developer experience or avoid serious programming bugs. Note that code style\r\n  is often a subjective matter. Unless they are explicitly mentioned to be\r\n  preferred in the [developer notes](/doc/developer-notes.md), stylistic code\r\n  changes are usually rejected.\r\n-->\r\n\r\n<!--\r\nBitcoin Core has a thorough review process and even the most trivial change\r\nneeds to pass a lot of eyes and requires non-zero or even substantial time\r\neffort to review. There is a huge lack of active reviewers on the project, so\r\npatches often sit for a long time.\r\n-->\r\n\r\nAdd shell (bash, fish, and zsh) completions for unified bitcoin CLI\r\n\r\nThis PR adds comprehensive shell completion scripts for the new unified `bitcoin` command-line interface introduced in #31375. The completions support bash, zsh, and fish shells and provide tab completion for all available commands, options, and arguments.\r\n\r\n### Example Usage\r\n```bash\r\n# Complete subcommands\r\nbitcoin <TAB>\r\n# gui  node  rpc  wallet  tx  help  bench  chainstate  test  test-gui\r\n\r\n# Complete RPC methods  \r\nbitcoin rpc <TAB>\r\n# getblockchaininfo  getbestblockhash  getblock  ...\r\n\r\n# Complete options\r\nbitcoin node -<TAB>\r\n# -datadir  -conf  -daemon  -help  -rpcport  ...\r\n```\r\n\r\nClose #33603",
      "state": "open",
      "user": "hulxv",
      "created_at": "2025-10-30T18:09:16Z",
      "updated_at": "2025-11-03T20:30:30Z",
      "comments": 4,
      "url": "https://github.com/bitcoin/bitcoin/pull/33747",
      "labels": [
        "Scripts and tools"
      ],
      "comment_list": [
        {
          "user": "DrahtBot",
          "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/33747.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\nA summary of reviews will appear here.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#33402](https://github.com/bitcoin/bitcoin/pull/33402) (contrib: Add zsh completion scripts by mstampfer)\n* [#33385](https://github.com/bitcoin/bitcoin/pull/33385) (contrib: Add bash completion for new bitcoin command by caesrcd)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n<!--5faf32d7da4f0f540f40219e4f7537a3-->",
          "created_at": "2025-10-30T18:09:21Z"
        },
        {
          "user": "fanquake",
          "body": "Thanks. However aside from the fish addition, this duplicates works already being done in #33385 and #33402.",
          "created_at": "2025-11-03T17:21:28Z"
        },
        {
          "user": "hulxv",
          "body": "> Thanks. However aside from the fish addition, this duplicates works already being done in #33385 and #33402.\r\n\r\nActually, bash is the only is implemented in #33385 but zsh isn't implemented in #33402\r\n\r\nAlso in #33385, he covers only `rpc`, `node`, and `tx`, but mine covers all subcommands",
          "created_at": "2025-11-03T17:45:37Z"
        },
        {
          "user": "caesrcd",
          "body": "The bash completion in #33385 is being created in the same way the `bitcoin` command was ‚Äî as a wrapper. For that reason, since bash completions currently exist only for `bitcoin-cli`, `bitcoind`, and `bitcoin-tx`, it only covers `rpc`, `node`, and `tx`.\r\n\r\nI think it‚Äôs unnecessary to duplicate existing bash completions. Once #33385 gets merged, we can just add completions for the commands that don‚Äôt have them yet.",
          "created_at": "2025-11-03T20:30:30Z"
        }
      ]
    },
    {
      "number": 33746,
      "title": "ci: Add missing python3-dev package for riscv64",
      "body": "This is required to compile the pip wheels on native riscv64.\r\n\r\n",
      "state": "closed",
      "user": "maflcko",
      "created_at": "2025-10-30T13:15:16Z",
      "updated_at": "2025-10-31T12:28:03Z",
      "comments": 6,
      "url": "https://github.com/bitcoin/bitcoin/pull/33746",
      "labels": [
        "Tests"
      ],
      "comment_list": [
        {
          "user": "DrahtBot",
          "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/33746.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| ACK | [fanquake](https://github.com/bitcoin/bitcoin/pull/33746#issuecomment-3472257325) |\n\nIf your review is incorrectly listed, please react with üëé to this comment and the bot will ignore it on the next update.\n<!--5faf32d7da4f0f540f40219e4f7537a3-->",
          "created_at": "2025-10-30T13:15:22Z"
        },
        {
          "user": "maflcko",
          "body": "Otherwise the CI output will look like:\r\n\r\n```\r\n+ retry -- pip3 install --break-system-packages pycapnp\r\nCollecting pycapnp\r\n  Downloading pycapnp-2.2.1.tar.gz (709 kB)\r\n     ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ 709.1/709.1 kB 539.2 kB/s eta 0:00:00\r\n  Installing build dependencies: started\r\n  Installing build dependencies: finished with status 'done'\r\n  Getting requirements to build wheel: started\r\n  Getting requirements to build wheel: finished with status 'done'\r\n  Preparing metadata (pyproject.toml): started\r\n  Preparing metadata (pyproject.toml): finished with status 'done'\r\nBuilding wheels for collected packages: pycapnp\r\n  Building wheel for pycapnp (pyproject.toml): started\r\n  Building wheel for pycapnp (pyproject.toml): still running...\r\n  Building wheel for pycapnp (pyproject.toml): still running...\r\n  Building wheel for pycapnp (pyproject.toml): still running...\r\n  Building wheel for pycapnp (pyproject.toml): still running...\r\n  Building wheel for pycapnp (pyproject.toml): still running...\r\n  Building wheel for pycapnp (pyproject.toml): still running...\r\n  Building wheel for pycapnp (pyproject.toml): finished with status 'error'\r\n  error: subprocess-exited-with-error\r\n  \r\n  √ó Building wheel for pycapnp (pyproject.toml) did not run successfully.\r\n  ‚îÇ exit code: 1\r\n  ‚ï∞‚îÄ> [494 lines of output]\r\n...\r\n\r\n      -- Installing: /tmp/pip-install-6_9orfqj/pycapnp_1469b51e09c645a3b47136cf952b1f1d/build64/bin/capnpc-capnp\r\n      *WARNING* no libcapnp detected or rebuild forced. Attempting to build it from source now. If you have C++ Cap'n Proto installed, it may be out of date or is not being detected. This may take a while...\r\n      fetching https://capnproto.org/capnproto-c++-1.0.1.tar.gz into /tmp/pip-install-6_9orfqj/pycapnp_1469b51e09c645a3b47136cf952b1f1d/bundled\r\n      copying /tmp/pip-install-6_9orfqj/pycapnp_1469b51e09c645a3b47136cf952b1f1d/build64/include/capnp/rpc-twoparty.capnp -> build/lib.linux-riscv64-cpython-312/capnp\r\n      copying /tmp/pip-install-6_9orfqj/pycapnp_1469b51e09c645a3b47136cf952b1f1d/build64/include/capnp/stream.capnp -> build/lib.linux-riscv64-cpython-312/capnp\r\n      copying /tmp/pip-install-6_9orfqj/pycapnp_1469b51e09c645a3b47136cf952b1f1d/build64/include/capnp/rpc.capnp -> build/lib.linux-riscv64-cpython-312/capnp\r\n      copying /tmp/pip-install-6_9orfqj/pycapnp_1469b51e09c645a3b47136cf952b1f1d/build64/include/capnp/schema.capnp -> build/lib.linux-riscv64-cpython-312/capnp\r\n      copying /tmp/pip-install-6_9orfqj/pycapnp_1469b51e09c645a3b47136cf952b1f1d/build64/include/capnp/persistent.capnp -> build/lib.linux-riscv64-cpython-312/capnp\r\n      copying /tmp/pip-install-6_9orfqj/pycapnp_1469b51e09c645a3b47136cf952b1f1d/build64/include/capnp/c++.capnp -> build/lib.linux-riscv64-cpython-312/capnp\r\n      building 'capnp.lib.capnp' extension\r\n      creating build/temp.linux-riscv64-cpython-312/capnp/helpers\r\n      creating build/temp.linux-riscv64-cpython-312/capnp/includes\r\n      creating build/temp.linux-riscv64-cpython-312/capnp/lib\r\n      riscv64-linux-gnu-g++ -fno-strict-overflow -Wsign-compare -DNDEBUG -g -O2 -Wall -fPIC -I. -Icapnp/includes -I/tmp/pip-install-6_9orfqj/pycapnp_1469b51e09c645a3b47136cf952b1f1d/build64/include -I/ci_container_base/ci/scratch/py_venv/include -I/usr/include/python3.12 -c capnp/helpers/capabilityHelper.cpp -o build/temp.linux-riscv64-cpython-312/capnp/helpers/capabilityHelper.o --std=c++14\r\n      In file included from capnp/helpers/capabilityHelper.cpp:1:\r\n      ./capnp/helpers/capabilityHelper.h:7:10: fatal error: Python.h: No such file or directory\r\n          7 | #include \"Python.h\"\r\n            |          ^~~~~~~~~~\r\n      compilation terminated.\r\n      error: command '/usr/bin/riscv64-linux-gnu-g++' failed with exit code 1\r\n      [end of output]\r\n  \r\n  note: This error originates from a subprocess, and is likely not a problem with pip.\r\n  ERROR: Failed building wheel for pycapnp\r\nFailed to build pycapnp\r\nERROR: Could not build wheels for pycapnp, which is required to install pyproject.toml-based projects\r\n",
          "created_at": "2025-10-30T13:17:44Z"
        },
        {
          "user": "maflcko",
          "body": "This is based on commit 72511fd02e72b74be11273e97bd7911786a82e54 to avoid the clang-16 ICE, so the CI should now pass on `FILE_ENV=\"./ci/test/00_setup_env_native_nowallet_libbitcoinkernel.sh\"`.",
          "created_at": "2025-10-30T13:20:06Z"
        },
        {
          "user": "fanquake",
          "body": "ACK fae9235d39a9976a725cfc6f32cfacb1bdfcf7a3 - did not test.",
          "created_at": "2025-10-30T15:52:18Z"
        },
        {
          "user": "maflcko",
          "body": "(force pushed for Alpine)",
          "created_at": "2025-10-30T16:46:24Z"
        },
        {
          "user": "fanquake",
          "body": "ACK facf8b771a192ba17c8c4f9c43f248d83b3c8015",
          "created_at": "2025-10-31T10:03:37Z"
        }
      ]
    },
    {
      "number": 33745,
      "title": "mining: check witness commitment in submitBlock",
      "body": "When an IPC client requests a new block template via the Mining interface, we hold on to its `CBlock`. That way when they call `submitSolution()` we can modify it in place, rather than having to reconstruct the full block like the `submitblock` RPC does.\r\n\r\nBefore this commit however we forgot to invalidate `m_checked_witness_commitment`, which we should since the client brings a new coinbase.\r\n\r\nThis would cause us to accept an invalid chaintip.\r\n\r\nFix this and add a test to confirm that we now reject such a block. As a sanity check, we add a second node to the test and confirm that will accept our mined block.\r\n\r\nAs first noticed in #33374 the IPC code takes the coinbase as provided, unlike the `submitblock` RPC which calls `UpdateUncommittedBlockStructures()` and adds witness commitment to the coinbase if it was missing.\r\n\r\nAlthough that could have been an alternative fix, we instead document that IPC clients are expected to provide the full coinbase including witness commitment.\r\n\r\nPatch to produce the original issue:\r\n\r\n```diff\r\ndiff --git a/src/node/miner.cpp b/src/node/miner.cpp\r\nindex b988e28a3f..28e9048a4d 100644\r\n--- a/src/node/miner.cpp\r\n+++ b/src/node/miner.cpp\r\n@@ -450,15 +450,10 @@ void AddMerkleRootAndCoinbase(CBlock& block, CTransactionRef coinbase, uint32_t\r\n     }\r\n     block.nVersion = version;\r\n     block.nTime = timestamp;\r\n     block.nNonce = nonce;\r\n     block.hashMerkleRoot = BlockMerkleRoot(block);\r\n-\r\n-    // Reset cached checks\r\n-    block.m_checked_witness_commitment = false;\r\n-    block.m_checked_merkle_root = false;\r\n-    block.fChecked = false;\r\n }\r\n\r\n std::unique_ptr<CBlockTemplate> WaitAndCreateNewBlock(ChainstateManager& chainman,\r\n                                                       KernelNotifications& kernel_notifications,\r\n                                                       CTxMemPool* mempool,\r\ndiff --git a/test/functional/interface_ipc.py b/test/functional/interface_ipc.py\r\nindex cce56e3294..bf1b7048ab 100755\r\n--- a/test/functional/interface_ipc.py\r\n+++ b/test/functional/interface_ipc.py\r\n@@ -216,22 +216,22 @@ class IPCInterfaceTest(BitcoinTestFramework):\r\n             assert_equal(res.result, True)\r\n\r\n             # The remote template block will be mutated, capture the original:\r\n             remote_block_before = await self.parse_and_deserialize_block(template, ctx)\r\n\r\n-            self.log.debug(\"Submitted coinbase must include witness\")\r\n+            self.log.debug(\"Submitted coinbase with missing witness is accepted\")\r\n             assert_not_equal(coinbase.serialize_without_witness().hex(), coinbase.serialize().hex())\r\n             res = await template.result.submitSolution(ctx, block.nVersion, block.nTime, block.nNonce, coinbase.serialize_without_witness())\r\n-            assert_equal(res.result, False)\r\n+            assert_equal(res.result, True)\r\n\r\n             self.log.debug(\"Even a rejected submitBlock() mutates the template's block\")\r\n             # Can be used by clients to download and inspect the (rejected)\r\n             # reconstructed block.\r\n             remote_block_after = await self.parse_and_deserialize_block(template, ctx)\r\n             assert_not_equal(remote_block_before.serialize().hex(), remote_block_after.serialize().hex())\r\n\r\n-            self.log.debug(\"Submit again, with the witness\")\r\n+            self.log.debug(\"Submit again, with the witness - does not replace the invalid block\")\r\n             res = await template.result.submitSolution(ctx, block.nVersion, block.nTime, block.nNonce, coinbase.serialize())\r\n             assert_equal(res.result, True)\r\n\r\n             self.log.debug(\"Block should propagate\")\r\n             assert_equal(self.nodes[1].getchaintips()[0][\"height\"], current_block_height + 1)\r\n```\r\n",
      "state": "closed",
      "user": "Sjors",
      "created_at": "2025-10-30T12:02:55Z",
      "updated_at": "2025-11-12T15:32:00Z",
      "comments": 12,
      "url": "https://github.com/bitcoin/bitcoin/pull/33745",
      "labels": [
        "Mining"
      ],
      "comment_list": [
        {
          "user": "DrahtBot",
          "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/33745.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| ACK | [ryanofsky](https://github.com/bitcoin/bitcoin/pull/33745#issuecomment-3474302360), [TheCharlatan](https://github.com/bitcoin/bitcoin/pull/33745#pullrequestreview-3410154831), [ismaelsadeeq](https://github.com/bitcoin/bitcoin/pull/33745#pullrequestreview-3444353769) |\n\nIf your review is incorrectly listed, please react with üëé to this comment and the bot will ignore it on the next update.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#33819](https://github.com/bitcoin/bitcoin/pull/33819) (mining: add getCoinbase() by Sjors)\n* [#32420](https://github.com/bitcoin/bitcoin/pull/32420) (miner: drop dummy extraNonce in coinbase scriptSig for templates requested via IPC by Sjors)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n<!--5faf32d7da4f0f540f40219e4f7537a3-->",
          "created_at": "2025-10-30T12:03:01Z"
        },
        {
          "user": "fanquake",
          "body": "https://github.com/bitcoin/bitcoin/actions/runs/18939943748/job/54075967306?pr=33745#step:9:2351:\r\n```bash\r\n\r\ntest/miner_tests.cpp(70): Entering test suite \"miner_tests\"\r\ntest/miner_tests.cpp(686): Entering test case \"CreateNewBlock_validity\"\r\n<snip>\r\n 2025-10-30T12:08:21.221330Z [test] [validationinterface.cpp:218] [void ValidationSignals::BlockConnected(ChainstateRole, const std::shared_ptr<const CBlock> &, const CBlockIndex *)] [validation] Enqueuing BlockConnected: block hash=000000000019d6689c085ae165831e934ff763ae46a2a6c172b3f1b60a8ce26f block height=0\r\n2025-10-30T12:08:21.221451Z [scheduler] [validationinterface.cpp:218] [auto ValidationSignals::BlockConnected(ChainstateRole, const std::shared_ptr<const CBlock> &, const CBlockIndex *)::(anonymous class)::operator()() const] [validation] BlockConnected: block hash=000000000019d6689c085ae165831e934ff763ae46a2a6c172b3f1b60node/miner.cpp:187 CreateNewBlock: Assertion `pblock->m_checked_witness_commitment' failed.\r\n```",
          "created_at": "2025-10-30T13:38:26Z"
        },
        {
          "user": "Sjors",
          "body": "@TheCharlatan wrote:\r\n\r\n> What about the other checked flags? Should we just reset all of them in `AddMerkleRootAndCoinbase`?\r\n\r\nDone and pushed, but still checking the CI failure.",
          "created_at": "2025-10-30T13:45:45Z"
        },
        {
          "user": "Sjors",
          "body": "I dropped `Assume(pblock->m_checked_witness_commitment);` from `miner.cpp`, since the assumptions seems to be wrong.",
          "created_at": "2025-10-30T13:48:45Z"
        },
        {
          "user": "Sjors",
          "body": "Pushed [7d57c4e](https://github.com/bitcoin/bitcoin/commit/7d57c4e44451ce1167ba76a73c9cc6f6fd6cfca4) to [2fc95ca](https://github.com/bitcoin/bitcoin/commit/2fc95ca731b52ca419215109c568e89bf683a94b): [compare](https://github.com/bitcoin/bitcoin/compare/7d57c4e44451ce1167ba76a73c9cc6f6fd6cfca4..2fc95ca731b52ca419215109c568e89bf683a94b). No behavior change.\r\n\r\nI added a patch the to PR description that reproduces the original issue.\r\n\r\nExpanded the `submitSolution` documentation to indicate that a duplicate block is not considered a failure, and why.\r\n\r\nI kept all three reset caches for simplicity.\r\n\r\nNote that `m_checked_merkle_root` will be false anyway, because `BlockAssembler::CreateNewBlock` skips the merle root check. If we really wanted to skip that check, since we created the merle root ourselves, we would have to modify `ProcessNewBlock` to forward `check_merkle_root` to its `CheckBlock` call. That seems out of scope.\r\n\r\nSimilarly `fChecked` will already be `false` because the only place that sets it to true is guarded by `if (fCheckPOW && fCheckMerkleRoot)`.",
          "created_at": "2025-10-31T08:55:31Z"
        },
        {
          "user": "Sjors",
          "body": "@ryanofsky wrote:\r\n\r\n> I do think more improvements could be made here:\r\n\r\nThese could be followups, some thoughts:\r\n\r\n> - documentation could be updated to say what requirements on submitSolution inputs are\r\n\r\nNot sure what to write there, basically whatever consensus requires. Previously (external) mining software would generate the whole coinbase from scratch and we never really documented that. \r\n\r\nThe Stratum v2 spec does specify what their `SubmitSolution` message should look like: https://stratumprotocol.org/specification/07-Template-Distribution-Protocol/#77-submitsolution-client-server\r\n\r\nThat's presumably based on their understanding of our code, so we shouldn't blindly copy-paste it.\r\n\r\n> and I think BlockTemplate accessors could be added so miners do not need to make hardcoded assumptions about the coinbase transaction?  (https://github.com/bitcoin/bitcoin/pull/33745#discussion_r2477980297).\r\n\r\nThe Template Provider I implemented takes all sorts of stuff from the coinbase in order to produce its [NewTemplate message](https://stratumprotocol.org/specification/07-Template-Distribution-Protocol/#72-newtemplate-server-client):\r\n\r\n- https://github.com/Sjors/sv2-tp/blob/50ea909bc43b9c7ad3ccb20b142533317a9ac993/src/sv2/messages.cpp#L8-L32\r\n- https://github.com/Sjors/sv2-tp/blob/50ea909bc43b9c7ad3ccb20b142533317a9ac993/src/sv2/template_provider.cpp#L557-L562\r\n\r\nThis could be refactored to use more accessors. Though I'd be worried about having lots of back and forth IPC messages.\r\n\r\n> It would also be nice to return error messages and not just the false return value.\r\n\r\nIndeed, though this requires a refactor of `ProcessNewBlock`.",
          "created_at": "2025-10-31T09:11:41Z"
        },
        {
          "user": "Sjors",
          "body": "cc @ajtowns",
          "created_at": "2025-10-31T09:23:19Z"
        },
        {
          "user": "Sjors",
          "body": "I split the template block mutation test into a third commit and documented its history in the commit message.",
          "created_at": "2025-10-31T10:59:39Z"
        },
        {
          "user": "Sjors",
          "body": "I wrote:\r\n\r\n> The Template Provider I implemented takes all sorts of stuff from the coinbase in order to produce its NewTemplate message\r\n\r\nThis is a continuing source of confusion, see e.g. https://github.com/Sjors/sv2-tp/pull/55#pullrequestreview-3404172536\r\n\r\nOrthogonal to this PR, but I plan to add some getters to the interface later.",
          "created_at": "2025-10-31T16:10:30Z"
        },
        {
          "user": "ryanofsky",
          "body": "Code review ACK 6eaa00fe20206baedc0d8ade5bb8d066ea615704. Just documentation updates and test clarifications since last review, also splitting up a commit. \r\n\r\n---\r\n\r\nre: https://github.com/bitcoin/bitcoin/pull/33745#issuecomment-3472031005\r\n\r\n> > and I think BlockTemplate accessors could be added so miners do not need to make hardcoded assumptions about the coinbase transaction?  ([#33745 (comment)](https://github.com/bitcoin/bitcoin/pull/33745#discussion_r2477980297)).\r\n> \r\n> The Template Provider I implemented takes all sorts of stuff from the coinbase [...]\r\n\r\nThanks, those links to your implementation were really helpful. I didn't realize all of the required information for a possible protocol upgrade is actually available from getCoinbaseTx() and getWitnessCommitmentIndex() and not that hard to access. It's really the SV2 protocol that needs to change to be more future proof, not the mining interface.\r\n\r\n\r\n> This could be refactored to use more accessors. Though I'd be worried about having lots of back and forth IPC messages.\r\n\r\nYeah I wouldn't suggest adding lots of accessors just for convenience. If there are maybe a handful of fields that would be useful to return, could have a single getCoinbaseInfo() or similar method. But seems not very important.\r\n\r\n\r\n> > It would also be nice to return error messages and not just the false return value.\r\n> \r\n> Indeed, though this requires a refactor of `ProcessNewBlock`.\r\n\r\nYes, and definitely tangential to this PR, but it does seem like this change wouldn't be a big refactor since there is already a [BlockValidationState](https://github.com/bitcoin/bitcoin/blob/da6f041e39efaf64a84b748556e321021ec1f756/src/validation.cpp#L4517) variable that can be returned.\r\n\r\n\r\n\r\n> > * documentation could be updated to say what requirements on submitSolution inputs are\r\n> \r\n> Not sure what to write there, basically whatever consensus requires. Previously (external) mining software would generate the whole coinbase from scratch and we never really documented that.\r\n\r\nI guess the following comment would be overkill, but honestly I find this issue pretty confusing and think if we are going to be in an awkward state where external [software](https://github.com/bitcoin/bitcoin/pull/33374#issuecomment-3299129244) and [protocols](https://mirror.b10c.me/bitcoin-bitcoin/33374#issuecomment-3299309843) are making hardcoded assumptions about the node it could be useful to have a description of what's required and why.\r\n\r\nI asked chatgpt to write a comment describing requirements fully and maybe this is just useful for me personally, but to me it covers the information that seems useful to know:\r\n\r\n```c++\r\n/**\r\n * Construct a block from this template using the supplied header fields and\r\n * coinbase transaction, then submit it for processing/broadcast.\r\n *\r\n * SegWit / coinbase requirements:\r\n *   - When a witness commitment is expected for this template\r\n *     (i.e. getWitnessCommitmentIndex() != -1), the caller MUST supply a\r\n *     coinbase that is consistent with the template‚Äôs commitment semantics:\r\n *\r\n *       ‚Ä¢ Coinbase OUTPUT at the commitment index with script\r\n *         OP_RETURN 0xaa21a9ed <32-byte commitment>.\r\n *\r\n *       ‚Ä¢ Coinbase INPUT witness stack that contains a single 32-byte\r\n *         ‚Äúwitness-reserved value‚Äù R at vin[0].scriptWitness.stack[0].\r\n *\r\n *       ‚Ä¢ The 32-byte commitment MUST equal:\r\n *            SHA256d( WitnessMerkleRoot(block) || R )\r\n *\r\n *     IMPORTANT (future-proofing): The value R is consensus-opaque. Its\r\n *     contents and required construction MAY change via soft-fork in the\r\n *     future. Clients MUST treat R as a node-provided value and MUST NOT\r\n *     invent or substitute their own, unless the template explicitly\r\n *     authorizes client-chosen R.\r\n *\r\n * Provided helpers on BlockTemplate:\r\n *   - getCoinbaseTx()               : Base coinbase transaction for this template\r\n *                                     satisfying the requirements.\r\n *   - getWitnessCommitmentIndex()   : vout index of the witness-commitment OP_RETURN\r\n *                                     or -1 if no commitment is expected.\r\n *   - getCoinbaseCommitment()       : Serialized OP_RETURN script (0xaa21a9ed || 32B payload)\r\n *                                     to place at the commitment index.\r\n *\r\n * No auto-fixups:\r\n *     Unlike the submitblock RPC method, this IPC method\r\n *     DOES NOT call UpdateUncommittedBlockStructures() and\r\n *     DOES NOT modify/mint R or the commitment on your behalf. If the\r\n *     coinbase is missing/malformed/inconsistent or R does not match the\r\n *     template‚Äôs requirements, the call SHOULD fail with a descriptive error.\r\n *\r\n * Mutation:\r\n *   - This call mutates the underlying template‚Äôs block (coinbase, merkle\r\n *     root, header fields). Subsequent getBlockHeader()/getBlock()/\r\n *     getCoinbaseTx() reflect the updated state.\r\n *\r\n * Errors (recommended set):\r\n *   - MissingWitnessCommitmentOutput\r\n *   - MissingCoinbaseWitnessReservedValue\r\n *   - InvalidWitnessReservedValueSize\r\n *   - WitnessCommitmentMismatch\r\n *   - ReservedValueNotAuthorized   // client supplied R not matching template\r\n *   - TemplateStale\r\n *\r\n * Parameters:\r\n *   @param version   Block header nVersion.\r\n *   @param timestamp Block header nTime (UNIX epoch).\r\n *   @param nonce     Block header nNonce (32-bit).\r\n *   @param coinbase  COMPLETE coinbase tx (including witness if required).\r\n *\r\n * @returns true if enqueued for processing (independent of final validity).\r\n */\r\nvirtual bool submitSolution(uint32_t version,\r\n                            uint32_t timestamp,\r\n                            uint32_t nonce,\r\n                            CTransactionRef coinbase) = 0;\r\n```",
          "created_at": "2025-10-31T18:18:54Z"
        },
        {
          "user": "Sjors",
          "body": "Note that 6eaa00fe20206baedc0d8ade5bb8d066ea615704 _test: clarify submitBlock() mutates the template_ seems to conflict with what is proposed for the `BlockTemplateCache` in #33421, see https://github.com/bitcoin/bitcoin/pull/33421#pullrequestreview-3448014534. The plan there is to copy the template `CBlock` and apply the solution to that copy.\r\n\r\nThe choice between modifying in place and copying is not material to this pull request, and the code and test can be modified later, but it's probably better to decide which direction to go first.",
          "created_at": "2025-11-11T13:18:39Z"
        },
        {
          "user": "ismaelsadeeq",
          "body": "See https://github.com/bitcoin/bitcoin/pull/33421#discussion_r2514393534\r\n\r\nThat PR should be updated. This is the right direction IMO.",
          "created_at": "2025-11-11T14:29:51Z"
        }
      ]
    },
    {
      "number": 33744,
      "title": "ci: Fix lint runner selection (and docker cache)",
      "body": "Fixes: #33735\r\n\r\nCorrect runner type selection for the lint job.\r\n\r\nThis was erroneously left-out during refactor of the runner selection mechanism in #33302 causing the lint job to run on GH hosts (and therefore not be able to acces local cirrus caches).",
      "state": "closed",
      "user": "willcl-ark",
      "created_at": "2025-10-30T10:38:58Z",
      "updated_at": "2025-11-04T11:43:45Z",
      "comments": 6,
      "url": "https://github.com/bitcoin/bitcoin/pull/33744",
      "labels": [
        "Tests"
      ],
      "comment_list": [
        {
          "user": "DrahtBot",
          "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/33744.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| ACK | [hebasto](https://github.com/bitcoin/bitcoin/pull/33744#pullrequestreview-3412060705), [maflcko](https://github.com/bitcoin/bitcoin/pull/33744#issuecomment-3485496156) |\n\nIf your review is incorrectly listed, please react with üëé to this comment and the bot will ignore it on the next update.\n<!--5faf32d7da4f0f540f40219e4f7537a3-->",
          "created_at": "2025-10-30T10:39:04Z"
        },
        {
          "user": "maflcko",
          "body": "lgtm ACK 0b3b8a3be1a0db0dfc634acca1d9305dc0fbfae6\r\n\r\nThis is now selecting the correct provider.\r\n\r\n\r\nSome follow-up ideas:\r\n\r\nI ran `codex -c model=gpt-5-mini --dangerously-bypass-approvals-and-sandbox exec 'Review the top commit'` on ff18b6bbaf322739fe98fd51b0d89d65a5775ab5 for fun, and it printed:\r\n\r\n```\r\n**Potential issue I found**\r\n- In `action.yml` the `cache-provider` `options` list contains `gh`:\r\n  - `.github/actions/configure-docker/action.yml:4`\r\n  - But the workflow sets `provider=gha` in `ci.yml` (`echo \"provider=gha\" >> \"$GITHUB_OUTPUT\"`).\r\n```\r\n\r\nWhich looks real. I guess given that GitHub seems to ignore if wrong options are passed and doesn't do any validation anyway, it seems fine to remove them?\r\n\r\nAlso, could use a yaml anchor to re-use the snippet and specify the runners verbosely for the lint as well:\r\n\r\n```\r\n            cirrus-runner: 'ghcr.io/cirruslabs/ubuntu-runner-amd64:24.04-xs'\r\n            fallback-runner: 'ubuntu-24.04'\r\n```\r\n\r\nBut those are just nits. Feel free to ignore them.",
          "created_at": "2025-10-30T11:23:02Z"
        },
        {
          "user": "willcl-ark",
          "body": "I think it would make sense to include here. ",
          "created_at": "2025-10-30T13:05:34Z"
        },
        {
          "user": "willcl-ark",
          "body": "Sorry for the slow turnaround.\r\n\r\nI pushed an additional commit to address (half of) @maflcko's nits. He is correct that GHA apparently does not validate inputs (even if you set `type: choice`), so it makes sense to remove the `options`. In order that we not miss if the wrong option is passed here in the future I added a sanity check which will annotate the CI run with a `Warning` when an unknown input is detected. See the bottom of the annotations of this run for what that looks like: https://github.com/willcl-ark/bitcoin/actions/runs/19039344679",
          "created_at": "2025-11-03T15:18:49Z"
        },
        {
          "user": "maflcko",
          "body": "Didn't look at the second commit, which is written in Bash, but I guess this is harmless and fine either way.\r\n\r\nre-ACK 7632e0ba312a372259897c68fd7c7eb723df3738 üìû\r\n\r\n<details><summary>Show signature</summary>\r\n\r\nSignature:\r\n\r\n```\r\nuntrusted comment: signature from minisign secret key on empty file; verify via: minisign -Vm \"${path_to_any_empty_file}\" -P RWTRmVTMeKV5noAMqVlsMugDDCyyTSbA3Re5AkUrhvLVln0tSaFWglOw -x \"${path_to_this_whole_four_line_signature_blob}\"\r\nRUTRmVTMeKV5npGrKx1nqXCw5zeVHdtdYURB/KlyA/LMFgpNCs+SkW9a8N95d+U4AP1RJMi+krxU1A3Yux4bpwZNLvVBKy0wLgM=\r\ntrusted comment: re-ACK 7632e0ba312a372259897c68fd7c7eb723df3738 üìû\r\nWsj9jTyJ6hXdXzBRMaD6VfTIDzB+tNr/XZ8/PQRjnFNEFVI69yWaecnfLehm0JYzTWUz1H8zm72xzAnaCiGEBw==\r\n```\r\n\r\n</details>\r\n",
          "created_at": "2025-11-04T11:27:55Z"
        },
        {
          "user": "fanquake",
          "body": "Backported to `30.x` in #33609.",
          "created_at": "2025-11-04T11:43:45Z"
        }
      ]
    },
    {
      "number": 33743,
      "title": "fuzz: refactor memcpy to std::ranges::copy to work around ubsan warn",
      "body": "Using std::ranges::copy from the C++ standard library has a few benefits here:\r\n\r\n* It has the additional benefit of being a bit more type safe and document the byte cast explicitly.\r\n* The compiler will likely optimize it to the same asm, but performance doesn't really matter here anyway.\r\n* It has defined semantics for empty source ranges.\r\n\r\nFixes https://github.com/bitcoin/bitcoin/issues/33643",
      "state": "closed",
      "user": "maflcko",
      "created_at": "2025-10-30T10:10:00Z",
      "updated_at": "2025-10-31T12:28:55Z",
      "comments": 4,
      "url": "https://github.com/bitcoin/bitcoin/pull/33743",
      "labels": [
        "Tests",
        "Fuzzing"
      ],
      "comment_list": [
        {
          "user": "DrahtBot",
          "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/33743.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| ACK | [marcofleon](https://github.com/bitcoin/bitcoin/pull/33743#pullrequestreview-3400116871), [dergoegge](https://github.com/bitcoin/bitcoin/pull/33743#pullrequestreview-3403414040) |\n\nIf your review is incorrectly listed, please react with üëé to this comment and the bot will ignore it on the next update.\n<!--5faf32d7da4f0f540f40219e4f7537a3-->",
          "created_at": "2025-10-30T10:10:06Z"
        },
        {
          "user": "fanquake",
          "body": "cc @dergoegge @marcofleon ",
          "created_at": "2025-10-30T10:11:48Z"
        },
        {
          "user": "purpleKarrot",
          "body": "> * It works around an UB-Sanitizer bug, when the source range is empty.\r\n\r\nI guess what you want to express is:\r\n\r\n* It has defined semantics for empty source ranges.\r\n\r\nPassing a zero length to `memcpy` is UB per the language standard. This is not an \"UB-Sanitizer bug\".",
          "created_at": "2025-10-30T13:30:32Z"
        },
        {
          "user": "maflcko",
          "body": "Yeah, I guess it is too early to call this a bug, but the language standard has been changed, see https://github.com/bitcoin/bitcoin/pull/33644#issuecomment-3430890579.\r\n\r\nI've used your wording for now.",
          "created_at": "2025-10-30T14:18:45Z"
        }
      ]
    },
    {
      "number": 33742,
      "title": "doc: Document valgrind aarch64 clang workaround",
      "body": "Fixes https://github.com/bitcoin/bitcoin/issues/29635\r\n\r\nThe upstream bug will likely not be fixed any time soon, so it seems better to document the workaround and refer to the upstream bug.\r\n\r\nThis also allows to use any clang version (instead of requiring 16), going forward.",
      "state": "closed",
      "user": "maflcko",
      "created_at": "2025-10-30T09:07:21Z",
      "updated_at": "2025-10-30T14:23:22Z",
      "comments": 2,
      "url": "https://github.com/bitcoin/bitcoin/pull/33742",
      "labels": [
        "Docs"
      ],
      "comment_list": [
        {
          "user": "DrahtBot",
          "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/33742.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\nA summary of reviews will appear here.\n<!--5faf32d7da4f0f540f40219e4f7537a3-->",
          "created_at": "2025-10-30T09:07:27Z"
        },
        {
          "user": "maflcko",
          "body": "Closing for now",
          "created_at": "2025-10-30T14:23:17Z"
        }
      ]
    },
    {
      "number": 33741,
      "title": "rpc: Optionally print feerates in sat/vb",
      "body": "Part of https://github.com/bitcoin/bitcoin/issues/32093\r\n\r\nReturning feerates in BTC/kvB it can be very burdensome and is not good practice, as the most widely adopted units are sat/vB. This PR aims to show a PoC of how we could migrate to sat/vb in a backwards compatible manner.\r\n\r\nThe RPC affectd by this PR are `getmempoolinfo`, `getnetworkinfo`, `getwalletinfo`, `estimatesmartfee` and `estimaterawfee`.\r\n\r\nBecause of sub 1sat/vB environment we cannot rely on GetFee() because it internally uses FeeFrac EvaluateFee() function which rounds the values to always return an int. If the `feerate < 1` then it will be rounded to 1 or 0.\r\n\r\nFor more context or discuss how to migrate also arguments please refer to the open issue https://github.com/bitcoin/bitcoin/issues/32093.",
      "state": "open",
      "user": "polespinasa",
      "created_at": "2025-10-30T00:39:41Z",
      "updated_at": "2025-12-27T17:45:01Z",
      "comments": 8,
      "url": "https://github.com/bitcoin/bitcoin/pull/33741",
      "labels": [
        "RPC/REST/ZMQ",
        "Needs rebase"
      ],
      "comment_list": [
        {
          "user": "DrahtBot",
          "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/33741.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| Concept ACK | [w0xlt](https://github.com/bitcoin/bitcoin/pull/33741#pullrequestreview-3397062784) |\n\nIf your review is incorrectly listed, please react with üëé to this comment and the bot will ignore it on the next update.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#34113](https://github.com/bitcoin/bitcoin/pull/34113) (refactor: [rpc] Remove confusing and brittle integral casts by maflcko)\n* [#34075](https://github.com/bitcoin/bitcoin/pull/34075) (fees: Introduce Mempool Based Fee Estimation to reduce overestimation by ismaelsadeeq)\n* [#32138](https://github.com/bitcoin/bitcoin/pull/32138) (wallet, rpc: remove settxfee and paytxfee by polespinasa)\n* [#24539](https://github.com/bitcoin/bitcoin/pull/24539) (Add a \"tx output spender\" index by sstone)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n<!--5faf32d7da4f0f540f40219e4f7537a3-->",
          "created_at": "2025-10-30T00:39:46Z"
        },
        {
          "user": "polespinasa",
          "body": "@maflcko thanks for reviewing :)\r\n\r\n> I guess it is a bit verbose to have each RPC annotated with a type optional arg, but there probably isn't an easier solution.\r\n\r\nI don't think there is either, at least not in a backwards compatible way. \r\n\r\n> There could be a global option to toggle the default, to improve the UX.\r\n\r\nThat would be great for a `bitcoin-cli` user, but probably fatal for other programs that rely on the Bitcoin Core RPC.\r\nE.g. if a user with a Lightning Node enables sat/vB, thus making `estimatesmartfee` return `sat/vb` by default, probably the LN node will force close the channels due to lack of fees to pay.",
          "created_at": "2025-10-30T20:29:21Z"
        },
        {
          "user": "glozow",
          "body": "> Returning feerates in BTC/kvB it can be very burdensome and is not good practice, as the most widely adopted units are sat/vB. \r\n\r\nCan you explain why it's not good practice? I agree it's not as human-readable but I don't software minds either way. Not to be snarky, but I think the most widely adopted usage of this RPC interface must be to handle what it returns, including converting it before printing to users.\r\n\r\n> This PR aims to show a PoC of how we could migrate to sat/vb in a backwards compatible manner.\r\n\r\nIt seems extremely dangerous to ever change the default... no matter how much notice is given, it's a massive api break that would cause software to suddenly be several orders of magnitude off.\r\n\r\nA different approach could be to add another field to each result, like \"feerate_satvb\". A global config option like `-feeraterepresentation\" could determine which results are returned so that RPC results aren't bloated. I'm not familiar with how we might pass a global config option to the RPCs though.",
          "created_at": "2025-11-11T14:27:21Z"
        },
        {
          "user": "polespinasa",
          "body": "@glozow thanks for your comments :)\r\n\r\n> Can you explain why it's not good practice?\r\n\r\nWe open the door to other software/users to make easy mistakes by forcing them to do a unit conversion that Core shouldn't have done in the first place. I understand that this has been like this since ¬øalways?, but giving users the option to have sat/vB (or even more units thanks to FeeFrac) can be useful and reduce the burden on other software.\r\n\r\n> It seems extremely dangerous to ever change the default... no matter how much notice is given, it's a massive api break that would cause software to suddenly be several orders of magnitude off.\r\n\r\nI agree, this PR doesn't change any default behavior. It MUST be done in a backwards compatible way.\r\n\r\n> A different approach could be to add another field to each result, like \"feerate_satvb\".\r\n\r\nYes! This is another approach already taken by `fundrawtransaction` for example ([context](https://github.com/bitcoin/bitcoin/issues/32093#issuecomment-2884755244)).\r\n\r\n> A global config option like `-feeraterepresentation\" could determine which results are returned so that RPC results aren't bloated. I'm not familiar with how we might pass a global config option to the RPCs though.\r\n\r\nI don't dislike at all this approach and I would probably be open to switching to it if there's consensus that it is better.\r\nBut I am afraid that with that approach users can easily make huge mistakes. They could start their node with `-feeraterepresentation=satvB` and then use some software on top that expects BTC/kvB. That could be fatal. Because of that, I decided to follow the bool option in each RPC call. See https://github.com/bitcoin/bitcoin/pull/33741#issuecomment-3469979496",
          "created_at": "2025-11-11T18:46:45Z"
        },
        {
          "user": "glozow",
          "body": "> forcing them to do a unit conversion that Core shouldn't have done in the first place.\r\n\r\nI still don't see the argument for why a unit per kvB is so problematic. BTC and satoshis are easily convertible.\r\n\r\nI do think it's worthwhile to unify the format for inputting and and outputting feerates. And I agree it should be configurable, given there are multiple preferred formats.\r\n\r\nMy concern is the idea that the default format might be changed in the future, causing somebody's reading of a feerate to be off by a factor of 100,000. I think the acceptable way to do this is to create new fields and maybe phase out the old ones.\r\n\r\n> They could start their node with -feeraterepresentation=satvB and then use some software on top that expects BTC/kvB. That could be fatal.\r\n\r\nThat's why the results must have different names. If they forget the config option, they should get a key error.",
          "created_at": "2025-11-11T19:14:24Z"
        },
        {
          "user": "w0xlt",
          "body": "Adding a new field in the result called `feerate_unit` (string) to specify the unit used (`sat/vB` or `BTC/kvB`) may address this issue.\r\nThe current approach looks good to me, though.",
          "created_at": "2025-11-12T22:09:56Z"
        },
        {
          "user": "polespinasa",
          "body": "> I do think it's worthwhile to unify the format for inputting and and outputting feerates. And I agree it should be configurable, given there are multiple preferred formats.\r\n\r\nYes the idea is to be able to use sat/vB or BTC/kvB in inputting and outputting. This PR is just a PoC on how we could do it for outputting. \r\n\r\n> My concern is the idea that the default format might be changed in the future\r\n\r\nI don't think the default will ever be changed. I left the door open to it in some comments, but I would not push for it tbh.\r\n\r\n> That's why the results must have different names. If they forget the config option, they should get a key error.\r\n\r\nOh sorry I didn't understand your idea. So you propose to add a startup option to choose the feerate units and then on the outputs change the key so it will return a key error if someone is expecting a different unit? I think that's a good approach, how would you do it for rpc arguments though? Unless you force to use named arguments I think it can still lead to errors.",
          "created_at": "2025-11-13T01:52:17Z"
        },
        {
          "user": "DrahtBot",
          "body": "<!--cf906140f33d8803c4a75a2196329ecb-->\nüêô This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n",
          "created_at": "2025-12-27T17:45:01Z"
        }
      ]
    }
  ],
  "issues": [
    {
      "number": 33748,
      "title": ".",
      "body": ".",
      "state": "closed",
      "user": "roodmandev-ux",
      "created_at": "2025-10-30T21:20:48Z",
      "updated_at": "2025-10-30T22:05:55Z",
      "comments": 0,
      "url": "https://github.com/bitcoin/bitcoin/issues/33748",
      "labels": []
    }
  ],
  "summary": {
    "pull_requests": 9,
    "issues": 1
  }
}