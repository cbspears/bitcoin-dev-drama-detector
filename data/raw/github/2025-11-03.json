{
  "source": "github",
  "repository": "bitcoin/bitcoin",
  "fetched_at": "2026-01-15T20:28:00.435841+00:00",
  "date": "2025-11-03",
  "pull_requests": [
    {
      "number": 33772,
      "title": "prevector: simplify implementation of comparison operators and match behavior of `std::vector`",
      "body": "The reduced amount of code reduces maintenance. Providing `prevector::operator<=>` allows classes that are implemented in terms of `prevector` to use the compiler provided `operator<=>`.\r\n\r\nHowever, **there is a breaking change**!\r\n\r\nThe old implementation claims to be a drop-in replacement for `std::vector`. However, the implementation for `operator<` is different when comparing two vectors of different length, as can be presented with the following code:\r\n\r\n```cpp\r\nint main()\r\n{\r\n    auto const v12 = std::vector{1, 2};\r\n    auto const v3 = std::vector{3};\r\n\r\n    auto const pv12 = prevector<4, int>(v12.begin(), v12.end());\r\n    auto const pv3 = prevector<4, int>(v3.begin(), v3.end());\r\n\r\n    assert((v12 < v3) == (pv12 < pv3));\r\n}\r\n```\r\n\r\nWith the old implementation of `prevector`, the assertion fails. With my change, it passes.\r\nI ask the reviewers to confirm whether this change in behavior is acceptable or not.",
      "state": "open",
      "user": "purpleKarrot",
      "created_at": "2025-11-03T14:23:43Z",
      "updated_at": "2025-12-08T17:44:46Z",
      "comments": 3,
      "url": "https://github.com/bitcoin/bitcoin/pull/33772",
      "labels": [
        "Utils/log/libs",
        "Needs rebase"
      ],
      "comment_list": [
        {
          "user": "DrahtBot",
          "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/33772.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| Concept NACK | [stickies-v](https://github.com/bitcoin/bitcoin/pull/33772#pullrequestreview-3413315690) |\n\nIf your review is incorrectly listed, please react with üëé to this comment and the bot will ignore it on the next update.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#33771](https://github.com/bitcoin/bitcoin/pull/33771) (refactor: C++20 operators by purpleKarrot)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n<!--5faf32d7da4f0f540f40219e4f7537a3-->",
          "created_at": "2025-11-03T14:23:47Z"
        },
        {
          "user": "fanquake",
          "body": "As indicated by the CI, the macOS SDK we are targeting doesn't (yet) support `lexicographical_compare_three_way`. A Guix build will fail the same way:\r\n```bash\r\nIn file included from /distsrc-base/distsrc-21318e8b5df5-arm64-apple-darwin/src/chainparams.cpp:6:\r\nIn file included from /distsrc-base/distsrc-21318e8b5df5-arm64-apple-darwin/src/chainparams.h:9:\r\nIn file included from /distsrc-base/distsrc-21318e8b5df5-arm64-apple-darwin/src/kernel/chainparams.h:11:\r\nIn file included from /distsrc-base/distsrc-21318e8b5df5-arm64-apple-darwin/src/primitives/block.h:9:\r\nIn file included from /distsrc-base/distsrc-21318e8b5df5-arm64-apple-darwin/src/primitives/transaction.h:12:\r\nIn file included from /distsrc-base/distsrc-21318e8b5df5-arm64-apple-darwin/src/script/script.h:11:\r\n/distsrc-base/distsrc-21318e8b5df5-arm64-apple-darwin/src/prevector.h:446:21: error: no member named 'lexicographical_compare_three_way' in namespace 'std'; did you mean 'lexicographical_compare'?\r\n  446 |         return std::lexicographical_compare_three_way(begin(), end(), other.begin(), other.end());\r\n      |                ~~~~~^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\r\n      |                     lexicographical_compare\r\n/root/SDKs/Xcode-15.0-15A240d-extracted-SDK-with-libcxx-headers/usr/include/c++/v1/__algorithm/lexicographical_compare.h:42:1: note: 'lexicographical_compare' declared here\r\n   42 | lexicographical_compare(_InputIterator1 __first1, _InputIterator1 __last1,\r\n      | ^\r\n```",
          "created_at": "2025-11-03T15:23:51Z"
        },
        {
          "user": "DrahtBot",
          "body": "<!--cf906140f33d8803c4a75a2196329ecb-->\nüêô This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n",
          "created_at": "2025-12-08T17:44:46Z"
        }
      ]
    },
    {
      "number": 33771,
      "title": "refactor: C++20 operators",
      "body": "Remove all `operator!=` definitions and provide `operator<=>` as a replacement where all relational comparison operators were defined before.\r\n\r\nThe compiler is able to deduce missing comparison operators from `operator!=` and `operator<=>`. The compiler provided operators have the following advantages:\r\n\r\n1. less code\r\n2. guaranteed consistency\r\n\r\nRefactoring that changes the implementation, or replaces it with `= default` is left for a separate PR.",
      "state": "closed",
      "user": "purpleKarrot",
      "created_at": "2025-11-03T13:49:08Z",
      "updated_at": "2025-12-09T12:37:57Z",
      "comments": 6,
      "url": "https://github.com/bitcoin/bitcoin/pull/33771",
      "labels": [
        "Refactoring"
      ],
      "comment_list": [
        {
          "user": "DrahtBot",
          "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/33771.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| ACK | [stickies-v](https://github.com/bitcoin/bitcoin/pull/33771#pullrequestreview-3411834976), [optout21](https://github.com/bitcoin/bitcoin/pull/33771#issuecomment-3517219391), [janb84](https://github.com/bitcoin/bitcoin/pull/33771#pullrequestreview-3525686869), [Chand-ra](https://github.com/bitcoin/bitcoin/pull/33771#issuecomment-3625675526), [maflcko](https://github.com/bitcoin/bitcoin/pull/33771#issuecomment-3627658898), [sipa](https://github.com/bitcoin/bitcoin/pull/33771#pullrequestreview-3552981158) |\n\nIf your review is incorrectly listed, please copy-paste <code>&lt;!--meta-tag:bot-skip--&gt;</code> into the comment that the bot should ignore.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#33772](https://github.com/bitcoin/bitcoin/pull/33772) (prevector: simplify implementation of comparison operators and match behavior of `std::vector` by purpleKarrot)\n* [#33711](https://github.com/bitcoin/bitcoin/pull/33711) (transaction: Adding script witness to ToString for CTxIn by Ataraxia009)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n<!--5faf32d7da4f0f540f40219e4f7537a3-->",
          "created_at": "2025-11-03T13:49:13Z"
        },
        {
          "user": "optout21",
          "body": "utACK 48840bfc2d7beeac0ddf56a3c26b243156ec8936\r\n\r\nStraightforward refactoring resulting in code removal üòé\r\nFirst commit removes `!=` operator where `==` exits. Second commit replaces 4 comparison operators with the new `<=>` spaceship operator.\r\nMy only concern is that competence with the new `<=>` operator may not be extensive across the developer community of this project, but hey, it's time to learn!",
          "created_at": "2025-11-11T14:37:21Z"
        },
        {
          "user": "optout21",
          "body": "I wonder whether it would it be possible check for superfluous comparison operator implementations in linting?",
          "created_at": "2025-11-11T14:38:01Z"
        },
        {
          "user": "Chand-ra",
          "body": "tACK [`48840bf`](https://github.com/bitcoin/bitcoin/commit/48840bfc2d7beeac0ddf56a3c26b243156ec8936). Built the PR and ran unit tests; everything passes.\r\n\r\nVerified that all instances of  `operator!=` have been removed and  `operator<=>` replaces combined implementations of `<`, `<=`, `>`, and `>=`. (Note: PR #33772 and not this one gets rid of `operator<` in [`src/prevector.h`](https://github.com/bitcoin/bitcoin/blob/89dc82295ebd8a959fb5f6e7a116b6ce9e44e340/src/prevector.h#L458).)",
          "created_at": "2025-12-08T08:37:55Z"
        },
        {
          "user": "maflcko",
          "body": "review ACK 48840bfc2d7beeac0ddf56a3c26b243156ec8936 üåñ\r\n\r\n<details><summary>Show signature</summary>\r\n\r\nSignature:\r\n\r\n```\r\nuntrusted comment: signature from minisign secret key on empty file; verify via: minisign -Vm \"${path_to_any_empty_file}\" -P RWTRmVTMeKV5noAMqVlsMugDDCyyTSbA3Re5AkUrhvLVln0tSaFWglOw -x \"${path_to_this_whole_four_line_signature_blob}\"\r\nRUTRmVTMeKV5npGrKx1nqXCw5zeVHdtdYURB/KlyA/LMFgpNCs+SkW9a8N95d+U4AP1RJMi+krxU1A3Yux4bpwZNLvVBKy0wLgM=\r\ntrusted comment: review ACK 48840bfc2d7beeac0ddf56a3c26b243156ec8936 üåñ\r\nRJCzzHS7aZcc9j1dS+BlIns6fkD9vUnjg/5rVEcIpZ07JGtNbdDramcmgcbbznLHZYBJgSUdVocxGNYeupAnCw==\r\n```\r\n\r\n</details>\r\n",
          "created_at": "2025-12-08T15:54:23Z"
        },
        {
          "user": "maflcko",
          "body": "I think there are some missed cases. It could make sense to include them in a follow-up?\r\n\r\n```diff\r\ndiff --git a/src/kernel/bitcoinkernel_wrapper.h b/src/kernel/bitcoinkernel_wrapper.h\r\nindex 3fb90da7a9..055ea83808 100644\r\n--- a/src/kernel/bitcoinkernel_wrapper.h\r\n+++ b/src/kernel/bitcoinkernel_wrapper.h\r\n@@ -465,14 +465,9 @@ private:\r\n     TxidApi() = default;\r\n \r\n public:\r\n-    bool operator==(const TxidApi& other) const\r\n+    friend bool operator==(const Derived& lhs, const Derived& rhs)\r\n     {\r\n-        return btck_txid_equals(impl(), other.impl()) != 0;\r\n-    }\r\n-\r\n-    bool operator!=(const TxidApi& other) const\r\n-    {\r\n-        return btck_txid_equals(impl(), other.impl()) == 0;\r\n+        return btck_txid_equals(lhs.get(), rhs.get()) != 0;\r\n     }\r\n \r\n     std::array<std::byte, 32> ToBytes() const\r\n@@ -665,14 +660,9 @@ private:\r\n     }\r\n \r\n public:\r\n-    bool operator==(const Derived& other) const\r\n-    {\r\n-        return btck_block_hash_equals(impl(), other.get()) != 0;\r\n-    }\r\n-\r\n-    bool operator!=(const Derived& other) const\r\n+    friend bool operator==(const Derived& lhs, const Derived& rhs)\r\n     {\r\n-        return btck_block_hash_equals(impl(), other.get()) == 0;\r\n+        return btck_block_hash_equals(lhs.get(), rhs.get()) != 0;\r\n     }\r\n \r\n     std::array<std::byte, 32> ToBytes() const\r\n",
          "created_at": "2025-12-09T12:37:57Z"
        }
      ]
    },
    {
      "number": 33770,
      "title": "init: Require explicit -asmap filename",
      "body": "Currently, if `-asmap` is specified without a filename bitcoind tries to load `ip_asn.map` data file.\r\n\r\nThis change now requires `-asmap=ip_asn.map` or another filename to be specified explicitly.\r\n\r\nThe change is intended to make behavior of the option explicit and avoid confusion reported https://github.com/bitcoin/bitcoin/issues/33386 where documentation specifies a default file which is not actually loaded by default. It was originally implemented in\r\nhttps://github.com/bitcoin/bitcoin/pull/33631#issuecomment-3410302383 and various alternatives are discussed there.\r\n",
      "state": "closed",
      "user": "ryanofsky",
      "created_at": "2025-11-03T13:17:43Z",
      "updated_at": "2025-11-21T23:28:50Z",
      "comments": 16,
      "url": "https://github.com/bitcoin/bitcoin/pull/33770",
      "labels": [
        "P2P"
      ],
      "comment_list": [
        {
          "user": "DrahtBot",
          "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/33770.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| ACK | [brunoerg](https://github.com/bitcoin/bitcoin/pull/33770#issuecomment-3552990665), [fjahr](https://github.com/bitcoin/bitcoin/pull/33770#issuecomment-3552996786), [vostrnad](https://github.com/bitcoin/bitcoin/pull/33770#issuecomment-3553386556) |\n| Stale ACK | [TheCharlatan](https://github.com/bitcoin/bitcoin/pull/33770#pullrequestreview-3416860885), [pablomartin4btc](https://github.com/bitcoin/bitcoin/pull/33770#pullrequestreview-3418202432), [jurraca](https://github.com/bitcoin/bitcoin/pull/33770#issuecomment-3497961898) |\n| User requested bot ignore | [achow101](https://github.com/bitcoin/bitcoin/pull/33770#issuecomment-3564962500) |\n\nIf your review is incorrectly listed, please react with üëé to this comment and the bot will ignore it on the next update.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#33920](https://github.com/bitcoin/bitcoin/pull/33920) (Export embedded ASMap RPC by fjahr)\n* [#33702](https://github.com/bitcoin/bitcoin/pull/33702) (contrib: Remove brittle, confusing and redundant UTF8 encoding from Python IO by maflcko)\n* [#33631](https://github.com/bitcoin/bitcoin/pull/33631) (init: Split file path handling out of -asmap option by fjahr)\n* [#31260](https://github.com/bitcoin/bitcoin/pull/31260) (scripted-diff: Type-safe settings retrieval by ryanofsky)\n* [#28792](https://github.com/bitcoin/bitcoin/pull/28792) (build: Embedded ASMap [3/3]: Build binary dump header file by fjahr)\n* [#17783](https://github.com/bitcoin/bitcoin/pull/17783) (common: Disallow calling IsArgSet() on ALLOW_LIST options by ryanofsky)\n* [#17581](https://github.com/bitcoin/bitcoin/pull/17581) (refactor: Remove settings merge reverse precedence code by ryanofsky)\n* [#17580](https://github.com/bitcoin/bitcoin/pull/17580) (refactor: Add ALLOW_LIST flags and enforce usage in CheckArgFlags by ryanofsky)\n* [#17493](https://github.com/bitcoin/bitcoin/pull/17493) (util: Forbid ambiguous multiple assignments in config file by ryanofsky)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n<!--5faf32d7da4f0f540f40219e4f7537a3-->",
          "created_at": "2025-11-03T13:17:47Z"
        },
        {
          "user": "ryanofsky",
          "body": "Thanks for the suggestions and reviews! Implemented some test cleanup below.\r\n\r\nI do want to wait for feedback from @fjahr before going ahead with this PR since he expressed a preference for keeping behavior unchanged until #28792 is merged (\"I am again leaning towards keeping the current behavior for the intermediary step\" from https://github.com/bitcoin/bitcoin/pull/33631#issuecomment-3475259644) and I think that would be reasonable. But I do think this PR is an improvement in the short term, and resolution to #33386, and good preparation for #28792 since it makes stops making `-asmap` load file data like #28792 will also do.\r\n\r\n<!-- begin push-3 -->\r\nUpdated cfeb160baec1369452c42d05c51f2a6af76ed077 -> 44717da29b626bfdcb20a32318689d74c4113b7b ([`pr/asmapd.2`](https://github.com/ryanofsky/bitcoin/commits/pr/asmapd.2) -> [`pr/asmapd.3`](https://github.com/ryanofsky/bitcoin/commits/pr/asmapd.3), [compare](https://github.com/ryanofsky/bitcoin/compare/pr/asmapd.2..pr/asmapd.3))<!-- end --> cleaning up test as suggested\r\n",
          "created_at": "2025-11-05T13:54:26Z"
        },
        {
          "user": "fjahr",
          "body": "Thanks @ryanofsky for the ping and for moving the conversation forward.\r\n\r\nI am -0 on this change for now because in the recollection of conversations about ASMap usage whenever the conversation touched this (which was rarely) then either people were indifferent about the default path or found it nice to have. I don‚Äôt recollect anyone expressing negativity about it, as in it doesn‚Äôt make sense or it won‚Äôt be used. I can not point at specific people or conversations that were documented for this, so take it with a grain of salt. Also, I think the maintenance burden of the code is minimal and the inconsistencies are not as big of deal to me as to others.\r\n\r\nAs I laid out in https://github.com/bitcoin/bitcoin/pull/33631#issuecomment-3475259644 I convinced myself that the current behavior is as consistent as we can get currently and in the context of embedded asmap data being added but being off by default. And when we switch to on by default eventually the behavior should be fully consistent. So not making a change is still my slight preference based on the sentiment I mentioned above.\r\n\r\nHowever, this is an absolutely valid and certainly also the easiest solution. I think it is also not unreasonable to assume that the demand for this feature goes down when we have the embedded data available. The code looks good to me as well on first glance.\r\n\r\nI will reach out to a few people today that have been using asmap files consistently in the past and ask them to weigh in if they prefer to use asmap with this option. If there isn‚Äôt anyone speaking out in favor of keeping it within a few days it should be fine to remove it and I would change my -0 to +0. But if this PR gets overwhelming support and is merged earlier, I would also be fine with it.",
          "created_at": "2025-11-06T12:36:30Z"
        },
        {
          "user": "ryanofsky",
          "body": "> [P]eople were indifferent about the default path or found it nice to have. I don‚Äôt recollect anyone expressing negativity about it, as in it doesn‚Äôt make sense or it won‚Äôt be used\r\n\r\nTo be sure, I think it could make sense to have a default path that is loaded by default. I think it just to confusing to have a default path that is not loaded by default, and I think https://github.com/bitcoin/bitcoin/issues/33386 shows I'm not the only one who finds the current situation confusing.\r\n\r\nAlso if #28792 will require `-asmap=<file>` to load file data, then it would seem to make sense to also require that now, instead of providing two ways of loading file data now (`-asmap=<file>` and `-asmap`) and then taking one away later.",
          "created_at": "2025-11-06T13:15:03Z"
        },
        {
          "user": "fjahr",
          "body": "> To be sure, I think it could make sense to have a default path that is loaded by default. I think it just to confusing to have a default path that is not loaded by default, and I think #33386 shows I'm not the only one who finds the current situation confusing.\r\n\r\nSure I don't question that there is a potential confusion, we just disagree on whether the confusion is bad enough to take away the feature. I would like to go with whatever the users want which might be in favor of keeping the option, but if I can't confirm that hunch in the short term then happy to ACK removing it. I have pinged the OP of #33386 there as well to clarify where they stand on this.\r\n\r\n> Also if #28792 will require `-asmap=<file>` to load file data, then it would seem to make sense to also require that now, instead of providing two ways of loading file data now (`-asmap=<file>` and `-asmap`) and then taking one away later.\r\n\r\nReview on #28792 is extremely slow, so I do expect this discussion here and https://github.com/bitcoin/bitcoin/pull/33631 to be resolved or merged before #28792 is close to getting merged. So I am not so concerned with ordering.\r\n",
          "created_at": "2025-11-06T13:37:29Z"
        },
        {
          "user": "jurraca",
          "body": "ACK 44717da29b626bfdcb20a32318689d74c4113b7b \r\n\r\nI think it's a better pattern to force users to specify the filename, but I can't tell whether users currently depend on the default. ",
          "created_at": "2025-11-06T15:50:16Z"
        },
        {
          "user": "sipa",
          "body": "I'm neutral on this PR.\r\n\r\nI do use the `asmap.dat` loading by default, but (a) don't care about changing that to specify it explicitly and (b) I hope #28794 happens soonish so it becomes a non-issue (as I will switch to built-in asmap files rather than explicit ones in the datadir).",
          "created_at": "2025-11-06T15:58:00Z"
        },
        {
          "user": "0xB10C",
          "body": "I load the `asmap.dat` file on by using `asmap=/absolute/path/to/asmap.dat` in my [config](https://github.com/0xB10C/peer-observer-infra-library/blob/e14fc1e29a3adbd35d5e3af73766039279fbf5c4/modules/node/node.nix#L225). Since this PR doesn't change anything for me, I'm neutral on this too. ",
          "created_at": "2025-11-07T02:57:07Z"
        },
        {
          "user": "fjahr",
          "body": "ACK deac31dd779d28a8c01f1c3153650f5827cfe75d\r\n\r\nReviewed code and tested locally. I had grepped for other relevant mentions of the default location previously.",
          "created_at": "2025-11-14T15:06:27Z"
        },
        {
          "user": "brunoerg",
          "body": "reACK 288b8c30be42f2879d1a1f3d5ec3cac13f87ace4\r\n\r\nVerified it removed the `strprintf` and `(default: none)`.",
          "created_at": "2025-11-19T14:26:22Z"
        },
        {
          "user": "fjahr",
          "body": "reACK 288b8c30be42f2879d1a1f3d5ec3cac13f87ace4",
          "created_at": "2025-11-19T14:27:46Z"
        },
        {
          "user": "vostrnad",
          "body": "utACK 288b8c30be42f2879d1a1f3d5ec3cac13f87ace4",
          "created_at": "2025-11-19T15:38:23Z"
        },
        {
          "user": "achow101",
          "body": "@fjahr DrahtBot is ignoring your ACK, is that intended? If you mean to withdraw your ACK, I think editing your comment with a strikethrough and explanation is the typical way people do that.",
          "created_at": "2025-11-21T22:24:36Z"
        },
        {
          "user": "fjahr",
          "body": "> @fjahr DrahtBot is ignoring your ACK, is that intended? If you mean to withdraw your ACK, I think editing your comment with a strikethrough and explanation is the typical way people do that.\r\n\r\nIt falsely interpreted this comment as an ACK previously and that's when I put the ignore: https://github.com/bitcoin/bitcoin/pull/33770#issuecomment-3497304815 I have removed the emoji reaction, not sure if that makes it reconsider my latest ACK but that is still valid.",
          "created_at": "2025-11-21T22:28:40Z"
        },
        {
          "user": "fjahr",
          "body": "re-ACK 288b8c30be42f2879d1a1f3d5ec3cac13f87ace4\r\n\r\nOnly minor fixes since last review.",
          "created_at": "2025-11-21T22:30:53Z"
        },
        {
          "user": "achow101",
          "body": "ACK 288b8c30be42f2879d1a1f3d5ec3cac13f87ace4",
          "created_at": "2025-11-21T23:18:49Z"
        }
      ]
    },
    {
      "number": 33768,
      "title": "refactor: remove dead branches in `SingletonClusterImpl`",
      "body": "Found during review: [cluster mempool: control/optimize TxGraph memory usage](https://github.com/bitcoin/bitcoin/pull/33157#discussion_r2423058928)\r\n\r\n### Fixes\r\n`SplitAll()` always calls `ApplyRemovals()` first, for a singleton, it empties the cluster, therefore any `SingletonClusterImpl` passed to `Split()` must be empty.\r\n\r\n`TxGraphImpl::ApplyDependencies()` first merges each dependency group and asserts the group has at least one dependency. Since `parent` != `child`, `TxGraphImpl::Merge()` upgrades the merge target to `GenericClusterImpl`, therefore the `ApplyDependencies()` is never dispatched to `SingletonClusterImpl`.\r\n\r\n### Coverage proof:\r\n* https://maflcko.github.io/b-c-cov/fuzz.coverage/src/txgraph.cpp.gcov.html#L1446\r\n* https://storage.googleapis.com/oss-fuzz-coverage/bitcoin-core/reports/20251103/linux/src/bitcoin-core/src/txgraph.cpp.html#L1446",
      "state": "closed",
      "user": "l0rinc",
      "created_at": "2025-11-03T11:20:28Z",
      "updated_at": "2025-11-07T10:11:31Z",
      "comments": 2,
      "url": "https://github.com/bitcoin/bitcoin/pull/33768",
      "labels": [
        "Refactoring"
      ],
      "comment_list": [
        {
          "user": "DrahtBot",
          "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/33768.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| ACK | [sipa](https://github.com/bitcoin/bitcoin/pull/33768#pullrequestreview-3410906177), [instagibbs](https://github.com/bitcoin/bitcoin/pull/33768#issuecomment-3490803624) |\n\nIf your review is incorrectly listed, please react with üëé to this comment and the bot will ignore it on the next update.\n<!--5faf32d7da4f0f540f40219e4f7537a3-->",
          "created_at": "2025-11-03T11:20:34Z"
        },
        {
          "user": "instagibbs",
          "body": "ACK 2d23820ee11678d567c75f94c40011ed9f0e274f",
          "created_at": "2025-11-05T11:57:03Z"
        }
      ]
    }
  ],
  "issues": [
    {
      "number": 33769,
      "title": "log: \"Replaying blocks\" / \"Rolling forward\" logging is rate-limited",
      "body": "This should probably be excluded from rate-limiting:\n```bash\n2025-11-03T11:42:20Z Rolling forward 000000004a2ed49fca14f2a937747a307110a8da0a5052dd9065548c36aaaf17 (9627)\n2025-11-03T11:42:20Z Rolling forward 0000000019bee828395d1d6a283362222991a5bcfa37604b381ca0db25b1c191 (9628)\n2025-11-03T11:42:20Z Rolling forward 000000008b57d05f433a6fcf0942b7fef226678fc0a6a623088fd846f48274e0 (9629)\n2025-11-03T11:42:20Z Rolling forward 00000000de934300732c23fa07ebc4778d9b64a14d998e6eb3cffbefe01ad950 (9630)\n[*] 2025-11-03T11:42:20Z [warning] Excessive logging detected from ./validation.cpp:4947 (bool Chainstate::ReplayBlocks()): >1048576 bytes logged during the last time window of 3600s. Suppressing logging to disk from this source location until time window resets. Console logging unaffected. Last log entry.\n[*] 2025-11-03T11:42:20Z Rolling forward 0000000059958a2cc66e0d460faa7d11f4bff6a332ccac1c1435d25fd812a4d4 (9631)\n[*] 2025-11-03T11:42:20Z Rolling forward 00000000062252579e0d74e9fbee693645f52b085a5e29928b1c213b6a8f93aa (9632)\n[*] 2025-11-03T11:42:20Z Rolling forward 000000002a50b1ae5b32b06970f7a7a082c05328dac9969ccb55f7a05e5f25a0 (9633)\n[*] 2025-11-03T11:42:20Z Rolling forward 00000000260d5e479301d6f898e16ff58cf2e94da0ceb2f0c039eed791170d44 (9634)\n[*] 2025-11-03T11:42:20Z Rolling forward 00000000a0fac1ecca01d1eb33ce4981634ee2de5b6ebd944988a5010b147359 (9635)\n<snip>\n[*] 2025-11-03T11:42:35Z Rolling forward 000000000000089e9cca1b62ff9c0dcffce69e514f86c6ab78c5d95d0bc327f2 (137258)\n[*] 2025-11-03T11:42:35Z Rolling forward 000000000000047457383ea46e0313250f1c327f04ab3001267ce9ee8e6031d1 (137259)\n[*] 2025-11-03T11:42:35Z Rolling forward 00000000000007800f9de4fa37e8de049649a1efe8236508678a4d2f45052d72 (137260)\n[*] 2025-11-03T11:42:35Z Rolling forward 00000000000002eb049c8f116e6209e400d9568770c8bca3a21fd00771e8c0f2 (137261)\n[*] 2025-11-03T11:42:35Z Rolling forward 00000000000002cdcb65d9f67986589d12dbab16e049ac598fda46da13e95f17 (137262)\n[*] 2025-11-03T11:42:35Z Rolling forward 00000000000008754a10cbd100b3b7e5da82eaa6183470fb53bba9a98421cc9b (137263)\n[*] 2025-11-03T11:42:35Z Rolling forward 00000000000003c3e43b723c40e7b3753459c13c5ba035578a4a0a25773fa9c5 (137264)\n[*] 2025-11-03T11:42:36Z Loaded best chain: hashBestChain=00000000000003c3e43b723c40e7b3753459c13c5ba035578a4a0a25773fa9c5 height=137264 date=2011-07-21T00:58:46Z progress=0.000862\n[*] 2025-11-03T11:42:36Z init message: Verifying blocks‚Ä¶\n[*] 2025-11-03T11:42:36Z Verifying last 6 blocks at level 3\n[*] 2025-11-03T11:42:36Z Verification progress: 0%\n[*] 2025-11-03T11:42:36Z Shutdown requested. Exiting.\n[*] 2025-11-03T11:42:36Z Shutdown in progress...\n[*] 2025-11-03T11:42:36Z scheduler thread exit\n[*] 2025-11-03T11:42:36Z Flushed fee estimates to fee_estimates.dat.\n[*] 2025-11-03T11:42:36Z Shutdown done\n```\n\nResulting in a `debug.log` like:\n```bash\n2025-11-03T11:42:20Z Rolling forward 0000000002026d84baaf6c16bbc54f39bb89f10aa1b135d05265fad0266976a7 (9621)\n2025-11-03T11:42:20Z Rolling forward 000000000276b83d2c228c3d7de5fdc026ea345e4a8d77c098d654ff9464f89c (9622)\n2025-11-03T11:42:20Z Rolling forward 00000000dfac8a589bbb066ab83b93d49d463ab2dbf77ba0d70ad51c11177a3e (9623)\n2025-11-03T11:42:20Z Rolling forward 00000000fb2a066ba024f8e7fe54bb61599f7a2810748598aad77f369e9fcc9b (9624)\n2025-11-03T11:42:20Z Rolling forward 00000000b91b9b688617963d22b2b4d638cda7588a87c830f2111fc3eeb1b526 (9625)\n2025-11-03T11:42:20Z Rolling forward 00000000a6b6f1b2e7526a8c26043a01ce7098cbc5d95896b4dc24836b908411 (9626)\n2025-11-03T11:42:20Z Rolling forward 000000004a2ed49fca14f2a937747a307110a8da0a5052dd9065548c36aaaf17 (9627)\n2025-11-03T11:42:20Z Rolling forward 0000000019bee828395d1d6a283362222991a5bcfa37604b381ca0db25b1c191 (9628)\n2025-11-03T11:42:20Z Rolling forward 000000008b57d05f433a6fcf0942b7fef226678fc0a6a623088fd846f48274e0 (9629)\n2025-11-03T11:42:20Z Rolling forward 00000000de934300732c23fa07ebc4778d9b64a14d998e6eb3cffbefe01ad950 (9630)\n[*] 2025-11-03T11:42:20Z [warning] Excessive logging detected from ./validation.cpp:4947 (bool Chainstate::ReplayBlocks()): >1048576 bytes logged during the last time window of 3600s. Suppressing logging to disk from this source location until time window resets. Console logging unaffected. Last log entry.\n[*] 2025-11-03T11:42:20Z Rolling forward 0000000059958a2cc66e0d460faa7d11f4bff6a332ccac1c1435d25fd812a4d4 (9631)\n[*] 2025-11-03T11:42:36Z Loaded best chain: hashBestChain=00000000000003c3e43b723c40e7b3753459c13c5ba035578a4a0a25773fa9c5 height=137264 date=2011-07-21T00:58:46Z progress=0.000862\n[*] 2025-11-03T11:42:36Z init message: Verifying blocks‚Ä¶\n[*] 2025-11-03T11:42:36Z Verifying last 6 blocks at level 3\n[*] 2025-11-03T11:42:36Z Verification progress: 0%\n[*] 2025-11-03T11:42:36Z Shutdown requested. Exiting.\n[*] 2025-11-03T11:42:36Z Shutdown in progress...\n[*] 2025-11-03T11:42:36Z scheduler thread exit\n[*] 2025-11-03T11:42:36Z Flushed fee estimates to fee_estimates.dat.\n[*] 2025-11-03T11:42:36Z Shutdown done\n```",
      "state": "closed",
      "user": "fanquake",
      "created_at": "2025-11-03T11:49:53Z",
      "updated_at": "2025-11-10T16:45:49Z",
      "comments": 3,
      "url": "https://github.com/bitcoin/bitcoin/issues/33769",
      "labels": [
        "Utils/log/libs"
      ],
      "comment_list": [
        {
          "user": "stickies-v",
          "body": "Is there a good reason to unconditionally log this statement? It seems to me like a single unconditional \"Replaying blocks from hash (height)\" before starting the loop, and a conditional (debug) per-iteration statement would be sensible?",
          "created_at": "2025-11-03T12:56:36Z"
        },
        {
          "user": "l0rinc",
          "body": "I have pushed something similar in https://github.com/bitcoin/bitcoin/pull/33443",
          "created_at": "2025-11-03T13:33:35Z"
        },
        {
          "user": "fanquake",
          "body": "Closing given #33443.",
          "created_at": "2025-11-10T16:45:49Z"
        }
      ]
    }
  ],
  "summary": {
    "pull_requests": 4,
    "issues": 1
  }
}