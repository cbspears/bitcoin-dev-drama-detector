{
  "source": "github",
  "repository": "bitcoin/bitcoin",
  "fetched_at": "2026-01-15T20:24:48.698764+00:00",
  "date": "2025-10-16",
  "pull_requests": [
    {
      "number": 33642,
      "title": "doc: archive release notes for v28.3",
      "body": "",
      "state": "closed",
      "user": "fanquake",
      "created_at": "2025-10-16T15:50:52Z",
      "updated_at": "2025-10-16T16:23:23Z",
      "comments": 1,
      "url": "https://github.com/bitcoin/bitcoin/pull/33642",
      "labels": [
        "Docs"
      ],
      "comment_list": [
        {
          "user": "DrahtBot",
          "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/33642.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| ACK | [stickies-v](https://github.com/bitcoin/bitcoin/pull/33642#pullrequestreview-3345767371) |\n\nIf your review is incorrectly listed, please react with üëé to this comment and the bot will ignore it on the next update.\n<!--5faf32d7da4f0f540f40219e4f7537a3-->\n### LLM Linter (‚ú® experimental)\n\nPossible typos and grammar issues:\n\n- \"taproot became always active in v24.0\" -> \"taproot became active in v24.0\" [‚Äúbecame always active‚Äù is ungrammatical; use ‚Äúbecame active‚Äù to convey the intended meaning]\n\n<sup>drahtbot_id_5_m</sup>\n",
          "created_at": "2025-10-16T15:50:58Z"
        }
      ]
    },
    {
      "number": 33641,
      "title": "Update leveldb subtree to latest master",
      "body": "Rather than continue to close PRs/\"Send these upstream\" i.e: #33638, #33148, #22664, #13781; just fix the typos. \r\n\r\nIncludes https://github.com/bitcoin-core/leveldb-subtree/pull/57.",
      "state": "closed",
      "user": "fanquake",
      "created_at": "2025-10-16T12:54:27Z",
      "updated_at": "2025-10-16T19:10:44Z",
      "comments": 3,
      "url": "https://github.com/bitcoin/bitcoin/pull/33641",
      "labels": [],
      "comment_list": [
        {
          "user": "DrahtBot",
          "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/33641.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| ACK | [stickies-v](https://github.com/bitcoin/bitcoin/pull/33641#pullrequestreview-3345811711), [l0rinc](https://github.com/bitcoin/bitcoin/pull/33641#issuecomment-3411960774), [cedwies](https://github.com/bitcoin/bitcoin/pull/33641#issuecomment-3412213444) |\n\nIf your review is incorrectly listed, please react with üëé to this comment and the bot will ignore it on the next update.\n<!--5faf32d7da4f0f540f40219e4f7537a3-->",
          "created_at": "2025-10-16T12:54:32Z"
        },
        {
          "user": "l0rinc",
          "body": "ACK 54ffe3de5b1d15f10516ea536a12e13cd7d338f3",
          "created_at": "2025-10-16T17:27:40Z"
        },
        {
          "user": "cedwies",
          "body": "ACK 54ffe3d",
          "created_at": "2025-10-16T18:15:50Z"
        }
      ]
    },
    {
      "number": 33639,
      "title": "ci: Only write docker build images to Cirrus cache",
      "body": "The `DOCKER_BUILD_CACHE_ARG` env var holds the options on how to use cache providers. Storing the image layers is useful for the Cirrus cache provider, because it offers 10GB per runner (https://cirrus-runners.app/setup/#speeding-up-the-cache). The cached image layers can help to avoid issues when the upstream package manager infra (apt native, apt llvm, pip, apk, git clone, ...) has outages or network issues.\r\n\r\nHowever, on the GitHub Actions cache provider, a *total* cache of 10GB is offered for the whole repo. This cache must be shared with the depends cache, and the ccache, as well as the previous releases cache. So it is already full and trying to put the docker build layers into it will lead to an overflow.\r\n\r\nFix it by only writing to the docker cache on Cirrus.\r\n\r\nAlso, `DOCKER_BUILD_CACHE_ARG` requires a `shellcheck disable=SC2086` on the full build command. Fix that as well by using `shlex.split` from Python on just this variable.",
      "state": "closed",
      "user": "maflcko",
      "created_at": "2025-10-16T09:37:37Z",
      "updated_at": "2025-10-23T10:57:41Z",
      "comments": 5,
      "url": "https://github.com/bitcoin/bitcoin/pull/33639",
      "labels": [
        "Tests"
      ],
      "comment_list": [
        {
          "user": "DrahtBot",
          "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/33639.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| ACK | [l0rinc](https://github.com/bitcoin/bitcoin/pull/33639#pullrequestreview-3361025213), [m3dwards](https://github.com/bitcoin/bitcoin/pull/33639#issuecomment-3431070343), [cedwies](https://github.com/bitcoin/bitcoin/pull/33639#issuecomment-3431476175), [willcl-ark](https://github.com/bitcoin/bitcoin/pull/33639#pullrequestreview-3364931557) |\n\nIf your review is incorrectly listed, please react with üëé to this comment and the bot will ignore it on the next update.\n<!--5faf32d7da4f0f540f40219e4f7537a3-->\n### LLM Linter (‚ú® experimental)\n\nPossible typos and grammar issues:\n\n- Building {os.environ['CONTAINER_NAME']} image tag to run in -> Building {os.environ['CONTAINER_NAME']} image to run [original phrasing is incomplete/ambiguous (\"...tag to run in\" leaves the phrase \"in\" without an object), so remove \"tag\" and \"in\" to make the intent clear]\n\n<sup>drahtbot_id_5_m</sup>\n",
          "created_at": "2025-10-16T09:37:43Z"
        },
        {
          "user": "maflcko",
          "body": "> Let's see how much slowdown this would cause without caching.\r\n\r\nI don't think this has any measurable effect on the runtime. The only benefit could be avoiding intermittent network errors.",
          "created_at": "2025-10-21T14:22:58Z"
        },
        {
          "user": "m3dwards",
          "body": "ACK fabe0e07de1ad2f26da62f3ebe0e9be3f939b1f8\r\n\r\nThis will save a lot of space and help to prevent the other caches from getting evicted which are much more important than the docker build layer caches. Should only slow down the jobs by a few minutes at most and hopefully be a net positive as the other more important caches (like ccache) will not have been evicted.\r\n\r\nRan on master on my own fork.",
          "created_at": "2025-10-22T08:28:56Z"
        },
        {
          "user": "cedwies",
          "body": "reACK fabe0e0",
          "created_at": "2025-10-22T09:57:13Z"
        },
        {
          "user": "maflcko",
          "body": "Hmm, so I did a fresh run in a repo with a clean GHA cache, and it now says:\r\n\r\n>  Approaching total cache storage limit (8.89 GB of 10 GB Used) \r\n\r\nSo I guess we are still close to overlapping the cache and certainly will reach cache churn with more than one push to the default branch.",
          "created_at": "2025-10-23T10:57:41Z"
        }
      ]
    },
    {
      "number": 33638,
      "title": "chore: remove repetitive word in src/leveldb/README.md",
      "body": "<!--\r\n*** Please remove the following help text before submitting: ***\r\n\r\nPull requests without a rationale and clear improvement may be closed\r\nimmediately.\r\n\r\nGUI-related pull requests should be opened against\r\nhttps://github.com/bitcoin-core/gui\r\nfirst. See CONTRIBUTING.md\r\n-->\r\n\r\n<!--\r\nPlease provide clear motivation for your patch and explain how it improves\r\nBitcoin Core user experience or Bitcoin Core developer experience\r\nsignificantly:\r\n\r\n* Any test improvements or new tests that improve coverage are always welcome.\r\n* All other changes should have accompanying unit tests (see `src/test/`) or\r\n  functional tests (see `test/`). Contributors should note which tests cover\r\n  modified code. If no tests exist for a region of modified code, new tests\r\n  should accompany the change.\r\n* Bug fixes are most welcome when they come with steps to reproduce or an\r\n  explanation of the potential issue as well as reasoning for the way the bug\r\n  was fixed.\r\n* Features are welcome, but might be rejected due to design or scope issues.\r\n  If a feature is based on a lot of dependencies, contributors should first\r\n  consider building the system outside of Bitcoin Core, if possible.\r\n* Refactoring changes are only accepted if they are required for a feature or\r\n  bug fix or otherwise improve developer experience significantly. For example,\r\n  most \"code style\" refactoring changes require a thorough explanation why they\r\n  are useful, what downsides they have and why they *significantly* improve\r\n  developer experience or avoid serious programming bugs. Note that code style\r\n  is often a subjective matter. Unless they are explicitly mentioned to be\r\n  preferred in the [developer notes](/doc/developer-notes.md), stylistic code\r\n  changes are usually rejected.\r\n-->\r\n\r\n<!--\r\nBitcoin Core has a thorough review process and even the most trivial change\r\nneeds to pass a lot of eyes and requires non-zero or even substantial time\r\neffort to review. There is a huge lack of active reviewers on the project, so\r\npatches often sit for a long time.\r\n-->\r\n\r\nRemove repetitive word in src/leveldb/README.md\r\n",
      "state": "closed",
      "user": "vastonus",
      "created_at": "2025-10-16T08:02:05Z",
      "updated_at": "2025-10-21T08:31:23Z",
      "comments": 3,
      "url": "https://github.com/bitcoin/bitcoin/pull/33638",
      "labels": [],
      "comment_list": [
        {
          "user": "DrahtBot",
          "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/33638.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\nA summary of reviews will appear here.\n<!--5faf32d7da4f0f540f40219e4f7537a3-->",
          "created_at": "2025-10-16T08:02:09Z"
        },
        {
          "user": "fanquake",
          "body": "Leveldb changes need to go to the upstream repo.",
          "created_at": "2025-10-16T08:32:18Z"
        },
        {
          "user": "fanquake",
          "body": "Pushed this and other changes into https://github.com/bitcoin-core/leveldb-subtree/pull/57.",
          "created_at": "2025-10-16T10:16:20Z"
        }
      ]
    },
    {
      "number": 33637,
      "title": "refactor: optimize block index comparisons (1.4-6.8x faster)",
      "body": "### Context\r\nThe comparator is often called either directly or for the sorting of [setBlockIndexCandidates](https://github.com/bitcoin/bitcoin/blob/master/src/validation.h#L637), a red-black tree-set containing valid block headers where the comparator is invoked extensively.\r\nBesided the sorted set usages, the comparator is used directly in `Chainstate` in `FindMostWorkChain`, `PruneBlockIndexCandidates`, `ActivateBestChain` and `InvalidateBlock`; and in `ChainstateManager` in `LoadBlockIndex`, `CheckBlockIndex`, `ActivateSnapshot` and `PopulateAndValidateSnapshot`.\r\n\r\nIt was profiled during the investigation of https://github.com/bitcoin/bitcoin/issues/33618#issuecomment-3402229976. \r\n\r\n### Testing\r\nTo ensure the optimized implementations are both fast and correct, the first commit adds a dedicated benchmark to measure `CBlockIndexWorkComparator` performance, and the second commit adds randomized tests comparing the new implementation with the original one.\r\n\r\n### Results\r\n\r\n> GCC 15.0.1:\r\n\r\n* `CBlockIndexWorkComparator`: 100,772,511 cmp/s ‚Üí 656,674,205 cmp/s = 6.51x faster\r\n* `CheckBlockIndex`: 9,091 ops/s ‚Üí 14,765 ops/s = 1.62x faster\r\n\r\n> Clang 22.0.0:\r\n\r\n* `CBlockIndexWorkComparator`: 100,451,893 cmp/s ‚Üí 683,414,234 cmp/s = 6.8x faster\r\n* `CheckBlockIndex`: 10,322 ops/s ‚Üí 14,376 ops/s = 1.39x faster\r\n\r\nSee https://corecheck.dev/bitcoin/bitcoin/pulls/33637 for the CI's `CheckBlockIndex` performance.\r\n\r\n<details>\r\n<summary>gcc and clang measurements</summary>\r\n\r\n> Compiler: gcc 15.0.1\r\nb60450fae8 bench: add benchmark to measure `CBlockIndexWorkComparator` performance\r\n\r\n|              ns/cmp |               cmp/s |    err% |         ins/cmp |         cyc/cmp |    IPC |        bra/cmp |   miss% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------------:|----------------:|-------:|---------------:|--------:|----------:|:----------\r\n|                9.92 |      100,772,511.62 |    0.0% |           63.98 |           35.64 |  1.795 |          14.17 |    1.9% |      5.50 | `CBlockIndexWorkComparator`\r\n\r\n|               ns/op |                op/s |    err% |          ins/op |          cyc/op |    IPC |         bra/op |   miss% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------------:|----------------:|-------:|---------------:|--------:|----------:|:----------\r\n|          109,996.46 |            9,091.20 |    0.2% |    1,014,421.11 |      394,979.29 |  2.568 |     313,025.11 |    0.0% |      5.50 | `CheckBlockIndex`\r\n\r\ne2e02177ba refactor: inline `arith_uint256` comparison operator\r\n\r\n|              ns/cmp |               cmp/s |    err% |         ins/cmp |         cyc/cmp |    IPC |        bra/cmp |   miss% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------------:|----------------:|-------:|---------------:|--------:|----------:|:----------\r\n|                6.48 |      154,439,491.66 |    0.0% |           31.01 |           23.25 |  1.334 |           7.16 |    3.8% |      5.50 | `CBlockIndexWorkComparator`\r\n\r\n|               ns/op |                op/s |    err% |          ins/op |          cyc/op |    IPC |         bra/op |   miss% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------------:|----------------:|-------:|---------------:|--------:|----------:|:----------\r\n|          105,754.86 |            9,455.83 |    0.1% |      913,130.11 |      379,588.20 |  2.406 |     276,692.11 |    0.0% |      5.50 | `CheckBlockIndex`\r\n\r\n85b74b01de refactor: optimize `arith_uint256` comparison with spaceship operator\r\n\r\n|              ns/cmp |               cmp/s |    err% |         ins/cmp |         cyc/cmp |    IPC |        bra/cmp |   miss% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------------:|----------------:|-------:|---------------:|--------:|----------:|:----------\r\n|                6.37 |      156,990,488.06 |    0.0% |           28.85 |           22.87 |  1.261 |           8.61 |    3.2% |      5.50 | `CBlockIndexWorkComparator`\r\n\r\n|               ns/op |                op/s |    err% |          ins/op |          cyc/op |    IPC |         bra/op |   miss% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------------:|----------------:|-------:|---------------:|--------:|----------:|:----------\r\n|           83,803.10 |           11,932.73 |    0.0% |      743,565.09 |      300,824.84 |  2.472 |     232,646.08 |    0.0% |      5.56 | `CheckBlockIndex`\r\n\r\ndeb58eea2f refactor: optimize `CBlockIndexWorkComparator` with std::tie\r\n\r\n|              ns/cmp |               cmp/s |    err% |         ins/cmp |         cyc/cmp |    IPC |        bra/cmp |   miss% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------------:|----------------:|-------:|---------------:|--------:|----------:|:----------\r\n|                1.52 |      656,674,205.98 |    0.0% |           13.18 |            5.47 |  2.410 |           3.06 |    0.1% |      5.50 | `CBlockIndexWorkComparator`\r\n\r\n|               ns/op |                op/s |    err% |          ins/op |          cyc/op |    IPC |         bra/op |   miss% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------------:|----------------:|-------:|---------------:|--------:|----------:|:----------\r\n|           67,726.84 |           14,765.19 |    0.2% |      585,826.07 |      243,155.90 |  2.409 |     181,920.07 |    0.0% |      5.54 | `CheckBlockIndex`\r\n\r\n> Compiler: clang 22.0.0\r\n\r\nb60450fae8 bench: add benchmark to measure `CBlockIndexWorkComparator` performance\r\n\r\n|              ns/cmp |               cmp/s |    err% |         ins/cmp |         cyc/cmp |    IPC |        bra/cmp |   miss% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------------:|----------------:|-------:|---------------:|--------:|----------:|:----------\r\n|                9.96 |      100,451,893.46 |    0.0% |           61.28 |           35.75 |  1.714 |          13.62 |    2.1% |      5.52 | `CBlockIndexWorkComparator`\r\n\r\n|               ns/op |                op/s |    err% |          ins/op |          cyc/op |    IPC |         bra/op |   miss% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------------:|----------------:|-------:|---------------:|--------:|----------:|:----------\r\n|           96,878.70 |           10,322.19 |    0.1% |      802,827.10 |      347,679.01 |  2.309 |     234,823.10 |    0.0% |      5.50 | `CheckBlockIndex`\r\n\r\ne2e02177ba refactor: inline `arith_uint256` comparison operator\r\n\r\n|              ns/cmp |               cmp/s |    err% |         ins/cmp |         cyc/cmp |    IPC |        bra/cmp |   miss% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------------:|----------------:|-------:|---------------:|--------:|----------:|:----------\r\n|                6.13 |      163,183,693.10 |    0.0% |           25.74 |           22.01 |  1.170 |           6.10 |    4.6% |      5.50 | `CBlockIndexWorkComparator`\r\n\r\n|               ns/op |                op/s |    err% |          ins/op |          cyc/op |    IPC |         bra/op |   miss% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------------:|----------------:|-------:|---------------:|--------:|----------:|:----------\r\n|           86,307.94 |           11,586.42 |    1.2% |      646,229.09 |      309,785.33 |  2.086 |     195,119.09 |    0.0% |      5.54 | `CheckBlockIndex`\r\n\r\n85b74b01de refactor: optimize `arith_uint256` comparison with spaceship operator\r\n\r\n|              ns/cmp |               cmp/s |    err% |         ins/cmp |         cyc/cmp |    IPC |        bra/cmp |   miss% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------------:|----------------:|-------:|---------------:|--------:|----------:|:----------\r\n|                6.36 |      157,330,900.16 |    1.0% |           26.20 |           22.61 |  1.159 |           6.55 |    4.4% |      5.53 | `CBlockIndexWorkComparator`\r\n\r\n|               ns/op |                op/s |    err% |          ins/op |          cyc/op |    IPC |         bra/op |   miss% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------------:|----------------:|-------:|---------------:|--------:|----------:|:----------\r\n|           75,031.66 |           13,327.71 |    1.0% |      650,604.15 |      266,934.04 |  2.437 |     149,967.14 |    0.0% |      5.54 | `CheckBlockIndex`\r\n\r\ndeb58eea2f refactor: optimize `CBlockIndexWorkComparator` with std::tie\r\n\r\n|              ns/cmp |               cmp/s |    err% |         ins/cmp |         cyc/cmp |    IPC |        bra/cmp |   miss% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------------:|----------------:|-------:|---------------:|--------:|----------:|:----------\r\n|                1.46 |      683,414,234.14 |    0.0% |           16.12 |            5.25 |  3.067 |           4.02 |    0.1% |      5.50 | `CBlockIndexWorkComparator`\r\n\r\n|               ns/op |                op/s |    err% |          ins/op |          cyc/op |    IPC |         bra/op |   miss% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------------:|----------------:|-------:|---------------:|--------:|----------:|:----------\r\n|           69,559.70 |           14,376.14 |    0.1% |      559,208.07 |      249,654.28 |  2.240 |     132,342.07 |    0.0% |      5.51 | `CheckBlockIndex`\r\n\r\n</details>\r\n\r\n### Reproducer\r\n\r\nRun the equivalence tests with:\r\n```bash\r\ncmake -B build && cmake --build build && ./build/bin/test_bitcoin --run_test=arith_uint256_tests,blockchain_tests\r\n```\r\n\r\nEach commit shows how it changes the relevant benchmarks.\r\n\r\n<details>\r\n<summary>Benchmark script</summary>\r\n\r\n```bash\r\nfor compiler in gcc clang; do \\\r\n  if [ \"$compiler\" = \"gcc\" ]; then CC=gcc; CXX=g++; COMP_VER=$(gcc -dumpfullversion); \\\r\n  else CC=clang; CXX=clang++; COMP_VER=$(clang -dumpversion); fi && \\\r\n  echo \"> Compiler: $compiler $COMP_VER\" && \\\r\n  for commit in b60450fae83970daa9dc2da0706bf126a2f41515 e2e02177ba6f7fac34eda9696dad2e8ecd44e6cd 85b74b01de7e914d07630138eaa78f09a083b85b deb58eea2fdd2712a28aa6b81417087426b19f5b; do \\\r\n    git fetch origin $commit >/dev/null 2>&1 && git checkout $commit >/dev/null 2>&1 && git log -1 --pretty='%h %s' && \\\r\n    rm -rf build && \\\r\n    cmake -B build -DBUILD_BENCH=ON -DENABLE_IPC=OFF -DCMAKE_BUILD_TYPE=RelWithDebInfo -DCMAKE_C_COMPILER=$CC -DCMAKE_CXX_COMPILER=$CXX >/dev/null 2>&1 && \\\r\n    cmake --build build -j$(nproc) >/dev/null 2>&1 && \\\r\n    for i in 1; do \\\r\n      build/bin/bench_bitcoin -filter='CBlockIndexWorkComparator|CheckBlockIndex' -min-time=5000; \\\r\n    done; \\\r\n  done; \\\r\ndone\r\n```\r\n\r\n</details>\r\n\r\nNote: something similar was already started in https://github.com/bitcoin/bitcoin/pull/33334, but this is a broader optimization that doesn't use the same technique: added as coauthor regardless.",
      "state": "open",
      "user": "l0rinc",
      "created_at": "2025-10-16T01:54:31Z",
      "updated_at": "2026-01-15T19:19:56Z",
      "comments": 13,
      "url": "https://github.com/bitcoin/bitcoin/pull/33637",
      "labels": [
        "Refactoring",
        "CI failed"
      ],
      "comment_list": [
        {
          "user": "DrahtBot",
          "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/33637.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| Concept ACK | [mzumsande](https://github.com/bitcoin/bitcoin/pull/33637#pullrequestreview-3401558839) |\n| Approach ACK | [Raimo33](https://github.com/bitcoin/bitcoin/pull/33637#issuecomment-3414573082) |\n| Stale ACK | [laanwj](https://github.com/bitcoin/bitcoin/pull/33637#pullrequestreview-3364368958), [optout21](https://github.com/bitcoin/bitcoin/pull/33637#issuecomment-3480376742) |\n\nIf your review is incorrectly listed, please copy-paste <code>&lt;!--meta-tag:bot-skip--&gt;</code> into the comment that the bot should ignore.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#34179](https://github.com/bitcoin/bitcoin/pull/34179) (refactor: Enable transparent lookup for setBlockIndexCandidates to remove const_cast by joaonevess)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n<!--5faf32d7da4f0f540f40219e4f7537a3-->\n### LLM Linter (‚ú® experimental)\n\n\n\nPossible places where named args for integral literals may be used (e.g. `func(x, /*named_arg=*/0)` in C++, and `func(x, named_arg=0)` in Python):\n\n- DoubleEquals(difficulty, expected_difficulty, 0.00001) in src/test/blockchain_tests.cpp\n\n\n\n<sup>2026-01-15</sup>\n",
          "created_at": "2025-10-16T01:54:37Z"
        },
        {
          "user": "Raimo33",
          "body": "Approach ACK\r\n\r\nI have tested the new block index comparator but I‚Äôll refrain from acking the added benchmarks/tests",
          "created_at": "2025-10-17T09:16:18Z"
        },
        {
          "user": "Christewart",
          "body": "I attempted to run the script, not really sure what these results indicate. Just pasting what the results were\r\n<details>\r\n\r\n```\r\nDarwin Chriss-MacBook-Pro.local 24.6.0 Darwin Kernel Version 24.6.0: Mon Jul 14 11:30:55 PDT 2025; root:xnu-11417.140.69~1/RELEASE_ARM64_T6031 arm64\r\n```\r\n\r\n```\r\nApple clang version 17.0.0 (clang-1700.3.19.1)\r\nTarget: arm64-apple-darwin24.6.0\r\nThread model: posix\r\nInstalledDir: /Library/Developer/CommandLineTools/usr/bin\r\n```\r\n\r\n\r\n```\r\n|              ns/cmp |               cmp/s |    err% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------:|:----------\r\n|                4.97 |      201,237,014.91 |    0.4% |      5.49 | `CBlockIndexWorkComparator`\r\n\r\n|               ns/op |                op/s |    err% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------:|:----------\r\n|           43,777.21 |           22,842.94 |    0.3% |      5.41 | `CheckBlockIndex`\r\n```\r\n\r\n```\r\n|              ns/cmp |               cmp/s |    err% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------:|:----------\r\n|                1.89 |      529,694,702.31 |    0.1% |      5.50 | `CBlockIndexWorkComparator`\r\n\r\n|               ns/op |                op/s |    err% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------:|:----------\r\n|           38,303.87 |           26,107.02 |    0.1% |      5.35 | `CheckBlockIndex`\r\n```\r\n\r\n```\r\n|              ns/cmp |               cmp/s |    err% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------:|:----------\r\n|                2.31 |      432,334,219.11 |    0.6% |      5.45 | `CBlockIndexWorkComparator`\r\n\r\n|               ns/op |                op/s |    err% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------:|:----------\r\n|           33,598.60 |           29,763.15 |    0.2% |      5.32 | `CheckBlockIndex`\r\n```\r\n```\r\n|              ns/cmp |               cmp/s |    err% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------:|:----------\r\n|                0.78 |    1,287,258,159.19 |    0.1% |      5.46 | `CBlockIndexWorkComparator`\r\n\r\n|               ns/op |                op/s |    err% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------:|:----------\r\n|           31,055.32 |           32,200.61 |    0.1% |      5.30 | `CheckBlockIndex`\r\n```\r\n</details",
          "created_at": "2025-10-18T21:34:57Z"
        },
        {
          "user": "l0rinc",
          "body": "Thanks for the measurements @Christewart, this is how your measurements compare to mine (but most importantly how it compares to `master`):\r\n<img width=\"2385\" height=\"883\" alt=\"image\" src=\"https://github.com/user-attachments/assets/96a59d25-292e-4e11-bd2c-3fb11a5b13cb\" />\r\n",
          "created_at": "2025-10-19T00:24:34Z"
        },
        {
          "user": "l0rinc",
          "body": "Rebased after https://github.com/bitcoin/bitcoin/pull/29640 - only change was adjusting the comment",
          "created_at": "2025-10-28T23:19:25Z"
        },
        {
          "user": "l0rinc",
          "body": "Pushed, thanks for the review, you had a few good points, added you as coauthor.\r\n\r\n> the gain of using the spaceship operator (which comes at the cost of readability) is marginal.\r\n\r\nthe spaceship might not be very familiar to us yet, but it's arguably simpler, having fewer moving parts, and some compilers prefer that over the manual comparisons.",
          "created_at": "2025-10-31T13:13:33Z"
        },
        {
          "user": "optout21",
          "body": "utACK 5cbb9a40873203ea5a4dd0aa7127c9756da2f607\r\n\r\nAn evident, localized micro-optimization in a hot-path. I haven't run measurements.",
          "created_at": "2025-11-03T12:44:19Z"
        },
        {
          "user": "optout21",
          "body": "reACK 6e9061f8b7ad77df4566990121f5bebc1f9e6e15\r\n\r\nRebase, no content changes. 237eec0f7ca095bc60e40ee94ba1a160a7064753..6e9061f8b7ad77df4566990121f5bebc1f9e6e15 \r\nPrev: utACK 237eec0f7ca095bc60e40ee94ba1a160a7064753\r\nRe-acked (after 7 mins :D ), only minor/formatting changes since last review",
          "created_at": "2025-11-03T12:52:15Z"
        },
        {
          "user": "maflcko",
          "body": "> Profiling the performance regression in [#33618 (comment)](https://github.com/bitcoin/bitcoin/issues/33618#issuecomment-3399937858) revealed that `CBlockIndexWorkComparator` and its underlying `base_uint<256u>::CompareTo` are hot paths during block validation, consuming ~4% of CPU time.\r\n\r\nI don't follow here. The issue is about the additional `CWallet::WriteBestBlock` overhead? `CBlockIndexWorkComparator` seems unrelated to the issue, at least I can't see how it changed the result between 29.x and 30.x.\r\n\r\nInstead of mentioning an unrelated issue, I think it could be better to mention what real-world effect this improvement has. I think that is `-checkblockindex` (default in regtest) and possibly `LoadExternalBlockFile`/`LoadBlockIndex`?",
          "created_at": "2025-11-06T15:34:25Z"
        },
        {
          "user": "l0rinc",
          "body": "> CBlockIndexWorkComparator seems unrelated to the issue\r\n\r\nThe original issue won't be fixed since it's not exactly a bug, but we could still speed up the regression by optimizing another bottleneck.\r\nSince you found the etymology confusing, I have removed the details from the description, only mentioned https://github.com/bitcoin/bitcoin/issues/33618#issuecomment-3402229976 for the flame graph that show this being one of the bottlenecks. Not the biggest one, but the one we can easily optimize and clean up.\r\n\r\n> I think that is -checkblockindex (default in regtest)\r\n\r\nYes, this was mentioned in the benchmarking section.\r\n\r\n> possibly LoadExternalBlockFile/LoadBlockIndex\r\n\r\nYes, it's used explicitly in `Chainstate` in `FindMostWorkChain`, `PruneBlockIndexCandidates`, `ActivateBestChain` and `InvalidateBlock`.\r\nAnd `ChainstateManager` in `LoadBlockIndex`, `CheckBlockIndex`, `ActivateSnapshot` and `PopulateAndValidateSnapshot`.\r\nBut the [setBlockIndexCandidates](https://github.com/bitcoin/bitcoin/blob/master/src/validation.h#L637) usages should already suffice as motivation, I'd say:\r\n```bash\r\ngit grep 'setBlockIndexCandidates.' src/validation.cpp | wc -l \r\n   44\r\n```\r\n",
          "created_at": "2025-11-06T16:22:42Z"
        },
        {
          "user": "l0rinc",
          "body": "Rebased after https://github.com/bitcoin/bitcoin/commit/4f65a1c5db84426b9d814a18f63ac46632691ab2#diff-f14e9423bd43609969886b2e42751c55606344e0b71780564cdb23515802cec0R12, ready for review again.",
          "created_at": "2025-11-25T14:53:23Z"
        },
        {
          "user": "l0rinc",
          "body": "Rebased to fix silent merge conflict.",
          "created_at": "2026-01-15T17:13:16Z"
        },
        {
          "user": "DrahtBot",
          "body": "<!--85328a0da195eb286784d51f73fa0af9-->\nüöß At least one of the CI tasks failed.\n<sub>Task `iwyu`: https://github.com/bitcoin/bitcoin/actions/runs/21039886920/job/60501264056</sub>\n<sub>LLM reason (‚ú® experimental): IWYU reported a failure after adjusting includes in src/node/blockstorage.h, causing the CI to fail.</sub>\n\n<details><summary>Hints</summary>\n\nTry to run the tests locally, according to the documentation. However, a CI failure may still\nhappen due to a number of reasons, for example:\n\n* Possibly due to a silent merge conflict (the changes in this pull request being\nincompatible with the current code in the target branch). If so, make sure to rebase on the latest\ncommit of the target branch.\n\n* A sanitizer issue, which can only be found by compiling with the sanitizer and running the\n  affected test.\n\n* An intermittent issue.\n\nLeave a comment here, if you need help tracking down a confusing failure.\n\n</details>\n\n",
          "created_at": "2026-01-15T19:13:45Z"
        }
      ]
    },
    {
      "number": 33636,
      "title": "wallet: Expand MuSig test coverage and follow-ups",
      "body": "This is a follow-up to #29675 and primarily adds test coverage for some of the most prominent failure cases in the last commit. \r\n\r\nThe following commits address a few left-over nit comments that didn't make it in before merge.",
      "state": "closed",
      "user": "fjahr",
      "created_at": "2025-10-16T00:02:51Z",
      "updated_at": "2025-12-23T01:15:04Z",
      "comments": 6,
      "url": "https://github.com/bitcoin/bitcoin/pull/33636",
      "labels": [
        "Wallet"
      ],
      "comment_list": [
        {
          "user": "DrahtBot",
          "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/33636.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| ACK | [rkrux](https://github.com/bitcoin/bitcoin/pull/33636#pullrequestreview-3510456391), [achow101](https://github.com/bitcoin/bitcoin/pull/33636#issuecomment-3684688010) |\n\nIf your review is incorrectly listed, please copy-paste <code>&lt;!--meta-tag:bot-skip--&gt;</code> into the comment that the bot should ignore.\n<!--5faf32d7da4f0f540f40219e4f7537a3-->",
          "created_at": "2025-10-16T00:02:57Z"
        },
        {
          "user": "achow101",
          "body": "Concept ACK",
          "created_at": "2025-11-19T23:36:24Z"
        },
        {
          "user": "fjahr",
          "body": "Addressed the feedback from @rkrux , thanks for the review!",
          "created_at": "2025-11-24T17:59:00Z"
        },
        {
          "user": "rkrux",
          "body": "In PR description:\r\n\r\n```diff\r\n- primarily adds test coverage for some of the most prominent failure cases in the first commit.\r\n+ primarily adds test coverage for some of the most prominent failure cases in the last commit.\r\n``` ",
          "created_at": "2025-11-26T11:31:55Z"
        },
        {
          "user": "fjahr",
          "body": "> In PR description:\r\n> \r\n> ```diff\r\n> - primarily adds test coverage for some of the most prominent failure cases in the first commit.\r\n> + primarily adds test coverage for some of the most prominent failure cases in the last commit.\r\n> ```\r\n\r\nFixed as well",
          "created_at": "2025-11-26T14:26:05Z"
        },
        {
          "user": "achow101",
          "body": "ACK 217dbbbb5e38ab582ee0b3ef37fe9e99d887d7c8",
          "created_at": "2025-12-23T01:04:20Z"
        }
      ]
    }
  ],
  "issues": [
    {
      "number": 33640,
      "title": "ci: short read: expected xxxxxxxxx bytes but got xxxxxxxxx: unexpected EOF",
      "body": "This issue is happening semi-frequently. i.e https://github.com/bitcoin/bitcoin/actions/runs/18560885434/job/52909339714?pr=33591#step:9:231:\n```bash\n #10 [5/5] RUN [\"bash\", \"-c\", \"cd /ci_container_base/ && set -o errexit && source ./ci/test/00_setup_env.sh && ./ci/test/01_base_install.sh\"]\n#10 sha256:9ff7145d1456945488a8d8d2466983d85b23a449070f110460965a1547aec2c0 122.68MB / 660.19MB 5.7s\n#10 sha256:3d058fa1c6c9853659e7c57f9938cc3e7bc8b256a1221e2fa5dfc955b8055a50 3.86kB / 3.86kB 0.3s done\n#10 sha256:948296864369b9bd381893ff3a644420170ca34e65df918140a9304a37d03f30 1.85kB / 1.85kB 0.3s done\n#10 sha256:4f4fb700ef54461cfa02571ae0db9a0dc1e0cdb5577484a6d75e68dc38e8acc1 32B / 32B 0.3s done\n#10 sha256:4b3ffd8ccb5201a0fc03585952effb4ed2d1ea5e704d2e7330212fb8b16c86a3 29.72MB / 29.72MB 1.7s done\n#10 sha256:9ff7145d1456945488a8d8d2466983d85b23a449070f110460965a1547aec2c0 156.24MB / 660.19MB 7.1s\n#10 sha256:9ff7145d1456945488a8d8d2466983d85b23a449070f110460965a1547aec2c0 191.89MB / 660.19MB 8.3s\n#10 sha256:9ff7145d1456945488a8d8d2466983d85b23a449070f110460965a1547aec2c0 225.44MB / 660.19MB 9.8s\n#10 DONE 11.1s\n\n#11 exporting to docker image format\n#11 ERROR: short read: expected 660192933 bytes but got 251015612: unexpected EOF\n------\n > exporting to docker image format:\n------\nERROR: failed to build: failed to solve: short read: expected 660192933 bytes but got 251015612: unexpected EOF\nCommand '['./ci/test/02_run_container.sh']' returned non-zero exit status 1.\n```\nWas mentioned in IRC yesterday as well.",
      "state": "closed",
      "user": "fanquake",
      "created_at": "2025-10-16T12:45:10Z",
      "updated_at": "2025-10-29T10:09:56Z",
      "comments": 5,
      "url": "https://github.com/bitcoin/bitcoin/issues/33640",
      "labels": [
        "Tests",
        "CI failed"
      ],
      "comment_list": [
        {
          "user": "fanquake",
          "body": "IRC yesterday: https://github.com/bitcoin/bitcoin/actions/runs/18534138379/job/52824610461",
          "created_at": "2025-10-16T15:44:46Z"
        },
        {
          "user": "fanquake",
          "body": "https://github.com/bitcoin/bitcoin/actions/runs/17769369035/job/50682078335?pr=33117",
          "created_at": "2025-10-16T16:13:50Z"
        },
        {
          "user": "maflcko",
          "body": "Normally, network requests are retried in CI to work around intermittent network issues. I guess it could be tried  here as well.\n\nI can take a look next week.",
          "created_at": "2025-10-17T08:53:06Z"
        },
        {
          "user": "maflcko",
          "body": "Similar variation: https://github.com/bitcoin/bitcoin/actions/runs/18713760603/job/53368943173#step:9:165:\n\n```\nBuilding ci_native_msan image tag to run in\n+ docker buildx build --file=/home/admin/actions-runner/_work/bitcoin/bitcoin/ci/test_imagefile --build-arg=CI_IMAGE_NAME_TAG=mirror.gcr.io/ubuntu:24.04 --build-arg=FILE_ENV=./ci/test/00_setup_env_native_msan.sh --build-arg=BASE_ROOT_DIR=/home/admin/actions-runner/_work/_temp --platform=linux --label=bitcoin-ci-test --tag=ci_native_msan --cache-from type=gha,url=http://127.0.0.1:12321/,url_v2=http://127.0.0.1:12321/,scope=ci_native_msan --cache-to type=gha,url=http://127.0.0.1:12321/,url_v2=http://127.0.0.1:12321/,mode=max,ignore-error=true,scope=ci_native_msan --load /home/admin/actions-runner/_work/bitcoin/bitcoin\n#0 building with \"builder-c409df70-e5b4-4870-bbbc-35cd721af826\" instance using docker-container driver\n\n#1 [internal] load build definition from test_imagefile\n#1 transferring dockerfile: 842B done\n#1 DONE 0.0s\n\n#2 [internal] load metadata for mirror.gcr.io/ubuntu:24.04\n#2 ERROR: failed to do request: Head \"https://mirror.gcr.io/v2/ubuntu/manifests/24.04\": dial tcp [2a00:1450:4010:c1e::52]:443: connect: network is unreachable\n------\n > [internal] load metadata for mirror.gcr.io/ubuntu:24.04:\n------\ntest_imagefile:9\n--------------------\n   7 |     # We never want scratch, but default arg silences a Warning\n   8 |     ARG CI_IMAGE_NAME_TAG=scratch\n   9 | >>> FROM ${CI_IMAGE_NAME_TAG}\n  10 |     \n  11 |     ARG FILE_ENV\n--------------------\nERROR: failed to build: failed to solve: mirror.gcr.io/ubuntu:24.04: failed to resolve source metadata for mirror.gcr.io/ubuntu:24.04: failed to do request: Head \"https://mirror.gcr.io/v2/ubuntu/manifests/24.04\": dial tcp [2a00:1450:4010:c1e::52]:443: connect: network is unreachable\nCommand '['docker', 'buildx', 'build', '--file=/home/admin/actions-runner/_work/bitcoin/bitcoin/ci/test_imagefile', '--build-arg=CI_IMAGE_NAME_TAG=mirror.gcr.io/ubuntu:24.04', '--build-arg=FILE_ENV=./ci/test/00_setup_env_native_msan.sh', '--build-arg=BASE_ROOT_DIR=/home/admin/actions-runner/_work/_temp', '--platform=linux', '--label=bitcoin-ci-test', '--tag=ci_native_msan', '--cache-from', 'type=gha,url=http://127.0.0.1:12321/,url_v2=http://127.0.0.1:12321/,scope=ci_native_msan', '--cache-to', 'type=gha,url=http://127.0.0.1:12321/,url_v2=http://127.0.0.1:12321/,mode=max,ignore-error=true,scope=ci_native_msan', '--load', '/home/admin/actions-runner/_work/bitcoin/bitcoin']' returned non-zero exit status 1.\nError: Process completed with exit code 1.",
          "created_at": "2025-10-22T12:43:43Z"
        },
        {
          "user": "maflcko",
          "body": "I presume the same issue exists for the lint task. Though, the caching there does not seem to work at all. So it could make sense to make the caching work there, and then also add a retry loop there.\n\n\nOtherwise, there could be Ubuntu APT timeouts like https://github.com/bitcoin/bitcoin/actions/runs/18861389218/job/53820273763?pr=33247#step:4:1053",
          "created_at": "2025-10-28T21:28:09Z"
        }
      ]
    }
  ],
  "summary": {
    "pull_requests": 6,
    "issues": 1
  }
}