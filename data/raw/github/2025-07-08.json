{
  "source": "github",
  "repository": "bitcoin/bitcoin",
  "fetched_at": "2026-01-15T19:55:46.154324+00:00",
  "date": "2025-07-08",
  "pull_requests": [
    {
      "number": 32924,
      "title": "test: add valid tx test with minimum-sized ECDSA signature (8 bytes DER-encoded)",
      "body": "Currently in our tests, all ECDSA signatures passing verification have sizes of 69 bytes and above (that's the DER-encoded size, i.e. counted without the sighash flag byte) [1]. This PR adds test coverage for the minimum-sized valid case of 8 bytes, by taking an interesting testnet transaction that I stumbled upon: \r\nhttps://mempool.space/testnet/tx/c6c232a36395fa338da458b86ff1327395a9afc28c5d2daa4273e410089fd433\r\nNote that this is a very obscure construction that only works because the public key used isn't contained in the locking script, but calculated and provided later at spending time (see https://bitcointalk.org/index.php?topic=1729534.msg17309060#msg17309060 for an explainer), to match the message (sighash) and picked signature. So this doesn't represent a use-case that really makes sense in practice, but it can still appear in a block (not in mempool though, due to `SCRIPT_VERIFY_CONST_SCRIPTCODE`), and having test-coverage seems useful.\r\n\r\nCan be tested with same patch below (tests crash with the condition `>= 9`, but pass with `>= 8`).\r\n\r\n[1] this can be verified by applying the following patch and running the tests:\r\n```diff\r\ndiff --git a/src/pubkey.cpp b/src/pubkey.cpp\r\nindex a4ca9a170a..bee0caa603 100644\r\n--- a/src/pubkey.cpp\r\n+++ b/src/pubkey.cpp\r\n@@ -288,7 +288,9 @@ bool CPubKey::Verify(const uint256 &hash, const std::vector<unsigned char>& vchS\r\n     /* libsecp256k1's ECDSA verification requires lower-S signatures, which have\r\n      * not historically been enforced in Bitcoin, so normalize them first. */\r\n     secp256k1_ecdsa_signature_normalize(secp256k1_context_static, &sig, &sig);\r\n-    return secp256k1_ecdsa_verify(secp256k1_context_static, &sig, hash.begin(), &pubkey);\r\n+    bool ret = secp256k1_ecdsa_verify(secp256k1_context_static, &sig, hash.begin(), &pubkey);\r\n+    if (ret) assert(vchSig.size() >= 69);\r\n+    return ret;\r\n }\r\n```",
      "state": "closed",
      "user": "theStack",
      "created_at": "2025-07-08T18:22:21Z",
      "updated_at": "2025-10-30T16:59:48Z",
      "comments": 5,
      "url": "https://github.com/bitcoin/bitcoin/pull/32924",
      "labels": [
        "Tests"
      ],
      "comment_list": [
        {
          "user": "DrahtBot",
          "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/32924.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| ACK | [ajtowns](https://github.com/bitcoin/bitcoin/pull/32924#issuecomment-3464418432), [real-or-random](https://github.com/bitcoin/bitcoin/pull/32924#pullrequestreview-3398953286), [fjahr](https://github.com/bitcoin/bitcoin/pull/32924#issuecomment-3468674950) |\n\nIf your review is incorrectly listed, please react with üëé to this comment and the bot will ignore it on the next update.\n<!--5faf32d7da4f0f540f40219e4f7537a3-->",
          "created_at": "2025-07-08T18:22:27Z"
        },
        {
          "user": "Sammie05",
          "body": "Thanks for adding coverage for this very specific edge case.\r\n\r\nUsing a real testnet transaction is a solid way to ensure the test reflects actual chain data.\r\nAlso appreciate the clear comments explaining why this minimal 8-byte DER signature can appear and why it matters.",
          "created_at": "2025-07-13T03:40:01Z"
        },
        {
          "user": "ajtowns",
          "body": "ACK 5fa81e239a39d161a6d5aba7bcc7e1f22a5be777 lgtm\r\n\r\nPresumably it would also be possible to use the same signature on a p2wsh tx (`<sig> SWAP CHECKSIG`) which would lose the `CONST_SCRIPTCODE` requirement. Could also presumably just have the script be `CHECKSIG` and provide both the pubkey and the short signature in either p2sh or p2wsh.",
          "created_at": "2025-10-29T22:14:03Z"
        },
        {
          "user": "fanquake",
          "body": "cc @real-or-random @jonasnick ",
          "created_at": "2025-10-30T10:21:34Z"
        },
        {
          "user": "fjahr",
          "body": "tACK 5fa81e239a39d161a6d5aba7bcc7e1f22a5be777\r\n\r\nReviewed code and verified the behavior with the suggestions in the PR description.",
          "created_at": "2025-10-30T15:43:20Z"
        }
      ]
    },
    {
      "number": 32922,
      "title": "test: use notarized v28.2 binaries and fix macOS detection",
      "body": "Since https://github.com/bitcoin/bitcoin/pull/31407 macOS guix builds are signed and notarized. This was included in v29 and backported to 28.x.\r\n\r\nThis PR bumps the v28.0 previous release binary to v28.2 and adjusts the test that uses it. Additionally it no longer manually code signs binaries >= v28.2.\r\n\r\nWhile testing on an M4 mac and redownloading all the binaries, I noticed that `platform == \"arm64-apple-darwin\"` doesn't actually work. This initially used `args.platform` in #26694, but that was changed to just `platform` in #32219.\r\n\r\nSo the first commit switches this to use `args.host`. I manually tested on Intel macOS 13.7.6 that code-signing still isn't needed there (when downloading using a script).\r\n\r\nAlso documented that you can set `HOST`.",
      "state": "closed",
      "user": "Sjors",
      "created_at": "2025-07-08T11:15:34Z",
      "updated_at": "2025-07-15T15:12:47Z",
      "comments": 5,
      "url": "https://github.com/bitcoin/bitcoin/pull/32922",
      "labels": [
        "Tests"
      ],
      "comment_list": [
        {
          "user": "DrahtBot",
          "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/32922.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| ACK | [m3dwards](https://github.com/bitcoin/bitcoin/pull/32922#issuecomment-3070026124), [maflcko](https://github.com/bitcoin/bitcoin/pull/32922#issuecomment-3072572623) |\n\nIf your review is incorrectly listed, please react with üëé to this comment and the bot will ignore it on the next update.\n<!--5faf32d7da4f0f540f40219e4f7537a3-->\n### LLM Linter (‚ú® experimental)\n\nPossible typos and grammar issues:\n\n- mac -> Mac [proper noun capitalization for Apple's Mac]\n\n<sup>drahtbot_id_4_m</sup>\n",
          "created_at": "2025-07-08T11:15:40Z"
        },
        {
          "user": "Sjors",
          "body": "cc @kdmukai, @m3dwards ",
          "created_at": "2025-07-08T11:59:33Z"
        },
        {
          "user": "Sjors",
          "body": "I switched to `args.host`, see https://github.com/bitcoin/bitcoin/pull/32922#discussion_r2192923546\r\n\r\nAlso documented that you can set `HOST`.",
          "created_at": "2025-07-08T16:12:45Z"
        },
        {
          "user": "m3dwards",
          "body": "ACK 4bb4c865999bfa0b0cb5aa806cf62dbf982fcfe9\r\n\r\nTested that the correct binaries were self signed on ARM Mac. Also checked the SHA256 sums for 28.2.",
          "created_at": "2025-07-14T15:29:55Z"
        },
        {
          "user": "maflcko",
          "body": "review ACK 4bb4c865999bfa0b0cb5aa806cf62dbf982fcfe9 üöè\r\n\r\n<details><summary>Show signature</summary>\r\n\r\nSignature:\r\n\r\n```\r\nuntrusted comment: signature from minisign secret key on empty file; verify via: minisign -Vm \"${path_to_any_empty_file}\" -P RWTRmVTMeKV5noAMqVlsMugDDCyyTSbA3Re5AkUrhvLVln0tSaFWglOw -x \"${path_to_this_whole_four_line_signature_blob}\"\r\nRUTRmVTMeKV5npGrKx1nqXCw5zeVHdtdYURB/KlyA/LMFgpNCs+SkW9a8N95d+U4AP1RJMi+krxU1A3Yux4bpwZNLvVBKy0wLgM=\r\ntrusted comment: review ACK 4bb4c865999bfa0b0cb5aa806cf62dbf982fcfe9 üöè\r\nPi0ZlqMjZ2h9BG6ZjDVKGx3MQl00wVVrmL/Obc2nPUOTs3OAjcYBntKJqxWMrnhbqbJQrDz9eKwsYLykAUboBA==\r\n```\r\n\r\n</details>\r\n",
          "created_at": "2025-07-15T08:08:11Z"
        }
      ]
    },
    {
      "number": 32921,
      "title": "test: less ambiguous error if bitcoind is missing",
      "body": "Before this change, when a functional test is run without building the source,  the error message suggested that previous release binaries were missing.\r\n\r\nWhen no previous release version is set, make the error message more specifically about bitcoind.\r\n\r\nTo test, try this before and after:\r\n\r\n```sh\r\ngit clean -dfx\r\ncmake -B build\r\nbuild/test/functional/mining_basic.py\r\ncmake --build build\r\nbuild/test/functional/mining_basic.py\r\nbuild/test/functional/wallet_backwards_compatibility.py\r\ntest/get_previous_releases.py\r\nbuild/test/functional/wallet_backwards_compatibility.py\r\n```\r\n\r\n",
      "state": "closed",
      "user": "Sjors",
      "created_at": "2025-07-08T08:37:41Z",
      "updated_at": "2025-07-10T21:51:27Z",
      "comments": 4,
      "url": "https://github.com/bitcoin/bitcoin/pull/32921",
      "labels": [
        "Tests"
      ],
      "comment_list": [
        {
          "user": "DrahtBot",
          "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/32921.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| ACK | [janb84](https://github.com/bitcoin/bitcoin/pull/32921#pullrequestreview-2998712380), [w0xlt](https://github.com/bitcoin/bitcoin/pull/32921#pullrequestreview-3003460655), [achow101](https://github.com/bitcoin/bitcoin/pull/32921#issuecomment-3059204041) |\n\nIf your review is incorrectly listed, please react with üëé to this comment and the bot will ignore it on the next update.\n<!--5faf32d7da4f0f540f40219e4f7537a3-->\n### LLM Linter (‚ú® experimental)\n\nPossible typos and grammar issues:\n\n- ‚ÄúPrevious releases binaries‚Äù -> ‚ÄúPrevious release binaries‚Äù [fix plural noun for clarity]\n\n<sup>drahtbot_id_4_m</sup>\n",
          "created_at": "2025-07-08T08:37:47Z"
        },
        {
          "user": "DrahtBot",
          "body": "<!--85328a0da195eb286784d51f73fa0af9-->\nüöß At least one of the CI tasks failed.\n<sub>Task `lint`: https://github.com/bitcoin/bitcoin/runs/45539391667</sub>\n<sub>LLM reason (‚ú® experimental): Lint errors caused the CI failure.</sub>\n\n<details><summary>Hints</summary>\n\nTry to run the tests locally, according to the documentation. However, a CI failure may still\nhappen due to a number of reasons, for example:\n\n* Possibly due to a silent merge conflict (the changes in this pull request being\nincompatible with the current code in the target branch). If so, make sure to rebase on the latest\ncommit of the target branch.\n\n* A sanitizer issue, which can only be found by compiling with the sanitizer and running the\n  affected test.\n\n* An intermittent issue.\n\nLeave a comment here, if you need help tracking down a confusing failure.\n\n</details>\n\n",
          "created_at": "2025-07-08T08:46:19Z"
        },
        {
          "user": "Sjors",
          "body": "If you're testing this on Apple Silicon, you may also need #32922. ",
          "created_at": "2025-07-08T11:20:47Z"
        },
        {
          "user": "achow101",
          "body": "ACK 83bb41455715a9e05320ba791987204031626c10",
          "created_at": "2025-07-10T21:45:51Z"
        }
      ]
    }
  ],
  "issues": [
    {
      "number": 32923,
      "title": "guix: Windows build is non-deterministic across build architectures",
      "body": "This has been the case since https://github.com/bitcoin/bitcoin/commit/8578fabb95face25d9fa7dfaad38d0a2857c2481.\n\nGuix build on `x86_64` & `aarch64` @ 01f908195589 (prior merge):\n```bash\n0324606fdfc525e2acf6ffc5b5327021df6b47de107dbeb51f54162a3dead570  guix-build-01f908195589/output/dist-archive/bitcoin-01f908195589.tar.gz\ne9be0c0c6ab0d856c2176ff0da9c4fb3599f8bd0d578138262fde7307691c28b  guix-build-01f908195589/output/x86_64-w64-mingw32/SHA256SUMS.part\nb27afe43704fa3045f1acebd967f282781f5d1907b48fbc1455c69a7f148ab1a  guix-build-01f908195589/output/x86_64-w64-mingw32/bitcoin-01f908195589-win64-codesigning.tar.gz\nb445befd6dbe5668d9e6f1f2722fba0ed9b01c33c12271b790befb4856b988a9  guix-build-01f908195589/output/x86_64-w64-mingw32/bitcoin-01f908195589-win64-debug.zip\naddb8b7c4ebefeeef5ece568cdc021bc98f5c5e8a57bfac7dd12fc41df487bda  guix-build-01f908195589/output/x86_64-w64-mingw32/bitcoin-01f908195589-win64-setup-unsigned.exe\n472d798ca94c12331b4a0c5f3d7160b11d7b7a7f18776a2edb8220fffe9f9fa9  guix-build-01f908195589/output/x86_64-w64-mingw32/bitcoin-01f908195589-win64-unsigned.zip\n```\n\nGuix Build @ 8578fabb95face25d9fa7dfaad38d0a2857c2481:\n```bash\n# x86_64\na993b92027df5cc5ff6ee2355fb4214fe566769917abcedd91b2c4c01814891f  guix-build-8578fabb95fa/output/dist-archive/bitcoin-8578fabb95fa.tar.gz\n26912d42f5228c146ee27a533daf4d111f164a34e77b6ab68a15b25c3f89d37d  guix-build-8578fabb95fa/output/x86_64-w64-mingw32/SHA256SUMS.part\n756656f917c0025b5b921f3fbd20f0f0815867b85c692c0bdaf6ec139adb88a3  guix-build-8578fabb95fa/output/x86_64-w64-mingw32/bitcoin-8578fabb95fa-win64-codesigning.tar.gz\n9c0b6af68e716767a3ab83c3c22aae4074c26afa0ca01ad9d16ccbe90d219148  guix-build-8578fabb95fa/output/x86_64-w64-mingw32/bitcoin-8578fabb95fa-win64-debug.zip\na103dba4ba354ed2f3ca73dfa19e86a525ba40d9d6c7baf67f663623e02449a1  guix-build-8578fabb95fa/output/x86_64-w64-mingw32/bitcoin-8578fabb95fa-win64-setup-unsigned.exe\nf77d0ef89287a5233c2904e266d3e93f779665cfa3d10586339df053bebdab84  guix-build-8578fabb95fa/output/x86_64-w64-mingw32/bitcoin-8578fabb95fa-win64-unsigned.zip\n\n# aarch64\na993b92027df5cc5ff6ee2355fb4214fe566769917abcedd91b2c4c01814891f  guix-build-8578fabb95fa/output/dist-archive/bitcoin-8578fabb95fa.tar.gz\nf3bb452cb21520cd31c962a2c54866f0a0176ac2f6e6848ac6926b5c0a7b4131  guix-build-8578fabb95fa/output/x86_64-w64-mingw32/SHA256SUMS.part\n19c98f753129ef55c920ab5dbb93b23de5164d43bd2654533c0cce8783b1406d  guix-build-8578fabb95fa/output/x86_64-w64-mingw32/bitcoin-8578fabb95fa-win64-codesigning.tar.gz\n9c0b6af68e716767a3ab83c3c22aae4074c26afa0ca01ad9d16ccbe90d219148  guix-build-8578fabb95fa/output/x86_64-w64-mingw32/bitcoin-8578fabb95fa-win64-debug.zip\n78ace262a902030421b0748252701d4c948f72458ec7f1dddd84492ef620b53d  guix-build-8578fabb95fa/output/x86_64-w64-mingw32/bitcoin-8578fabb95fa-win64-setup-unsigned.exe\n8262620ed8029972b991e79e65c446cc0bae7d15f6db8c4f78dc7e0aff173900  guix-build-8578fabb95fa/output/x86_64-w64-mingw32/bitcoin-8578fabb95fa-win64-unsigned.zip\n```\n\nI originally thought this was somehow introduced in #32837. However this was the difference in the binaries:\n```diff\n--- a.txt\n+++ b.txt\n@@ -1,9 +1,9 @@\n \n-bitcoin-qt.exe_built_on_x86_64_unstripped:\tfile format coff-x86-64\n+bitcoin-qt.exe_built_on_aarch64_unstripped:\tfile format coff-x86-64\n \n Disassembly of section .text:\n \n 0000000140b1b070 <_ZN11WalletModel18prepareTransactionER22WalletModelTransactionRKN6wallet12CCoinControlE>:\n 140b1b070: f3 0f 1e fa                 \tendbr64\n 140b1b074: 41 57                       \tpushq\t%r15\n 140b1b076: 41 56                       \tpushq\t%r14\n@@ -607,15 +607,15 @@\n 140b1bb7d: b8 ff ff ff ff              \tmovl\t$0xffffffff, %eax       # imm = 0xFFFFFFFF\n 140b1bb82: e9 1f fb ff ff              \tjmp\t0x140b1b6a6 <_ZN11WalletModel18prepareTransactionER22WalletModelTransactionRKN6wallet12CCoinControlE+0x636>\n 140b1bb87: 89 56 1c                    \tmovl\t%edx, 0x1c(%rsi)\n 140b1bb8a: 4c 01 fa                    \taddq\t%r15, %rdx\n 140b1bb8d: 49 89 d0                    \tmovq\t%rdx, %r8\n 140b1bb90: 31 c0                       \txorl\t%eax, %eax\n 140b1bb92: 4d 29 f8                    \tsubq\t%r15, %r8\n-140b1bb95: 4c 39 fa                    \tcmpq\t%r15, %rdx\n+140b1bb95: 49 39 d7                    \tcmpq\t%rdx, %r15\n 140b1bb98: 0f 84 68 fc ff ff           \tje\t0x140b1b806 <_ZN11WalletModel18prepareTransactionER22WalletModelTransactionRKN6wallet12CCoinControlE+0x796>\n 140b1bb9e: 66 90                       \tnop\n 140b1bba0: 41 0f b6 14 07              \tmovzbl\t(%r15,%rax), %edx\n 140b1bba5: 88 14 01                    \tmovb\t%dl, (%rcx,%rax)\n 140b1bba8: 48 83 c0 01                 \taddq\t$0x1, %rax\n 140b1bbac: 49 39 c0                    \tcmpq\t%rax, %r8\n 140b1bbaf: 75 ef                       \tjne\t0x140b1bba0 <_ZN11WalletModel18prepareTransactionER22WalletModelTransactionRKN6wallet12CCoinControlE+0xb30>\n```",
      "state": "closed",
      "user": "fanquake",
      "created_at": "2025-07-08T13:45:28Z",
      "updated_at": "2025-07-11T09:24:44Z",
      "comments": 5,
      "url": "https://github.com/bitcoin/bitcoin/issues/32923",
      "labels": [
        "Windows",
        "Build system"
      ],
      "comment_list": [
        {
          "user": "achow101",
          "body": "#32597 being the cause of this non-determinism doesn't make any sense to me.\n\nThe function with the non-determinsm is `WalletModel::prepareTransaction` which is a GUI only function that was not modified by #32597. That PR didn't change anything remotely near that, so it being the root cause makes no sense.\n\naddr2line indicates that the problematic line corresponds to https://github.com/bitcoin/bitcoin/blob/a40e9536588c366886de4f4b9d67b8665a509929/src/prevector.h#L174 After unwrapping all of the inlines, the offending caller is https://github.com/bitcoin/bitcoin/blob/a40e9536588c366886de4f4b9d67b8665a509929/src/qt/walletmodel.cpp#L183\n\nThis issue being in prevector is also very weird. This code is called all over place throughout the project, and it's only in this one particular instance where it is compiled differently?",
          "created_at": "2025-07-10T05:55:37Z"
        },
        {
          "user": "maflcko",
          "body": "> The function with the non-determinsm is `WalletModel::prepareTransaction` which is a GUI only function that was not modified by [#32597](https://github.com/bitcoin/bitcoin/pull/32597). That PR didn't change anything remotely near that, so it being the root cause makes no sense.\n\nMy guess would be that one of the O2 passes (or the linker) is confused by the `std::map` changes in the header. (`wallet.h` is included in that gui module)",
          "created_at": "2025-07-10T06:47:56Z"
        },
        {
          "user": "dstadulis",
          "body": "Nice catch!\n\ntldr: seems there should be no *logical* difference between the two -- but CMIIW:\n\n## Assessing the differences\n\nTwo changes exist between the two segments of machine code:\n\n1. Registry Extension prefix of the `cmpq` instruction\n2. The encoding of the operands are switched, in x86 assembly syntax convention.\n\nLet's try to decode the logical effect of the changes!\n\nA consequential, control-flow op code `cmpq` which sets \"[condition codes](https://www.cs.cmu.edu/afs/cs/academic/class/15213-s20/www/recitations/x86-cheat-sheet.pdf)\" value(s) in `EFLAGS` registers.  Added after IA32, for the ability to compare quad words on x86-64, a prefix is used to maintain compatability with prior x86 versions.\n\nLet's try to decode the logical effect of these two changes!\n\n## Conditional Jumps\n\n> 140b1bb98: 0f 84 68 fc ff ff           \tje\t0x140b1b806\n\n`0F 84` hex indicates a Jcc \"Jump if conditions met\" predicate, followed by the bytes `68 fc ff ff` i.e. the code doubleword (a signed, relative 32 byte offset -- indicated the jump destinaton address).  [`0F 84`, Specifically indicates the `je` predicate which checks if the zero-flag ZF has been set by the CC values](https://www.felixcloutier.com/x86/jcc#:~:text=0F%2084%20cd,equal%20(ZF%3D1).) in [EFLAGs](https://en.wikipedia.org/wiki/FLAGS_register).\n\nWhat sets the zero-flag CC EFLAG value?\n\n## `cmpq`!\n\naddress:\t opcode           \t\t\t\tmnemonic\n>-140b1bb95: 4c 39 fa                    \tcmpq\t%r15, %rdx\n>+140b1bb95: 49 39 d7                    \tcmpq\t%rdx, %r15\n\nLet's decode the machine code:\n`0x39` corresponds to the [`cmp` instruction](https://www.felixcloutier.com/x86/cmp), while `0x4C` and `0x49` are the Registry Extension (REX) prefixes.  The software that translated machine code to mnemonic attested that the operands on {source, destination} have been flipped (Maybe the source of the build's discrepancy is a [NASM / GAS AT&T syntax difference](https://en.wikibooks.org/wiki/X86_Assembly/GNU_assembly_syntax#) between the two build environments?)\n\n## Establishing equivalent between machine code and mnemonic: Decoding operand encoding\nNow, dear bit lovers, the time has come to decode the ModR/M byte to determine the operand order and registers involved.\n\n[Documentation specifies](https://wiki.osdev.org/X86-64_Instruction_Encoding#ModR/M_and_SIB_bytes) that the registers -- used as operands to `cmp` -- are specified with two, 3 bit segements of the machine code.  Hence if the two 3 bit sequences match, the logical result of of `0x39 FA` and `0x39 D7` should be equivalent.  Let's check:\n\n```python\ndef compare_binary_bits(hex_value1, hex_value2):\n    # Convert hexadecimal to binary and remove '0b' prefix\n    bin_value1 = bin(int(hex_value1, 16))[2:].zfill(8)\n    print(f\"bin_value1: {bin_value1}\")\n    bin_value2 = bin(int(hex_value2, 16))[2:].zfill(8)\n    print(f\"bin_value2: {bin_value2}\")\n\n    # Extract last 3 bits and 4th from the last - 7th from the last bits (0-indexed)\n    last_3_bits1 = bin_value1[-3:]\n    print(f\"last_3_bits1: {last_3_bits1}\")\n    middle_bits1 = bin_value1[-6:-3]\n    print(f\"middle_bits1: {middle_bits1}\")\n\n    last_3_bits2 = bin_value2[-3:]\n    print(f\"last_3_bits2: {last_3_bits2}\")\n    middle_bits2 = bin_value2[-6:-3]\n    print(f\"middle_bits2: {middle_bits2}\")\n\n    # Assert transposition of operands / registers\n    assert (last_3_bits2 == middle_bits1) and (last_3_bits1 == middle_bits2), \"Bits do not match\"\n\n# Test with given hex values\ncompare_binary_bits('FA', 'D7')\n```\n\nIndeed, the operands match -- as attested to in the mnemonic. üòÆ‚Äçüí®\n\n## Decoding the Operands' Prefix: \nSpecification:\n>In 64-bit mode, the same opcodes represent the instruction prefix REX and are not treated as individual instructions.\nFrom: [325383-088-sdm-vol-2abcd.pdf](https://www.intel.com/content/www/us/en/developer/articles/technical/intel-sdm.html)\n\nGiven the operands' prefixes of\n\n0x4C => 0b01001100\n0x49 => 0b01001001\n\nAnd the [prefix decoding map](https://wiki.osdev.org/X86-64_Instruction_Encoding#Encoding:~:text=Fixed%20bit%20pattern-,W,field%20or%20the%20SIB.base%20field.%20See%2064%2Dbit%20addressing.,-Because%20the%20first)...\n\n**The x86-64 specification differences between to the two binaries is found:**\n- the binary, compiled on x86-64, has set the R extention which affects the MODRM.reg field.\n- while the binary, compiled on aarch64, has set the B extention which affects either the MODRM.rm field or the SIB.base field.\n\nIIUC, these REX settings only affect the size of the registers of the source operrands and not the logical result of the specification -- which is likely why the difference is elided during machine-code-to-mnemonic translation.\n\n## Reasoning about potential consequences\n\nGiven both prefixes set the REX.W extension, the `cmp` instruction should run the [comparison on the two operands](https://namazso.github.io/x86/html/CMP.html#:~:text=REX.W%20%2B%2039,r/m64.) equivalently as `cmp` function is symetrical / equivalent, with transposed operands.  `cmp` sets the zero-flag in EFLAGS which then `je` continues on as normal.  Thus: **there is no logical difference in the result of how the machine code should functioning, according to x86-64 specification** ‚úÖ\n\n## Intel x86-64 Documentation:\n- PDF: https://www.intel.com/content/www/us/en/developer/articles/technical/intel-sdm.html#three-volume\n- HTML: https://github.com/xem/minix86/blob/9a192e6b456008ddd328ef0e9eeecfa4e6988ef0/README.md?plain=1#L15-L17\n[E]FLAGS register (and what the arithmetic flags denote) are described in [section 3.4.3 of Intel¬Æ 64 and IA-32 Architectures Software Developer‚Äôs Manual, Volume 1](https://www.intel.com/content/dam/www/public/us/en/documents/manuals/64-ia-32-architectures-software-developer-vol-1-manual.pdf)\n\n## jcc\nhttps://c9x.me/x86/html/file_module_x86_id_146.html\nhttps://www.felixcloutier.com/x86/jcc\n\n## cmp links\nhttps://asm-docs.microagi.org/x86/cmp.html\nhttps://tizee.github.io/x86_ref_book_web/instruction/cmp.html#compare-two-operands\nhttps://c9x.me/x86/html/file_module_x86_id_35.html\n\n## Decoding\nIntel¬Æ X86 Encoder Decoder (Intel¬Æ XED) is a software library: https://intelxed.github.io decoding [4C39FA](https://toolsbits.com/instruction?bytes=4c39fa) and [4939D7](https://toolsbits.com/instruction?bytes=4939D7)\n\n```sh\n$ echo \"obase=2; ibase=16; 4C\" | bc\n1001100\n$ echo \"obase=2; ibase=16; 49\" | bc\n1001001\n```\n\n## radare2 \nColor coding mnemonics from associated machine code\n```sh\nr2 -a x86 =(echo -en \"\\x49\\x39\\xd7\")\n```",
          "created_at": "2025-07-10T06:48:46Z"
        },
        {
          "user": "Sjors",
          "body": "The most recent change in `prevector.h`, and the only one that hasn't been shipped in a release yet, was a40e9536588c366886de4f4b9d67b8665a509929. But that just removed the reverse iterator, which this doesn't use afaik.\n\nYou could try initiazing `std::vector<CRecipient> vecSend;` with the size of `recipients`, which might result in different code paths. Though even if that restored determinism it wouldn't fix the underlying issue.\n\nMy own aarch64 builder is broken #32759, so I can't test it. Though I might just nuke it and try again.",
          "created_at": "2025-07-10T06:57:58Z"
        },
        {
          "user": "achow101",
          "body": "#32930 seems like it results in a different enough code path to workaround this issue.\n\nUltimately, this seems like an upstream compiler bug.",
          "created_at": "2025-07-10T07:00:30Z"
        }
      ]
    }
  ],
  "summary": {
    "pull_requests": 3,
    "issues": 1
  }
}