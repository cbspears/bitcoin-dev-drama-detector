{
  "source": "github",
  "repository": "bitcoin/bitcoin",
  "fetched_at": "2026-01-15T19:16:08.987836+00:00",
  "date": "2025-02-10",
  "pull_requests": [
    {
      "number": 31837,
      "title": "test: add missing sync to p2p_tx_download.py",
      "body": "If the node hasn't processed the inv from the outbound peer before the mocktime bump, the peer won't be preferred after the other inv timeouts, failing the test . Therefore, add a sync, just  like there is one after the `send_message` calls in the previous lines.\r\n\r\nFixes #31833",
      "state": "closed",
      "user": "mzumsande",
      "created_at": "2025-02-10T18:41:30Z",
      "updated_at": "2025-02-11T15:35:49Z",
      "comments": 2,
      "url": "https://github.com/bitcoin/bitcoin/pull/31837",
      "labels": [
        "Tests"
      ],
      "comment_list": [
        {
          "user": "DrahtBot",
          "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/31837.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| ACK | [instagibbs](https://github.com/bitcoin/bitcoin/pull/31837#pullrequestreview-2607241569), [maflcko](https://github.com/bitcoin/bitcoin/pull/31837#issuecomment-2650037065) |\n\nIf your review is incorrectly listed, please react with ðŸ‘Ž to this comment and the bot will ignore it on the next update.\n",
          "created_at": "2025-02-10T18:41:36Z"
        },
        {
          "user": "maflcko",
          "body": "lgtm ACK 8fe552fe6e0f1fb3600d4c5bc53b4873def6e94e",
          "created_at": "2025-02-11T07:44:38Z"
        }
      ]
    },
    {
      "number": 31836,
      "title": "contrib: Add deterministic-fuzz-coverage",
      "body": "The goal of this script is to detect and debug the remaining fuzz determinism and stability issues (https://github.com/bitcoin/bitcoin/issues/29018).",
      "state": "closed",
      "user": "maflcko",
      "created_at": "2025-02-10T16:23:23Z",
      "updated_at": "2025-03-17T20:44:19Z",
      "comments": 20,
      "url": "https://github.com/bitcoin/bitcoin/pull/31836",
      "labels": [
        "Scripts and tools"
      ],
      "comment_list": [
        {
          "user": "DrahtBot",
          "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/31836.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| ACK | [marcofleon](https://github.com/bitcoin/bitcoin/pull/31836#pullrequestreview-2621090220), [brunoerg](https://github.com/bitcoin/bitcoin/pull/31836#pullrequestreview-2621138925) |\n| Concept ACK | [dergoegge](https://github.com/bitcoin/bitcoin/pull/31836#issuecomment-2662894878) |\n\nIf your review is incorrectly listed, please react with ðŸ‘Ž to this comment and the bot will ignore it on the next update.\n",
          "created_at": "2025-02-10T16:23:27Z"
        },
        {
          "user": "brunoerg",
          "body": "Concept ACK on having a script to check fuzz stability issues",
          "created_at": "2025-02-10T16:24:38Z"
        },
        {
          "user": "maflcko",
          "body": "cc @marcofleon @dergoegge  (Checking in to see if you have something similar already?)",
          "created_at": "2025-02-10T16:29:09Z"
        },
        {
          "user": "marcofleon",
          "body": "Nice. We do have something similar, although it could likely be refined more. You can see it [here](https://github.com/marcofleon/coverage/tree/master/deterministic-coverage). It should show all the places where hit count between two coverage reports differs. \r\n\r\nI generated the json files with\r\n```\r\nllvm-cov export ./fuzzbuild/src/test/fuzz/fuzz -instr-profile=coverage.profdata > coverage.json\r\n```\r\nand then run it like this\r\n```\r\npython3 compare_coverage.py p2p_headers_presync.json p2p_headers_presync2.json\r\n```\r\nI ran both scripts on `p2p_headers_presync` (which I remembered has some subpar stability) and am seeing a difference in results. This PR's script is saying the harness passes the coverage test while the one I linked is showing differences in hit count. I can take a look some more tomorrow.",
          "created_at": "2025-02-10T19:15:52Z"
        },
        {
          "user": "maflcko",
          "body": "> This PR's script is saying the harness passes the coverage test while the one I linked is showing differences in hit count.\r\n\r\nThanks, good catch! Fixed off-by-one ",
          "created_at": "2025-02-11T11:17:26Z"
        },
        {
          "user": "maflcko",
          "body": "> Nice. We do have something similar, although it could likely be refined more. You can see it [here](https://github.com/marcofleon/coverage/tree/master/deterministic-coverage). It should show all the places where hit count between two coverage reports differs.\r\n\r\nNice. Happy to pull it in here, but I think it is similar to `diff --unified`, so I used that here for now. Not sure if your script handles sub-line regions, but in this pull they can trivally be enabled by adding the `-show-line-counts-or-regions` arg to `llvm-cov`.",
          "created_at": "2025-02-11T11:32:28Z"
        },
        {
          "user": "maflcko",
          "body": "I've created https://github.com/bitcoin/bitcoin/pull/31841 to make it easier to test this on a real patch.",
          "created_at": "2025-02-11T13:43:46Z"
        },
        {
          "user": "marcofleon",
          "body": "Is there a disadvantage to running the harness twice using `-runs=1` or even more and then comparing the coverage reports? Vs going through the inputs one by one.\r\n\r\nSeparately (but maybe related?), I ran this script again on `p2p_headers_presync` and there was no failure. If you look at these two coverage reports and go to line 1126, you'll see the different hit counts:\r\n\r\nhttps://marcofleon.github.io/coverage/p2p_headers_presync/coverage/root/bitcoin/src/net_processing.cpp.html\r\nhttps://marcofleon.github.io/coverage/p2p_headers_presync2/coverage/root/bitcoin/src/net_processing.cpp.html\r\n\r\nUsing your script, should that not show up on at least one of the inputs?\r\n \r\nTo reproduce:\r\n```\r\nLLVM_PROFILE_FILE=\"p2pcoverage.profraw\" FUZZ=p2p_headers_presync ./fuzzbuild/src/test/fuzz/fuzz ../qa-assets/fuzz_corpora/p2p_headers_presync -runs=1\r\nllvm-profdata merge --sparse p2pcoverage.profraw -o p2pcoverage.profdata \r\nllvm-cov show ./fuzzbuild/src/test/fuzz/fuzz -instr-profile=p2pcoverage.profdata -format=html -output-dir=p2p_headers_presync\r\n```\r\n\r\nedit: I guess if the target is unstable then maybe it wouldn't fail every time. That's also why I was thinking about executing the tests using `-runs=n` and then comparing from there.",
          "created_at": "2025-02-11T16:49:13Z"
        },
        {
          "user": "maflcko",
          "body": "> Is there a disadvantage to running the harness twice using `-runs=1` or even more and then comparing the coverage reports? Vs going through the inputs one by one.\r\n\r\nI am thinking that sometimes the non-determinism is specific to one input. For example, if a piece of code is completely unreachable by one input, it will never be non-deterministic, so running over that seed to reproduce the non-determinism is just busy-work.\r\n\r\nedit: But I guess there could also be non-determinism when running over all fuzz inputs combined, and only then. Maybe I should add this to the script as well?\r\n\r\n> edit: I guess if the target is unstable then maybe it wouldn't fail every time. That's also why I was thinking about executing the tests using `-runs=n` and then comparing from there.\r\n\r\nYes, non-determinism is non-deterministic. Though, I can add an option to be able to set runs=`2`, and possibly another setting to focus on one fuzz input file?",
          "created_at": "2025-02-11T16:58:21Z"
        },
        {
          "user": "maflcko",
          "body": "Fixed the typo. I'll add the other features and a fix for the `m_next_inv_to_inbounds` non-determinism  that you mentioned in a follow-up, if that is all right?",
          "created_at": "2025-02-11T21:00:28Z"
        },
        {
          "user": "maflcko",
          "body": "Went ahead and added the other check (as well as comments to explain the reasoning). I hope this addresses all outstanding feedback.",
          "created_at": "2025-02-12T08:30:06Z"
        },
        {
          "user": "marcofleon",
          "body": "Thanks for adding that, I think it makes the script more complete. The only thing missing is the `runs=1` arg in `run_single` for when the entry is the full corpus dir. Right now it just runs continuously. But other than that, lgtm.",
          "created_at": "2025-02-13T16:22:53Z"
        },
        {
          "user": "maflcko",
          "body": "Ah, I didn't test with libFuzzer. I guess to support that I'll have to port https://github.com/bitcoin/bitcoin/blob/c242fa5be358150d83c2446896b6f4c45c6365e9/test/fuzz/test_runner.py#L170\r\n\r\nI'll do that tomorrow.",
          "created_at": "2025-02-13T16:29:32Z"
        },
        {
          "user": "maflcko",
          "body": "Force pushed to add support for executables linked with libFuzzer",
          "created_at": "2025-02-14T09:50:52Z"
        },
        {
          "user": "dergoegge",
          "body": "Concept ACK",
          "created_at": "2025-02-17T11:53:00Z"
        },
        {
          "user": "brunoerg",
          "body": "Also, worths adding a .gitignore for the tool (especially for the `target` folder)?",
          "created_at": "2025-02-17T13:59:08Z"
        },
        {
          "user": "maflcko",
          "body": "Thanks for the two nits. I'll address them in one of the related follow-ups that will touch this area anyway.",
          "created_at": "2025-02-17T14:07:01Z"
        },
        {
          "user": "maflcko",
          "body": "Done in https://github.com/bitcoin/bitcoin/pull/31901",
          "created_at": "2025-02-18T20:31:08Z"
        },
        {
          "user": "l0rinc",
          "body": "After this change I keep getting `untracked files will be overwritten by rebase` for `contrib/devtools/deterministic-fuzz-coverage/Cargo.lock`: added a follow-up to commit it https://github.com/bitcoin/bitcoin/pull/32082",
          "created_at": "2025-03-17T12:00:16Z"
        },
        {
          "user": "maflcko",
          "body": "> After this change I keep getting `untracked files will be overwritten by rebase` for `contrib/devtools/deterministic-fuzz-coverage/Cargo.lock`: added a follow-up to commit it #32082\r\n\r\nWhen testing locally, my recommendation would be to generally try to rebase a pull request onto current master. This ensures you get the latest fixes, keep your ccache temperature high by focussing on master, and may even find silent merge conflicts.",
          "created_at": "2025-03-17T20:44:17Z"
        }
      ]
    },
    {
      "number": 31835,
      "title": "validation: set BLOCK_FAILED_CHILD correctly",
      "body": "This PR addresses 3 issues related to how `BLOCK_FAILED_CHILD` is set:\r\n1. In `InvalidateBlock()`\r\n- Previously, `BLOCK_FAILED_CHILD` was not being set when it should have been.\r\n- This was due to an incorrect traversal condition, which is fixed in this PR.\r\n\r\n2. In `SetBlockFailure()`\r\n- `BLOCK_FAILED_VALID` is now cleared before setting `BLOCK_FAILED_CHILD`.\r\n\r\n3. In `InvalidateBlock()`\r\n- if block is already marked as `BLOCK_FAILED_CHILD`, don't mark it as `BLOCK_FAILED_VALID` again.\r\n\r\nAlso adds a unit test to check `BLOCK_FAILED_VALID` and `BLOCK_FAILED_CHILD` status in `InvalidateBlock()`.\r\n\r\n<details>\r\n<summary><h3>looking for feedback on an alternate approach</h3></summary>\r\n<br>\r\n\r\nAn alternate approach could be removing `BLOCK_FAILED_CHILD` since even though we have a distinction between\r\n`BLOCK_FAILED_VALID` and `BLOCK_FAILED_CHILD` in the codebase, we don't use it for anything. Whenever we check for BlockStatus, we use `BLOCK_FAILED_MASK` which encompasses both of them. See  similar discussion in https://github.com/bitcoin/bitcoin/pull/16856.\r\n\r\nI have a branch with this approach in https://github.com/stratospher/bitcoin/commits/2025_02_remove_block_failed_child/.\r\nCompared to the version in #16856, it also resets `BLOCK_FAILED_CHILD` already on disk to `BLOCK_FAILED_VALID` when loading from disk so that we won't be in a dirty state in a no-`BLOCK_FAILED_CHILD`-world.\r\n\r\nI'm not sure if it's a good idea to remove `BLOCK_FAILED_CHILD` though. would be curious to hear what others think of this approach.\r\n\r\nthanks @ mzumsande for helpful discussion regarding this PR!\r\n</details>",
      "state": "closed",
      "user": "stratospher",
      "created_at": "2025-02-10T14:59:43Z",
      "updated_at": "2025-04-23T21:10:03Z",
      "comments": 4,
      "url": "https://github.com/bitcoin/bitcoin/pull/31835",
      "labels": [
        "Validation"
      ],
      "comment_list": [
        {
          "user": "DrahtBot",
          "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/31835.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| ACK | [TheCharlatan](https://github.com/bitcoin/bitcoin/pull/31835#pullrequestreview-2728780393), [mzumsande](https://github.com/bitcoin/bitcoin/pull/31835#pullrequestreview-2729590096), [achow101](https://github.com/bitcoin/bitcoin/pull/31835#issuecomment-2825477728) |\n| Concept ACK | [naiyoma](https://github.com/bitcoin/bitcoin/pull/31835#pullrequestreview-2742622791) |\n\nIf your review is incorrectly listed, please react with ðŸ‘Ž to this comment and the bot will ignore it on the next update.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#31778](https://github.com/bitcoin/bitcoin/pull/31778) (refactor: simplify GetAncestor by kcalvinalvin)\n* [#31405](https://github.com/bitcoin/bitcoin/pull/31405) (validation: stricter internal handling of invalid blocks by mzumsande)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n",
          "created_at": "2025-02-10T14:59:47Z"
        },
        {
          "user": "stratospher",
          "body": "also added 1 more commit 1771866 (taken from https://github.com/bitcoin/bitcoin/pull/16856) since I ran into [this situation](https://github.com/bitcoin/bitcoin/blob/17718660b8c95d1c12124ba2f38baf286a3bddf2/src/test/blockchain_tests.cpp#L151) when using the fuzzer from https://github.com/bitcoin/bitcoin/pull/31533",
          "created_at": "2025-03-08T12:24:21Z"
        },
        {
          "user": "naiyoma",
          "body": "\r\n> I'm not sure if it's a good idea to remove `BLOCK_FAILED_CHILD` though. would be curious to hear what others think of this approach.\r\n\r\nIMO, I think removing BLOCK_FAILED_CHILD is a better approach, I agree with this comment [https://github.com/bitcoin/bitcoin/pull/16856#issuecomment-687724324](https://github.com/bitcoin/bitcoin/pull/16856#issuecomment-687724324),  it seems  simpler and helps avoid potential hidden bugs",
          "created_at": "2025-04-07T19:35:12Z"
        },
        {
          "user": "achow101",
          "body": "ACK 3c3548a70eedb8dcf6a4a8d605a4a12e814c7cac",
          "created_at": "2025-04-23T20:52:13Z"
        }
      ]
    },
    {
      "number": 31834,
      "title": "build: disable bitcoin-node if daemon is not built",
      "body": "When building for fuzzing with multiprocess enabled, we were still trying to build `bitcoin-node`. This PR fixes that, by applying a similar check as for `bitcoin-gui`.\r\n\r\nBefore:\r\n\r\n```\r\ncmake -B build -DBUILD_FOR_FUZZING=ON -DWITH_MULTIPROCESS=ON\r\n\r\n...\r\n\r\nConfigure summary\r\n=================\r\nExecutables:\r\n  bitcoind ............................ OFF\r\n  bitcoin-node (multiprocess) ......... ON\r\n  bitcoin-qt (GUI) .................... OFF\r\n  bitcoin-gui (GUI, multiprocess) ..... OFF\r\n\r\n...\r\n\r\ncmake --build build\r\n\r\n...\r\n\r\n[ 84%] Built target bitcoin-node\r\n```\r\n\r\nAfter:\r\n\r\n```\r\n  bitcoin-node (multiprocess) ......... OFF\r\n```\r\n\r\nAnd no `bitcoin-node` target gets built (not to be confused with `bitcoin_node`).",
      "state": "closed",
      "user": "Sjors",
      "created_at": "2025-02-10T13:29:31Z",
      "updated_at": "2025-02-11T12:52:08Z",
      "comments": 4,
      "url": "https://github.com/bitcoin/bitcoin/pull/31834",
      "labels": [
        "Build system"
      ],
      "comment_list": [
        {
          "user": "DrahtBot",
          "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/31834.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| ACK | [hebasto](https://github.com/bitcoin/bitcoin/pull/31834#pullrequestreview-2606067407), [ryanofsky](https://github.com/bitcoin/bitcoin/pull/31834#pullrequestreview-2606125408), [laanwj](https://github.com/bitcoin/bitcoin/pull/31834#pullrequestreview-2608355209) |\n\nIf your review is incorrectly listed, please react with ðŸ‘Ž to this comment and the bot will ignore it on the next update.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#31741](https://github.com/bitcoin/bitcoin/pull/31741) (multiprocess: Add libmultiprocess git subtree by ryanofsky)\n* [#31679](https://github.com/bitcoin/bitcoin/pull/31679) (cmake: Move internal binaries from bin/ to libexec/ by ryanofsky)\n* [#30975](https://github.com/bitcoin/bitcoin/pull/30975) (ci: build multiprocess on most jobs by Sjors)\n* [#30437](https://github.com/bitcoin/bitcoin/pull/30437) (multiprocess: add bitcoin-mine test program by ryanofsky)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n",
          "created_at": "2025-02-10T13:29:35Z"
        },
        {
          "user": "hebasto",
          "body": "> When building for fuzzing with multiprocess enabled, we were still trying to build `bitcoin-node`. This PR fixes that...\r\n\r\nBut 7e11ee6ad9b04546b900e38dee349db821415ba7 modifies only the summary output.",
          "created_at": "2025-02-10T13:32:00Z"
        },
        {
          "user": "ryanofsky",
          "body": "> But [7e11ee6](https://github.com/bitcoin/bitcoin/commit/7e11ee6ad9b04546b900e38dee349db821415ba7) modifies only the summary output.\r\n\r\nMaybe also should include:\r\n\r\n```diff\r\ndiff --git a/src/CMakeLists.txt b/src/CMakeLists.txt\r\nindex 89fdd855a459..8c42359d2d55 100644\r\n--- a/src/CMakeLists.txt\r\n+++ b/src/CMakeLists.txt\r\n@@ -320,7 +320,7 @@ if(BUILD_DAEMON)\r\n   )\r\n   list(APPEND installable_targets bitcoind)\r\n endif()\r\n-if(WITH_MULTIPROCESS)\r\n+if(WITH_MULTIPROCESS AND BUILD_DAEMON)\r\n   add_executable(bitcoin-node\r\n     bitcoind.cpp\r\n     init/bitcoin-node.cpp\r\n@@ -332,8 +332,9 @@ if(WITH_MULTIPROCESS)\r\n     $<TARGET_NAME_IF_EXISTS:bitcoin_wallet>\r\n   )\r\n   list(APPEND installable_targets bitcoin-node)\r\n+endif()\r\n \r\n-  if(BUILD_TESTS)\r\n+if(WITH_MULTIPROCESS AND BUILD_TESTS)\r\n     # bitcoin_ipc_test library target is defined here in src/CMakeLists.txt\r\n     # instead of src/test/CMakeLists.txt so capnp files in src/test/ are able to\r\n     # reference capnp files in src/ipc/capnp/ by relative path. The Cap'n Proto\r\n@@ -347,7 +348,6 @@ if(WITH_MULTIPROCESS)\r\n       test/ipc_test.capnp\r\n     )\r\n     add_dependencies(bitcoin_ipc_test bitcoin_ipc_headers)\r\n-  endif()\r\n endif()\r\n \r\n \r\n```",
          "created_at": "2025-02-10T13:58:27Z"
        },
        {
          "user": "Sjors",
          "body": "Added, and updated the PR description.",
          "created_at": "2025-02-10T14:17:59Z"
        }
      ]
    },
    {
      "number": 31831,
      "title": ".",
      "body": "<!--\r\n*** Please remove the following help text before submitting: ***\r\n\r\nPull requests without a rationale and clear improvement may be closed\r\nimmediately.\r\n\r\nGUI-related pull requests should be opened against\r\nhttps://github.com/bitcoin-core/gui\r\nfirst. See CONTRIBUTING.md\r\n-->\r\n\r\n<!--\r\nPlease provide clear motivation for your patch and explain how it improves\r\nBitcoin Core user experience or Bitcoin Core developer experience\r\nsignificantly:\r\n\r\n* Any test improvements or new tests that improve coverage are always welcome.\r\n* All other changes should have accompanying unit tests (see `src/test/`) or\r\n  functional tests (see `test/`). Contributors should note which tests cover\r\n  modified code. If no tests exist for a region of modified code, new tests\r\n  should accompany the change.\r\n* Bug fixes are most welcome when they come with steps to reproduce or an\r\n  explanation of the potential issue as well as reasoning for the way the bug\r\n  was fixed.\r\n* Features are welcome, but might be rejected due to design or scope issues.\r\n  If a feature is based on a lot of dependencies, contributors should first\r\n  consider building the system outside of Bitcoin Core, if possible.\r\n* Refactoring changes are only accepted if they are required for a feature or\r\n  bug fix or otherwise improve developer experience significantly. For example,\r\n  most \"code style\" refactoring changes require a thorough explanation why they\r\n  are useful, what downsides they have and why they *significantly* improve\r\n  developer experience or avoid serious programming bugs. Note that code style\r\n  is often a subjective matter. Unless they are explicitly mentioned to be\r\n  preferred in the [developer notes](/doc/developer-notes.md), stylistic code\r\n  changes are usually rejected.\r\n-->\r\n\r\n<!--\r\nBitcoin Core has a thorough review process and even the most trivial change\r\nneeds to pass a lot of eyes and requires non-zero or even substantial time\r\neffort to review. There is a huge lack of active reviewers on the project, so\r\npatches often sit for a long time.\r\n-->\r\n",
      "state": "closed",
      "user": "ShivaanjayNarula",
      "created_at": "2025-02-10T07:58:15Z",
      "updated_at": "2025-02-10T08:06:53Z",
      "comments": 1,
      "url": "https://github.com/bitcoin/bitcoin/pull/31831",
      "labels": [],
      "comment_list": [
        {
          "user": "DrahtBot",
          "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/31831.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\nA summary of reviews will appear here.\n",
          "created_at": "2025-02-10T07:58:18Z"
        }
      ]
    }
  ],
  "issues": [
    {
      "number": 31838,
      "title": "`rpc_getblockstats.py` fails with `--gen-test-data`",
      "body": "The test only pass with the currently generated data. It will fail when using the integrated feature to generate this data and running against it.\n\nReproduction instructions. On top of current master 1d813e4bf52a207ec526303df7b2e3d40d5eaa54 create a clean default build and run the test:\n```\ncmake -B repro\ncmake --build repro -j20\n./repro/test/functional/rpc_getblockstats.py --gen-test-data\n```\n\nInitially it will fail because it's missing the wallet arguments. Patch it with:\n```diff\ndiff --git a/test/functional/rpc_getblockstats.py b/test/functional/rpc_getblockstats.py\nindex 002763201a5..2a7c8ac34af 100755\n--- a/test/functional/rpc_getblockstats.py\n+++ b/test/functional/rpc_getblockstats.py\n@@ -24,6 +24,7 @@ class GetblockstatsTest(BitcoinTestFramework):\n     max_stat_pos = 2\n \n     def add_options(self, parser):\n+        self.add_wallet_options(parser)\n         parser.add_argument('--gen-test-data', dest='gen_test_data',\n                             default=False, action='store_true',\n                             help='Generate test data')\n```\n\nRun the test again. It will now fail in its own business logic:\n```python\n[...]\n2025-02-10T21:30:27.577000Z TestFramework (INFO): Test tip including OP_RETURN\n2025-02-10T21:30:27.577000Z TestFramework (ERROR): Assertion failed\nTraceback (most recent call last):\n  File \"/home/darosior/code/core/bitcoin/test/functional/test_framework/test_framework.py\", line 135, in main\n    self.run_test()\n  File \"/home/darosior/code/core/bitcoin/./repro/test/functional/rpc_getblockstats.py\", line 182, in run_test\n    assert_equal(tip_stats[\"utxo_size_inc\"], 441)\n  File \"/home/darosior/code/core/bitcoin/test/functional/test_framework/util.py\", line 77, in assert_equal\n    raise AssertionError(\"not(%s)\" % \" == \".join(str(arg) for arg in (thing1, thing2) + args))\nAssertionError: not(450 == 441)\n[...]\n```",
      "state": "open",
      "user": "darosior",
      "created_at": "2025-02-10T21:32:28Z",
      "updated_at": "2025-08-26T03:33:01Z",
      "comments": 2,
      "url": "https://github.com/bitcoin/bitcoin/issues/31838",
      "labels": [
        "Wallet",
        "Tests"
      ],
      "comment_list": [
        {
          "user": "maflcko",
          "body": "The test should be using the miniwallet. Otherwise, it seems likely that some wallet change can affect the transactions and thus block stats.",
          "created_at": "2025-02-12T14:19:41Z"
        },
        {
          "user": "kannapoix",
          "body": "For anyone reproducing this issue at the current master HEAD: Please add the flag -deprecatedrpc=settxfee.\n\n```diff\ndiff --git a/test/functional/rpc_getblockstats.py b/test/functional/rpc_getblockstats.py\nindex 002763201a5..a904e56d7f0 100755\n--- a/test/functional/rpc_getblockstats.py\n+++ b/test/functional/rpc_getblockstats.py\n@@ -24,6 +24,7 @@ class GetblockstatsTest(BitcoinTestFramework):\n     max_stat_pos = 2\n \n     def add_options(self, parser):\n+        self.add_wallet_options(parser)\n         parser.add_argument('--gen-test-data', dest='gen_test_data',\n                             default=False, action='store_true',\n                             help='Generate test data')\n@@ -36,6 +37,7 @@ class GetblockstatsTest(BitcoinTestFramework):\n         self.num_nodes = 1\n         self.setup_clean_chain = True\n         self.supports_cli = False\n+        self.extra_args = [['-deprecatedrpc=settxfee']]\n```",
          "created_at": "2025-08-26T03:33:01Z"
        }
      ]
    },
    {
      "number": 31833,
      "title": "ci: intermittent p2p_tx_download.py timeout (test_preferred_tiebreaker_inv)",
      "body": "Seen in: https://github.com/bitcoin/bitcoin/actions/runs/13236532677/job/36942441812?pr=30975 (#30975)\n\n```\ntest  2025-02-10T09:21:22.592000Z TestFramework (INFO): Test that preferred peers are always selected over non-preferred when ready \n test  2025-02-10T09:21:22.592000Z TestFramework.node0 (DEBUG): Stopping node \n node0 2025-02-10T09:21:22.593102Z [http] [httpserver.cpp:306] [http_request_cb] [http] Received a POST request for / from 127.0.0.1:57336 \n node0 2025-02-10T09:21:22.593212Z [httpworker.6] [rpc/request.cpp:241] [parse] [rpc] ThreadRPCServer method=stop user=__cookie__ \n node0 2025-02-10T09:21:22.593261Z [init] [httpserver.cpp:508] [InterruptHTTPServer] [http] Interrupting HTTP server \n node0 2025-02-10T09:21:22.593478Z [init] [httprpc.cpp:382] [InterruptHTTPRPC] [rpc] Interrupting HTTP RPC server \n node0 2025-02-10T09:21:22.593490Z [init] [rpc/server.cpp:291] [operator()] [rpc] Interrupting RPC \n node0 2025-02-10T09:21:22.593517Z [init] [init.cpp:286] [Shutdown] Shutdown: In progress... \n node0 2025-02-10T09:21:22.593529Z [shutoff] [httprpc.cpp:387] [StopHTTPRPC] [rpc] Stopping HTTP RPC server \n node0 2025-02-10T09:21:22.593536Z [shutoff] [httpserver.cpp:770] [UnregisterHTTPHandler] [http] Unregistering HTTP handler for / (exactmatch 1) \n node0 2025-02-10T09:21:22.593545Z [shutoff] [httpserver.cpp:770] [UnregisterHTTPHandler] [http] Unregistering HTTP handler for /wallet/ (exactmatch 0) \n node0 2025-02-10T09:21:22.593553Z [shutoff] [rpc/server.cpp:303] [operator()] [rpc] Stopping RPC \n node0 2025-02-10T09:21:22.593636Z [shutoff] [rpc/server.cpp:306] [operator()] [rpc] RPC stopped. \n node0 2025-02-10T09:21:22.593646Z [shutoff] [httpserver.cpp:520] [StopHTTPServer] [http] Stopping HTTP server \n node0 2025-02-10T09:21:22.593653Z [shutoff] [httpserver.cpp:522] [StopHTTPServer] [http] Waiting for HTTP worker threads to exit \n node0 2025-02-10T09:21:22.593976Z [addcon] [util/thread.cpp:22] [TraceThread] addcon thread exit \n node0 2025-02-10T09:21:22.594367Z [shutoff] [httpserver.cpp:550] [StopHTTPServer] [http] Waiting for HTTP event thread to exit \n node0 2025-02-10T09:21:22.594396Z [http] [httpserver.cpp:355] [ThreadHTTP] [http] Exited http event loop \n node0 2025-02-10T09:21:22.594482Z [shutoff] [httpserver.cpp:556] [StopHTTPServer] [http] Stopped HTTP server \n node0 2025-02-10T09:21:22.643280Z [net] [util/thread.cpp:22] [TraceThread] net thread exit \n node0 2025-02-10T09:21:22.643367Z [msghand] [util/thread.cpp:22] [TraceThread] msghand thread exit \n test  2025-02-10T09:21:22.644000Z TestFramework.p2p (DEBUG): Closed connection to: 127.0.0.1:14456 \n test  2025-02-10T09:21:22.644000Z TestFramework.p2p (DEBUG): Closed connection to: 127.0.0.1:14456 \n test  2025-02-10T09:21:22.644000Z TestFramework.p2p (DEBUG): Closed connection to: 127.0.0.1:14456 \n node0 2025-02-10T09:21:22.644215Z [shutoff] [net.cpp:2391] [DumpAddresses] [net] Flushed 0 addresses to peers.dat  0ms \n node0 2025-02-10T09:21:22.644227Z [shutoff] [net.cpp:3477] [StopNodes] [net] Stopping node, disconnecting peer=1 \n node0 2025-02-10T09:21:22.644234Z [shutoff] [net.cpp:565] [CloseSocketDisconnect] [net] Resetting socket for peer=1 \n test  2025-02-10T09:21:24.705000Z TestFramework.p2p (DEBUG): Send message to 127.0.0.1:49138: msg_pong(nonce=3365597ad9b5dc7f) \n test  2025-02-10T09:21:24.705000Z TestFramework.p2p (DEBUG): Received message from 127.0.0.1:49138: msg_getheaders(locator=CBlockLocator(vHave=[25904390216175313194312162455780078753009692101200952252992871177711616225820, 10439194800033568075353954394040901046437382900627609508673849620975391395575, 40446225147528968444488730747006358517695899943732003474923480031726915305221, 32881632053604177249247854545860335098773301364214891775874295669143030708145, 8274383136340278425284592751131987282275833971901249227378370713913292132329, 91375339536865810244115815573593171857986770160039248524702050... (msg truncated) \n test  2025-02-10T09:21:24.705000Z TestFramework.p2p (DEBUG): Received message from 127.0.0.1:49138: msg_feefilter(feerate=000003e8) \n node0 2025-02-10T09:21:24.705018Z (mocktime: 2025-02-10T09:21:24Z) [msghand] [net_processing.cpp:3380] [ProcessMessage] [net] received: verack (0 bytes) peer=11 \n node0 2025-02-10T09:21:24.705027Z (mocktime: 2025-02-10T09:21:24Z) [msghand] [net_processing.cpp:3625] [ProcessMessage] New outbound-full-relay v1 peer connected: version: 70016, blocks=-1, peer=11 \n node0 2025-02-10T09:21:24.705036Z (mocktime: 2025-02-10T09:21:24Z) [msghand] [net.cpp:3875] [PushMessage] [net] sending sendcmpct (9 bytes) peer=11 \n node0 2025-02-10T09:21:24.705062Z (mocktime: 2025-02-10T09:21:24Z) [msghand] [net.cpp:3875] [PushMessage] [net] sending ping (8 bytes) peer=11 \n node0 2025-02-10T09:21:24.705100Z (mocktime: 2025-02-10T09:21:24Z) [msghand] [net.cpp:3875] [PushMessage] [net] sending getheaders (645 bytes) peer=11 \n node0 2025-02-10T09:21:24.705124Z (mocktime: 2025-02-10T09:21:24Z) [msghand] [net_processing.cpp:5508] [SendMessages] [net] initial getheaders (199) to peer=11 (startheight:-1) \n node0 2025-02-10T09:21:24.705144Z (mocktime: 2025-02-10T09:21:24Z) [msghand] [net.cpp:3875] [PushMessage] [net] sending feefilter (8 bytes) peer=11 \n node0 2025-02-10T09:21:24.705878Z (mocktime: 2025-02-10T09:21:24Z) [msghand] [net_processing.cpp:3380] [ProcessMessage] [net] received: pong (8 bytes) peer=11 \n test  2025-02-10T09:21:24.753000Z TestFramework.p2p (DEBUG): Send message to 127.0.0.1:49138: msg_ping(nonce=00000000) \n test  2025-02-10T09:21:24.754000Z TestFramework.p2p (DEBUG): Send message to 127.0.0.1:49138: msg_ping(nonce=00000001) \n test  2025-02-10T09:21:24.754000Z TestFramework.p2p (DEBUG): Received message from 127.0.0.1:49138: msg_pong(nonce=00000000) \n test  2025-02-10T09:21:24.754000Z TestFramework.p2p (DEBUG): Received message from 127.0.0.1:49138: msg_pong(nonce=00000001) \n node0 2025-02-10T09:21:24.754344Z (mocktime: 2025-02-10T09:21:24Z) [msghand] [net_processing.cpp:3380] [ProcessMessage] [net] received: ping (8 bytes) peer=11 \n node0 2025-02-10T09:21:24.754365Z (mocktime: 2025-02-10T09:21:24Z) [msghand] [net.cpp:3875] [PushMessage] [net] sending pong (8 bytes) peer=11 \n node0 2025-02-10T09:21:24.754415Z (mocktime: 2025-02-10T09:21:24Z) [msghand] [net_processing.cpp:3380] [ProcessMessage] [net] received: ping (8 bytes) peer=11 \n node0 2025-02-10T09:21:24.754438Z (mocktime: 2025-02-10T09:21:24Z) [msghand] [net.cpp:3875] [PushMessage] [net] sending pong (8 bytes) peer=11 \n test  2025-02-10T09:21:24.804000Z TestFramework.p2p (DEBUG): Send message to 127.0.0.1:49138: msg_inv(inv=[CInv(type=WTX hash=00000000000000000000000000000000000000000000000000000000ff00ff00)]) \n node0 2025-02-10T09:21:24.805809Z (mocktime: 2025-02-10T09:21:24Z) [http] [httpserver.cpp:306] [http_request_cb] [http] Received a POST request for / from 127.0.0.1:57432 \n node0 2025-02-10T09:21:24.805870Z (mocktime: 2025-02-10T09:21:24Z) [httpworker.1] [rpc/request.cpp:241] [parse] [rpc] ThreadRPCServer method=getpeerinfo user=__cookie__ \n test  2025-02-10T09:21:24.809000Z TestFramework.p2p (DEBUG): Received message from 127.0.0.1:14456: msg_getdata(inv=[CInv(type=WTX hash=00000000000000000000000000000000000000000000000000000000ff00ff00)]) \n node0 2025-02-10T09:21:24.809051Z (mocktime: 2025-02-10T09:21:24Z) [http] [httpserver.cpp:306] [http_request_cb] [http] Received a POST request for / from 127.0.0.1:57432 \n node0 2025-02-10T09:21:24.809106Z (mocktime: 2025-02-10T09:21:24Z) [httpworker.0] [rpc/request.cpp:241] [parse] [rpc] ThreadRPCServer method=setmocktime user=__cookie__ \n node0 2025-02-10T09:21:24.809392Z (mocktime: 2025-02-10T09:22:22Z) [msghand] [node/txdownloadman_impl.cpp:277] [GetRequestsToSend] [net] timeout of inflight wtx 00000000000000000000000000000000000000000000000000000000ff00ff00 from peer=0 \n node0 2025-02-10T09:21:24.809423Z (mocktime: 2025-02-10T09:22:22Z) [msghand] [node/txdownloadman_impl.cpp:282] [GetRequestsToSend] [net] Requesting wtx 00000000000000000000000000000000000000000000000000000000ff00ff00 peer=10 \n node0 2025-02-10T09:21:24.809433Z (mocktime: 2025-02-10T09:22:22Z) [msghand] [net.cpp:3875] [PushMessage] [net] sending getdata (37 bytes) peer=10 \n node0 2025-02-10T09:21:24.809628Z (mocktime: 2025-02-10T09:22:22Z) [msghand] [net_processing.cpp:3380] [ProcessMessage] [net] received: inv (37 bytes) peer=11 \n node0 2025-02-10T09:21:24.809657Z (mocktime: 2025-02-10T09:22:22Z) [msghand] [net_processing.cpp:3943] [ProcessMessage] [net] got inv: wtx 00000000000000000000000000000000000000000000000000000000ff00ff00  new peer=11 \n test  2025-02-10T09:21:34.852000Z TestFramework.utils (ERROR): wait_until() failed. Predicate: '''' \n                                           def test_function():\n                                               if check_connected:\n                                                   assert self.is_connected\n                                               return test_function_in()\n                                   '''\n test  2025-02-10T09:21:34.852000Z TestFramework (ERROR): Assertion failed \n                                   Traceback (most recent call last):\n                                     File \"/home/runner/work/bitcoin/bitcoin/test/functional/test_framework/test_framework.py\", line 135, in main\n                                       self.run_test()\n                                     File \"/home/runner/work/bitcoin/bitcoin/build/test/functional/p2p_tx_download.py\", line 385, in run_test\n                                       self.test_preferred_tiebreaker_inv()\n                                     File \"/home/runner/work/bitcoin/bitcoin/build/test/functional/p2p_tx_download.py\", line 283, in test_preferred_tiebreaker_inv\n                                       pref_peer.wait_until(lambda: pref_peer.tx_getdata_count >= 1, timeout=10)\n                                     File \"/home/runner/work/bitcoin/bitcoin/test/functional/test_framework/p2p.py\", line 594, in wait_until\n                                       wait_until_helper_internal(test_function, timeout=timeout, lock=p2p_lock, timeout_factor=self.timeout_factor, check_interval=check_interval)\n                                     File \"/home/runner/work/bitcoin/bitcoin/test/functional/test_framework/util.py\", line 317, in wait_until_helper_internal\n                                       raise AssertionError(\"Predicate {} not true after {} seconds\".format(predicate_source, timeout))\n                                   AssertionError: Predicate ''''\n                                           def test_function():\n                                               if check_connected:\n                                                   assert self.is_connected\n                                               return test_function_in()\n                                   ''' not true after 10 seconds\n test  2025-02-10T09:21:34.854000Z TestFramework (DEBUG): Closing down network thread \n```",
      "state": "closed",
      "user": "Sjors",
      "created_at": "2025-02-10T09:50:59Z",
      "updated_at": "2025-02-11T08:58:49Z",
      "comments": 2,
      "url": "https://github.com/bitcoin/bitcoin/issues/31833",
      "labels": [
        "CI failed"
      ],
      "comment_list": [
        {
          "user": "fanquake",
          "body": "https://github.com/bitcoin/bitcoin/runs/36959123903:  https://cirrus-ci.com/task/6537248474136576?logs=ci#L5874.",
          "created_at": "2025-02-10T14:52:22Z"
        },
        {
          "user": "mzumsande",
          "body": "Looks like it's just a missing sync, see #31837.",
          "created_at": "2025-02-10T18:42:12Z"
        }
      ]
    },
    {
      "number": 31832,
      "title": "Wallets not automatically loaded",
      "body": "### Is there an existing issue for this?\n\n- [x] I have searched the existing issues\n\n### Current behaviour\n\nafter starting `bitcoind` the wallets are not automatically loaded\n\n### Expected behaviour\n\nthe wallets should be  automatically loaded\n\n### Steps to reproduce\n\nMy bitcoin.conf\n```\npid=/run/bitcoin/bitcoind.pid\nnodebuglogfile=1\ndatadir=/var/bitcoin\nloglevel=info\nproxy=127.0.0.1:9050\ntestnet4=1\n\n[testnet4]\nwalletdir=/var/wallet\n\nserver=1\nrpcuser=satobox\nrpcport=8332\nrpcconnect=127.0.0.1\nrpcauth=satobox:c7eadc9121b2af62e92df69f1$3eecb49b2600f152f728a9f66ab38028e8c710a04ea06c69e4a2f291e7d6eee3\n\n```\n\nmy wallet dir:\n\n```\nls -l /var/wallet/\ntotal 28\ndrwx------ 2 64874 64874  4096 Feb 10 08:19 Wallet-01\ndrwx------ 2 64874 64874  4096 Feb  9 14:55 Wallet-02\ndrwx------ 2 64874 64874  4096 Feb  9 14:56 Wallet-03\n\n```\n\n\nwhen I start bitcoind:\n\n`/usr/bin/bitcoind -conf=/etc/bitcoin/bitcoin.conf`\n\n\nNothing shows up:\n\n```\n# bitcoin-cli listwallets\n[\n]\n```\n\nI have to load them manually:\n\n`bitcoin-cli loadwallet \"Wallet-01\"\n`\n\n```\n# bitcoin-cli listwallets\n[\n  \"Wallet-01\"\n]\n```\n\n\n\n### Relevant log output\n\nsee above\n\n### How did you obtain Bitcoin Core\n\nCompiled from source\n\n### What version of Bitcoin Core are you using?\n\nmaster\n\n### Operating system and version\n\nUbuntu 24.04\n\n### Machine specifications\n\n_No response_",
      "state": "closed",
      "user": "embetrix",
      "created_at": "2025-02-10T08:25:50Z",
      "updated_at": "2025-02-10T10:23:57Z",
      "comments": 4,
      "url": "https://github.com/bitcoin/bitcoin/issues/31832",
      "labels": [
        "Wallet",
        "Questions and Help"
      ],
      "comment_list": [
        {
          "user": "maflcko",
          "body": "If you want to have a wallet loaded on startup, you'll have to set `load_on_startup` to `True`.\n\nTo learn more about the `loadwallet` RPC, you can try `help loadwallet`.",
          "created_at": "2025-02-10T08:52:27Z"
        },
        {
          "user": "maflcko",
          "body": "Usually the issue tracker is used to track technical issues related to the Bitcoin Core code base.\n\nGeneral bitcoin questions and/or support requests are best directed to the [Bitcoin StackExchange](https://bitcoin.stackexchange.com) or the `#bitcoin` IRC channel on Libera Chat, or one of the Bitcoin subreddits, or any other place that you feel is well suited.\n\n ",
          "created_at": "2025-02-10T08:52:53Z"
        },
        {
          "user": "willcl-ark",
          "body": "In addition to @maflcko's suggestion, another way to explicitly load wallets at startup is to use the `-wallet=<path>` startup option in your configuration (multiple times in your case, for multiple wallets).",
          "created_at": "2025-02-10T08:57:08Z"
        },
        {
          "user": "embetrix",
          "body": "thanks for the suggestions:\n\nthe following command:\n\n`bitcoin-cli loadwallet \"Wallet-01\"  true`\n\nmake a wallet automatically loaded",
          "created_at": "2025-02-10T10:23:46Z"
        }
      ]
    }
  ],
  "summary": {
    "pull_requests": 5,
    "issues": 3
  }
}