{
  "source": "github",
  "repository": "bitcoin/bitcoin",
  "fetched_at": "2026-01-15T19:45:26.107487+00:00",
  "date": "2025-05-23",
  "pull_requests": [
    {
      "number": 32607,
      "title": "rpc: Note in fundrawtransaction doc, fee rate is for package",
      "body": "Accidentally made some transactions with a much higher fee rate than I wanted because I did not know this would do it for the package rather than the individual tx.",
      "state": "closed",
      "user": "benthecarman",
      "created_at": "2025-05-23T22:30:16Z",
      "updated_at": "2025-06-09T15:15:38Z",
      "comments": 10,
      "url": "https://github.com/bitcoin/bitcoin/pull/32607",
      "labels": [
        "RPC/REST/ZMQ"
      ],
      "comment_list": [
        {
          "user": "DrahtBot",
          "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/32607.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| ACK | [rkrux](https://github.com/bitcoin/bitcoin/pull/32607#pullrequestreview-2891529215), [danielabrozzoni](https://github.com/bitcoin/bitcoin/pull/32607#pullrequestreview-2896689686), [achow101](https://github.com/bitcoin/bitcoin/pull/32607#issuecomment-2941640165) |\n| Stale ACK | [i-am-yuvi](https://github.com/bitcoin/bitcoin/pull/32607#issuecomment-2906902161), [kevkevinpal](https://github.com/bitcoin/bitcoin/pull/32607#issuecomment-2917459536) |\n\nIf your review is incorrectly listed, please react with üëé to this comment and the bot will ignore it on the next update.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#32618](https://github.com/bitcoin/bitcoin/pull/32618) (wallet: Remove ISMINE_WATCHONLY and watchonly from RPCs by achow101)\n* [#32523](https://github.com/bitcoin/bitcoin/pull/32523) (wallet: Remove watchonly behavior and isminetypes by achow101)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n<!--5faf32d7da4f0f540f40219e4f7537a3-->",
          "created_at": "2025-05-23T22:30:19Z"
        },
        {
          "user": "DrahtBot",
          "body": "<!--85328a0da195eb286784d51f73fa0af9-->\nüöß At least one of the CI tasks failed.\n<sub>Task `macOS-cross, gui, no tests`: https://github.com/bitcoin/bitcoin/runs/42814612722</sub>\n<sub>LLM reason (‚ú® experimental): The CI failure is due to a build error in `src/wallet/rpc/spend.cpp` related to a missing closing curly brace.\n</sub>\n\n<details><summary>Hints</summary>\n\nTry to run the tests locally, according to the documentation. However, a CI failure may still\nhappen due to a number of reasons, for example:\n\n* Possibly due to a silent merge conflict (the changes in this pull request being\nincompatible with the current code in the target branch). If so, make sure to rebase on the latest\ncommit of the target branch.\n\n* A sanitizer issue, which can only be found by compiling with the sanitizer and running the\n  affected test.\n\n* An intermittent issue.\n\nLeave a comment here, if you need help tracking down a confusing failure.\n\n</details>\n\n",
          "created_at": "2025-05-23T22:35:37Z"
        },
        {
          "user": "maflcko",
          "body": "> Interesting that the `feature_fee_estimation.py ` test fails in the CI coincidentally but seems unrelated to me as it passed in my system. Maybe a rerun/push would fix it?\r\n\r\nSee https://github.com/bitcoin/bitcoin/issues/32461",
          "created_at": "2025-05-24T10:54:32Z"
        },
        {
          "user": "yuvicc",
          "body": "ACK fe0432b1c4a10b74844c2dedefccfe340c0d3b10\r\n\r\nThis will be a helpful note for someone using the rpc.",
          "created_at": "2025-05-24T15:52:58Z"
        },
        {
          "user": "luke-jr",
          "body": "Is this actually intended behaviour?",
          "created_at": "2025-05-27T16:24:08Z"
        },
        {
          "user": "achow101",
          "body": "> Is this actually intended behaviour?\r\n\r\nYes, see #26152",
          "created_at": "2025-05-27T18:05:06Z"
        },
        {
          "user": "kevkevinpal",
          "body": "ACK [fe0432b](https://github.com/bitcoin/bitcoin/pull/32607/commits/fe0432b1c4a10b74844c2dedefccfe340c0d3b10)",
          "created_at": "2025-05-28T19:57:23Z"
        },
        {
          "user": "benthecarman",
          "body": "impl'd @achow101's suggestions, also added missing `\\n` at end of the doc",
          "created_at": "2025-06-02T16:18:57Z"
        },
        {
          "user": "achow101",
          "body": "ACK f98e1aaf34e347088caa54403521e3b5cb55dd40",
          "created_at": "2025-06-04T21:49:24Z"
        },
        {
          "user": "fanquake",
          "body": "Backported to `29.x` in #32589.",
          "created_at": "2025-06-09T15:15:37Z"
        }
      ]
    },
    {
      "number": 32606,
      "title": "p2p: Drop unsolicited CMPCTBLOCK from non-HB peer",
      "body": "Processing unsolicited `CMPCTBLOCK`'s from a peer that has not been marked high bandwidth is not well-specified behavior in BIP-0152, in fact the BIP seems to imply that it is not permitted:\r\n\r\n> \"[...] method is not useful for compact blocks because `cmpctblock` blocks can be sent unsolicitedly in high-bandwidth mode\"\r\n\r\nSee https://github.com/bitcoin/bips/blob/master/bip-0152.mediawiki#separate-version-for-segregated-witness\r\n\r\nThis partially mitigates a mempool leak described in #28272, making it only possible for peers selected as high bandwidth to discover a node's mempool.",
      "state": "open",
      "user": "davidgumberg",
      "created_at": "2025-05-23T21:58:15Z",
      "updated_at": "2025-11-12T21:58:37Z",
      "comments": 21,
      "url": "https://github.com/bitcoin/bitcoin/pull/32606",
      "labels": [
        "P2P"
      ]
    },
    {
      "number": 32604,
      "title": "log: Mitigate disk filling attacks by rate limiting LogPrintf, LogInfo, LogWarning, LogError",
      "body": "This revives the work done by dergoegge in https://github.com/bitcoin/bitcoin/pull/21603. The approach is similar ‚Äî this PR uses `std::source_location` under the hood now that we can use c++20 features. It also resets the rate limiting statistics via the `CScheduler`. The logging functions have also changed slightly since that PR was opened, so work has been done to preserve the intent of the original rate limiting change. I have tried to give commit attribution where possible.\r\n\r\n**Approach:**\r\nEach source code location is given an hourly logging quota of 1MiB of logging per hour. Logging is only dropped from source locations that exceed the quota.\r\n- Only logging to disk is rate limited. Logging to console is not rate limited.\r\n- Printing with the category argument is not rate limited.\r\n- `UpdateTip: new best=[‚Ä¶]` is logged without rate limiting. High log volume is expected for that source location during IBD.\r\n- When logging is restarted a tally of how many bytes were dropped is printed.\r\n- All logs will be prefixed with [*] if there is at least one source location that is currently being suppressed.\r\n\r\nI've repurposed the old logging rpc mentioned in #21603 in another branch for testing [here](https://github.com/Crypt-iQ/bitcoin/tree/log_ratelimiting_05192025_rpc). This can be used to log from source locations and test out the new changes in logging behavior. Note that the `setmocktime` RPC needs to be used to set the mock time past the current clock time to reset the logging messages.\r\n\r\nExample usage:\r\n```\r\nbitcoin-cli -regtest excessivelog 1 1048500 # log just under 1MiB\r\nbitcoin-cli -regtest excessivelog 1 100 # this should get the total amount logged above 1MiB\r\n                                        # and the rate limiting logic should kick in\r\nbitcoin-cli -regtest excessivelog 2 1048500\r\nbitcoin-cli -regtest excessivelog 2 100 # trigger rate limiting from another location\r\nbitcoin-cli -regtest mockscheduler 3600 # fast-forward the scheduler\r\nbitcoin-cli -regtest excessivelog 1 100 # this should trigger logging to resume and will log the source locations that were reset\r\n```\r\n\r\nExample output:\r\n```\r\n2025-07-02T22:03:56Z [warning] Excessive logging detected from rpc/node.cpp:142 (RPCHelpMan excessivelog()): >1048576 bytes logged during the last time window of 3600s. Suppressing logging to disk from this source location until time window resets. Console logging unaffected. Last log entry.\r\n[*] 2025-07-02T22:03:56Z aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa\r\n2025-07-02T22:04:58Z (mocktime: 2262-04-11T23:47:15Z) Restarting logging from rpc/node.cpp:142 (RPCHelpMan excessivelog()): 121 bytes were dropped during the last 3600s.\r\n2025-07-02T22:04:58Z (mocktime: 2262-04-11T23:47:15Z) Restarting logging from rpc/node.cpp:139 (RPCHelpMan excessivelog()): 121 bytes were dropped during the last 3600s.\r\n```",
      "state": "closed",
      "user": "Crypt-iQ",
      "created_at": "2025-05-23T20:48:49Z",
      "updated_at": "2026-01-08T16:01:44Z",
      "comments": 27,
      "url": "https://github.com/bitcoin/bitcoin/pull/32604",
      "labels": [
        "Utils/log/libs"
      ]
    },
    {
      "number": 32603,
      "title": "rpc, doc: clarify wallet version in getwalletinfo help",
      "body": "I noted in review of a previous PR here: https://github.com/bitcoin/bitcoin/pull/32553#pullrequestreview-2853743852.\r\n\r\nRelaying the same information in the RPC help that's present in a code comment: https://github.com/bitcoin/bitcoin/blob/af65fd1a333011137dafd3df9a51704fd319feb4/src/wallet/wallet.h#L809-L810\r\n\r\n<!--\r\n*** Please remove the following help text before submitting: ***\r\n\r\nPull requests without a rationale and clear improvement may be closed\r\nimmediately.\r\n\r\nGUI-related pull requests should be opened against\r\nhttps://github.com/bitcoin-core/gui\r\nfirst. See CONTRIBUTING.md\r\n-->\r\n\r\n<!--\r\nPlease provide clear motivation for your patch and explain how it improves\r\nBitcoin Core user experience or Bitcoin Core developer experience\r\nsignificantly:\r\n\r\n* Any test improvements or new tests that improve coverage are always welcome.\r\n* All other changes should have accompanying unit tests (see `src/test/`) or\r\n  functional tests (see `test/`). Contributors should note which tests cover\r\n  modified code. If no tests exist for a region of modified code, new tests\r\n  should accompany the change.\r\n* Bug fixes are most welcome when they come with steps to reproduce or an\r\n  explanation of the potential issue as well as reasoning for the way the bug\r\n  was fixed.\r\n* Features are welcome, but might be rejected due to design or scope issues.\r\n  If a feature is based on a lot of dependencies, contributors should first\r\n  consider building the system outside of Bitcoin Core, if possible.\r\n* Refactoring changes are only accepted if they are required for a feature or\r\n  bug fix or otherwise improve developer experience significantly. For example,\r\n  most \"code style\" refactoring changes require a thorough explanation why they\r\n  are useful, what downsides they have and why they *significantly* improve\r\n  developer experience or avoid serious programming bugs. Note that code style\r\n  is often a subjective matter. Unless they are explicitly mentioned to be\r\n  preferred in the [developer notes](/doc/developer-notes.md), stylistic code\r\n  changes are usually rejected.\r\n-->\r\n\r\n<!--\r\nBitcoin Core has a thorough review process and even the most trivial change\r\nneeds to pass a lot of eyes and requires non-zero or even substantial time\r\neffort to review. There is a huge lack of active reviewers on the project, so\r\npatches often sit for a long time.\r\n-->\r\n",
      "state": "closed",
      "user": "rkrux",
      "created_at": "2025-05-23T15:19:03Z",
      "updated_at": "2025-08-18T08:21:52Z",
      "comments": 2,
      "url": "https://github.com/bitcoin/bitcoin/pull/32603",
      "labels": [
        "Needs rebase"
      ],
      "comment_list": [
        {
          "user": "DrahtBot",
          "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/32603.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| Stale ACK | [jonatack](https://github.com/bitcoin/bitcoin/pull/32603#pullrequestreview-2865264982) |\n\nIf your review is incorrectly listed, please react with üëé to this comment and the bot will ignore it on the next update.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#32977](https://github.com/bitcoin/bitcoin/pull/32977) (wallet: Remove wallet version and several legacy related functions by w0xlt)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n<!--5faf32d7da4f0f540f40219e4f7537a3-->",
          "created_at": "2025-05-23T15:19:05Z"
        },
        {
          "user": "DrahtBot",
          "body": "<!--cf906140f33d8803c4a75a2196329ecb-->\nüêô This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n",
          "created_at": "2025-08-16T00:42:19Z"
        }
      ]
    },
    {
      "number": 32602,
      "title": "fuzz: Add target for coins database",
      "body": "This reopens https://github.com/bitcoin/bitcoin/pull/28216.\r\n\r\nThe current `coins_view` target only tests `CCoinsViewCache` using a basic `CCoinsView` instance. The addition of the `coins_view_db` target enables testing with an actual `CCoinsViewDB` as the backend.",
      "state": "closed",
      "user": "marcofleon",
      "created_at": "2025-05-23T15:01:21Z",
      "updated_at": "2025-10-30T13:58:39Z",
      "comments": 4,
      "url": "https://github.com/bitcoin/bitcoin/pull/32602",
      "labels": [
        "Tests",
        "Fuzzing"
      ],
      "comment_list": [
        {
          "user": "DrahtBot",
          "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/32602.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| ACK | [TheCharlatan](https://github.com/bitcoin/bitcoin/pull/32602#pullrequestreview-2878087402), [maflcko](https://github.com/bitcoin/bitcoin/pull/32602#issuecomment-2940437069), [l0rinc](https://github.com/bitcoin/bitcoin/pull/32602#issuecomment-2940862921) |\n\nIf your review is incorrectly listed, please react with üëé to this comment and the bot will ignore it on the next update.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#32313](https://github.com/bitcoin/bitcoin/pull/32313) (coins: fix `cachedCoinsUsage` accounting in `CCoinsViewCache` by l0rinc)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n<!--5faf32d7da4f0f540f40219e4f7537a3-->",
          "created_at": "2025-05-23T15:01:24Z"
        },
        {
          "user": "marcofleon",
          "body": "The coverage between the two targets can be compared [here](https://marcofleon.github.io/coverage/coins_view/) and [here](https://marcofleon.github.io/coverage/coins_view_db/).\r\n\r\nInstability was a bit of a concern in the last PR, but was answered in https://github.com/bitcoin/bitcoin/pull/28216#issuecomment-2754900599.",
          "created_at": "2025-05-23T15:03:46Z"
        },
        {
          "user": "maflcko",
          "body": "lgtm ACK cfc42ae5b7ef6d3892907cfe36dc3ae923495d37\r\n",
          "created_at": "2025-06-04T15:18:56Z"
        },
        {
          "user": "l0rinc",
          "body": "code review ACK cfc42ae5b7ef6d3892907cfe36dc3ae923495d37",
          "created_at": "2025-06-04T17:40:34Z"
        }
      ]
    },
    {
      "number": 32601,
      "title": "test: Fix `system_tests/run_command` test",
      "body": "This PR addresses two issues related to the \"Return non-zero exit code, with error message for stderr\" check in the `system_tests/run_command` test:\r\n1. The test now checks the exact exit code, which must be 1.\r\n2. The process invocation string is removed from the exception message before checking the stderr output, as the latter is a substring of the former.\r\n\r\nThis is an alternative to https://github.com/bitcoin/bitcoin/pull/32577 without introducing a shell wrapper and altering quotation in `src/external_signer.cpp`.\r\n\r\nThe main idea is to avoid parsing the problematic `sh -c 'echo err 1>&2 && false'` command with `subprocess::Popen`.\r\n\r\nIn the past, this check used:https://github.com/bitcoin/bitcoin/blob/5abb9b1af49be9024f95fa2f777285c531785d85/src/test/system_tests.cpp#L56-L58\r\n\r\nwhich was problematic due to its dependence on the system locale.\r\n\r\nFixes https://github.com/bitcoin/bitcoin/issues/32574.",
      "state": "closed",
      "user": "hebasto",
      "created_at": "2025-05-23T12:51:35Z",
      "updated_at": "2025-07-04T10:25:40Z",
      "comments": 3,
      "url": "https://github.com/bitcoin/bitcoin/pull/32601",
      "labels": [
        "Tests",
        "CI failed"
      ],
      "comment_list": [
        {
          "user": "DrahtBot",
          "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/32601.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\nA summary of reviews will appear here.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#32577](https://github.com/bitcoin/bitcoin/pull/32577) (subprocess: Let shell parse command on non-Windows systems by hebasto)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n<!--5faf32d7da4f0f540f40219e4f7537a3-->",
          "created_at": "2025-05-23T12:51:38Z"
        },
        {
          "user": "DrahtBot",
          "body": "<!--85328a0da195eb286784d51f73fa0af9-->\nüöß At least one of the CI tasks failed.\n<sub>Task `lint`: https://github.com/bitcoin/bitcoin/runs/42784049574</sub>\n<sub>LLM reason (‚ú® experimental): The CI failure is due to a missing `export LC_ALL=C` statement in a shell script, as reported by a lint test.\n</sub>\n\n<details><summary>Hints</summary>\n\nTry to run the tests locally, according to the documentation. However, a CI failure may still\nhappen due to a number of reasons, for example:\n\n* Possibly due to a silent merge conflict (the changes in this pull request being\nincompatible with the current code in the target branch). If so, make sure to rebase on the latest\ncommit of the target branch.\n\n* A sanitizer issue, which can only be found by compiling with the sanitizer and running the\n  affected test.\n\n* An intermittent issue.\n\nLeave a comment here, if you need help tracking down a confusing failure.\n\n</details>\n\n",
          "created_at": "2025-05-23T12:58:09Z"
        },
        {
          "user": "fanquake",
          "body": "Probably close this now, if #32577 has been re-opened, and the approach here has been nacked for re-introducing bugs?",
          "created_at": "2025-07-04T09:09:54Z"
        }
      ]
    },
    {
      "number": 32598,
      "title": "walletdb: Log additional exception error messages for corrupted wallets",
      "body": "Many exceptions thrown for corruption are `std::runtime_error`; we should catch those and log the message to help with debugging.\r\n\r\nSplit from #32489",
      "state": "closed",
      "user": "achow101",
      "created_at": "2025-05-23T00:42:07Z",
      "updated_at": "2025-05-30T10:33:28Z",
      "comments": 3,
      "url": "https://github.com/bitcoin/bitcoin/pull/32598",
      "labels": [],
      "comment_list": [
        {
          "user": "DrahtBot",
          "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/32598.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| ACK | [furszy](https://github.com/bitcoin/bitcoin/pull/32598#pullrequestreview-2865753098), [rkrux](https://github.com/bitcoin/bitcoin/pull/32598#pullrequestreview-2866176097), [davidgumberg](https://github.com/bitcoin/bitcoin/pull/32598#issuecomment-2920938821), [Sjors](https://github.com/bitcoin/bitcoin/pull/32598#pullrequestreview-2880884812) |\n| Concept ACK | [jonatack](https://github.com/bitcoin/bitcoin/pull/32598#pullrequestreview-2865443270) |\n\nIf your review is incorrectly listed, please react with üëé to this comment and the bot will ignore it on the next update.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#27865](https://github.com/bitcoin/bitcoin/pull/27865) (wallet: Track no-longer-spendable TXOs separately by achow101)\n* [#27286](https://github.com/bitcoin/bitcoin/pull/27286) (wallet: Keep track of the wallet's own transaction outputs in memory by achow101)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n<!--5faf32d7da4f0f540f40219e4f7537a3-->",
          "created_at": "2025-05-23T00:42:15Z"
        },
        {
          "user": "achow101",
          "body": "> Should also change [HasLegacyRecords()](https://github.com/bitcoin/bitcoin/blob/2df824f4e62b6bc569044819cd64f66f3839ba13/src/wallet/walletdb.cpp#L544) as it would log the same error twice with this change.\r\n\r\nDone",
          "created_at": "2025-05-23T18:31:28Z"
        },
        {
          "user": "davidgumberg",
          "body": "ACK https://github.com/bitcoin/bitcoin/commit/ad9a13fc424e9deb262e2b1d54bcdc7370263ea0\r\n",
          "created_at": "2025-05-30T01:03:46Z"
        }
      ]
    },
    {
      "number": 32597,
      "title": "wallet: Always set descriptor cache upgraded flag for new wallets",
      "body": "Newly created wallets will always have an upgraded descriptor cache, so set those.\r\n\r\nAlso, to verify this behavior, add a new `flags` field to `getwalletinfo` and check that in the functional tests.\r\n\r\nSplit from #32489",
      "state": "closed",
      "user": "achow101",
      "created_at": "2025-05-23T00:39:49Z",
      "updated_at": "2025-07-08T13:47:40Z",
      "comments": 4,
      "url": "https://github.com/bitcoin/bitcoin/pull/32597",
      "labels": [
        "Wallet"
      ],
      "comment_list": [
        {
          "user": "DrahtBot",
          "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/32597.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| ACK | [Sjors](https://github.com/bitcoin/bitcoin/pull/32597#issuecomment-2944074815), [w0xlt](https://github.com/bitcoin/bitcoin/pull/32597#pullrequestreview-2918828047), [rkrux](https://github.com/bitcoin/bitcoin/pull/32597#pullrequestreview-2936775302) |\n| Concept ACK | [adyshimony](https://github.com/bitcoin/bitcoin/pull/32597#issuecomment-2910699910) |\n\nIf your review is incorrectly listed, please react with üëé to this comment and the bot will ignore it on the next update.\n<!--5faf32d7da4f0f540f40219e4f7537a3-->",
          "created_at": "2025-05-23T00:39:52Z"
        },
        {
          "user": "adyshimony",
          "body": "ACK \r\n\r\n[47237cd](https://github.com/bitcoin/bitcoin/pull/32597/commits/47237cd1938058b29fdec242c3a37611e255fda0)\r\n\r\n<details><summary>Test details</summary>\r\n<p>\r\n\r\n\r\nManual tests:\r\n\r\n```\r\n\r\n./bitcoin-cli createwallet \"test_32597_wallet\" false false \"\" false true\r\n{\r\n  \"name\": \"test_32597_wallet\",\r\n  \"warnings\": [\r\n    \"Empty string given as passphrase, wallet will not be encrypted.\"\r\n  ]\r\n}\r\n\r\n\r\n\r\n./bitcoin-cli -rpcwallet=test_32597_wallet getwalletinfo\r\n{\r\n  \"walletname\": \"test_32597_wallet\",\r\n  \"walletversion\": 169900,\r\n  \"format\": \"sqlite\",\r\n  \"balance\": 0.00000000,\r\n  \"unconfirmed_balance\": 0.00000000,\r\n  \"immature_balance\": 0.00000000,\r\n  \"txcount\": 0,\r\n  \"keypoolsize\": 4000,\r\n  \"keypoolsize_hd_internal\": 4000,\r\n  \"paytxfee\": 0.00000000,\r\n  \"private_keys_enabled\": true,\r\n  \"avoid_reuse\": false,\r\n  \"scanning\": false,\r\n  \"descriptors\": true,\r\n  \"external_signer\": false,\r\n  \"blank\": false,\r\n  \"birthtime\": 1748289166,\r\n  \"flags\": [\r\n    \"last_hardened_xpub_cached\",\r\n    \"descriptor_wallet\"\r\n  ],\r\n  \"lastprocessedblock\": {\r\n    \"hash\": \"0000000000000000000104185d6d17742c6f4e4a7b005af0e14c55176037ad95\",\r\n    \"height\": 898492\r\n  }\r\n}\r\n```\r\n\r\nFunctional tests:\r\n\r\n```\r\nbuild/test/functional/wallet_avoidreuse.py\r\n2025-05-26T20:24:39.668000Z TestFramework (INFO): PRNG seed is: 1859031226962638324\r\n2025-05-26T20:24:39.669000Z TestFramework (INFO): Initializing test directory /tmp/bitcoin_func_test_b3fqengx\r\n2025-05-26T20:24:40.193000Z TestFramework (INFO): Test wallet files persist avoid_reuse flag\r\n2025-05-26T20:24:40.761000Z TestFramework (INFO): Test immutable wallet flags\r\n2025-05-26T20:24:42.050000Z TestFramework (INFO): Test that change doesn't turn into non-change when spent\r\n2025-05-26T20:24:42.135000Z TestFramework (INFO): Test sending from reused address with avoid_reuse=false\r\n2025-05-26T20:24:42.289000Z TestFramework (INFO): Test sending from reused legacy address fails\r\n2025-05-26T20:24:43.382000Z TestFramework (INFO): Test sending from reused p2sh-segwit address fails\r\n2025-05-26T20:24:43.452000Z TestFramework (INFO): Test sending from reused bech32 address fails\r\n2025-05-26T20:24:43.531000Z TestFramework (INFO): Test getbalances used category\r\n2025-05-26T20:24:45.734000Z TestFramework (INFO): Test that full destination groups are preferred in coin selection\r\n2025-05-26T20:24:47.031000Z TestFramework (INFO): Test that all destination groups are used\r\n2025-05-26T20:24:49.956000Z TestFramework (INFO): Stopping nodes\r\n2025-05-26T20:24:50.010000Z TestFramework (INFO): Cleaning up /tmp/bitcoin_func_test_b3fqengx on exit\r\n2025-05-26T20:24:50.010000Z TestFramework (INFO): Tests successful\r\n```\r\n\r\n\r\n```\r\nbuild/test/functional/wallet_createwallet.py\r\n2025-05-26T20:25:07.813000Z TestFramework (INFO): PRNG seed is: 2684982768405465258\r\n2025-05-26T20:25:07.814000Z TestFramework (INFO): Initializing test directory /tmp/bitcoin_func_test_p9897jvk\r\n2025-05-26T20:25:08.134000Z TestFramework (INFO): Run createwallet with invalid parameters.\r\n2025-05-26T20:25:08.150000Z TestFramework (INFO): Test disableprivatekeys creation.\r\n2025-05-26T20:25:08.169000Z TestFramework (INFO): Test that private keys cannot be imported\r\n2025-05-26T20:25:08.182000Z TestFramework (INFO): Test blank creation with private keys disabled.\r\n2025-05-26T20:25:08.199000Z TestFramework (INFO): Test blank creation with private keys enabled.\r\n2025-05-26T20:25:08.255000Z TestFramework (INFO): Test blank creation with privkeys enabled and then encryption\r\n2025-05-26T20:25:08.691000Z TestFramework (INFO): Test blank creation with privkeys disabled and then encryption\r\n2025-05-26T20:25:08.711000Z TestFramework (INFO): New blank and encrypted wallets can be created\r\n2025-05-26T20:25:09.108000Z TestFramework (INFO): Test creating a new encrypted wallet.\r\n2025-05-26T20:25:09.547000Z TestFramework (INFO): Test making a wallet with avoid reuse flag\r\n2025-05-26T20:25:09.563000Z TestFramework (INFO): Using a passphrase with private keys disabled returns error\r\n2025-05-26T20:25:09.564000Z TestFramework (INFO): Test that legacy wallets cannot be created\r\n2025-05-26T20:25:09.565000Z TestFramework (INFO): Check that the version number is being logged correctly\r\n2025-05-26T20:25:09.658000Z TestFramework (INFO): Stopping nodes\r\n2025-05-26T20:25:09.810000Z TestFramework (INFO): Cleaning up /tmp/bitcoin_func_test_p9897jvk on exit\r\n2025-05-26T20:25:09.810000Z TestFramework (INFO): Tests successful\r\n\r\n```\r\n\r\nbitcoin-cli help shows the new flags field:\r\n\r\n```\r\nbuild/bin/bitcoin-cli help getwalletinfo\r\ngetwalletinfo\r\n\r\nReturns an object containing various wallet state info.\r\n\r\nResult:\r\n{                                         (json object)\r\n  \"walletname\" : \"str\",                   (string) the wallet name\r\n  \"walletversion\" : n,                    (numeric) the wallet version\r\n  \"format\" : \"str\",                       (string) the database format (only sqlite)\r\n  \"balance\" : n,                          (numeric) DEPRECATED. Identical to getbalances().mine.trusted\r\n  \"unconfirmed_balance\" : n,              (numeric) DEPRECATED. Identical to getbalances().mine.untrusted_pending\r\n  \"immature_balance\" : n,                 (numeric) DEPRECATED. Identical to getbalances().mine.immature\r\n  \"txcount\" : n,                          (numeric) the total number of transactions in the wallet\r\n  \"keypoololdest\" : xxx,                  (numeric, optional) the UNIX epoch time of the oldest pre-generated key in the key pool. Legacy wallets only.\r\n  \"keypoolsize\" : n,                      (numeric) how many new keys are pre-generated (only counts external keys)\r\n  \"keypoolsize_hd_internal\" : n,          (numeric, optional) how many new keys are pre-generated for internal use (used for change outputs, only appears if the wallet is using this feature, otherwise external keys are used)\r\n  \"unlocked_until\" : xxx,                 (numeric, optional) the UNIX epoch time until which the wallet is unlocked for transfers, or 0 if the wallet is locked (only present for passphrase-encrypted wallets)\r\n  \"paytxfee\" : n,                         (numeric) the transaction fee configuration, set in BTC/kvB\r\n  \"private_keys_enabled\" : true|false,    (boolean) false if privatekeys are disabled for this wallet (enforced watch-only wallet)\r\n  \"avoid_reuse\" : true|false,             (boolean) whether this wallet tracks clean/dirty coins in terms of reuse\r\n  \"scanning\" : {                          (json object) current scanning details, or false if no scan is in progress\r\n    \"duration\" : n,                       (numeric) elapsed seconds since scan start\r\n    \"progress\" : n                        (numeric) scanning progress percentage [0.0, 1.0]\r\n  },\r\n  \"descriptors\" : true|false,             (boolean) whether this wallet uses descriptors for output script management\r\n  \"external_signer\" : true|false,         (boolean) whether this wallet is configured to use an external signer such as a hardware wallet\r\n  \"blank\" : true|false,                   (boolean) Whether this wallet intentionally does not contain any keys, scripts, or descriptors\r\n  \"birthtime\" : xxx,                      (numeric, optional) The start time for blocks scanning. It could be modified by (re)importing any descriptor with an earlier timestamp.\r\n  \"flags\" : [                             (json array) The flags currently set on the wallet\r\n    \"str\",                                (string) The name of the flag\r\n    ...\r\n  ],\r\n  \"lastprocessedblock\" : {                (json object) hash and height of the block this information was generated on\r\n    \"hash\" : \"hex\",                       (string) hash of the block this information was generated on\r\n    \"height\" : n                          (numeric) height of the block this information was generated on\r\n  }\r\n}\r\n\r\n```\r\n\r\n\r\n</p>\r\n</details> ",
          "created_at": "2025-05-26T22:16:43Z"
        },
        {
          "user": "Sjors",
          "body": "ACK 47237cd1938058b29fdec242c3a37611e255fda0\r\n\r\n> Also, to verify this behavior, add a new flags field to getwalletinfo and check that in the functional tests.\r\n\r\nI checked that reverting the first commit breaks the new tests.",
          "created_at": "2025-06-05T12:35:09Z"
        },
        {
          "user": "fanquake",
          "body": "As far as I can tell, this change is the cause of non-determinism when Guix building the Windows binaries, on different architectures: #32923.",
          "created_at": "2025-07-08T13:47:40Z"
        }
      ]
    }
  ],
  "issues": [
    {
      "number": 32600,
      "title": "intermittent issue in feature_init.py (bitcoind should have exited with expected error LevelDB error: Corruption)",
      "body": "https://cirrus-ci.com/task/5185890844147712?logs=ci#L3553:\n\n```\n267/267 - \u001b[1mfeature_init.py\u001b[0m failed, Duration: 2420 s\n[17:16:50.450] \n[17:16:50.450] \u001b[1mstdout:\n[17:16:50.450] \u001b[0m2025-05-21T20:36:30.563000Z TestFramework (INFO): PRNG seed is: 630547506121562679\n\n...\n\n[17:16:50.450] 2025-05-21T20:36:49.282000Z TestFramework (INFO): Perturbing file to ensure failure /ci_container_base/ci/scratch/test_runner/test_runner_‚Çø_üèÉ_20250521_201845/feature_init_53/node0/regtest/indexes/coinstats/db/000033.ldb\n[17:16:50.450] 2025-05-21T20:36:49.282000Z TestFramework (INFO): Perturbing file to ensure failure /ci_container_base/ci/scratch/test_runner/test_runner_‚Çø_üèÉ_20250521_201845/feature_init_53/node0/regtest/indexes/coinstats/db/000034.log\n[17:16:50.450] 2025-05-21T20:36:50.003000Z TestFramework (INFO): Perturbing file to ensure failure /ci_container_base/ci/scratch/test_runner/test_runner_‚Çø_üèÉ_20250521_201845/feature_init_53/node0/regtest/indexes/txindex/000029.log\n[17:16:50.450] 2025-05-21T21:16:50.010000Z TestFramework (ERROR): Assertion failed\n[17:16:50.450] Traceback (most recent call last):\n[17:16:50.450]   File \"/ci_container_base/test/functional/test_framework/test_node.py\", line 682, in assert_start_raises_init_error\n[17:16:50.450]     ret = self.process.wait(timeout=self.rpc_timeout)\n[17:16:50.450]           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n[17:16:50.450]   File \"/usr/lib/python3.12/subprocess.py\", line 1264, in wait\n[17:16:50.450]     return self._wait(timeout=timeout)\n[17:16:50.450]            ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n[17:16:50.450]   File \"/usr/lib/python3.12/subprocess.py\", line 2045, in _wait\n[17:16:50.450]     raise TimeoutExpired(self.args, timeout)\n[17:16:50.450] subprocess.TimeoutExpired: Command '['bitcoin-node', '-datadir=/ci_container_base/ci/scratch/test_runner/test_runner_‚Çø_üèÉ_20250521_201845/feature_init_53/node0', '-logtimemicros', '-debug', '-debugexclude=libevent', '-debugexclude=leveldb', '-debugexclude=rand', '-uacomment=testnode0', '-logthreadnames', '-logsourcelocations', '-loglevel=trace', '-v2transport=1', '-txindex=1', '-blockfilterindex=1', '-coinstatsindex=1', '-checkblocks=200', '-checklevel=4']' timed out after 2400 seconds\n[17:16:50.450] \n[17:16:50.450] During handling of the above exception, another exception occurred:\n[17:16:50.450] \n[17:16:50.450] Traceback (most recent call last):\n[17:16:50.450]   File \"/ci_container_base/test/functional/test_framework/test_framework.py\", line 184, in main\n[17:16:50.450]     self.run_test()\n[17:16:50.450]   File \"/ci_container_base/ci/scratch/build-i686-pc-linux-gnu/test/functional/feature_init.py\", line 190, in run_test\n[17:16:50.450]     self.init_stress_test()\n[17:16:50.450]   File \"/ci_container_base/ci/scratch/build-i686-pc-linux-gnu/test/functional/feature_init.py\", line 161, in init_stress_test\n[17:16:50.450]     start_expecting_error(err_fragment)\n[17:16:50.450]   File \"/ci_container_base/ci/scratch/build-i686-pc-linux-gnu/test/functional/feature_init.py\", line 51, in start_expecting_error\n[17:16:50.450]     node.assert_start_raises_init_error(\n[17:16:50.450]   File \"/ci_container_base/test/functional/test_framework/test_node.py\", line 712, in assert_start_raises_init_error\n[17:16:50.450]     self._raise_assertion_error(assert_msg)\n[17:16:50.450]   File \"/ci_container_base/test/functional/test_framework/test_node.py\", line 195, in _raise_assertion_error\n[17:16:50.450]     raise AssertionError(self._node_msg(msg))\n[17:16:50.450] AssertionError: [node 0] bitcoind should have exited within 2400s with expected error LevelDB error: Corruption",
      "state": "closed",
      "user": "maflcko",
      "created_at": "2025-05-23T06:21:19Z",
      "updated_at": "2025-07-08T00:45:23Z",
      "comments": 3,
      "url": "https://github.com/bitcoin/bitcoin/issues/32600",
      "labels": [
        "CI failed"
      ],
      "comment_list": [
        {
          "user": "Cyber-Lord",
          "body": "I've attempted reproducing this issue locally using \"test/functional/feature_init.py\". After deleting some LevelDB .ldb files manually, I was able to trigger the failure. Instead of the expected \"Error opening coins database.\", the node exited with \"Error opening block database.\", confirming that the error message varies depending on which part of the LevelDB data is corrupted.\n\nI am thinking of submitting a patch to make the test more robust by allowing multiple expected error messages (e.g., both \"coins database\" and \"block database\"). This should reduce flakiness and make the test better reflect real-world failure modes.",
          "created_at": "2025-05-23T20:51:52Z"
        },
        {
          "user": "furszy",
          "body": "#32835.",
          "created_at": "2025-06-30T14:48:38Z"
        },
        {
          "user": "furszy",
          "body": "can close it.",
          "created_at": "2025-07-08T00:35:22Z"
        }
      ]
    }
  ],
  "summary": {
    "pull_requests": 8,
    "issues": 1
  }
}