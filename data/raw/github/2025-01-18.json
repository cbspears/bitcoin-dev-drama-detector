{
  "source": "github",
  "repository": "bitcoin/bitcoin",
  "fetched_at": "2026-01-15T19:10:25.316261+00:00",
  "date": "2025-01-18",
  "pull_requests": [
    {
      "number": 31682,
      "title": "[IBD] specialize CheckBlock's input & coinbase checks",
      "body": "This change is part of [[IBD] - Tracking PR for speeding up Initial Block Download](https://github.com/bitcoin/bitcoin/pull/32043)\r\n\r\n### Summary\r\n`CheckBlock`'s latency is critical for efficiently validating correct inputs during transaction validation, including mempool acceptance and new block creation.\r\n\r\nThis PR improves performance and maintainability by introducing the following changes:\r\n* Simplified checks for the most common cases (1 or 2 inputs - [70-90% of transactions have a single input](https://transactionfee.info/charts/transactions-1in)).\r\n* Optimized the general case by replacing `std::set` with sorted `std::vector` for improved locality.\r\n* Simplified Null prevout checks from linear to constant time.\r\n\r\n### Context, concerns\r\n\r\nAs noted by Sipa in https://github.com/bitcoin/bitcoin/pull/31682#pullrequestreview-2570273162, this is consensus-critical code (especially since we've had an actual inflation bug related to duplicate checking).\r\nHowever, the changes here are very confined to a single function, easily reviewed, and I have a general preference for avoiding `std::set` when sorted `std::vector` works too as well.\r\n\r\nThe goal of this change is to [make block validation faster](https://github.com/bitcoin/bitcoin/pull/14387#issuecomment-442748969) via a low-risk alternative.\r\n\r\n### Measurements\r\n\r\n<details>\r\n<summary>C++ compiler .......................... AppleClang 16.0.0.16000026</summary>\r\n\r\n> Before:\r\n\r\n|            ns/block |             block/s |    err% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------:|:----------\r\n|          372,743.63 |            2,682.81 |    1.1% |     10.99 | `CheckBlockBench`\r\n\r\n|               ns/op |                op/s |    err% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------:|:----------\r\n|        3,304,694.54 |              302.60 |    0.5% |     11.05 | `DuplicateInputs`\r\n|            9,585.10 |          104,328.55 |    0.1% |     11.03 | `ProcessTransactionBench`\r\n\r\n> After:\r\n\r\n|            ns/block |             block/s |    err% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------:|:----------\r\n|          179,971.00 |            5,556.45 |    0.3% |     11.02 | `CheckBlockBench`\r\n\r\n|               ns/op |                op/s |    err% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------:|:----------\r\n|          963,177.98 |            1,038.23 |    1.7% |     10.92 | `DuplicateInputs`\r\n|            9,410.90 |          106,259.75 |    0.3% |     11.01 | `ProcessTransactionBench`\r\n\r\n</details>\r\n\r\n* 2.07x faster `CheckBlockBench`\r\n* 3.4x faster `DuplicateInputs`\r\n* 1.8% faster `ProcessTransactionBench`\r\n\r\n-----\r\n\r\n<details>\r\n<summary>C++ compiler .......................... GNU 13.3.0</summary>\r\n\r\n> Before:\r\n\r\n|            ns/block |             block/s |    err% |       ins/block |       cyc/block |    IPC |      bra/block |   miss% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------------:|----------------:|-------:|---------------:|--------:|----------:|:----------\r\n|        1,096,261.84 |              912.19 |    0.1% |    7,963,390.88 |    3,487,375.26 |  2.283 |   1,266,941.00 |    1.8% |     11.03 | `CheckBlockBench`\r\n\r\n|               ns/op |                op/s |    err% |          ins/op |          cyc/op |    IPC |         bra/op |   miss% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------------:|----------------:|-------:|---------------:|--------:|----------:|:----------\r\n|        8,366,309.48 |              119.53 |    0.0% |   23,865,177.67 |   26,620,160.23 |  0.897 |   5,972,887.41 |    4.0% |     10.78 | `DuplicateInputs`\r\n|           56,199.57 |           17,793.73 |    0.1% |      229,263.01 |      178,766.31 |  1.282 |      15,509.97 |    0.5% |     10.91 | `ProcessTransactionBench`\r\n\r\n> After:\r\n\r\n|            ns/block |             block/s |    err% |       ins/block |       cyc/block |    IPC |      bra/block |   miss% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------------:|----------------:|-------:|---------------:|--------:|----------:|:----------\r\n|          834,855.94 |            1,197.81 |    0.0% |    6,518,548.86 |    2,656,039.78 |  2.454 |     919,160.84 |    1.5% |     10.78 | `CheckBlockBench`\r\n\r\n|               ns/op |                op/s |    err% |          ins/op |          cyc/op |    IPC |         bra/op |   miss% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------------:|----------------:|-------:|---------------:|--------:|----------:|:----------\r\n|        4,261,492.75 |              234.66 |    0.0% |   17,379,823.40 |   13,559,793.33 |  1.282 |   4,265,714.28 |    3.4% |     11.00 | `DuplicateInputs`\r\n|           55,819.53 |           17,914.88 |    0.1% |      227,828.15 |      177,520.09 |  1.283 |      15,184.36 |    0.4% |     10.91 | `ProcessTransactionBench`\r\n\r\n</details>\r\n\r\n* 31% faster `CheckBlockBench`\r\n* 2x faster `DuplicateInputs`\r\n* 0.5% faster `ProcessTransactionBench`\r\n\r\n----\r\n\r\nWhile the point of the change isn't necessarily to speed up IBD, but you can see the measurements at https://github.com/bitcoin/bitcoin/pull/31682#issuecomment-2606765689\r\n\r\n----\r\n\r\nRelated PRs: \r\n* https://github.com/bitcoin/bitcoin/pull/14397 - very similar solution, I only found it after pushing the PR (was closed for inactivity)\r\n* https://github.com/bitcoin/bitcoin/pull/14837 - a faster, but a lot more complex alternative (was closed for complexity and inactivity).",
      "state": "open",
      "user": "l0rinc",
      "created_at": "2025-01-18T15:03:56Z",
      "updated_at": "2026-01-14T23:25:02Z",
      "comments": 26,
      "url": "https://github.com/bitcoin/bitcoin/pull/31682",
      "labels": [
        "Validation",
        "Needs rebase"
      ]
    },
    {
      "number": 31680,
      "title": "Delete .github/workflows directory",
      "body": "<!--\r\n*** Please remove the following help text before submitting: ***\r\n\r\nPull requests without a rationale and clear improvement may be closed\r\nimmediately.\r\n\r\nGUI-related pull requests should be opened against\r\nhttps://github.com/bitcoin-core/gui\r\nfirst. See CONTRIBUTING.md\r\n-->\r\n\r\n<!--\r\nPlease provide clear motivation for your patch and explain how it improves\r\nBitcoin Core user experience or Bitcoin Core developer experience\r\nsignificantly:\r\n\r\n* Any test improvements or new tests that improve coverage are always welcome.\r\n* All other changes should have accompanying unit tests (see `src/test/`) or\r\n  functional tests (see `test/`). Contributors should note which tests cover\r\n  modified code. If no tests exist for a region of modified code, new tests\r\n  should accompany the change.\r\n* Bug fixes are most welcome when they come with steps to reproduce or an\r\n  explanation of the potential issue as well as reasoning for the way the bug\r\n  was fixed.\r\n* Features are welcome, but might be rejected due to design or scope issues.\r\n  If a feature is based on a lot of dependencies, contributors should first\r\n  consider building the system outside of Bitcoin Core, if possible.\r\n* Refactoring changes are only accepted if they are required for a feature or\r\n  bug fix or otherwise improve developer experience significantly. For example,\r\n  most \"code style\" refactoring changes require a thorough explanation why they\r\n  are useful, what downsides they have and why they *significantly* improve\r\n  developer experience or avoid serious programming bugs. Note that code style\r\n  is often a subjective matter. Unless they are explicitly mentioned to be\r\n  preferred in the [developer notes](/doc/developer-notes.md), stylistic code\r\n  changes are usually rejected.\r\n-->\r\n\r\n<!--\r\nBitcoin Core has a thorough review process and even the most trivial change\r\nneeds to pass a lot of eyes and requires non-zero or even substantial time\r\neffort to review. There is a huge lack of active reviewers on the project, so\r\npatches often sit for a long time.\r\n-->\r\n",
      "state": "closed",
      "user": "Ali-pixcell",
      "created_at": "2025-01-18T07:47:36Z",
      "updated_at": "2025-01-18T08:17:44Z",
      "comments": 1,
      "url": "https://github.com/bitcoin/bitcoin/pull/31680",
      "labels": [],
      "comment_list": [
        {
          "user": "DrahtBot",
          "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/31680.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\nA summary of reviews will appear here.\n",
          "created_at": "2025-01-18T07:47:39Z"
        }
      ]
    }
  ],
  "issues": [
    {
      "number": 31684,
      "title": "`generateblock` RPC Not Collecting Transaction Fees",
      "body": "### Is there an existing issue for this?\n\n- [x] I have searched the existing issues\n\n### Current behaviour\n\nThe `generateblock` RPC does not properly collect transaction fees when creating a block. Instead of including the fees in the block reward, the block is created with only the block subsidy, leaving out the fees from transactions included in the block.\n\n### Expected behaviour\n\nThe block reward should include both the block subsidy and the transaction fees from all transactions included in the block.\n\n### Steps to reproduce\n\n1. Start a Bitcoin Core node in regtest mode.\n2. Generate 101 blocks to fund a wallet.\n3. Create a transaction with a fee.\n4. Call the `generateblock` RPC with the transaction above.\n5. Inspect the resulting block to confirm that the block reward does not include the fee.\n\n### Relevant log output\n\n```\n$ bitcoin-cli -regtest getblock 05fe640f818d46b9ba931d8f4179562a0d042008abe4b9ed98072d0bca449f30 2`\n```\n```json\n{\n  \"hash\": \"05fe640f818d46b9ba931d8f4179562a0d042008abe4b9ed98072d0bca449f30\",\n  \"confirmations\": 1,\n  \"height\": 102,\n  \"version\": 536870912,\n  \"versionHex\": \"20000000\",\n  \"merkleroot\": \"ac0b08a969181b07d5d08a1dedce2aeeea2d30f050b837cd4a90b73846875ecc\",\n  \"time\": 1737237217,\n  \"mediantime\": 1737237198,\n  \"nonce\": 5,\n  \"bits\": \"207fffff\",\n  \"difficulty\": 4.656542373906925e-10,\n  \"chainwork\": \"00000000000000000000000000000000000000000000000000000000000000ce\",\n  \"nTx\": 2,\n  \"previousblockhash\": \"38a851e21e26dc54159198e8eda06c0fb94debb1316dd504b74bb5114f9273fe\",\n  \"strippedsize\": 295,\n  \"size\": 440,\n  \"weight\": 1325,\n  \"tx\": [\n    {\n      \"txid\": \"065d28a4a15b90fc052b613e5db7540f1e5164159ca17fe88f27cfdb857c811d\",\n      \"hash\": \"ad545fbff90d4ddf126dc835bec6f50fc51a7e72c6b6c9f16bf240e464d68810\",\n      \"version\": 2,\n      \"size\": 168,\n      \"vsize\": 141,\n      \"weight\": 564,\n      \"locktime\": 0,\n      \"vin\": [\n        {\n          \"coinbase\": \"016600\",\n          \"txinwitness\": [\n            \"0000000000000000000000000000000000000000000000000000000000000000\"\n          ],\n          \"sequence\": 4294967295\n        }\n      ],\n      \"vout\": [\n        {\n          \"value\": 50.00000000,\n          \"n\": 0,\n          \"scriptPubKey\": {\n            \"asm\": \"0 a41424b6995beeaef7cbc9a4ebcf91b71793983d\",\n            \"desc\": \"addr(bcrt1q5s2zfd5et0h2aa7texjwhnu3kute8xpaqgz39r)#qxc0s854\",\n            \"hex\": \"0014a41424b6995beeaef7cbc9a4ebcf91b71793983d\",\n            \"address\": \"bcrt1q5s2zfd5et0h2aa7texjwhnu3kute8xpaqgz39r\",\n            \"type\": \"witness_v0_keyhash\"\n          }\n        },\n        {\n          \"value\": 0.00000000,\n          \"n\": 1,\n          \"scriptPubKey\": {\n            \"asm\": \"OP_RETURN aa21a9ed3dde4089261cfff17418209ef46ed64df4d49543df0daeafc6fc41ce09766229\",\n            \"desc\": \"raw(6a24aa21a9ed3dde4089261cfff17418209ef46ed64df4d49543df0daeafc6fc41ce09766229)#hu88gsq4\",\n            \"hex\": \"6a24aa21a9ed3dde4089261cfff17418209ef46ed64df4d49543df0daeafc6fc41ce09766229\",\n            \"type\": \"nulldata\"\n          }\n        }\n      ],\n      \"hex\": \"020000000001010000000000000000000000000000000000000000000000000000000000000000ffffffff03016600ffffffff0200f2052a01000000160014a41424b6995beeaef7cbc9a4ebcf91b71793983d0000000000000000266a24aa21a9ed3dde4089261cfff17418209ef46ed64df4d49543df0daeafc6fc41ce097662290120000000000000000000000000000000000000000000000000000000000000000000000000\"\n    },\n    {\n      \"txid\": \"f66ffdec54562ec07aac05c2c25d91937a0059ffebf802705be31f59be76f3e9\",\n      \"hash\": \"567df936509935ee19841e9b717668cb6d419eeaba41f9c05ab0351a56c3293f\",\n      \"version\": 2,\n      \"size\": 191,\n      \"vsize\": 110,\n      \"weight\": 437,\n      \"locktime\": 0,\n      \"vin\": [\n        {\n          \"txid\": \"f5dc14e8b10b94b038ce9d6a789a12e3428e5acfd07de7ea461762f6c23f267e\",\n          \"vout\": 0,\n          \"scriptSig\": {\n            \"asm\": \"\",\n            \"hex\": \"\"\n          },\n          \"txinwitness\": [\n            \"304402206b532fdf2ca4111872a8c8c322ab68e21e079253862c3c95cf86d18efcdb143d022039514e377cbac97c3ec1459aec7c9584a56c1c527588600c0435483c7b96535c01\",\n            \"03fc3c5d0caa493055f57d5f3098b42555543a5219519ab90a22b20ddea49f1515\"\n          ],\n          \"sequence\": 4294967293\n        }\n      ],\n      \"vout\": [\n        {\n          \"value\": 39.99998900,\n          \"n\": 0,\n          \"scriptPubKey\": {\n            \"asm\": \"0 a41424b6995beeaef7cbc9a4ebcf91b71793983d\",\n            \"desc\": \"addr(bcrt1q5s2zfd5et0h2aa7texjwhnu3kute8xpaqgz39r)#qxc0s854\",\n            \"hex\": \"0014a41424b6995beeaef7cbc9a4ebcf91b71793983d\",\n            \"address\": \"bcrt1q5s2zfd5et0h2aa7texjwhnu3kute8xpaqgz39r\",\n            \"type\": \"witness_v0_keyhash\"\n          }\n        }\n      ],\n      \"fee\": 10.00001100,\n      \"hex\": \"020000000001017e263fc2f6621746eae77dd0cf5a8e42e3129a786a9dce38b0940bb1e814dcf50000000000fdffffff01b4236bee00000000160014a41424b6995beeaef7cbc9a4ebcf91b71793983d0247304402206b532fdf2ca4111872a8c8c322ab68e21e079253862c3c95cf86d18efcdb143d022039514e377cbac97c3ec1459aec7c9584a56c1c527588600c0435483c7b96535c012103fc3c5d0caa493055f57d5f3098b42555543a5219519ab90a22b20ddea49f151500000000\"\n    }\n  ]\n}\n```\n\n### How did you obtain Bitcoin Core\n\nCompiled from source\n\n### What version of Bitcoin Core are you using?\n\nBitcoin Core daemon version v28.99.0-ae69fc37e4ff\n\n### Operating system and version\n\nUbuntu 24.04.1 LTS\n\n### Machine specifications\n\n_No response_",
      "state": "open",
      "user": "vforvilela",
      "created_at": "2025-01-18T22:08:18Z",
      "updated_at": "2025-09-25T17:23:57Z",
      "comments": 3,
      "url": "https://github.com/bitcoin/bitcoin/issues/31684",
      "labels": [
        "Docs",
        "Tests"
      ],
      "comment_list": [
        {
          "user": "maflcko",
          "body": "> The block reward should include both the block subsidy and the transaction fees from all transactions included in the block.\n\nIs there a use case for this? `generateblock` is a test-only RPC, so there is no need to write extra code to collect the fees. Note that the other `generate*` calls will collect the fees.",
          "created_at": "2025-01-20T07:31:01Z"
        },
        {
          "user": "maflcko",
          "body": "Maybe the doc could be updated to say \"Transaction fees are not collected in the block reward\" to clarify that this is the intentional behavior for now?",
          "created_at": "2025-01-23T08:21:56Z"
        },
        {
          "user": "polespinasa",
          "body": "I think you might want to take a look to #32468, it partially solves this atm.\nAt the moment it only collects fees when the mempool option is used and not when a set of txs is provided manually, but it's a start :)",
          "created_at": "2025-09-25T17:23:27Z"
        }
      ]
    },
    {
      "number": 31683,
      "title": ".",
      "body": "",
      "state": "closed",
      "user": "WTRADEEA",
      "created_at": "2025-01-18T21:09:50Z",
      "updated_at": "2025-01-18T21:48:15Z",
      "comments": 0,
      "url": "https://github.com/bitcoin/bitcoin/issues/31683",
      "labels": []
    }
  ],
  "summary": {
    "pull_requests": 2,
    "issues": 2
  }
}