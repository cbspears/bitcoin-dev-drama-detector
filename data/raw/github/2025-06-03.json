{
  "source": "github",
  "repository": "bitcoin/bitcoin",
  "fetched_at": "2026-01-15T19:47:46.039444+00:00",
  "date": "2025-06-03",
  "pull_requests": [
    {
      "number": 32677,
      "title": "test: headers sync timeout",
      "body": "When reviewing PR #32051 and considering which functional tests might need to be adapted/extended accordingly, I noticed there appears to be limited functional test coverage for header sync timeouts and thought it might be helpful to add one.\r\n\r\nThis test attempts to cover two scenarios:\r\n\r\n1. **Normal peer timeout behavior:** When a peer fails to respond to initial getheaders requests within the timeout period, it should be disconnected and the node should attempt to sync headers from the next available peer.\r\n\r\n2. **Noban peer behavior:** When a peer with noban privileges times out, it should remain connected while the node still attempts to sync headers from other peers.\r\n",
      "state": "closed",
      "user": "stringintech",
      "created_at": "2025-06-03T18:50:04Z",
      "updated_at": "2025-08-04T21:45:51Z",
      "comments": 11,
      "url": "https://github.com/bitcoin/bitcoin/pull/32677",
      "labels": [
        "Tests"
      ],
      "comment_list": [
        {
          "user": "DrahtBot",
          "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/32677.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| ACK | [stratospher](https://github.com/bitcoin/bitcoin/pull/32677#pullrequestreview-3018395027), [maflcko](https://github.com/bitcoin/bitcoin/pull/32677#issuecomment-3072510986) |\n| Concept ACK | [yuvicc](https://github.com/bitcoin/bitcoin/pull/32677#issuecomment-2948079431), [Prabhat1308](https://github.com/bitcoin/bitcoin/pull/32677#pullrequestreview-2935249487) |\n| Stale ACK | [mzumsande](https://github.com/bitcoin/bitcoin/pull/32677#pullrequestreview-2954748917) |\n\nIf your review is incorrectly listed, please react with üëé to this comment and the bot will ignore it on the next update.\n<!--5faf32d7da4f0f540f40219e4f7537a3-->",
          "created_at": "2025-06-03T18:50:07Z"
        },
        {
          "user": "yuvicc",
          "body": "Concept ACK\r\n\r\nGreat observation and thanks for adding. I was thinking if we could add this timeout test in [`p2p_initial_headers_sync.py`](https://github.com/bitcoin/bitcoin/blob/master/test/functional/p2p_initial_headers_sync.py) instead of creating another one. ",
          "created_at": "2025-06-06T04:53:16Z"
        },
        {
          "user": "stringintech",
          "body": "> I was thinking if we could add this timeout test in [`p2p_initial_headers_sync.py`](https://github.com/bitcoin/bitcoin/blob/master/test/functional/p2p_initial_headers_sync.py) instead of creating another one.\r\n\r\n@yuvicc Actually, I did not consider that. However, now that I am thinking about it, the two sub-tests in the new test file share some context that is not used by the test file you mentioned. So, I think it is cleaner to keep them separate, especially if it will be extended to test the addnode peers as well (like [here](https://github.com/stringintech/bitcoin/commit/02f4bec94db6db81b2885646312219ddabf82270#diff-8ba81fc6003c09eec6425cd72ae7384e982dde0a7a5ca12a9a9349a41879df95)). But I will be thinking more about it while waiting for other feedback.",
          "created_at": "2025-06-07T19:28:54Z"
        },
        {
          "user": "stringintech",
          "body": "16a62fa to bff80f5 - Addressed feedback by @mzumsande and @yuvicc; Thanks!",
          "created_at": "2025-06-11T21:45:54Z"
        },
        {
          "user": "stringintech",
          "body": "Drafted to address the issue explained [here](https://github.com/bitcoin/bitcoin/pull/32677#discussion_r2153287651) and the new comments.",
          "created_at": "2025-06-18T09:48:09Z"
        },
        {
          "user": "stringintech",
          "body": "[bff80f5](https://github.com/bitcoin/bitcoin/commit/bff80f59bd8f4d7176f70eab6ad7086ca869a120) to [8d257ed](https://github.com/bitcoin/bitcoin/commit/8d257ed5937a47e1a60b7fe085f2e984eb60a956) - Addressed formatting comments and reverted to original approach of using the genesis block time as best header time for timeout calculation (as discussed in [this](https://github.com/bitcoin/bitcoin/pull/32677#discussion_r2134916035) conversation).",
          "created_at": "2025-06-23T17:44:07Z"
        },
        {
          "user": "stringintech",
          "body": "[8d257ed](https://github.com/bitcoin/bitcoin/commit/8d257ed5937a47e1a60b7fe085f2e984eb60a956) to [1154618](https://github.com/bitcoin/bitcoin/commit/11546183c70def6c0aa539642fd1c9ada3d46840) ([compare](https://github.com/bitcoin/bitcoin/compare/8d257ed5937a47e1a60b7fe085f2e984eb60a956..11546183c70def6c0aa539642fd1c9ada3d46840)) - Addresses review comments from @maflcko and @l0rinc. Thanks!",
          "created_at": "2025-06-27T15:11:41Z"
        },
        {
          "user": "maflcko",
          "body": "re-ACK 11546183c70def6c0aa539642fd1c9ada3d46840 üóª\r\n\r\n<details><summary>Show signature</summary>\r\n\r\nSignature:\r\n\r\n```\r\nuntrusted comment: signature from minisign secret key on empty file; verify via: minisign -Vm \"${path_to_any_empty_file}\" -P RWTRmVTMeKV5noAMqVlsMugDDCyyTSbA3Re5AkUrhvLVln0tSaFWglOw -x \"${path_to_this_whole_four_line_signature_blob}\"\r\nRUTRmVTMeKV5npGrKx1nqXCw5zeVHdtdYURB/KlyA/LMFgpNCs+SkW9a8N95d+U4AP1RJMi+krxU1A3Yux4bpwZNLvVBKy0wLgM=\r\ntrusted comment: re-ACK 11546183c70def6c0aa539642fd1c9ada3d46840 üóª\r\nmqU5RZJ+SCn2jP2WG28PjthiMcefRUfGQhbyBaqFzcGSJGzjbCeWMsdkfKxExydD2QhCuNnvvHPlzBI4hcfHCA==\r\n```\r\n\r\n</details>\r\n",
          "created_at": "2025-07-14T10:16:25Z"
        },
        {
          "user": "stringintech",
          "body": "[1154618](https://github.com/bitcoin/bitcoin/commit/11546183c70def6c0aa539642fd1c9ada3d46840) to [61e800e](https://github.com/bitcoin/bitcoin/commit/61e800e75cffa256ccdbc2ffc7a1739c00880ce0) - Applied [suggestion](https://github.com/bitcoin/bitcoin/pull/32677#discussion_r2204080826) by @stratospher to move helper methods before their respective subtest. Thanks!",
          "created_at": "2025-07-14T14:23:17Z"
        },
        {
          "user": "maflcko",
          "body": "re-ACK 61e800e75cffa256ccdbc2ffc7a1739c00880ce0 üóù\r\n\r\n<details><summary>Show signature</summary>\r\n\r\nSignature:\r\n\r\n```\r\nuntrusted comment: signature from minisign secret key on empty file; verify via: minisign -Vm \"${path_to_any_empty_file}\" -P RWTRmVTMeKV5noAMqVlsMugDDCyyTSbA3Re5AkUrhvLVln0tSaFWglOw -x \"${path_to_this_whole_four_line_signature_blob}\"\r\nRUTRmVTMeKV5npGrKx1nqXCw5zeVHdtdYURB/KlyA/LMFgpNCs+SkW9a8N95d+U4AP1RJMi+krxU1A3Yux4bpwZNLvVBKy0wLgM=\r\ntrusted comment: re-ACK 61e800e75cffa256ccdbc2ffc7a1739c00880ce0 üóù\r\nXhUGX4l4l2w6MYNlOvNRVgYeftSBi08ZqM3A4eRybDzwtcBh2wPhgBSfIAMcPCLAmOwRbbJywtNLWPRazKx6CA==\r\n```\r\n\r\n</details>\r\n",
          "created_at": "2025-07-15T07:54:42Z"
        },
        {
          "user": "jonatack",
          "body": "Post-merge ACK, thanks @stringintech!",
          "created_at": "2025-08-04T21:45:51Z"
        }
      ]
    },
    {
      "number": 32676,
      "title": "test: apply microsecond precision to test framework logging",
      "body": "When analyzing functional test logs (produced with `combine_logs.py`), entries sometimes sort slightly out of order because even though python prints 6 digits for microsecond precision, it fills up the last 3 digits with zeroes. For example, it may look like a message was received by the test framework before it was sent by the node.\r\n\r\nChange this to actually use microsecond precision - this should make combined logs a little bit easier to analyze.\r\n\r\n",
      "state": "closed",
      "user": "mzumsande",
      "created_at": "2025-06-03T17:53:49Z",
      "updated_at": "2025-06-05T01:48:46Z",
      "comments": 4,
      "url": "https://github.com/bitcoin/bitcoin/pull/32676",
      "labels": [
        "Tests"
      ],
      "comment_list": [
        {
          "user": "DrahtBot",
          "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/32676.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| ACK | [maflcko](https://github.com/bitcoin/bitcoin/pull/32676#pullrequestreview-2893719748), [janb84](https://github.com/bitcoin/bitcoin/pull/32676#pullrequestreview-2897953035), [davidgumberg](https://github.com/bitcoin/bitcoin/pull/32676#issuecomment-2937200960), [achow101](https://github.com/bitcoin/bitcoin/pull/32676#issuecomment-2941703254) |\n\nIf your review is incorrectly listed, please react with üëé to this comment and the bot will ignore it on the next update.\n<!--5faf32d7da4f0f540f40219e4f7537a3-->",
          "created_at": "2025-06-03T17:53:55Z"
        },
        {
          "user": "DrahtBot",
          "body": "<!--85328a0da195eb286784d51f73fa0af9-->\nüöß At least one of the CI tasks failed.\n<sub>Task `lint`: https://github.com/bitcoin/bitcoin/runs/43407398087</sub>\n<sub>LLM reason (‚ú® experimental): The CI failure is caused by a failed lint check due to a dead code warning in Python code.</sub>\n\n<details><summary>Hints</summary>\n\nTry to run the tests locally, according to the documentation. However, a CI failure may still\nhappen due to a number of reasons, for example:\n\n* Possibly due to a silent merge conflict (the changes in this pull request being\nincompatible with the current code in the target branch). If so, make sure to rebase on the latest\ncommit of the target branch.\n\n* A sanitizer issue, which can only be found by compiling with the sanitizer and running the\n  affected test.\n\n* An intermittent issue.\n\nLeave a comment here, if you need help tracking down a confusing failure.\n\n</details>\n\n",
          "created_at": "2025-06-03T18:02:43Z"
        },
        {
          "user": "davidgumberg",
          "body": "Tested ACK https://github.com/bitcoin/bitcoin/pull/32676/commits/ed179e0a6528c39b3bca76365f256716f917e19b\r\n\r\nAdded an `assert(0)` to `feature_abortnode.py` and on this branch, microsecond times are printed, on master (5471e29d057049d2b5a) they are not.\r\n\r\nDidn't try to reproduce the described situation in the PR of out-of-order logs, but it makes sense that the existing behavior would result in nonsensical ordering of logs any time you have sub-ms events, and I can recall having run into this before.\r\n\r\n\r\n<details>\r\n\r\n<summary>\r\n\r\n### Test logs\r\n\r\n</summary> \r\n\r\n```diff\r\ndiff --git a/test/functional/feature_abortnode.py b/test/functional/feature_abortnode.py\r\nindex a5c8aa163a..8abe487b9e 100755\r\n--- a/test/functional/feature_abortnode.py\r\n+++ b/test/functional/feature_abortnode.py\r\n@@ -37,6 +37,7 @@ class AbortNodeTest(BitcoinTestFramework):\r\n             # Check that node0 aborted\r\n             self.log.info(\"Waiting for crash\")\r\n             self.nodes[0].wait_until_stopped(timeout=5, expect_error=True, expected_stderr=\"Error: A fatal internal error occurred, see debug.log for details: Failed to disconnect block.\")\r\n+        assert(0)\r\n         self.log.info(\"Node crashed - now verifying restart fails\")\r\n         self.nodes[0].assert_start_raises_init_error()\r\n```\r\n\r\n\r\n#### #32676 (https://github.com/bitcoin/bitcoin/pull/32676/commits/ed179e0a6528c39b3bca76365f256716f917e19b)\r\n\r\n```console\r\n$ git checkout --detach ed179e0\r\n$ ./build/test/functional/feature_abortnode.py\r\n2025-06-03T20:52:18.520787Z TestFramework (INFO): PRNG seed is: 5653719685663637249\r\n2025-06-03T20:52:18.521155Z TestFramework (INFO): Initializing test directory /tmp/bitcoin_func_test_q_44vhww\r\n2025-06-03T20:52:18.885450Z TestFramework (INFO): Waiting for crash\r\n2025-06-03T20:52:19.036796Z TestFramework (ERROR): Assertion failed\r\nTraceback (most recent call last):\r\n  File \"/bitcoin/test/functional/test_framework/test_framework.py\", line 190, in main\r\n    self.run_test()\r\n    ~~~~~~~~~~~~~^^\r\n  File \"/bitcoin./build/test/functional/feature_abortnode.py\", line 40, in run_test\r\n    assert(0)\r\n           ^\r\nAssertionError\r\n2025-06-03T20:52:19.088096Z TestFramework (INFO): Not stopping nodes as test failed. The dangling processes will be cleaned up later.\r\n2025-06-03T20:52:19.088240Z TestFramework (WARNING): Not cleaning up dir /tmp/bitcoin_func_test_q_44vhww\r\n2025-06-03T20:52:19.088274Z TestFramework (ERROR): Test failed. Test logging available at /tmp/bitcoin_func_test_q_44vhww/test_framework.log\r\n2025-06-03T20:52:19.088372Z TestFramework (ERROR):\r\n2025-06-03T20:52:19.088455Z TestFramework (ERROR): Hint: Call /bitcoin/test/functional/combine_logs.py '/tmp/bitcoin_func_test_q_44vhww' to consolidate all logs\r\n2025-06-03T20:52:19.088480Z TestFramework (ERROR):\r\n2025-06-03T20:52:19.088499Z TestFramework (ERROR): If this failure happened unexpectedly or intermittently, please file a bug and provide a link or upload of the combined log.\r\n2025-06-03T20:52:19.088536Z TestFramework (ERROR): https://github.com/bitcoin/bitcoin/issues\r\n2025-06-03T20:52:19.088554Z TestFramework (ERROR):\r\n```\r\n\r\n#### master (https://github.com/bitcoin/bitcoin/commit/5471e29d057049d2b5ab8447d8752cce3393086d)\r\n\r\n```console\r\n$ git checkout --detach 5471e2\r\n$ ./build/test/functional/feature_abortnode.py\r\n2025-06-03T21:00:11.760000Z TestFramework (INFO): PRNG seed is: 6770717479175070298\r\n2025-06-03T21:00:11.760000Z TestFramework (INFO): Initializing test directory /tmp/bitcoin_func_test_z_r_1o2o\r\n2025-06-03T21:00:12.124000Z TestFramework (INFO): Waiting for crash\r\n2025-06-03T21:00:12.276000Z TestFramework (ERROR): Assertion failed\r\nTraceback (most recent call last):\r\n  File \"/bitcoin/test/functional/test_framework/test_framework.py\", line 189, in main\r\n    self.run_test()\r\n    ~~~~~~~~~~~~~^^\r\n  File \"/bitcoin/./build/test/functional/feature_abortnode.py\", line 40, in run_test\r\n    assert(0)\r\n           ^\r\nAssertionError\r\n2025-06-03T21:00:12.327000Z TestFramework (INFO): Not stopping nodes as test failed. The dangling processes will be cleaned up later.\r\n2025-06-03T21:00:12.327000Z TestFramework (WARNING): Not cleaning up dir /tmp/bitcoin_func_test_z_r_1o2o\r\n2025-06-03T21:00:12.327000Z TestFramework (ERROR): Test failed. Test logging available at /tmp/bitcoin_func_test_z_r_1o2o/test_framework.log\r\n2025-06-03T21:00:12.327000Z TestFramework (ERROR):\r\n2025-06-03T21:00:12.327000Z TestFramework (ERROR): Hint: Call /bitcoin/test/functional/combine_logs.py '/tmp/bitcoin_func_test_z_r_1o2o' to consolidate all logs\r\n2025-06-03T21:00:12.327000Z TestFramework (ERROR):\r\n2025-06-03T21:00:12.327000Z TestFramework (ERROR): If this failure happened unexpectedly or intermittently, please file a bug and provide a link or upload of the combined log.\r\n2025-06-03T21:00:12.327000Z TestFramework (ERROR): https://github.com/bitcoin/bitcoin/issues\r\n2025-06-03T21:00:12.327000Z TestFramework (ERROR):",
          "created_at": "2025-06-03T21:04:45Z"
        },
        {
          "user": "achow101",
          "body": "ACK ed179e0a6528c39b3bca76365f256716f917e19b",
          "created_at": "2025-06-04T22:04:31Z"
        }
      ]
    },
    {
      "number": 32675,
      "title": "test: wallet: cover wallet passphrase with a null char",
      "body": "This PR adds test coverage for the `walletpassphrase`/`walletpassphrasechange` RPC when the passphrase is incorrect due to a null character. \r\n\r\nFor reference: https://github.com/bitcoin/bitcoin/pull/27068 introduced the usage of `SecureString` to allow null characters.",
      "state": "closed",
      "user": "brunoerg",
      "created_at": "2025-06-03T17:17:37Z",
      "updated_at": "2025-06-06T22:12:26Z",
      "comments": 4,
      "url": "https://github.com/bitcoin/bitcoin/pull/32675",
      "labels": [
        "Tests"
      ],
      "comment_list": [
        {
          "user": "DrahtBot",
          "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/32675.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| ACK | [maflcko](https://github.com/bitcoin/bitcoin/pull/32675#issuecomment-2939987081), [w0xlt](https://github.com/bitcoin/bitcoin/pull/32675#pullrequestreview-2898357025), [BrandonOdiwuor](https://github.com/bitcoin/bitcoin/pull/32675#pullrequestreview-2899781298), [theStack](https://github.com/bitcoin/bitcoin/pull/32675#pullrequestreview-2900231176), [pablomartin4btc](https://github.com/bitcoin/bitcoin/pull/32675#pullrequestreview-2900967011), [achow101](https://github.com/bitcoin/bitcoin/pull/32675#issuecomment-2950920751) |\n\nIf your review is incorrectly listed, please react with üëé to this comment and the bot will ignore it on the next update.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#32290](https://github.com/bitcoin/bitcoin/pull/32290) (test: allow all functional tests to be run or skipped with --usecli by mzumsande)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n<!--5faf32d7da4f0f540f40219e4f7537a3-->",
          "created_at": "2025-06-03T17:17:40Z"
        },
        {
          "user": "brunoerg",
          "body": "3b90060a2df2b65369117f3ee8afe26be631867d..7cfbb8575e1ffbad5c48e2c461b45dd6ac63d064 address https://github.com/bitcoin/bitcoin/pull/32675#discussion_r2124757170",
          "created_at": "2025-06-04T13:08:31Z"
        },
        {
          "user": "maflcko",
          "body": "lgtm ACK 7cfbb8575e1ffbad5c48e2c461b45dd6ac63d064",
          "created_at": "2025-06-04T13:11:07Z"
        },
        {
          "user": "achow101",
          "body": "ACK 7cfbb8575e1ffbad5c48e2c461b45dd6ac63d064",
          "created_at": "2025-06-06T22:05:04Z"
        }
      ]
    },
    {
      "number": 32673,
      "title": "clang-tidy: Apply modernize-deprecated-headers",
      "body": "Bitcoin Core is written in C++, so it is confusing to sometimes use the deprecated C headers (with the `.h` extension). For example, it is less clear whether `string.h` refers to the file in this repo or the cstring stdlib header (https://github.com/bitcoin/bitcoin/pull/31308#discussion_r2121492797).\r\n\r\nThe check is currently disabled for headers, to exclude subtree headers.",
      "state": "closed",
      "user": "maflcko",
      "created_at": "2025-06-03T13:23:34Z",
      "updated_at": "2025-06-12T06:27:52Z",
      "comments": 3,
      "url": "https://github.com/bitcoin/bitcoin/pull/32673",
      "labels": [],
      "comment_list": [
        {
          "user": "DrahtBot",
          "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/32673.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| ACK | [l0rinc](https://github.com/bitcoin/bitcoin/pull/32673#issuecomment-2939069298), [janb84](https://github.com/bitcoin/bitcoin/pull/32673#pullrequestreview-2898033481), [stickies-v](https://github.com/bitcoin/bitcoin/pull/32673#pullrequestreview-2917849118), [achow101](https://github.com/bitcoin/bitcoin/pull/32673#issuecomment-2964395932) |\n\nIf your review is incorrectly listed, please react with üëé to this comment and the bot will ignore it on the next update.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#32729](https://github.com/bitcoin/bitcoin/pull/32729) (test,refactor: extract script template helpers & widen sigop count coverage by l0rinc)\n* [#32317](https://github.com/bitcoin/bitcoin/pull/32317) (kernel: Separate UTXO set access from validation functions by TheCharlatan)\n* [#31308](https://github.com/bitcoin/bitcoin/pull/31308) (ci, iwyu: Treat warnings as errors for specific directories by hebasto)\n* [#29770](https://github.com/bitcoin/bitcoin/pull/29770) (index: Check all necessary block data is available before starting to sync by fjahr)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n<!--5faf32d7da4f0f540f40219e4f7537a3-->",
          "created_at": "2025-06-03T13:23:38Z"
        },
        {
          "user": "l0rinc",
          "body": "ACK fa9ca13f35be0a023aeed78775ad66f95717b28b\r\n\r\nThe new commit is only moving includes (not deleting any) and changing one remaining copyright header.",
          "created_at": "2025-06-04T08:16:40Z"
        },
        {
          "user": "achow101",
          "body": "ACK fa9ca13f35be0a023aeed78775ad66f95717b28b",
          "created_at": "2025-06-11T21:56:59Z"
        }
      ]
    },
    {
      "number": 32672,
      "title": "ci: update pwsh to use custom shell that fails-fast",
      "body": "Github by default sets [fail fast](https://docs.github.com/en/actions/writing-workflows/workflow-syntax-for-github-actions#exit-codes-and-error-action-preference) behaviour on pswh shell which means that if any powershell cmdlet fails the script will stop and exit. The problem is that this behaviour doesn't apply when calling native executables, it only applies to powershell cmdlets.\r\n\r\nI think the safest thing is to whenever we use pwsh to enable `$PSNativeCommandUseErrorActionPreference = $true` which will also fail calling any exe that returns a non-zero exit code.\r\n\r\nTechnically the step `Adjust paths in test/config.ini` only uses cmdlets so this step will not benefit from this change but I feel like it's good practice to still enable this feature in case this script gets modified in the future to call an exe.\r\n\r\nHere is a CI run that has a script that fails silently (look at Windows Native, VS 2022 -> Get tool information): https://github.com/m3dwards/bitcoin/actions/runs/15415032095/job/43375709475\r\nAnd with this change applied, the script correctly fails: https://github.com/m3dwards/bitcoin/actions/runs/15416585565/job/43380685364",
      "state": "open",
      "user": "m3dwards",
      "created_at": "2025-06-03T12:03:44Z",
      "updated_at": "2025-10-22T15:27:18Z",
      "comments": 10,
      "url": "https://github.com/bitcoin/bitcoin/pull/32672",
      "labels": [
        "Windows",
        "Tests",
        "Needs rebase"
      ],
      "comment_list": [
        {
          "user": "DrahtBot",
          "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/32672.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| Concept ACK | [hodlinator](https://github.com/bitcoin/bitcoin/pull/32672#issuecomment-3027942199), [hebasto](https://github.com/bitcoin/bitcoin/pull/32672#issuecomment-3031898351) |\n| User requested bot ignore | [fanquake](https://github.com/bitcoin/bitcoin/pull/32672#issuecomment-3027913283) |\n\nIf your review is incorrectly listed, please react with üëé to this comment and the bot will ignore it on the next update.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#33562](https://github.com/bitcoin/bitcoin/pull/33562) (DRAFT: add a freebsd job using systemlibs by willcl-ark)\n* [#32513](https://github.com/bitcoin/bitcoin/pull/32513) (ci: remove 3rd party js from windows dll gha job by m3dwards)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n<!--5faf32d7da4f0f540f40219e4f7537a3-->",
          "created_at": "2025-06-03T12:03:47Z"
        },
        {
          "user": "fanquake",
          "body": "cc @hebasto @hodlinator @davidgumberg  for Concept ACK / NACK.",
          "created_at": "2025-07-02T13:34:26Z"
        },
        {
          "user": "hodlinator",
          "body": "Concept ACK (but my PowerShell skill is 0).\r\n\r\n@fanquake you are currently registered as a N-A-C-K.",
          "created_at": "2025-07-02T13:43:34Z"
        },
        {
          "user": "hebasto",
          "body": "Concept ACK.\r\n\r\nDefining a new custom `job.defaults.run.shell` for all Windows jobs allows us to revert f8619196ceb5c6a58125506d276d9515837f043a and use the same shell across all steps. This is especially convenient for reproducing failures locally.",
          "created_at": "2025-07-03T11:19:35Z"
        },
        {
          "user": "m3dwards",
          "body": "> 1. The output in the \"Get tool information\" step has changed:\r\n\r\nI just added this as a nice to have but happy to remove.\r\n\r\n> 2\\. The exit code is not propagated to the action's status.\r\n\r\nUnfortunately I think this is just how it works. When there is a failure it will always use code 1. Without having to write code that checks error codes and returns those codes each time we call a native executable I don't think it's possible to have the same error code.\r\n",
          "created_at": "2025-07-04T08:52:59Z"
        },
        {
          "user": "maflcko",
          "body": "> This is especially convenient for reproducing failures locally.\r\n\r\nJust a general note on CI reproducibility: My recommendation would be to put as little code into vendor-specific locked-in yaml files and instead place CI code into vendor-agnostic scripts, so that they can be re-used outside of that vendor.\r\n\r\nI understand that it is nice to have the CI log split into sections, but this should also be possible with a script that allows several entry points: `./ci.py install; ./ci.py build; ./ci.py test;` (or similar)\r\n\r\nJust an unrelated general note. Anything is fine here and it is probably best to leave the decisions to the Windows devs here.",
          "created_at": "2025-07-04T09:18:01Z"
        },
        {
          "user": "m3dwards",
          "body": "After reading @maflcko's comment (which I agree with) and speaking with @hebasto offline I think it would be best that we change this to use powershell for all run steps on Windows jobs and look at condensing steps down into one or more scripts to aid in local reproducibility. As it stands, for someone to reproduce these steps locally they would have to jump between two shells. As I understand it, the change to use bash on windows was for the nicer fail fast behaviour but if we can get that in powershell now we should probably use the more native windows shell.\r\n\r\nMarking as draft for now until I rework. ",
          "created_at": "2025-07-04T09:30:22Z"
        },
        {
          "user": "maflcko",
          "body": "> As I understand it, the change to use bash on windows was for the nicer fail fast behaviour but if we can get that in powershell now we should probably use the more native windows shell.\r\n\r\nbash is also easier for non-windows devs to read and modify, so an alternative would also be python or rust as the ci runner script, but no strong opinion, I'd say anything is fine here.",
          "created_at": "2025-07-04T10:19:57Z"
        },
        {
          "user": "m3dwards",
          "body": "@hebasto is there any reason we need Powershell at all? Can we just use bash (or another language) everywhere?",
          "created_at": "2025-07-04T12:40:18Z"
        },
        {
          "user": "DrahtBot",
          "body": "<!--cf906140f33d8803c4a75a2196329ecb-->\nüêô This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n",
          "created_at": "2025-10-08T00:12:54Z"
        }
      ]
    },
    {
      "number": 32671,
      "title": ".",
      "body": "b9de2eb\r\n\r\n<!--\r\n*** Please remove the following help text before submitting: ***\r\n\r\nPull requests without a rationale and clear improvement may be closed\r\nimmediately.\r\n\r\nGUI-related pull requests should be opened against\r\nhttps://github.com/bitcoin-core/gui\r\nfirst. See CONTRIBUTING.md\r\n-->\r\n\r\n<!--\r\nPlease provide clear motivation for your patch and explain how it improves\r\nBitcoin Core user experience or Bitcoin Core developer experience\r\nsignificantly:\r\n\r\n* Any test improvements or new tests that improve coverage are always welcome.\r\n* All other changes should have accompanying unit tests (see `src/test/`) or\r\n  functional tests (see `test/`). Contributors should note which tests cover\r\n  modified code. If no tests exist for a region of modified code, new tests\r\n  should accompany the change.\r\n* Bug fixes are most welcome when they come with steps to reproduce or an\r\n  explanation of the potential issue as well as reasoning for the way the bug\r\n  was fixed.\r\n* Features are welcome, but might be rejected due to design or scope issues.\r\n  If a feature is based on a lot of dependencies, contributors should first\r\n  consider building the system outside of Bitcoin Core, if possible.\r\n* Refactoring changes are only accepted if they are required for a feature or\r\n  bug fix or otherwise improve developer experience significantly. For example,\r\n  most \"code style\" refactoring changes require a thorough explanation why they\r\n  are useful, what downsides they have and why they *significantly* improve\r\n  developer experience or avoid serious programming bugs. Note that code style\r\n  is often a subjective matter. Unless they are explicitly mentioned to be\r\n  preferred in the [developer notes](/doc/developer-notes.md), stylistic code\r\n  changes are usually rejected.\r\n-->\r\n\r\n<!--\r\nBitcoin Core has a thorough review process and even the most trivial change\r\nneeds to pass a lot of eyes and requires non-zero or even substantial time\r\neffort to review. There is a huge lack of active reviewers on the project, so\r\npatches often sit for a long time.\r\n-->\r\n",
      "state": "closed",
      "user": "Jokacar10",
      "created_at": "2025-06-03T11:25:28Z",
      "updated_at": "2025-06-05T08:29:11Z",
      "comments": 1,
      "url": "https://github.com/bitcoin/bitcoin/pull/32671",
      "labels": [],
      "comment_list": [
        {
          "user": "DrahtBot",
          "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/32671.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\nA summary of reviews will appear here.\n<!--5faf32d7da4f0f540f40219e4f7537a3-->",
          "created_at": "2025-06-03T11:25:31Z"
        }
      ]
    }
  ],
  "issues": [
    {
      "number": 32674,
      "title": "guix: nsis (Windows installer creator) is broken upstream",
      "body": "This will become a issue when we want to bump the time-machine next, and it'd be nicer if this is fixed and shipped upstream, rather than us having to work around the issue:\n\n```bash\n# guix --version\nguix (GNU Guix) 4b9d14378fcc3d8dd4eea36b541fe87e198fd7b8\n\n# guix build --no-substitutes nsis-x86_64\nSource/Plugins.cpp:278:18:   required from ‚Äòstatic void PrintPluginDirsHelper::print(const C&, const char*) [with C = std::map<std::__cxx11::basic_string<wchar_t>, std::__cxx11::basic_string<wchar_t>, STL::string_nocasecmpless<std::__cxx11::basic_string<wchar_t>, wchar_t> >]‚Äô\nSource/Plugins.cpp:287:31:   required from here\n/gnu/store/mrgjxwdy1l7s9m23bsrshdg3cb2q7nn3-gcc-cross-x86_64-w64-mingw32-14.2.0/include/c++/bits/stl_tree.h:768:15: error: non-constant condition for static assertion\n  768 |               is_invocable_v<const _Compare&, const _Key&, const _Key&>,\n      |               ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\nscons: *** [build/urelease/makensis/build.o] Error 1\nscons: *** [build/urelease/makensis/Plugins.o] Error 1\nscons: building terminated because of errors.\nerror: in phase 'build': uncaught exception:\n%exception #<&invoke-error program: \"scons\" arguments: (\"-j\" \"16\" \"UNICODE=yes\" \"SKIPUTILS=MakeLangId,Makensisw,NSIS Menu,SubStart,zip2exe\" \"SKIPDOC=COPYING\" \"STRIP_CP=no\" \"PREFIX=/gnu/store/z5ng740nbqh0s1n9i69c8wls96drdqy7-nsis-x86_64-3.10\" \"TARGET_ARCH=amd64\" \"XGCC_W32_PREFIX=x86_64-w64-mingw32-\" \"PREFIX_PLUGINAPI_INC=/gnu/store/gwcmzcwbdfcqxiv99xmr2cv9s9nz79bf-mingw-w64-x86_64-winpthreads-12.0.0/include/\" \"PREFIX_PLUGINAPI_LIB=/gnu/store/gwcmzcwbdfcqxiv99xmr2cv9s9nz79bf-mingw-w64-x86_64-winpthreads-12.0.0/lib/\" \"makensis\" \"stubs\" \"plugins\" \"utils\") exit-status: 2 term-signal: #f stop-signal: #f> \nphase `build' failed after 6.9 seconds\ncommand \"scons\" \"-j\" \"16\" \"UNICODE=yes\" \"SKIPUTILS=MakeLangId,Makensisw,NSIS Menu,SubStart,zip2exe\" \"SKIPDOC=COPYING\" \"STRIP_CP=no\" \"PREFIX=/gnu/store/z5ng740nbqh0s1n9i69c8wls96drdqy7-nsis-x86_64-3.10\" \"TARGET_ARCH=amd64\" \"XGCC_W32_PREFIX=x86_64-w64-mingw32-\" \"PREFIX_PLUGINAPI_INC=/gnu/store/gwcmzcwbdfcqxiv99xmr2cv9s9nz79bf-mingw-w64-x86_64-winpthreads-12.0.0/include/\" \"PREFIX_PLUGINAPI_LIB=/gnu/store/gwcmzcwbdfcqxiv99xmr2cv9s9nz79bf-mingw-w64-x86_64-winpthreads-12.0.0/lib/\" \"makensis\" \"stubs\" \"plugins\" \"utils\" failed with status 2\nbuild process 18 exited with status 256\nbuilder for `/gnu/store/slxnpxq0d350mbdb0iikgdqxdvr0c6c7-nsis-x86_64-3.10.drv' failed with exit code 1\nbuild of /gnu/store/slxnpxq0d350mbdb0iikgdqxdvr0c6c7-nsis-x86_64-3.10.drv failed\nView build log at '/var/log/guix/drvs/sl/xnpxq0d350mbdb0iikgdqxdvr0c6c7-nsis-x86_64-3.10.drv.gz'.\nguix build: error: build of `/gnu/store/slxnpxq0d350mbdb0iikgdqxdvr0c6c7-nsis-x86_64-3.10.drv' failed\n```\n\nSee also: https://issues.guix.gnu.org/71548. Looks like this is still broken, but differently.",
      "state": "closed",
      "user": "fanquake",
      "created_at": "2025-06-03T13:52:23Z",
      "updated_at": "2025-06-15T09:14:19Z",
      "comments": 5,
      "url": "https://github.com/bitcoin/bitcoin/issues/32674",
      "labels": [
        "Windows",
        "Build system",
        "Upstream"
      ],
      "comment_list": [
        {
          "user": "hebasto",
          "body": "Does it depend on the build machine architecture?",
          "created_at": "2025-06-03T14:07:59Z"
        },
        {
          "user": "fanquake",
          "body": "It fails building on `x86_64`, `aarch64` and with `--system=riscv64-linux`.",
          "created_at": "2025-06-03T19:37:37Z"
        },
        {
          "user": "hebasto",
          "body": "> This will become a issue when we want to bump the time-machine next...\n\nWe definitely want to bump it to resolve https://github.com/bitcoin/bitcoin/issues/30206. ",
          "created_at": "2025-06-11T16:45:52Z"
        },
        {
          "user": "hebasto",
          "body": "> This will become a issue when we want to bump the time-machine next, and it'd be nicer if this is fixed and shipped upstream, rather than us having to work around the issue...\n\nI've bisected the issue down to https://codeberg.org/guix/guix/commit/d6780d79d936832e1b2ea9103eefecd0a838fb16.",
          "created_at": "2025-06-13T07:28:43Z"
        },
        {
          "user": "hebasto",
          "body": "Fixed in https://codeberg.org/guix/guix/commit/514e7ac18a406cab6ad76efd615e2754d62ce238.",
          "created_at": "2025-06-15T09:14:13Z"
        }
      ]
    },
    {
      "number": 32669,
      "title": "upstream: capnp V2 doesn't support compilation with GCC (yet?)",
      "body": "See https://github.com/capnproto/capnproto/pull/2304, and the discussion from the maintainer. Seems like the interest in supporting GCC is pretty secondary:\n> Is there any way we can get a CI build that tests GCC support? Otherwise I'm sure it'll just bitrot again.\n\n> OK, seems fine to merge now but we can't really claim that GCC is \"supported\" until we have CI tests since it'll probably bitrot.\n\nWhen that PR lands, it looks like they will be supporting GCC 14.2 and later (relevant fix from `15.1` was backported).\n\nAssuming we are going to support / use capnp V2 at some point, it would be good if it did support GCC, if it doesn't, we'll have to bootstrap & use both Clang and GCC, for Linux builds in Guix, or patch capnp until it works with (our version of) GCC, or something else.\n\nhttps://capnproto.org/roadmap.html seems pretty outdated, as it still lists pre-1.x items, so it's not really clear when V2 is planned to happen.",
      "state": "open",
      "user": "fanquake",
      "created_at": "2025-06-03T08:58:17Z",
      "updated_at": "2025-06-03T14:19:03Z",
      "comments": 1,
      "url": "https://github.com/bitcoin/bitcoin/issues/32669",
      "labels": [
        "Upstream"
      ],
      "comment_list": [
        {
          "user": "ryanofsky",
          "body": "Thanks for finding this! I think best source of information about the v2 branch is probably https://capnproto.org/news/#whats-planned-for-20\n\nMy impression about the branch is that it's not intending to implement many significant changes, but more to be an API break and allow cleaning up some things like promise cancellations and EOF handling that they haven't been able to fix due to wanting to preserve backwards compatibility. They are also requiring C++20 and dropping support for -fno-exceptions and -fno-rtti.\n\nIt does sound like they aren't actively testing GCC (v2 announcement says \"as of this writing, GCC seems to ICE on KJ‚Äôs coroutine implementation\"), but I doubt they would make an actual release without GCC support. It looks like the objections to https://github.com/capnproto/capnproto/pull/2304 are that it adds `final` annotations too many places, and that it doesn't add GCC CI tests, and latter issue should be resolved when there is an ubuntu release with a new enough GCC.\n\nThe last capnproto [releases](https://github.com/capnproto/capnproto/tags) were 1.1.0 in December 2024 and 1.0.2 in January 2024. The v2 branch was announced in July 2023 and I expect issues with GCC will be resolved before there is a 2.0 release, but if this is not the case, I think should be ok sticking with 1.x until they are resolved, and I don't think we would be the only downstream project doing this in that situation.\n\nIn the meantime it probably would be a good idea to test the v2 branch to see if other changes in v2 break anything. I opened an issue to track that: https://github.com/bitcoin-core/libmultiprocess/issues/180",
          "created_at": "2025-06-03T14:19:01Z"
        }
      ]
    }
  ],
  "summary": {
    "pull_requests": 6,
    "issues": 2
  }
}