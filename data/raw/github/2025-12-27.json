{
  "source": "github",
  "repository": "bitcoin/bitcoin",
  "fetched_at": "2026-01-15T20:43:12.616903+00:00",
  "date": "2025-12-27",
  "pull_requests": [
    {
      "number": 34160,
      "title": "policy: Remove stale rationale paragraph",
      "body": "It belonged to the note removed in #33892",
      "state": "closed",
      "user": "flack",
      "created_at": "2025-12-27T21:34:22Z",
      "updated_at": "2025-12-29T10:54:54Z",
      "comments": 1,
      "url": "https://github.com/bitcoin/bitcoin/pull/34160",
      "labels": [
        "TX fees and policy"
      ],
      "comment_list": [
        {
          "user": "DrahtBot",
          "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/34160.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| ACK | [instagibbs](https://github.com/bitcoin/bitcoin/pull/34160#pullrequestreview-3614814844) |\n\nIf your review is incorrectly listed, please copy-paste <code>&lt;!--meta-tag:bot-skip--&gt;</code> into the comment that the bot should ignore.\n<!--5faf32d7da4f0f540f40219e4f7537a3-->",
          "created_at": "2025-12-27T21:34:29Z"
        }
      ]
    },
    {
      "number": 34158,
      "title": "torcontrol: Remove libevent usage",
      "body": "This is part of the effort to remove the libevent dependency from our code base: https://github.com/bitcoin/bitcoin/issues/31194\r\n\r\nThere is a dependency on #32061 but it only really needs one commit which is cherry-picked here in first position (add `LineReader`). I hope that a first chunk of that PR can be sliced off and reviewed independently so this PR here is not blocked by it.\r\n\r\nThe current approach tries to reuse existing code and follows roughly similar design decisions. It replaces the libevent-based async I/O with blocking I/O utilizing the existing `Sock` and `CThreadInterrupt`. The controller runs in a dedicated thread.\r\n\r\nThere are some optional code modernizations thrown in made along the way (namings, constexpr etc.). These are not strictly necessary but make the end result with the new code more consistent.",
      "state": "open",
      "user": "fjahr",
      "created_at": "2025-12-27T14:20:31Z",
      "updated_at": "2026-01-15T20:24:22Z",
      "comments": 12,
      "url": "https://github.com/bitcoin/bitcoin/pull/34158",
      "labels": [],
      "comment_list": [
        {
          "user": "DrahtBot",
          "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/34158.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| ACK | [pinheadmz](https://github.com/bitcoin/bitcoin/pull/34158#pullrequestreview-3661580911) |\n| Concept ACK | [sedited](https://github.com/bitcoin/bitcoin/pull/34158#issuecomment-3694015450), [pablomartin4btc](https://github.com/bitcoin/bitcoin/pull/34158#issuecomment-3694074809), [janb84](https://github.com/bitcoin/bitcoin/pull/34158#pullrequestreview-3614742906), [waketraindev](https://github.com/bitcoin/bitcoin/pull/34158#issuecomment-3694830686) |\n\nIf your review is incorrectly listed, please copy-paste <code>&lt;!--meta-tag:bot-skip--&gt;</code> into the comment that the bot should ignore.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#34242](https://github.com/bitcoin/bitcoin/pull/34242) (Prepare string and net utils for future HTTP operations by pinheadmz)\n* [#32061](https://github.com/bitcoin/bitcoin/pull/32061) (Replace libevent with our own HTTP and socket-handling implementation by pinheadmz)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n<!--5faf32d7da4f0f540f40219e4f7537a3-->",
          "created_at": "2025-12-27T14:20:37Z"
        },
        {
          "user": "sedited",
          "body": "Concept ACK",
          "created_at": "2025-12-27T14:35:33Z"
        },
        {
          "user": "pinheadmz",
          "body": "concept ACK\r\nQuick review on github - where are you using LineReader?",
          "created_at": "2025-12-27T14:38:52Z"
        },
        {
          "user": "DrahtBot",
          "body": "<!--85328a0da195eb286784d51f73fa0af9-->\nðŸš§ At least one of the CI tasks failed.\n<sub>Task `macOS-cross to arm64`: https://github.com/bitcoin/bitcoin/actions/runs/20540187798/job/59003472023</sub>\n<sub>LLM reason (âœ¨ experimental): Compilation error in fuzz tests: undefined type ConnectionCB and invalid TorControlConnection initialization (nullptr) in torcontrol.cpp.</sub>\n\n<details><summary>Hints</summary>\n\nTry to run the tests locally, according to the documentation. However, a CI failure may still\nhappen due to a number of reasons, for example:\n\n* Possibly due to a silent merge conflict (the changes in this pull request being\nincompatible with the current code in the target branch). If so, make sure to rebase on the latest\ncommit of the target branch.\n\n* A sanitizer issue, which can only be found by compiling with the sanitizer and running the\n  affected test.\n\n* An intermittent issue.\n\nLeave a comment here, if you need help tracking down a confusing failure.\n\n</details>\n\n",
          "created_at": "2025-12-27T15:32:27Z"
        },
        {
          "user": "fjahr",
          "body": "> where are you using LineReader?\r\n\r\nHeh, I did quite a bit of moving around after I got things working and seems like I picked from the branch where i didn't use it instead of the one where I did at the end. Pushed the right code for it now, using it in `ProcessBuffer`.\r\n\r\nWill work on fixing the fuzz test which I completely missed ðŸ™ƒ That's what's failing the CI.",
          "created_at": "2025-12-27T15:35:22Z"
        },
        {
          "user": "pablomartin4btc",
          "body": "Concept ACK",
          "created_at": "2025-12-27T16:24:13Z"
        },
        {
          "user": "waketraindev",
          "body": "Concept ACK\r\n\r\nThere's some uncovered new code in the coverage report, https://corecheck.dev/bitcoin/bitcoin/pulls/34158\r\nAnd some Sonarcloud warnings to check out.\r\n\r\n\r\n",
          "created_at": "2025-12-28T15:33:23Z"
        },
        {
          "user": "DrahtBot",
          "body": "<!--85328a0da195eb286784d51f73fa0af9-->\nðŸš§ At least one of the CI tasks failed.\n<sub>Task `lint`: https://github.com/bitcoin/bitcoin/actions/runs/20560088214/job/59049502835</sub>\n<sub>LLM reason (âœ¨ experimental): Python linting failed: an f-string had no placeholders (ruff warning F541) in test/functional/feature_torcontrol.py.</sub>\n\n<details><summary>Hints</summary>\n\nTry to run the tests locally, according to the documentation. However, a CI failure may still\nhappen due to a number of reasons, for example:\n\n* Possibly due to a silent merge conflict (the changes in this pull request being\nincompatible with the current code in the target branch). If so, make sure to rebase on the latest\ncommit of the target branch.\n\n* A sanitizer issue, which can only be found by compiling with the sanitizer and running the\n  affected test.\n\n* An intermittent issue.\n\nLeave a comment here, if you need help tracking down a confusing failure.\n\n</details>\n\n",
          "created_at": "2025-12-28T22:02:16Z"
        },
        {
          "user": "fjahr",
          "body": "Addressed feedback.\r\n\r\n> There's some uncovered new code in the coverage report, https://corecheck.dev/bitcoin/bitcoin/pulls/34158\r\n\r\nThe old code was largely uncovered as well but I have looked into it and added a simple functional test that provides some basic end-to-end coverage. I thought about unit tests too but I am not sure they provide much value aside from the functional and fuzz tests. But happy to be convinced otherwise if there are ideas for what they should cover.\r\n\r\n> And some Sonarcloud warnings to check out.\r\n\r\nI don't know what that is and the screenshot doesn't allow me to see which lines are meant by the comment. Happy to look into them if you can transfer the comments matching to the correct lines here somehow.",
          "created_at": "2025-12-28T22:16:13Z"
        },
        {
          "user": "waketraindev",
          "body": "> I don't know what that is and the screenshot doesn't allow me to see which lines are meant by the comment. Happy to look into them if you can transfer the comments matching to the correct lines here somehow.\r\n\r\nYou can see the warnings on https://corecheck.dev/bitcoin/bitcoin/pulls/34158 scroll down the page, above benchmarks, below uncovered included code\r\n\r\n\r\n",
          "created_at": "2025-12-28T23:14:40Z"
        },
        {
          "user": "fjahr",
          "body": "> You can see the warnings on https://corecheck.dev/bitcoin/bitcoin/pulls/34158 scroll down the page, above benchmarks, below uncovered included code\r\n\r\nTIL, thanks. I addressed the ones that made sense to me.",
          "created_at": "2025-12-31T17:06:21Z"
        },
        {
          "user": "DrahtBot",
          "body": "<!--85328a0da195eb286784d51f73fa0af9-->\nðŸš§ At least one of the CI tasks failed.\n<sub>Task `macOS-cross to arm64`: https://github.com/bitcoin/bitcoin/actions/runs/20623563561/job/59230100443</sub>\n<sub>LLM reason (âœ¨ experimental): Compilation failed due to use of std::jthread not available in the target standard library (missing C++20 jthread support).</sub>\n\n<details><summary>Hints</summary>\n\nTry to run the tests locally, according to the documentation. However, a CI failure may still\nhappen due to a number of reasons, for example:\n\n* Possibly due to a silent merge conflict (the changes in this pull request being\nincompatible with the current code in the target branch). If so, make sure to rebase on the latest\ncommit of the target branch.\n\n* A sanitizer issue, which can only be found by compiling with the sanitizer and running the\n  affected test.\n\n* An intermittent issue.\n\nLeave a comment here, if you need help tracking down a confusing failure.\n\n</details>\n\n",
          "created_at": "2025-12-31T18:18:42Z"
        }
      ]
    },
    {
      "number": 34157,
      "title": ".",
      "body": ".",
      "state": "closed",
      "user": "andaluzcoin",
      "created_at": "2025-12-27T13:50:34Z",
      "updated_at": "2025-12-27T13:56:59Z",
      "comments": 1,
      "url": "https://github.com/bitcoin/bitcoin/pull/34157",
      "labels": [],
      "comment_list": [
        {
          "user": "DrahtBot",
          "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/34157.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\nA summary of reviews will appear here.\n<!--5faf32d7da4f0f540f40219e4f7537a3-->\n### LLM Linter (âœ¨ experimental)\n\n\n\nPossible places where comparison-specific test macros should replace generic comparisons:\n\n- [test/functional/feature_pruning.py] assert res.get(\"completed\") is True -> Use assert_equal(res.get(\"completed\"), True)\n- [test/functional/feature_pruning.py] assert res.get(\"from_height\") == 0 -> Use assert_equal(res.get(\"from_height\"), 0)\n- [test/functional/feature_pruning.py] assert res.get(\"to_height\") == stop_height -> Use assert_equal(res.get(\"to_height\"), stop_height)\n\nNo other added Python changes contained bare assert comparisons that clearly map to the provided comparison helpers.\n\n\n\n<sup>2025-12-27</sup>\n",
          "created_at": "2025-12-27T13:50:43Z"
        }
      ]
    },
    {
      "number": 34156,
      "title": "wallet: fix unnamed legacy wallet migration failure",
      "body": "Minimal fix for #34128.\r\n\r\nThe issue occurs during the migration of a legacy unnamed wallet\r\n(the legacy \"default\" wallet). When the migration fails, the cleanup\r\nlogic is triggered to roll back the state, which involves erasing the\r\nnewly created descriptor wallets directories. Normally, this only\r\naffects the parent directories of named wallets, since they each\r\nreside in their own directories. However, because the unnamed\r\nwallet resides directly in the top-level `/wallets/` folder, this\r\nlogic accidentally deletes the main directory.\r\n\r\nThe fix ensures that only the wallet.dat file of the unnamed wallet\r\nis touched and restored, preserving the wallet in BDB format and\r\nleaving the main `/wallets/` directory intact.\r\n\r\n#### Story Line:\r\n#32273 fixed a different set of issues and, in doing so, uncovered\r\nthis one.\r\nBefore the mentioned PR, backups were stored in the same directory\r\nas the wallet.dat file. On a migration failure, the backup was then\r\ncopied to the top-level `/wallets/` directory. For the unnamed legacy\r\nwallet, the wallet directory is the `/wallets/` directory, so the source\r\nand destination paths were identical. As a result, we threw early in the\r\n`fs::copy_file` call ([here](https://github.com/bitcoin/bitcoin/blob/29.x/src/wallet/wallet.cpp#L4572)) because the file already existed, as we\r\nwere trying to copy the file onto itself. This caused the cleanup logic\r\nto abort early on and never reach the removal line.\r\n\r\n\r\n#### Testing Notes:\r\nCherry-pick the test commit on top of master and run it. You will\r\nsee the failure and realize the reason by reading the test code.",
      "state": "closed",
      "user": "furszy",
      "created_at": "2025-12-27T04:08:33Z",
      "updated_at": "2026-01-07T15:27:32Z",
      "comments": 27,
      "url": "https://github.com/bitcoin/bitcoin/pull/34156",
      "labels": [
        "Wallet"
      ]
    }
  ],
  "issues": [
    {
      "number": 34159,
      "title": "ci: failure in p2p_addr_selfannouncement.py",
      "body": "https://github.com/bitcoin/bitcoin/actions/runs/20445863729/job/58749036885#step:9:3498:\n```bash\n test  2025-12-22T23:47:48.293698Z TestFramework.p2p (DEBUG): Received message from 127.0.0.1:12164: msg_pong(nonce=00000000) \n test  2025-12-22T23:47:48.293794Z TestFramework.p2p (DEBUG): Received message from 127.0.0.1:12164: msg_pong(nonce=00000006) \n test  2025-12-22T23:47:48.344658Z TestFramework (ERROR): Unexpected exception \n                                   Traceback (most recent call last):\n                                     File \"/Users/runner/work/bitcoin/bitcoin/repo_archive/test/functional/test_framework/test_framework.py\", line 142, in main\n                                       self.run_test()\n                                       ~~~~~~~~~~~~~^^\n                                     File \"/Users/runner/work/bitcoin/bitcoin/repo_archive/ci/scratch/build-aarch64-apple-darwin24.6.0/test/functional/p2p_addr_selfannouncement.py\", line 67, in run_test\n                                       self.self_announcement_test(outbound=False, addrv2=True)\n                                       ~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n                                     File \"/Users/runner/work/bitcoin/bitcoin/repo_archive/ci/scratch/build-aarch64-apple-darwin24.6.0/test/functional/p2p_addr_selfannouncement.py\", line 135, in self_announcement_test\n                                       assert_equal(addr_receiver.self_announcements_received, last_self_announcements_received + 1)\n                                       ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n                                     File \"/Users/runner/work/bitcoin/bitcoin/repo_archive/test/functional/test_framework/util.py\", line 80, in assert_equal\n                                       raise AssertionError(\"not(%s)\" % \" == \".join(str(arg) for arg in (thing1, thing2) + args))\n                                   AssertionError: not(4 == 5)\n test  2025-12-22T23:47:48.347601Z TestFramework (DEBUG): Closing down network thread \n```",
      "state": "closed",
      "user": "fanquake",
      "created_at": "2025-12-27T15:55:09Z",
      "updated_at": "2026-01-06T09:38:18Z",
      "comments": 14,
      "url": "https://github.com/bitcoin/bitcoin/issues/34159",
      "labels": [],
      "comment_list": [
        {
          "user": "0xB10C",
          "body": "Will try to reproduce it. I suspect this is a addr message timestamp issue. Previously, I had something like this:\n\n```python\n  # The tricky part of this test is the timestamp of the self-announcement.\n  # The following helped me to debug timestamp mismatches, so I'm leaving it in for the next one.\n  elif addr.ip == self.expected.ip and addr.port == self.expected.port and addr.nServices == self.expected.nServices:\n      print(f\"Self-announcement timestamp mismatch: got={addr.time} expected={self.expected.time}\")\n```\nto catch them, but dropped it in https://github.com/bitcoin/bitcoin/pull/34039#discussion_r2628081222 ",
          "created_at": "2025-12-27T23:58:31Z"
        },
        {
          "user": "0xB10C",
          "body": "can reproduce with b3fef39: `Self-announcement timestamp mismatch: got=2656803201 expected=2655075201`\n\n```\n2025-12-28T00:54:24.0578490Z 2025-12-28T00:53:21.268810Z TestFramework (INFO): Test that the node does an address self-announcement to inbound connections (addrv1)\n2025-12-28T00:54:24.0682490Z 2025-12-28T00:53:21.269773Z TestFramework (INFO): Check that we get an initial self-announcement when connecting to a node and sending a GETADDR (inbound, addrv1)\n2025-12-28T00:54:24.0783520Z 2025-12-28T00:53:21.733615Z TestFramework (INFO): Check that we get more self-announcements sometime later (inbound, addrv1)\n2025-12-28T00:54:24.0884810Z Self-announcement timestamp mismatch: got=2656803201 expected=2655075201\n2025-12-28T00:54:24.0985270Z 2025-12-28T00:54:23.651301Z TestFramework (ERROR): Unexpected exception\n2025-12-28T00:54:24.1004690Z Traceback (most recent call last):\n2025-12-28T00:54:24.1005350Z   File \"/Users/runner/work/bitcoin/bitcoin/repo_archive/test/functional/test_framework/test_framework.py\", line 142, in main\n2025-12-28T00:54:24.1006280Z     self.run_test()\n2025-12-28T00:54:24.1006580Z     ~~~~~~~~~~~~~^^\n2025-12-28T00:54:24.1008060Z   File \"/Users/runner/work/bitcoin/bitcoin/repo_archive/ci/scratch/build-aarch64-apple-darwin24.6.0/test/functional/p2p_addr_selfannouncement.py\", line 70, in run_test\n2025-12-28T00:54:24.1008940Z     self.self_announcement_test(outbound=False, addrv2=False)\n2025-12-28T00:54:24.1010810Z     ~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n2025-12-28T00:54:24.1011690Z   File \"/Users/runner/work/bitcoin/bitcoin/repo_archive/ci/scratch/build-aarch64-apple-darwin24.6.0/test/functional/p2p_addr_selfannouncement.py\", line 139, in self_announcement_test\n2025-12-28T00:54:24.1012630Z     assert_equal(addr_receiver.self_announcements_received, last_self_announcements_received + 1)\n2025-12-28T00:54:24.1013240Z     ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n2025-12-28T00:54:24.1014500Z   File \"/Users/runner/work/bitcoin/bitcoin/repo_archive/test/functional/test_framework/util.py\", line 80, in assert_equal\n2025-12-28T00:54:24.1015240Z     raise AssertionError(\"not(%s)\" % \" == \".join(str(arg) for arg in (thing1, thing2) + args))\n2025-12-28T00:54:24.1017350Z AssertionError: not(515 == 516)\n2025-12-28T00:54:24.1019860Z 2025-12-28T00:54:23.840132Z TestFramework (INFO): Not stopping nodes as test failed. The dangling processes will be cleaned up later.\n2025-12-28T00:54:24.1021170Z 2025-12-28T00:54:23.840292Z TestFramework (WARNING): Not cleaning up dir /Users/runner/work/bitcoin/bitcoin/repo_archive/ci/scratch/test_runner/test_runner_â‚¿_ðŸƒ_20251228_003917/p2p_addr_selfannouncement_97\n2025-12-28T00:54:24.1025000Z 2025-12-28T00:54:23.840351Z TestFramework (ERROR): Test failed. Test logging available at /Users/runner/work/bitcoin/bitcoin/repo_archive/ci/scratch/test_runner/test_runner_â‚¿_ðŸƒ_20251228_003917/p2p_addr_selfannouncement_97/test_framework.log\n2025-12-28T00:54:24.1026100Z 2025-12-28T00:54:23.841833Z TestFramework (ERROR): \n2025-12-28T00:54:24.1027130Z 2025-12-28T00:54:23.842117Z TestFramework (ERROR): Hint: Call /Users/runner/work/bitcoin/bitcoin/repo_archive/test/functional/combine_logs.py '/Users/runner/work/bitcoin/bitcoin/repo_archive/ci/scratch/test_runner/test_runner_â‚¿_ðŸƒ_20251228_003917/p2p_addr_selfannouncement_97' to consolidate all logs\n2025-12-28T00:54:24.1028120Z 2025-12-28T00:54:23.842206Z TestFramework (ERROR): \n2025-12-28T00:54:24.1028740Z 2025-12-28T00:54:23.842385Z TestFramework (ERROR): If this failure happened unexpectedly or intermittently, please file a bug and provide a link or upload of the combined log.\n2025-12-28T00:54:24.1029540Z 2025-12-28T00:54:23.843333Z TestFramework (ERROR): https://github.com/bitcoin/bitcoin/issues\n2025-12-28T00:54:24.1030030Z 2025-12-28T00:54:23.844562Z TestFramework (ERROR): \n```",
          "created_at": "2025-12-28T09:16:06Z"
        },
        {
          "user": "naiyoma",
          "body": "> can reproduce with [b3fef39](https://github.com/bitcoin/bitcoin/commit/b3fef39e025e72d90684b6e2997fcd984b306508): `Self-announcement timestamp mismatch: got=2656803201 expected=2655075201`\n\nI havenâ€™t been able to reproduce this, Is the time difference btwn `got `and` expected,` consistently 20 day ? \n",
          "created_at": "2025-12-30T14:51:39Z"
        },
        {
          "user": "0xB10C",
          "body": "> > can reproduce with [b3fef39](https://github.com/bitcoin/bitcoin/commit/b3fef39e025e72d90684b6e2997fcd984b306508): `Self-announcement timestamp mismatch: got=2656803201 expected=2655075201`\n> \n> I havenâ€™t been able to reproduce this, Is the time difference btwn `got `and` expected,` consistently 20 day ?\n\nSorry, I didn't link to https://github.com/0xB10C/bitcoin/actions/runs/20546158233 - I'm not seeing the failure locally, just in CI.\n\nI was playing around with it in https://github.com/0xB10C/bitcoin/pull/15, and I think one options is to be less strict about the timestamp similar to:\n\n```patch\n        self.addr_messages_received += 1\n        for addr in message.addrs:\n            self.addresses_received += 1\n-           if addr == self.expected:\n+           if addr.time >= self.expected.time and addr.ip == self.expected.ip and addr.port == self.expected.port and addr.nServices == self.expected.nServices:\n                self.self_announcements_received += 1\n```",
          "created_at": "2025-12-30T16:20:19Z"
        },
        {
          "user": "hebasto",
          "body": "On OmniOS, https://github.com/hebasto/bitcoin-core-nightly/actions/runs/20611492118/job/59196832666:\n```\n181/282 - p2p_addr_selfannouncement.py failed, Duration: 1 s\n\nstdout:\n2025-12-31T04:29:42.401827Z TestFramework (INFO): PRNG seed is: 12631707991788085\n2025-12-31T04:29:42.403417Z TestFramework (INFO): Initializing test directory /home/runner/work/bitcoin-core-nightly/bitcoin-core-nightly/test_runner_â‚¿_ðŸƒ_20251231_042118/p2p_addr_selfannouncement_96\n2025-12-31T04:29:43.082640Z TestFramework (INFO): Test that the node does an address self-announcement to inbound connections (addrv1)\n2025-12-31T04:29:43.087917Z TestFramework (INFO): Check that we get an initial self-announcement when connecting to a node and sending a GETADDR (inbound, addrv1)\n2025-12-31T04:29:43.285933Z TestFramework (INFO): Check that we get more self-announcements sometime later (inbound, addrv1)\n2025-12-31T04:29:43.380398Z TestFramework (ERROR): Unexpected exception\nTraceback (most recent call last):\n  File \"/home/runner/work/bitcoin-core-nightly/bitcoin-core-nightly/test/functional/test_framework/test_framework.py\", line 142, in main\n    self.run_test()\n    ~~~~~~~~~~~~~^^\n  File \"/home/runner/work/bitcoin-core-nightly/bitcoin-core-nightly/build/test/functional/p2p_addr_selfannouncement.py\", line 66, in run_test\n    self.self_announcement_test(outbound=False, addrv2=False)\n    ~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/runner/work/bitcoin-core-nightly/bitcoin-core-nightly/build/test/functional/p2p_addr_selfannouncement.py\", line 135, in self_announcement_test\n    assert_equal(addr_receiver.self_announcements_received, last_self_announcements_received + 1)\n    ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/runner/work/bitcoin-core-nightly/bitcoin-core-nightly/test/functional/test_framework/util.py\", line 80, in assert_equal\n    raise AssertionError(\"not(%s)\" % \" == \".join(str(arg) for arg in (thing1, thing2) + args))\nAssertionError: not(1 == 2)\n2025-12-31T04:29:43.445243Z TestFramework (INFO): Not stopping nodes as test failed. The dangling processes will be cleaned up later.\n2025-12-31T04:29:43.445591Z TestFramework (WARNING): Not cleaning up dir /home/runner/work/bitcoin-core-nightly/bitcoin-core-nightly/test_runner_â‚¿_ðŸƒ_20251231_042118/p2p_addr_selfannouncement_96\n2025-12-31T04:29:43.445763Z TestFramework (ERROR): Test failed. Test logging available at /home/runner/work/bitcoin-core-nightly/bitcoin-core-nightly/test_runner_â‚¿_ðŸƒ_20251231_042118/p2p_addr_selfannouncement_96/test_framework.log\n2025-12-31T04:29:43.446523Z TestFramework (ERROR): \n2025-12-31T04:29:43.446782Z TestFramework (ERROR): Hint: Call /home/runner/work/bitcoin-core-nightly/bitcoin-core-nightly/test/functional/combine_logs.py '/home/runner/work/bitcoin-core-nightly/bitcoin-core-nightly/test_runner_â‚¿_ðŸƒ_20251231_042118/p2p_addr_selfannouncement_96' to consolidate all logs\n2025-12-31T04:29:43.446907Z TestFramework (ERROR): \n2025-12-31T04:29:43.447013Z TestFramework (ERROR): If this failure happened unexpectedly or intermittently, please file a bug and provide a link or upload of the combined log.\n2025-12-31T04:29:43.447489Z TestFramework (ERROR): https://github.com/bitcoin/bitcoin/issues\n2025-12-31T04:29:43.447623Z TestFramework (ERROR): \n\n\nstderr:\n[node 0] Cleaning up leftover process\n\n```",
          "created_at": "2025-12-31T11:09:03Z"
        },
        {
          "user": "fanquake",
          "body": "https://github.com/bitcoin/bitcoin/actions/runs/20546486544/job/59017686783?pr=34156#step:11:3758",
          "created_at": "2025-12-31T12:37:58Z"
        },
        {
          "user": "naiyoma",
          "body": "> Sorry, I didn't link to https://github.com/0xB10C/bitcoin/actions/runs/20546158233 - I'm not seeing the failure locally, just I\n\nI think this happens when there's a delay between calling `bumpmocktime() `and updating `expected.time`.\n\ntried this locally:\n\n```diff\n+++ b/test/functional/p2p_addr_selfannouncement.py\n@@ -37,11 +37,14 @@ class SelfAnnouncementReceiver(P2PInterface):\n         self.addrv2_test = addrv2\n \n     def handle_addr_message(self, message):\n+        print(f\">>> HANDLE_ADDR_MESSAGE called, expected.time={self.expected.time}\")\n         self.addr_messages_received += 1\n         for addr in message.addrs:\n             self.addresses_received += 1\n             if addr == self.expected:\n                 self.self_announcements_received += 1\n+            elif addr.ip == self.expected.ip and addr.port == self.expected.port and addr.nServices == self.expected.nServices:\n+                print(f\"Self-announcement timestamp mismatch: got={addr.time} expected={self.expected.time}\")\n \n     def on_addrv2(self, message):\n         assert (self.addrv2_test)\n@@ -119,7 +122,7 @@ class AddrSelfAnnouncementTest(BitcoinTestFramework):\n             addr_receiver.send_and_ping(msg_headers([tip_header]))\n \n         self.log.info(f\"Check that we get more self-announcements sometime later ({connection_type}, {addr_version})\")\n-        for _ in range(5):\n+        for _ in range(500):\n             last_self_announcements_received = addr_receiver.self_announcements_received\n             last_addr_messages_received = addr_receiver.addr_messages_received\n             last_addresses_received = addr_receiver.addresses_received\n@@ -128,7 +131,10 @@ class AddrSelfAnnouncementTest(BitcoinTestFramework):\n                 # self-announcements are sent on an exponential distribution with mean interval of 24h.\n                 # Setting the mocktime 20d forward gives a probability of (1 - e^-(480/24)) that\n                 # the event will occur (i.e. this fails once in ~500 million repeats).\n+                print(f\"BEFORE bumpmocktime()\")\n                 self.nodes[0].bumpmocktime(20 * ONE_DAY)\n+                time.sleep(0.1)\n+                print(f\"AFTER bumpmocktime(), before setting expected.time\")\n                 addr_receiver.expected.time = self.nodes[0].mocktime\n\n```\n\n",
          "created_at": "2025-12-31T12:39:27Z"
        },
        {
          "user": "naiyoma",
          "body": "got this with the diff above \n\n```\n2025-12-31T12:39:50.147708Z TestFramework (INFO): Check that we get an initial self-announcement when connecting to a node and sending a GETADDR (inbound, addrv1)\n>>> HANDLE_ADDR_MESSAGE called, expected.time=1767184790\n2025-12-31T12:39:50.304489Z TestFramework (INFO): Check that we get more self-announcements sometime later (inbound, addrv1)\nBEFORE bumpmocktime()\n>>> HANDLE_ADDR_MESSAGE called, expected.time=1767184790\nSelf-announcement timestamp mismatch: got=1768912790 expected=1767184790\nAFTER bumpmocktime(), before setting expected.time\n2025-12-31T12:39:50.459889Z TestFramework (ERROR): Unexpected exception\nTraceback (most recent call last):\n  File \"/home/ubuntu/Projects/bitcoin/test/functional/test_framework/test_framework.py\", line 142, in main\n    self.run_test()\n  File \"/home/ubuntu/Projects/bitcoin/./build/test/functional/p2p_addr_selfannouncement.py\", line 69, in run_test\n    self.self_announcement_test(outbound=False, addrv2=False)\n  File \"/home/ubuntu/Projects/bitcoin/./build/test/functional/p2p_addr_selfannouncement.py\", line 141, in self_announcement_test\n    assert_equal(addr_receiver.self_announcements_received, last_self_announcements_received + 1)\n  File \"/home/ubuntu/Projects/bitcoin/test/functional/test_framework/util.py\", line 80, in assert_equal\n    raise AssertionError(\"not(%s)\" % \" == \".join(str(arg) for arg in (thing1, thing2) + args))\nAssertionError: not(1 == 2)\n```\n",
          "created_at": "2025-12-31T12:47:00Z"
        },
        {
          "user": "naiyoma",
          "body": "> I was playing around with it in [0xB10C#15](https://github.com/0xB10C/bitcoin/pull/15), and I think one options is to be less strict about the timestamp similar to:\n\n>           if addr.time >= self.expected.time and addr.ip == self.expected.ip and addr.port == self.expected.port and addr.nServices == self.expected.nServices:\n\n\nI'm not sure this is always the case. Is it possible that `addr.time <= self.expected.time` could occur ? i think checking ip,port,service is sufficient.",
          "created_at": "2025-12-31T13:27:28Z"
        },
        {
          "user": "hebasto",
          "body": "On NetBSD 9.4, https://github.com/hebasto/bitcoin-core-nightly/actions/runs/20619499569/job/59218560248:\n```\n182/282 - p2p_addr_selfannouncement.py failed, Duration: 6 s\n\nstdout:\n2025-12-31T14:10:01.054524Z TestFramework (INFO): PRNG seed is: 279208991052383101\n2025-12-31T14:10:01.060063Z TestFramework (INFO): Initializing test directory /home/runner/work/bitcoin-core-nightly/bitcoin-core-nightly/test_runner_â‚¿_ðŸƒ_20251231_135038/p2p_addr_selfannouncement_96\n2025-12-31T14:10:03.459488Z TestFramework (INFO): Test that the node does an address self-announcement to inbound connections (addrv1)\n2025-12-31T14:10:03.472186Z TestFramework (INFO): Check that we get an initial self-announcement when connecting to a node and sending a GETADDR (inbound, addrv1)\n2025-12-31T14:10:04.247264Z TestFramework (INFO): Check that we get more self-announcements sometime later (inbound, addrv1)\n2025-12-31T14:10:04.961413Z TestFramework (INFO): Test that the node does an address self-announcement to inbound connections (addrv2)\n2025-12-31T14:10:04.963778Z TestFramework (INFO): Check that we get an initial self-announcement when connecting to a node and sending a GETADDR (inbound, addrv2)\n2025-12-31T14:10:05.115558Z TestFramework (INFO): Check that we get more self-announcements sometime later (inbound, addrv2)\n2025-12-31T14:10:05.739087Z TestFramework (ERROR): Unexpected exception\nTraceback (most recent call last):\n  File \"/home/runner/work/bitcoin-core-nightly/bitcoin-core-nightly/test/functional/test_framework/test_framework.py\", line 142, in main\n    self.run_test()\n    ~~~~~~~~~~~~~^^\n  File \"/home/runner/work/bitcoin-core-nightly/bitcoin-core-nightly/build/test/functional/p2p_addr_selfannouncement.py\", line 67, in run_test\n    self.self_announcement_test(outbound=False, addrv2=True)\n    ~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/runner/work/bitcoin-core-nightly/bitcoin-core-nightly/build/test/functional/p2p_addr_selfannouncement.py\", line 135, in self_announcement_test\n    assert_equal(addr_receiver.self_announcements_received, last_self_announcements_received + 1)\n    ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/runner/work/bitcoin-core-nightly/bitcoin-core-nightly/test/functional/test_framework/util.py\", line 80, in assert_equal\n    raise AssertionError(\"not(%s)\" % \" == \".join(str(arg) for arg in (thing1, thing2) + args))\nAssertionError: not(5 == 6)\n2025-12-31T14:10:05.745570Z TestFramework (INFO): Not stopping nodes as test failed. The dangling processes will be cleaned up later.\n2025-12-31T14:10:05.745741Z TestFramework (WARNING): Not cleaning up dir /home/runner/work/bitcoin-core-nightly/bitcoin-core-nightly/test_runner_â‚¿_ðŸƒ_20251231_135038/p2p_addr_selfannouncement_96\n2025-12-31T14:10:05.745854Z TestFramework (ERROR): Test failed. Test logging available at /home/runner/work/bitcoin-core-nightly/bitcoin-core-nightly/test_runner_â‚¿_ðŸƒ_20251231_135038/p2p_addr_selfannouncement_96/test_framework.log\n2025-12-31T14:10:05.746147Z TestFramework (ERROR): \n2025-12-31T14:10:05.746352Z TestFramework (ERROR): Hint: Call /home/runner/work/bitcoin-core-nightly/bitcoin-core-nightly/test/functional/combine_logs.py '/home/runner/work/bitcoin-core-nightly/bitcoin-core-nightly/test_runner_â‚¿_ðŸƒ_20251231_135038/p2p_addr_selfannouncement_96' to consolidate all logs\n2025-12-31T14:10:05.746466Z TestFramework (ERROR): \n2025-12-31T14:10:05.746574Z TestFramework (ERROR): If this failure happened unexpectedly or intermittently, please file a bug and provide a link or upload of the combined log.\n2025-12-31T14:10:05.746787Z TestFramework (ERROR): https://github.com/bitcoin/bitcoin/issues\n2025-12-31T14:10:05.746885Z TestFramework (ERROR): \n\n\nstderr:\n[node 0] Cleaning up leftover process\n\n```",
          "created_at": "2025-12-31T14:46:18Z"
        },
        {
          "user": "0xB10C",
          "body": "> I'm not sure this is always the case. Is it possible that `addr.time <= self.expected.time` could occur ? i think checking ip,port,service is sufficient.\n\nthat would work around the issue, but I think we should have coverage for the self-announcement timestamp being correct(ish). \n\n> I think this happens when there's a delay between calling bumpmocktime() and updating expected.time.\n\nAn earlier version of #34039 didn't use `bumpmocktime()`. We could revert to doing:\n\n```python\nself.mocktime += 20 * ONE_DAY\naddr_receiver.expected.time = self.mocktime\nself.nodes[0].setmocktime(self.mocktime)\naddr_receiver.sync_with_ping()\n```\n\nto make sure the expected timestamp is set before bumping the mocktime.",
          "created_at": "2025-12-31T15:26:50Z"
        },
        {
          "user": "fanquake",
          "body": "https://github.com/bitcoin/bitcoin/actions/runs/20656499701/job/59310311647#step:9:3863",
          "created_at": "2026-01-02T12:36:11Z"
        },
        {
          "user": "naiyoma",
          "body": "> An earlier version of [#34039](https://github.com/bitcoin/bitcoin/pull/34039) didn't use `bumpmocktime()`. We could revert to doing:\n\n\nYeah, this is certainly a better option",
          "created_at": "2026-01-02T15:43:35Z"
        },
        {
          "user": "0xB10C",
          "body": "> > An earlier version of [#34039](https://github.com/bitcoin/bitcoin/pull/34039) didn't use `bumpmocktime()`. We could revert to doing:\n> \n> Yeah, this is certainly a better option\n\ndoing this in https://github.com/bitcoin/bitcoin/pull/34204",
          "created_at": "2026-01-05T15:57:10Z"
        }
      ]
    }
  ],
  "summary": {
    "pull_requests": 4,
    "issues": 1
  }
}