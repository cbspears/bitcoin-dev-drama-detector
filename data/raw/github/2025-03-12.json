{
  "source": "github",
  "repository": "bitcoin/bitcoin",
  "fetched_at": "2026-01-15T19:24:05.084782+00:00",
  "date": "2025-03-12",
  "pull_requests": [
    {
      "number": 32049,
      "title": "contrib: Fix `gen-bitcoin-conf.sh`",
      "body": "In #31118, the format of bitcoind's `--help` output changed slightly in a way that breaks `gen-bitcoin-conf.sh`, modify the script to accommodate the new format, by starting after the line that says \"Options:\" and stripping the `-help` options and descriptions from the script output.\r\n\r\nBefore this PR, all options above `-help` were excluded from the example bitcoin.conf.\r\n",
      "state": "closed",
      "user": "davidgumberg",
      "created_at": "2025-03-12T22:00:22Z",
      "updated_at": "2025-03-14T03:14:53Z",
      "comments": 3,
      "url": "https://github.com/bitcoin/bitcoin/pull/32049",
      "labels": [
        "Scripts and tools"
      ],
      "comment_list": [
        {
          "user": "DrahtBot",
          "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/32049.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| ACK | [glozow](https://github.com/bitcoin/bitcoin/pull/32049#pullrequestreview-2680493978), [rkrux](https://github.com/bitcoin/bitcoin/pull/32049#pullrequestreview-2681359199), [mabu44](https://github.com/bitcoin/bitcoin/pull/32049#issuecomment-2721511568), [BrandonOdiwuor](https://github.com/bitcoin/bitcoin/pull/32049#pullrequestreview-2682713176) |\n\nIf your review is incorrectly listed, please react with ðŸ‘Ž to this comment and the bot will ignore it on the next update.\n",
          "created_at": "2025-03-12T22:00:25Z"
        },
        {
          "user": "mabu44",
          "body": "Tested ACK a24419f8bed5e1145ce171dbbdad957750585471",
          "created_at": "2025-03-13T14:42:10Z"
        },
        {
          "user": "fanquake",
          "body": "Backported in #32062.",
          "created_at": "2025-03-14T03:14:52Z"
        }
      ]
    },
    {
      "number": 32048,
      "title": "docs: Enhance TODO section in README.md with detailed explanations",
      "body": "This pull request improves the TODO section in the Minisketch README.md by:\r\n1. Adding detailed explanations for each planned improvement:\r\n- Explicit formulas for higher-degree polynomials\r\n- Subquadratic multiplication and modulus algorithms\r\n- Half-GCD algorithm implementation\r\n- Incremental decoding interface\r\n- Platform-specific optimizations beyond x86\r\n- 32-bit host optimizations\r\n- IBLT/Hybrid approaches\r\n2. Introducing implementation priorities to guide future development efforts:\r\n- Prioritizes ARM optimizations for mobile/embedded use\r\n- Highlights incremental decoding as high value for practical applications\r\n- Orders remaining improvements by complexity and expected performance gains\r\n\r\nThese enhancements make the roadmap clearer for potential contributors and provide better context about the technical goals of the project. The detailed explanations help developers understand the purpose and potential impact of each planned improvement.",
      "state": "closed",
      "user": "VolodymyrBg",
      "created_at": "2025-03-12T20:45:00Z",
      "updated_at": "2025-03-13T17:04:24Z",
      "comments": 2,
      "url": "https://github.com/bitcoin/bitcoin/pull/32048",
      "labels": [
        "Docs",
        "CI failed"
      ],
      "comment_list": [
        {
          "user": "DrahtBot",
          "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/32048.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\nA summary of reviews will appear here.\n",
          "created_at": "2025-03-12T20:45:04Z"
        },
        {
          "user": "DrahtBot",
          "body": "<!--85328a0da195eb286784d51f73fa0af9-->\nðŸš§ At least one of the CI tasks failed.\n<sub>Debug: https://github.com/bitcoin/bitcoin/runs/38666687165</sub>\n\n<details><summary>Hints</summary>\n\nTry to run the tests locally, according to the documentation. However, a CI failure may still\nhappen due to a number of reasons, for example:\n\n* Possibly due to a silent merge conflict (the changes in this pull request being\nincompatible with the current code in the target branch). If so, make sure to rebase on the latest\ncommit of the target branch.\n\n* A sanitizer issue, which can only be found by compiling with the sanitizer and running the\n  affected test.\n\n* An intermittent issue.\n\nLeave a comment here, if you need help tracking down a confusing failure.\n\n</details>\n",
          "created_at": "2025-03-12T21:13:52Z"
        }
      ]
    },
    {
      "number": 32046,
      "title": "[29.x] bump to v29.0rc1",
      "body": "- \"backport\" #32041 \r\n- bump version to v29.0rc1\r\n- generate manpages\r\n- add example bitcoin.conf\r\n- add release-notes.md pointing to wiki",
      "state": "closed",
      "user": "glozow",
      "created_at": "2025-03-12T18:28:31Z",
      "updated_at": "2025-03-13T04:20:37Z",
      "comments": 9,
      "url": "https://github.com/bitcoin/bitcoin/pull/32046",
      "labels": [
        "Backport"
      ],
      "comment_list": [
        {
          "user": "DrahtBot",
          "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/32046.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| ACK | [hebasto](https://github.com/bitcoin/bitcoin/pull/32046#pullrequestreview-2679617137), [achow101](https://github.com/bitcoin/bitcoin/pull/32046#issuecomment-2719368979), [davidgumberg](https://github.com/bitcoin/bitcoin/pull/32046#issuecomment-2719475327) |\n\nIf your review is incorrectly listed, please react with ðŸ‘Ž to this comment and the bot will ignore it on the next update.\n",
          "created_at": "2025-03-12T18:28:33Z"
        },
        {
          "user": "hebasto",
          "body": "> ACK [628e4f5](https://github.com/bitcoin/bitcoin/commit/628e4f59b8784fcde2de176fb98260e71def18ec), I have reviewed the code and it looks OK.\r\n\r\nRevoked. Man pages for `bitcoind` and `bitcoin-qt` miss \"ZeroMQ notification options\"",
          "created_at": "2025-03-12T18:51:57Z"
        },
        {
          "user": "glozow",
          "body": "Great, fixed.",
          "created_at": "2025-03-12T19:02:46Z"
        },
        {
          "user": "hebasto",
          "body": "> > ACK [628e4f5](https://github.com/bitcoin/bitcoin/commit/628e4f59b8784fcde2de176fb98260e71def18ec), I have reviewed the code and it looks OK.\r\n> \r\n> Revoked. Man pages for `bitcoind` and `bitcoin-qt` miss \"ZeroMQ notification options\"\r\n\r\nMy apologies for not checking all stuff at once, but `examples/bitcoin.conf` also lacks \"ZeroMQ notification options\".",
          "created_at": "2025-03-12T19:08:46Z"
        },
        {
          "user": "glozow",
          "body": "Thanks @hebasto!",
          "created_at": "2025-03-12T19:09:48Z"
        },
        {
          "user": "davidgumberg",
          "body": "It appears that `gen-bitcoin-conf.sh` became broken after https://github.com/bitcoin/bitcoin/pull/31118 changed the `--help` output format, all options above `-help` in the `--help` output are missing, I've opened a fix in #32049.\r\n\r\n<details>\r\n\r\n<summary>\r\n\r\n### bitcoin.conf diff between 28.1 and #32046\r\n\r\n</summary>\r\n\r\n```console\r\n$ git diff v28.1/share/examples/bitcoin.conf 32046/share/examples/bitcoin.conf\r\n```\r\n\r\n```diff\r\ndiff --git a/v28.1/share/examples/bitcoin.conf b/32046/share/examples/bitcoin.conf\r\nindex a8dfc27..5b0003b 100644\r\n--- a/v28.1/share/examples/bitcoin.conf\r\n+++ b/32046/share/examples/bitcoin.conf\r\n@@ -12,82 +12,6 @@\r\n ### Options\r\n \r\n \r\n-# Execute command when an alert is raised (%s in cmd is replaced by\r\n-# message)\r\n-#alertnotify=<cmd>\r\n-\r\n-# For backwards compatibility, treat an unused bitcoin.conf file in the\r\n-# datadir as a warning, not an error.\r\n-#allowignoredconf=1\r\n-\r\n-# If this block is in the chain assume that it and its ancestors are valid\r\n-# and potentially skip their script verification (0 to verify all,\r\n-# default:\r\n-# 000000000000000000011c5890365bdbe5d25b97ce0057589acaef4f1a57263f,\r\n-# testnet3:\r\n-# 000000000000000465b1a66c9f386308e8c75acef9201f3f577811da09fc90ad,\r\n-# testnet4:\r\n-# 000000005be348057db991fa5d89fe7c4695b667cfb311391a8db374b6f681fd,\r\n-# signet:\r\n-# 0000014aad1d58dddcb964dd749b073374c6306e716b22f573a2efe68d414539)\r\n-#assumevalid=<hex>\r\n-\r\n-# Maintain an index of compact filters by block (default: 0, values:\r\n-# basic). If <type> is not supplied or if <type> = 1, indexes for\r\n-# all known types are enabled.\r\n-#blockfilterindex=<type>\r\n-\r\n-# Execute command when the best block changes (%s in cmd is replaced by\r\n-# block hash)\r\n-#blocknotify=<cmd>\r\n-\r\n-# Extra transactions to keep in memory for compact block reconstructions\r\n-# (default: 100)\r\n-#blockreconstructionextratxn=<n>\r\n-\r\n-# Specify directory to hold blocks subdirectory for *.dat files (default:\r\n-# <datadir>)\r\n-#blocksdir=<dir>\r\n-\r\n-# Whether to reject transactions from network peers. Disables automatic\r\n-# broadcast and rebroadcast of transactions, unless the source peer\r\n-# has the 'forcerelay' permission. RPC transactions are not\r\n-# affected. (default: 0)\r\n-#blocksonly=1\r\n-\r\n-# Whether an XOR-key applies to blocksdir *.dat files. The created XOR-key\r\n-# will be zeros for an existing blocksdir or when `-blocksxor=0` is\r\n-# set, and random for a freshly initialized blocksdir. (default: 1)\r\n-#blocksxor=1\r\n-\r\n-# Maintain coinstats index used by the gettxoutsetinfo RPC (default: 0)\r\n-#coinstatsindex=1\r\n-\r\n-# Specify path to read-only configuration file. Relative paths will be\r\n-# prefixed by datadir location (only useable from command line, not\r\n-# configuration file) (default: bitcoin.conf)\r\n-#conf=<file>\r\n-\r\n-# Run in the background as a daemon and accept commands (default: 0)\r\n-#daemon=1\r\n-\r\n-# Wait for initialization to be finished before exiting. This implies\r\n-# -daemon (default: 0)\r\n-#daemonwait=1\r\n-\r\n-# Specify data directory\r\n-#datadir=<dir>\r\n-\r\n-# Maximum database cache size <n> MiB (4 to 16384, default: 450). In\r\n-# addition, unused mempool memory is shared for this cache (see\r\n-# -maxmempool).\r\n-#dbcache=<n>\r\n-\r\n-# Specify location of debug log file (default: debug.log). Relative paths\r\n-# will be prefixed by a net-specific datadir location. Pass\r\n-# -nodebuglogfile to disable writing the log to a file.\r\n-#debuglogfile=<file>\r\n-\r\n # Specify additional configuration file, relative to the -datadir path\r\n # (only useable from configuration file, not command line)\r\n #includeconf=<file>\r\n@@ -263,7 +187,7 @@\r\n # base while uppercase is 1024 base\r\n #maxuploadtarget=<n>\r\n \r\n-# Use NAT-PMP to map the listening port (default: 0)\r\n+# Use PCP or NAT-PMP to map the listening port (default: 0)\r\n #natpmp=1\r\n \r\n # Enable all P2P network activity (default: 1). Can be changed by the\r\n@@ -321,9 +245,6 @@\r\n # Tor control port password (default: empty)\r\n #torpassword=<pass>\r\n \r\n-# Use UPnP to map the listening port (default: 0)\r\n-#upnp=1\r\n-\r\n # Support v2 transport (default: 1)\r\n #v2transport=1\r\n \r\n@@ -586,10 +507,6 @@\r\n # this size or less (default: 83)\r\n #datacarriersize=1\r\n \r\n-# (DEPRECATED) Accept transaction replace-by-fee without requiring\r\n-# replaceability signaling (default: 1)\r\n-#mempoolfullrbf=1\r\n-\r\n # Fees (in BTC/kvB) smaller than this are considered zero fee for\r\n # relaying, mining and transaction creation (default: 0.00001)\r\n #minrelaytxfee=<amt>\r\n@@ -611,13 +528,18 @@\r\n ### Block creation options\r\n \r\n \r\n-# Set maximum BIP141 block weight (default: 3996000)\r\n+# Set maximum BIP141 block weight (default: 4000000)\r\n #blockmaxweight=<n>\r\n \r\n # Set lowest fee rate (in BTC/kvB) for transactions to be included in\r\n # block creation. (default: 0.00001)\r\n #blockmintxfee=<amt>\r\n \r\n+# Reserve space for the fixed-size block header plus the largest coinbase\r\n+# transaction the mining software may add to the block. (default:\r\n+# 8000).\r\n+#blockreservedweight=<n>\r\n+\r\n \r\n ### RPC server options\r\n \r\n@@ -663,7 +585,7 @@\r\n # 18332, testnet4: 48332, signet: 38332, regtest: 18443)\r\n #rpcport=<port>\r\n \r\n-# Set the number of threads to service RPC calls (default: 4)\r\n+# Set the number of threads to service RPC calls (default: 16)\r\n #rpcthreads=<n>\r\n \r\n # Username for JSON-RPC connections\r\n```\r\n\r\n</details>\r\n\r\nOtherwise, I compared this PR to the instructions in [`doc/release-process.md`](https://github.com/bitcoin/bitcoin/blob/master/doc/release-process.md#before-every-release-candidate) and the v28.0rc1 bump (#30726) and the same changes are made here plus the #32041 backport. I lightly reviewed the diff between the manpages generated here and in `v28.1`, and didn't see anything unexpected.\r\n<details>\r\n\r\n<summary>\r\n\r\n### manpages diff between 28.1 and #32046\r\n\r\n</summary>\r\n\r\n```console\r\n$ git diff v28.1/doc/man/ 32046/doc/man\r\n```\r\n\r\n```diff\r\ndiff --git a/v28.1/doc/man/Makefile.am b/v28.1/doc/man/Makefile.am\r\ndeleted file mode 100644\r\nindex 8f890da..0000000\r\n--- a/v28.1/doc/man/Makefile.am\r\n+++ /dev/null\r\n@@ -1,27 +0,0 @@\r\n-dist_man1_MANS=\r\n-\r\n-if BUILD_BITCOIND\r\n-  dist_man1_MANS+=bitcoind.1\r\n-endif\r\n-\r\n-if ENABLE_QT\r\n-  dist_man1_MANS+=bitcoin-qt.1\r\n-endif\r\n-\r\n-if BUILD_BITCOIN_CLI\r\n-  dist_man1_MANS+=bitcoin-cli.1\r\n-endif\r\n-\r\n-if BUILD_BITCOIN_TX\r\n-  dist_man1_MANS+=bitcoin-tx.1\r\n-endif\r\n-\r\n-if BUILD_BITCOIN_UTIL\r\n-  dist_man1_MANS+=bitcoin-util.1\r\n-endif\r\n-\r\n-if ENABLE_WALLET\r\n-if BUILD_BITCOIN_WALLET\r\n-  dist_man1_MANS+=bitcoin-wallet.1\r\n-endif\r\n-endif\r\ndiff --git a/v28.1/doc/man/bitcoin-cli.1 b/32046/doc/man/bitcoin-cli.1\r\nindex d355289..2eb89ff 100644\r\n--- a/v28.1/doc/man/bitcoin-cli.1\r\n+++ b/32046/doc/man/bitcoin-cli.1\r\n@@ -1,38 +1,36 @@\r\n .\\\" DO NOT MODIFY THIS FILE!  It was generated by help2man 1.49.3.\r\n-.TH BITCOIN-CLI \"1\" \"December 2024\" \"bitcoin-cli v28.1.0\" \"User Commands\"\r\n+.TH BITCOIN-CLI \"1\" \"March 2025\" \"bitcoin-cli v29.0.0rc1\" \"User Commands\"\r\n .SH NAME\r\n-bitcoin-cli \\- manual page for bitcoin-cli v28.1.0\r\n+bitcoin-cli \\- manual page for bitcoin-cli v29.0.0rc1\r\n .SH SYNOPSIS\r\n .B bitcoin-cli\r\n-[\\fI\\,options\\/\\fR] \\fI\\,<command> \\/\\fR[\\fI\\,params\\/\\fR]  \\fI\\,Send command to Bitcoin Core\\/\\fR\r\n+[\\fI\\,options\\/\\fR] \\fI\\,<command> \\/\\fR[\\fI\\,params\\/\\fR]\r\n .br\r\n .B bitcoin-cli\r\n-[\\fI\\,options\\/\\fR] \\fI\\,-named <command> \\/\\fR[\\fI\\,name=value\\/\\fR]...  \\fI\\,Send command to Bitcoin Core (with named arguments)\\/\\fR\r\n+[\\fI\\,options\\/\\fR] \\fI\\,-named <command> \\/\\fR[\\fI\\,name=value\\/\\fR]...\r\n .br\r\n .B bitcoin-cli\r\n-[\\fI\\,options\\/\\fR] \\fI\\,help                List commands\\/\\fR\r\n+[\\fI\\,options\\/\\fR] \\fI\\,help\\/\\fR\r\n .br\r\n .B bitcoin-cli\r\n-[\\fI\\,options\\/\\fR] \\fI\\,help <command>      Get help for a command\\/\\fR\r\n+[\\fI\\,options\\/\\fR] \\fI\\,help <command>\\/\\fR\r\n .SH DESCRIPTION\r\n-Bitcoin Core RPC client version v28.1.0\r\n+Bitcoin Core RPC client version v29.0.0rc1\r\n+.PP\r\n+The bitcoin\\-cli utility provides a command line interface to interact with a Bitcoin Core RPC server.\r\n+.PP\r\n+It can be used to query network information, manage wallets, create or broadcast transactions, and control the Bitcoin Core server.\r\n+.PP\r\n+Use the \"help\" command to list all commands. Use \"help <command>\" to show help for that command.\r\n+The \\fB\\-named\\fR option allows you to specify parameters using the key=value format, eliminating the need to pass unused positional parameters.\r\n .SH OPTIONS\r\n .HP\r\n-\\-?\r\n-.IP\r\n-Print this help message and exit\r\n-.HP\r\n-\\fB\\-addrinfo\\fR\r\n-.IP\r\n-Get the number of addresses known to the node, per network and total,\r\n-after filtering for quality and recency. The total number of\r\n-addresses known to the node may be higher.\r\n-.HP\r\n \\fB\\-color=\\fR<when>\r\n .IP\r\n Color setting for CLI output (default: auto). Valid values: always, auto\r\n (add color codes when standard output is connected to a terminal\r\n-and OS is not WIN32), never.\r\n+and OS is not WIN32), never. Only applies to the output of\r\n+\\fB\\-getinfo\\fR.\r\n .HP\r\n \\fB\\-conf=\\fR<file>\r\n .IP\r\n@@ -43,34 +41,14 @@ location. (default: bitcoin.conf)\r\n .IP\r\n Specify data directory\r\n .HP\r\n-\\fB\\-generate\\fR\r\n-.IP\r\n-Generate blocks, equivalent to RPC getnewaddress followed by RPC\r\n-generatetoaddress. Optional positional integer arguments are\r\n-number of blocks to generate (default: 1) and maximum iterations\r\n-to try (default: 1000000), equivalent to RPC generatetoaddress\r\n-nblocks and maxtries arguments. Example: bitcoin\\-cli \\fB\\-generate\\fR 4\r\n-1000\r\n-.HP\r\n-\\fB\\-getinfo\\fR\r\n+\\fB\\-help\\fR\r\n .IP\r\n-Get general information from the remote server. Note that unlike\r\n-server\\-side RPC calls, the output of \\fB\\-getinfo\\fR is the result of\r\n-multiple non\\-atomic requests. Some entries in the output may\r\n-represent results from different states (e.g. wallet balance may\r\n-be as of a different block from the chain state reported)\r\n+Print this help message and exit (also \\fB\\-h\\fR or \\-?)\r\n .HP\r\n \\fB\\-named\\fR\r\n .IP\r\n Pass named instead of positional arguments (default: false)\r\n .HP\r\n-\\fB\\-netinfo\\fR\r\n-.IP\r\n-Get network peer connection information from the remote server. An\r\n-optional integer argument from 0 to 4 can be passed for different\r\n-peers listings (default: 0). Pass \"help\" for detailed help\r\n-documentation.\r\n-.HP\r\n \\fB\\-rpcclienttimeout=\\fR<n>\r\n .IP\r\n Timeout in seconds during HTTP requests, or 0 for no timeout. (default:\r\n@@ -175,8 +153,42 @@ Consider moving to testnet4 now by using \\fB\\-testnet4\\fR.\r\n \\fB\\-testnet4\\fR\r\n .IP\r\n Use the testnet4 chain. Equivalent to \\fB\\-chain\\fR=\\fI\\,testnet4\\/\\fR.\r\n+.PP\r\n+CLI Commands:\r\n+.HP\r\n+\\fB\\-addrinfo\\fR\r\n+.IP\r\n+Get the number of addresses known to the node, per network and total,\r\n+after filtering for quality and recency. The total number of\r\n+addresses known to the node may be higher.\r\n+.HP\r\n+\\fB\\-generate\\fR\r\n+.IP\r\n+Generate blocks, equivalent to RPC getnewaddress followed by RPC\r\n+generatetoaddress. Optional positional integer arguments are\r\n+number of blocks to generate (default: 1) and maximum iterations\r\n+to try (default: 1000000), equivalent to RPC generatetoaddress\r\n+nblocks and maxtries arguments. Example: bitcoin\\-cli \\fB\\-generate\\fR 4\r\n+1000\r\n+.HP\r\n+\\fB\\-getinfo\\fR\r\n+.IP\r\n+Get general information from the remote server. Note that unlike\r\n+server\\-side RPC calls, the output of \\fB\\-getinfo\\fR is the result of\r\n+multiple non\\-atomic requests. Some entries in the output may\r\n+represent results from different states (e.g. wallet balance may\r\n+be as of a different block from the chain state reported)\r\n+.HP\r\n+\\fB\\-netinfo\\fR\r\n+.IP\r\n+Get network peer connection information from the remote server. An\r\n+optional argument from 0 to 4 can be passed for different peers\r\n+listings (default: 0). If a non\\-zero value is passed, an\r\n+additional \"outonly\" (or \"o\") argument can be passed to see\r\n+outbound peers only. Pass \"help\" (or \"h\") for detailed help\r\n+documentation.\r\n .SH COPYRIGHT\r\n-Copyright (C) 2009-2024 The Bitcoin Core developers\r\n+Copyright (C) 2009-2025 The Bitcoin Core developers\r\n \r\n Please contribute if you find Bitcoin Core useful. Visit\r\n <https://bitcoincore.org/> for further information about the software.\r\ndiff --git a/v28.1/doc/man/bitcoin-qt.1 b/32046/doc/man/bitcoin-qt.1\r\nindex fe76cd9..20b7b96 100644\r\n--- a/v28.1/doc/man/bitcoin-qt.1\r\n+++ b/32046/doc/man/bitcoin-qt.1\r\n@@ -1,20 +1,22 @@\r\n .\\\" DO NOT MODIFY THIS FILE!  It was generated by help2man 1.49.3.\r\n-.TH BITCOIN-QT \"1\" \"December 2024\" \"bitcoin-qt v28.1.0\" \"User Commands\"\r\n+.TH BITCOIN-QT \"1\" \"March 2025\" \"bitcoin-qt v29.0.0rc1\" \"User Commands\"\r\n .SH NAME\r\n-bitcoin-qt \\- manual page for bitcoin-qt v28.1.0\r\n+bitcoin-qt \\- manual page for bitcoin-qt v29.0.0rc1\r\n .SH SYNOPSIS\r\n .B bitcoin-qt\r\n-[\\fI\\,command-line options\\/\\fR] [\\fI\\,URI\\/\\fR]\r\n+[\\fI\\,options\\/\\fR] [\\fI\\,URI\\/\\fR]\r\n .SH DESCRIPTION\r\n-Bitcoin Core version v28.1.0\r\n+Bitcoin Core version v29.0.0rc1\r\n .PP\r\n-Optional URI is a Bitcoin address in BIP21 URI format.\r\n+The bitcoin\\-qt application provides a graphical interface for interacting with Bitcoin Core.\r\n+.PP\r\n+It combines the core functionalities of bitcoind with a user\\-friendly interface for wallet management, transaction history, and network statistics.\r\n+.PP\r\n+It is suitable for users who prefer a graphical over a command\\-line interface.\r\n+.PP\r\n+You can optionally specify a payment [URI], in e.g. the BIP21 URI format.\r\n .SH OPTIONS\r\n .HP\r\n-\\-?\r\n-.IP\r\n-Print this help message and exit\r\n-.HP\r\n \\fB\\-alertnotify=\\fR<cmd>\r\n .IP\r\n Execute command when an alert is raised (%s in cmd is replaced by\r\n@@ -30,13 +32,13 @@ datadir as a warning, not an error.\r\n If this block is in the chain assume that it and its ancestors are valid\r\n and potentially skip their script verification (0 to verify all,\r\n default:\r\n-000000000000000000011c5890365bdbe5d25b97ce0057589acaef4f1a57263f,\r\n+00000000000000000001b658dd1120e82e66d2790811f89ede9742ada3ed6d77,\r\n testnet3:\r\n-000000000000000465b1a66c9f386308e8c75acef9201f3f577811da09fc90ad,\r\n+00000000000003fc7967410ba2d0a8a8d50daedc318d43e8baf1a9782c236a57,\r\n testnet4:\r\n-000000005be348057db991fa5d89fe7c4695b667cfb311391a8db374b6f681fd,\r\n+0000000000003ed4f08dbdf6f7d6b271a6bcffce25675cb40aa9fa43179a89f3,\r\n signet:\r\n-0000014aad1d58dddcb964dd749b073374c6306e716b22f573a2efe68d414539)\r\n+000000895a110f46e59eb82bbc5bfb67fa314656009c295509c21b4999f5180a)\r\n .HP\r\n \\fB\\-blockfilterindex=\\fR<type>\r\n .IP\r\n@@ -97,9 +99,9 @@ Specify data directory\r\n .HP\r\n \\fB\\-dbcache=\\fR<n>\r\n .IP\r\n-Maximum database cache size <n> MiB (4 to 16384, default: 450). In\r\n-addition, unused mempool memory is shared for this cache (see\r\n-\\fB\\-maxmempool\\fR).\r\n+Maximum database cache size <n> MiB (minimum 4, default: 450). Make sure\r\n+you have enough RAM. In addition, unused memory allocated to the\r\n+mempool is shared with this cache (see \\fB\\-maxmempool\\fR).\r\n .HP\r\n \\fB\\-debuglogfile=\\fR<file>\r\n .IP\r\n@@ -107,6 +109,10 @@ Specify location of debug log file (default: debug.log). Relative paths\r\n will be prefixed by a net\\-specific datadir location. Pass\r\n \\fB\\-nodebuglogfile\\fR to disable writing the log to a file.\r\n .HP\r\n+\\fB\\-help\\fR\r\n+.IP\r\n+Print this help message and exit (also \\fB\\-h\\fR or \\-?)\r\n+.HP\r\n \\fB\\-includeconf=\\fR<file>\r\n .IP\r\n Specify additional configuration file, relative to the \\fB\\-datadir\\fR path\r\n@@ -319,7 +325,7 @@ base while uppercase is 1024 base\r\n .HP\r\n \\fB\\-natpmp\\fR\r\n .IP\r\n-Use NAT\\-PMP to map the listening port (default: 0)\r\n+Use PCP or NAT\\-PMP to map the listening port (default: 0)\r\n .HP\r\n \\fB\\-networkactive\\fR\r\n .IP\r\n@@ -388,10 +394,6 @@ Tor control host and port to use if onion listening enabled (default:\r\n .IP\r\n Tor control port password (default: empty)\r\n .HP\r\n-\\fB\\-upnp\\fR\r\n-.IP\r\n-Use UPnP to map the listening port (default: 0)\r\n-.HP\r\n \\fB\\-v2transport\\fR\r\n .IP\r\n Support v2 transport (default: 1)\r\n@@ -697,11 +699,6 @@ Relay and mine data carrier transactions (default: 1)\r\n Relay and mine transactions whose data\\-carrying raw scriptPubKey is of\r\n this size or less (default: 83)\r\n .HP\r\n-\\fB\\-mempoolfullrbf\\fR\r\n-.IP\r\n-(DEPRECATED) Accept transaction replace\\-by\\-fee without requiring\r\n-replaceability signaling (default: 1)\r\n-.HP\r\n \\fB\\-minrelaytxfee=\\fR<amt>\r\n .IP\r\n Fees (in BTC/kvB) smaller than this are considered zero fee for\r\n@@ -727,12 +724,18 @@ Block creation options:\r\n .HP\r\n \\fB\\-blockmaxweight=\\fR<n>\r\n .IP\r\n-Set maximum BIP141 block weight (default: 3996000)\r\n+Set maximum BIP141 block weight (default: 4000000)\r\n .HP\r\n \\fB\\-blockmintxfee=\\fR<amt>\r\n .IP\r\n Set lowest fee rate (in BTC/kvB) for transactions to be included in\r\n block creation. (default: 0.00001)\r\n+.HP\r\n+\\fB\\-blockreservedweight=\\fR<n>\r\n+.IP\r\n+Reserve space for the fixed\\-size block header plus the largest coinbase\r\n+transaction the mining software may add to the block. (default:\r\n+8000).\r\n .PP\r\n RPC server options:\r\n .HP\r\n@@ -787,7 +790,7 @@ Listen for JSON\\-RPC connections on <port> (default: 8332, testnet3:\r\n .HP\r\n \\fB\\-rpcthreads=\\fR<n>\r\n .IP\r\n-Set the number of threads to service RPC calls (default: 4)\r\n+Set the number of threads to service RPC calls (default: 16)\r\n .HP\r\n \\fB\\-rpcuser=\\fR<user>\r\n .IP\r\n@@ -836,7 +839,7 @@ Reset all settings changed in the GUI\r\n .IP\r\n Show splash screen on startup (default: 1)\r\n .SH COPYRIGHT\r\n-Copyright (C) 2009-2024 The Bitcoin Core developers\r\n+Copyright (C) 2009-2025 The Bitcoin Core developers\r\n \r\n Please contribute if you find Bitcoin Core useful. Visit\r\n <https://bitcoincore.org/> for further information about the software.\r\ndiff --git a/v28.1/doc/man/bitcoin-tx.1 b/32046/doc/man/bitcoin-tx.1\r\nindex 26cbd9b..b493f91 100644\r\n--- a/v28.1/doc/man/bitcoin-tx.1\r\n+++ b/32046/doc/man/bitcoin-tx.1\r\n@@ -1,25 +1,29 @@\r\n .\\\" DO NOT MODIFY THIS FILE!  It was generated by help2man 1.49.3.\r\n-.TH BITCOIN-TX \"1\" \"December 2024\" \"bitcoin-tx v28.1.0\" \"User Commands\"\r\n+.TH BITCOIN-TX \"1\" \"March 2025\" \"bitcoin-tx v29.0.0rc1\" \"User Commands\"\r\n .SH NAME\r\n-bitcoin-tx \\- manual page for bitcoin-tx v28.1.0\r\n+bitcoin-tx \\- manual page for bitcoin-tx v29.0.0rc1\r\n .SH SYNOPSIS\r\n .B bitcoin-tx\r\n-[\\fI\\,options\\/\\fR] \\fI\\,<hex-tx> \\/\\fR[\\fI\\,commands\\/\\fR]  \\fI\\,Update hex-encoded bitcoin transaction\\/\\fR\r\n+[\\fI\\,options\\/\\fR] \\fI\\,<hex-tx> \\/\\fR[\\fI\\,commands\\/\\fR]\r\n .br\r\n .B bitcoin-tx\r\n-[\\fI\\,options\\/\\fR] \\fI\\,-create \\/\\fR[\\fI\\,commands\\/\\fR]   \\fI\\,Create hex-encoded bitcoin transaction\\/\\fR\r\n+[\\fI\\,options\\/\\fR] \\fI\\,-create \\/\\fR[\\fI\\,commands\\/\\fR]\r\n .SH DESCRIPTION\r\n-Bitcoin Core bitcoin\\-tx utility version v28.1.0\r\n+Bitcoin Core bitcoin\\-tx utility version v29.0.0rc1\r\n+.PP\r\n+The bitcoin\\-tx tool is used for creating and modifying bitcoin transactions.\r\n+.PP\r\n+bitcoin\\-tx can be used with \"<hex\\-tx> [commands]\" to update a hex\\-encoded bitcoin transaction, or with \"\\-create [commands]\" to create a hex\\-encoded bitcoin transaction.\r\n .SH OPTIONS\r\n .HP\r\n-\\-?\r\n-.IP\r\n-Print this help message and exit\r\n-.HP\r\n \\fB\\-create\\fR\r\n .IP\r\n Create new, empty TX.\r\n .HP\r\n+\\fB\\-help\\fR\r\n+.IP\r\n+Print this help message and exit (also \\fB\\-h\\fR or \\-?)\r\n+.HP\r\n \\fB\\-json\\fR\r\n .IP\r\n Select JSON output\r\n@@ -142,7 +146,7 @@ set=NAME:JSON\\-STRING\r\n .IP\r\n Set register NAME to given JSON\\-STRING\r\n .SH COPYRIGHT\r\n-Copyright (C) 2009-2024 The Bitcoin Core developers\r\n+Copyright (C) 2009-2025 The Bitcoin Core developers\r\n \r\n Please contribute if you find Bitcoin Core useful. Visit\r\n <https://bitcoincore.org/> for further information about the software.\r\ndiff --git a/v28.1/doc/man/bitcoin-util.1 b/32046/doc/man/bitcoin-util.1\r\nindex 415e6d0..74cf232 100644\r\n--- a/v28.1/doc/man/bitcoin-util.1\r\n+++ b/32046/doc/man/bitcoin-util.1\r\n@@ -1,17 +1,22 @@\r\n .\\\" DO NOT MODIFY THIS FILE!  It was generated by help2man 1.49.3.\r\n-.TH BITCOIN-UTIL \"1\" \"December 2024\" \"bitcoin-util v28.1.0\" \"User Commands\"\r\n+.TH BITCOIN-UTIL \"1\" \"March 2025\" \"bitcoin-util v29.0.0rc1\" \"User Commands\"\r\n .SH NAME\r\n-bitcoin-util \\- manual page for bitcoin-util v28.1.0\r\n+bitcoin-util \\- manual page for bitcoin-util v29.0.0rc1\r\n .SH SYNOPSIS\r\n .B bitcoin-util\r\n-[\\fI\\,options\\/\\fR] [\\fI\\,commands\\/\\fR]  \\fI\\,Do stuff\\/\\fR\r\n+[\\fI\\,options\\/\\fR] [\\fI\\,command\\/\\fR]\r\n+.br\r\n+.B bitcoin-util\r\n+[\\fI\\,options\\/\\fR] \\fI\\,grind <hex-block-header>\\/\\fR\r\n .SH DESCRIPTION\r\n-Bitcoin Core bitcoin\\-util utility version v28.1.0\r\n+Bitcoin Core bitcoin\\-util utility version v29.0.0rc1\r\n+.PP\r\n+The bitcoin\\-util tool provides bitcoin related functionality that does not rely on the ability to access a running node. Available [commands] are listed below.\r\n .SH OPTIONS\r\n .HP\r\n-\\-?\r\n+\\fB\\-help\\fR\r\n .IP\r\n-Print this help message and exit\r\n+Print this help message and exit (also \\fB\\-h\\fR or \\-?)\r\n .HP\r\n \\fB\\-version\\fR\r\n .IP\r\n@@ -60,7 +65,7 @@ grind\r\n .IP\r\n Perform proof of work on hex header string\r\n .SH COPYRIGHT\r\n-Copyright (C) 2009-2024 The Bitcoin Core developers\r\n+Copyright (C) 2009-2025 The Bitcoin Core developers\r\n \r\n Please contribute if you find Bitcoin Core useful. Visit\r\n <https://bitcoincore.org/> for further information about the software.\r\ndiff --git a/v28.1/doc/man/bitcoin-wallet.1 b/32046/doc/man/bitcoin-wallet.1\r\nindex a043129..dbf3010 100644\r\n--- a/v28.1/doc/man/bitcoin-wallet.1\r\n+++ b/32046/doc/man/bitcoin-wallet.1\r\n@@ -1,22 +1,20 @@\r\n .\\\" DO NOT MODIFY THIS FILE!  It was generated by help2man 1.49.3.\r\n-.TH BITCOIN-WALLET \"1\" \"December 2024\" \"bitcoin-wallet v28.1.0\" \"User Commands\"\r\n+.TH BITCOIN-WALLET \"1\" \"March 2025\" \"bitcoin-wallet v29.0.0rc1\" \"User Commands\"\r\n .SH NAME\r\n-bitcoin-wallet \\- manual page for bitcoin-wallet v28.1.0\r\n+bitcoin-wallet \\- manual page for bitcoin-wallet v29.0.0rc1\r\n+.SH SYNOPSIS\r\n+.B bitcoin-wallet\r\n+[\\fI\\,options\\/\\fR] \\fI\\,<command>\\/\\fR\r\n .SH DESCRIPTION\r\n-Bitcoin Core bitcoin\\-wallet version v28.1.0\r\n+Bitcoin Core bitcoin\\-wallet utility version v29.0.0rc1\r\n .PP\r\n bitcoin\\-wallet is an offline tool for creating and interacting with Bitcoin Core wallet files.\r\n+.PP\r\n By default bitcoin\\-wallet will act on wallets in the default mainnet wallet directory in the datadir.\r\n-To change the target wallet, use the \\fB\\-datadir\\fR, \\fB\\-wallet\\fR and \\fB\\-regtest\\fR/\\-signet/\\-testnet/\\-testnet4 arguments.\r\n-.SS \"Usage:\"\r\n-.IP\r\n-bitcoin\\-wallet [options] <command>\r\n+.PP\r\n+To change the target wallet, use the \\fB\\-datadir\\fR, \\fB\\-wallet\\fR and (test)chain selection arguments.\r\n .SH OPTIONS\r\n .HP\r\n-\\-?\r\n-.IP\r\n-Print this help message and exit\r\n-.HP\r\n \\fB\\-datadir=\\fR<dir>\r\n .IP\r\n Specify data directory\r\n@@ -35,6 +33,10 @@ with 'createfromdump', loads the records into a new wallet.\r\n The format of the wallet file to create. Either \"bdb\" or \"sqlite\". Only\r\n used with 'createfromdump'\r\n .HP\r\n+\\fB\\-help\\fR\r\n+.IP\r\n+Print this help message and exit (also \\fB\\-h\\fR or \\-?)\r\n+.HP\r\n \\fB\\-legacy\\fR\r\n .IP\r\n Create legacy wallet. Only for 'create'\r\n@@ -121,7 +123,7 @@ salvage\r\n Attempt to recover private keys from a corrupt wallet. Warning:\r\n \\&'salvage' is experimental.\r\n .SH COPYRIGHT\r\n-Copyright (C) 2009-2024 The Bitcoin Core developers\r\n+Copyright (C) 2009-2025 The Bitcoin Core developers\r\n \r\n Please contribute if you find Bitcoin Core useful. Visit\r\n <https://bitcoincore.org/> for further information about the software.\r\ndiff --git a/v28.1/doc/man/bitcoind.1 b/32046/doc/man/bitcoind.1\r\nindex 1acb2df..865a59e 100644\r\n--- a/v28.1/doc/man/bitcoind.1\r\n+++ b/32046/doc/man/bitcoind.1\r\n@@ -1,18 +1,22 @@\r\n .\\\" DO NOT MODIFY THIS FILE!  It was generated by help2man 1.49.3.\r\n-.TH BITCOIND \"1\" \"December 2024\" \"bitcoind v28.1.0\" \"User Commands\"\r\n+.TH BITCOIND \"1\" \"March 2025\" \"bitcoind v29.0.0rc1\" \"User Commands\"\r\n .SH NAME\r\n-bitcoind \\- manual page for bitcoind v28.1.0\r\n+bitcoind \\- manual page for bitcoind v29.0.0rc1\r\n .SH SYNOPSIS\r\n .B bitcoind\r\n-[\\fI\\,options\\/\\fR]                     \\fI\\,Start Bitcoin Core\\/\\fR\r\n+[\\fI\\,options\\/\\fR]\r\n .SH DESCRIPTION\r\n-Bitcoin Core version v28.1.0\r\n+Bitcoin Core daemon version v29.0.0rc1\r\n+.PP\r\n+The Bitcoin Core daemon (bitcoind) is a headless program that connects to the Bitcoin network to validate and relay transactions and blocks, as well as relaying addresses.\r\n+.PP\r\n+It provides the backbone of the Bitcoin network and its RPC, REST and ZMQ services can provide various transaction, block and address\\-related services.\r\n+.PP\r\n+There is an optional wallet component which provides transaction services.\r\n+.PP\r\n+It can be used in a headless environment or as part of a server setup.\r\n .SH OPTIONS\r\n .HP\r\n-\\-?\r\n-.IP\r\n-Print this help message and exit\r\n-.HP\r\n \\fB\\-alertnotify=\\fR<cmd>\r\n .IP\r\n Execute command when an alert is raised (%s in cmd is replaced by\r\n@@ -28,13 +32,13 @@ datadir as a warning, not an error.\r\n If this block is in the chain assume that it and its ancestors are valid\r\n and potentially skip their script verification (0 to verify all,\r\n default:\r\n-000000000000000000011c5890365bdbe5d25b97ce0057589acaef4f1a57263f,\r\n+00000000000000000001b658dd1120e82e66d2790811f89ede9742ada3ed6d77,\r\n testnet3:\r\n-000000000000000465b1a66c9f386308e8c75acef9201f3f577811da09fc90ad,\r\n+00000000000003fc7967410ba2d0a8a8d50daedc318d43e8baf1a9782c236a57,\r\n testnet4:\r\n-000000005be348057db991fa5d89fe7c4695b667cfb311391a8db374b6f681fd,\r\n+0000000000003ed4f08dbdf6f7d6b271a6bcffce25675cb40aa9fa43179a89f3,\r\n signet:\r\n-0000014aad1d58dddcb964dd749b073374c6306e716b22f573a2efe68d414539)\r\n+000000895a110f46e59eb82bbc5bfb67fa314656009c295509c21b4999f5180a)\r\n .HP\r\n \\fB\\-blockfilterindex=\\fR<type>\r\n .IP\r\n@@ -95,9 +99,9 @@ Specify data directory\r\n .HP\r\n \\fB\\-dbcache=\\fR<n>\r\n .IP\r\n-Maximum database cache size <n> MiB (4 to 16384, default: 450). In\r\n-addition, unused mempool memory is shared for this cache (see\r\n-\\fB\\-maxmempool\\fR).\r\n+Maximum database cache size <n> MiB (minimum 4, default: 450). Make sure\r\n+you have enough RAM. In addition, unused memory allocated to the\r\n+mempool is shared with this cache (see \\fB\\-maxmempool\\fR).\r\n .HP\r\n \\fB\\-debuglogfile=\\fR<file>\r\n .IP\r\n@@ -105,6 +109,10 @@ Specify location of debug log file (default: debug.log). Relative paths\r\n will be prefixed by a net\\-specific datadir location. Pass\r\n \\fB\\-nodebuglogfile\\fR to disable writing the log to a file.\r\n .HP\r\n+\\fB\\-help\\fR\r\n+.IP\r\n+Print this help message and exit (also \\fB\\-h\\fR or \\-?)\r\n+.HP\r\n \\fB\\-includeconf=\\fR<file>\r\n .IP\r\n Specify additional configuration file, relative to the \\fB\\-datadir\\fR path\r\n@@ -317,7 +325,7 @@ base while uppercase is 1024 base\r\n .HP\r\n \\fB\\-natpmp\\fR\r\n .IP\r\n-Use NAT\\-PMP to map the listening port (default: 0)\r\n+Use PCP or NAT\\-PMP to map the listening port (default: 0)\r\n .HP\r\n \\fB\\-networkactive\\fR\r\n .IP\r\n@@ -386,10 +394,6 @@ Tor control host and port to use if onion listening enabled (default:\r\n .IP\r\n Tor control port password (default: empty)\r\n .HP\r\n-\\fB\\-upnp\\fR\r\n-.IP\r\n-Use UPnP to map the listening port (default: 0)\r\n-.HP\r\n \\fB\\-v2transport\\fR\r\n .IP\r\n Support v2 transport (default: 1)\r\n@@ -695,11 +699,6 @@ Relay and mine data carrier transactions (default: 1)\r\n Relay and mine transactions whose data\\-carrying raw scriptPubKey is of\r\n this size or less (default: 83)\r\n .HP\r\n-\\fB\\-mempoolfullrbf\\fR\r\n-.IP\r\n-(DEPRECATED) Accept transaction replace\\-by\\-fee without requiring\r\n-replaceability signaling (default: 1)\r\n-.HP\r\n \\fB\\-minrelaytxfee=\\fR<amt>\r\n .IP\r\n Fees (in BTC/kvB) smaller than this are considered zero fee for\r\n@@ -725,12 +724,18 @@ Block creation options:\r\n .HP\r\n \\fB\\-blockmaxweight=\\fR<n>\r\n .IP\r\n-Set maximum BIP141 block weight (default: 3996000)\r\n+Set maximum BIP141 block weight (default: 4000000)\r\n .HP\r\n \\fB\\-blockmintxfee=\\fR<amt>\r\n .IP\r\n Set lowest fee rate (in BTC/kvB) for transactions to be included in\r\n block creation. (default: 0.00001)\r\n+.HP\r\n+\\fB\\-blockreservedweight=\\fR<n>\r\n+.IP\r\n+Reserve space for the fixed\\-size block header plus the largest coinbase\r\n+transaction the mining software may add to the block. (default:\r\n+8000).\r\n .PP\r\n RPC server options:\r\n .HP\r\n@@ -785,7 +790,7 @@ Listen for JSON\\-RPC connections on <port> (default: 8332, testnet3:\r\n .HP\r\n \\fB\\-rpcthreads=\\fR<n>\r\n .IP\r\n-Set the number of threads to service RPC calls (default: 4)\r\n+Set the number of threads to service RPC calls (default: 16)\r\n .HP\r\n \\fB\\-rpcuser=\\fR<user>\r\n .IP\r\n@@ -812,7 +817,7 @@ subject to empty whitelists.\r\n .IP\r\n Accept command line and JSON\\-RPC commands\r\n .SH COPYRIGHT\r\n-Copyright (C) 2009-2024 The Bitcoin Core developers\r\n+Copyright (C) 2009-2025 The Bitcoin Core developers\r\n \r\n Please contribute if you find Bitcoin Core useful. Visit\r\n <https://bitcoincore.org/> for further information about the software.\r\n\r\n```\r\n</details>",
          "created_at": "2025-03-12T22:22:14Z"
        },
        {
          "user": "achow101",
          "body": "ACK 47e2fa86dc5433852fd9e5050a23de2accfdca8\r\n\r\nOther than the issue with the example bitcoin.conf, everything seems correct. I think we can move forward with rc1 and just backport the gen-bitcoin-conf.sh fixes for rc2 (or final). The script has to be rerun for every rc anyways.",
          "created_at": "2025-03-12T23:48:52Z"
        },
        {
          "user": "davidgumberg",
          "body": "ACK https://github.com/bitcoin/bitcoin/commit/47e2fa86dc5433852fd9e5050a23de2accfdca8d\r\n \r\nI'm ~0 on whether or not the release candidate should be held up by the example `bitcoin.conf`, but everything else looks good to me.",
          "created_at": "2025-03-13T01:00:16Z"
        },
        {
          "user": "fanquake",
          "body": "There's likely going to be more rcs than usual, so just getting this out for testing with the incomplete example .conf is fine.",
          "created_at": "2025-03-13T03:47:18Z"
        }
      ]
    },
    {
      "number": 32044,
      "title": "ci: Revert \"Temporary workaround for old CCACHE_DIR cirrus env\"",
      "body": "Seems fine to revert this now. If this still happens it should be rare enough and trivial to fix via a new push (normal push, force-push, rebase, ...), or to just ignore the failure.",
      "state": "closed",
      "user": "maflcko",
      "created_at": "2025-03-12T16:46:45Z",
      "updated_at": "2025-03-13T08:50:17Z",
      "comments": 1,
      "url": "https://github.com/bitcoin/bitcoin/pull/32044",
      "labels": [
        "Tests"
      ],
      "comment_list": [
        {
          "user": "DrahtBot",
          "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/32044.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| ACK | [fanquake](https://github.com/bitcoin/bitcoin/pull/32044#pullrequestreview-2680189403) |\n\nIf your review is incorrectly listed, please react with ðŸ‘Ž to this comment and the bot will ignore it on the next update.\n",
          "created_at": "2025-03-12T16:46:49Z"
        }
      ]
    },
    {
      "number": 32043,
      "title": "[IBD] Tracking PR for speeding up Initial Block Download",
      "body": "During the last Core Dev meeting, it was proposed to create a tracking PR aggregating the individual IBD optimizations - to illustrate how these changes contribute to the broader performance improvement efforts.\r\n\r\n## Summary: **>20%** full IBD speedup\r\nWe don't have many low-hanging fruits anymore, but big speed improvements can also be achieved by many small, focused changes.\r\nMany optimization opportunities are hiding in consensus critical code - this tracking PR provides justification for why those should also be considered.\r\nThe unmerged changes here collectively achieve a **>20%** speedup for full IBD (measured by multiple real runs until 886'000 blocks using 5GiB in-memory cache): from **8.59 hours** on master to **7.25 hours** for the PR.\r\n\r\nAnyone can (and is encouraged to) reproduce the results by following this guide: https://gist.github.com/l0rinc/83d2bdfce378ad7396610095ceb7bed5\r\n\r\n## Related issues:\r\n* https://github.com/bitcoin/bitcoin/issues/32832\r\n* https://github.com/bitcoin/bitcoin/issues/31494\r\n\r\n## PRs included here (in review priority order):\r\n* [x] https://github.com/bitcoin/bitcoin/pull/31490\r\n* [x] https://github.com/bitcoin/bitcoin/pull/31551\r\n* [x] https://github.com/bitcoin/bitcoin/pull/32487\r\n* [x] https://github.com/bitcoin/bitcoin/pull/31144\r\n* [x] https://github.com/bitcoin/bitcoin/pull/32827\r\n* [x] https://github.com/bitcoin/bitcoin/pull/32279\r\n* [x] https://github.com/bitcoin/bitcoin/pull/31645\r\n* [x] https://github.com/bitcoin/bitcoin/pull/33602\r\n* [x] https://github.com/bitcoin/bitcoin/pull/30442\r\n* [ ] https://github.com/bitcoin/bitcoin/pull/32497\r\n* [ ] https://github.com/bitcoin/bitcoin/pull/31132\r\n* [ ] https://github.com/bitcoin/bitcoin/pull/31682\r\n* [ ] https://github.com/bitcoin/bitcoin/pull/31868\r\n\r\n## Changing trends\r\nThe UTXO count and average block size have drastically increased in the past few years, providing a better overall picture of how Bitcoin behaves under real load.\r\n[<img width=\"500\" alt=\"image\" src=\"https://github.com/user-attachments/assets/d257b864-d9de-4f9d-b61b-acc6835f384f\" />](https://www.blockchain.com/explorer/charts/avg-block-size)\r\nProfiling IBD, given these circumstances, revealed many new optimization opportunities.\r\n\r\n## Similar efforts in the past years\r\n\r\nThere were many efforts to make sure Bitcoin Core remains performant in light of these new trends, a few recent notable examples include:\r\n* https://github.com/bitcoin/bitcoin/pull/25325 - use specialized pool allocator for in-memory cache (~21% faster IBD)\r\n* https://github.com/bitcoin/bitcoin/pull/28358 - allow the full UTXO set to fit into memory\r\n* https://github.com/bitcoin/bitcoin/pull/28280#issuecomment-2273368482 - fine-grained in-memory cache eviction for pruned nodes (~30% IBD speedup on pruned nodes)\r\n* https://github.com/bitcoin/bitcoin/pull/30039#issuecomment-2397229720 - reduce LevelDB writes, compactions and open files (~30% faster IBD for small in-memory cache)\r\n* https://github.com/bitcoin/bitcoin/pull/31490, https://github.com/bitcoin/bitcoin/pull/30849, https://github.com/bitcoin/bitcoin/pull/30906 - refactors derisking/enabling follow-up optimizations\r\n* https://github.com/bitcoin/bitcoin/pull/30326 - favor the happy path for cache misses (~2% IBD speedup)\r\n* https://github.com/bitcoin/bitcoin/pull/30884 - Windows regression fix\r\n\r\n## Reliable macro benchmarks\r\n\r\nThe measurements here were done on a high-end Intel i9-9900K CPU (8 cores/16 threads, 3.6GHz base, 5.0GHz boost), 64GB RAM, and a RAID configuration with multiple NVMe drives (total ~1.4TB fast storage), a dedicated Hetzner Auction box running latest Ubuntu. Sometimes a lower-end i7 was used with an HDD for comparison.\r\n\r\nTo make sure the setup reflected a real user's experience, we ran multiple full IBDs per commit (connecting to real nodes), until block 886'000 with a 5GiB in-memory cache where hyperfine was used to measure the final time (assuming normal distribution, stabilizing the final result via statistical methods), producing reliable results even when individual measurements varied (when hyperfine indicated that the measurements were all over the place we reran the whole benchmark).\r\nTo reduce the instability of headers synchronization and peer acquisition, we first started `bitcoind` until block 1, followed by the actual benchmarks until block 886'000.\r\n\r\nThe top 2 PRs (https://github.com/bitcoin/bitcoin/pull/31551 and https://github.com/bitcoin/bitcoin/pull/31144) were measured together by multiple people with different settings (and varying results):\r\n* @andrewtoth in https://github.com/bitcoin/bitcoin/pull/31144#issuecomment-2585403343 - 9% speedup with GCC\r\n* @hodlinator in https://github.com/bitcoin/bitcoin/pull/31144#issuecomment-2588220255 - 11.9% speedup with GCC\r\n* @mlori in https://github.com/bitcoin/bitcoin/pull/31144#issuecomment-2664077362 - 12% faster with GCC\r\n* @Sjors in https://github.com/bitcoin/bitcoin/pull/31144#issuecomment-2575279833 - 3% speedup with Clang\r\n\r\nAlso note that there is a separate effort to [add a reliable macro-benchmarking suite](https://github.com/bitcoin/bitcoin/pull/31996) to track the performance of the most critical usecases end-to-end (including IBD, compact blocks, UTXO iteration) - still WIP, not yet used here.\r\n\r\n## Current changes (in order of importance, reviews and reproducers are welcome):\r\n\r\nPlotting the performance of the blocks from the produced `debug.log` files (taken from the last run for each commit - can differ slightly from the normalized average shown below) visualizing the effect of each commit:\r\n\r\n<details>\r\n<summary>debug.log visualizer</summary>\r\n\r\n```python\r\nimport os\r\nimport sys\r\nimport re\r\nfrom datetime import datetime\r\nimport matplotlib.pyplot as plt\r\nimport numpy as np\r\n\r\n\r\ndef process_log_files_and_plot(log_dir, output_file=\"block_height_progress.png\"):\r\n    if not os.path.exists(log_dir) or not os.path.isdir(log_dir):\r\n        print(f\"Error: '{log_dir}' is not a valid directory\", file=sys.stderr)\r\n        return\r\n\r\n    debug_files = [f for f in os.listdir(log_dir) if\r\n                   f.startswith('debug-') and os.path.isfile(os.path.join(log_dir, f))]\r\n    if not debug_files:\r\n        print(f\"Warning: No debug files found in '{log_dir}'\", file=sys.stderr)\r\n        return\r\n\r\n    height_pattern = re.compile(r'UpdateTip:.*height=(\\d+)')\r\n    results = {}\r\n\r\n    for filename in debug_files:\r\n        filepath = os.path.join(log_dir, filename)\r\n        print(f\"Processing {filename}...\", file=sys.stderr)\r\n\r\n        update_tips = []\r\n        first_timestamp = None\r\n        line_count = tip_count = 0\r\n        found_shutdown_done = False\r\n\r\n        try:\r\n            with open(filepath, 'r', errors='ignore') as file:\r\n                for line_number, line in enumerate(file, 1):\r\n                    line_count += 1\r\n                    if line_count % 100000 == 0:\r\n                        print(f\"  Processed {line_count} lines, found {tip_count} UpdateTips...\", file=sys.stderr)\r\n\r\n                    if not found_shutdown_done:\r\n                        if \"Shutdown: done\" in line:\r\n                            found_shutdown_done = True\r\n                            print(f\"  Found 'Shutdown: done' at line {line_number}, starting to record\",\r\n                                  file=sys.stderr)\r\n                        continue\r\n\r\n                    if len(line) < 20 or \"UpdateTip:\" not in line:\r\n                        continue\r\n\r\n                    try:\r\n                        timestamp = datetime.strptime(line[:20], \"%Y-%m-%dT%H:%M:%SZ\")\r\n                        height_match = height_pattern.search(line)\r\n                        if not height_match:\r\n                            continue\r\n\r\n                        height = int(height_match.group(1))\r\n                        if first_timestamp is None:\r\n                            first_timestamp = timestamp\r\n\r\n                        update_tips.append((int((timestamp - first_timestamp).total_seconds()), height))\r\n                        tip_count += 1\r\n                    except ValueError:\r\n                        continue\r\n        except Exception as e:\r\n            print(f\"Error processing {filename}: {e}\", file=sys.stderr)\r\n            continue\r\n\r\n        print(f\"Finished processing {filename}: {line_count} lines, {tip_count} UpdateTips\", file=sys.stderr)\r\n\r\n        if update_tips:\r\n            time_dict = {}\r\n            for time, height in update_tips:\r\n                time_dict[time] = height\r\n            results[filename[6:14]] = sorted(time_dict.items())\r\n\r\n    if not results:\r\n        print(\"No valid data found in any files.\", file=sys.stderr)\r\n        return\r\n\r\n    print(f\"Creating plots with data from {len(results)} files\", file=sys.stderr)\r\n\r\n    sorted_results = []\r\n    for name, pairs in results.items():\r\n        if pairs:\r\n            sorted_results.append((name, pairs[-1][0] / 3600, pairs))\r\n\r\n    sorted_results.sort(key=lambda x: x[1], reverse=True)\r\n    colors = plt.cm.tab10(np.linspace(0, 1, len(sorted_results)))\r\n\r\n    # Plot 1: Height vs Time\r\n    plt.figure(figsize=(12, 8))\r\n\r\n    final_points = []\r\n    for idx, (name, last_time, pairs) in enumerate(sorted_results):\r\n        times = [t / 3600 for t, _ in pairs]\r\n        heights = [h for _, h in pairs]\r\n        plt.plot(heights, times, label=f\"{name} ({last_time:.2f}h)\", color=colors[idx], linewidth=1)\r\n        if pairs:\r\n            final_points.append((last_time, pairs[-1][1], colors[idx]))\r\n\r\n    for time, height, color in final_points:\r\n        plt.axhline(y=time, color=color, linestyle='--', alpha=0.3)\r\n        plt.axvline(x=height, color=color, linestyle='--', alpha=0.3)\r\n\r\n    plt.title('Sync Time by Block Height')\r\n    plt.xlabel('Block Height')\r\n    plt.ylabel('Elapsed Time (hours)')\r\n    plt.grid(True, linestyle='--', alpha=0.7)\r\n    plt.legend(loc='center left')\r\n    plt.tight_layout()\r\n\r\n    plt.savefig(output_file.replace('.png', '_reversed.png'), dpi=300)\r\n\r\n    # Plot 2: Performance Ratio by Time\r\n    if len(sorted_results) > 1:\r\n        plt.figure(figsize=(12, 8))\r\n\r\n        baseline = sorted_results[0]\r\n        baseline_time_by_height = {h: t for t, h in baseline[2]}\r\n\r\n        for idx, (name, _, pairs) in enumerate(sorted_results[1:], 1):\r\n            time_by_height = {h: t for t, h in pairs}\r\n\r\n            common_heights = [h for h in baseline_time_by_height.keys()\r\n                              if h >= 400000 and h in time_by_height]\r\n            common_heights.sort()\r\n\r\n            ratios = []\r\n            base_times = []\r\n\r\n            for h in common_heights:\r\n                base_t = baseline_time_by_height[h]\r\n                result_t = time_by_height[h]\r\n\r\n                if result_t > 0:\r\n                    ratios.append(base_t / result_t)\r\n                    base_times.append(base_t / 3600)\r\n\r\n            plt.plot(base_times, ratios,\r\n                     label=f\"{name} vs {baseline[0]}\",\r\n                     color=colors[idx], linewidth=1)\r\n\r\n        plt.axhline(y=1, color='gray', linestyle='--', alpha=0.7)\r\n\r\n        plt.title('Performance Improvement Over Time (Higher is Better)')\r\n        plt.xlabel('Baseline Elapsed Time (hours)')\r\n        plt.ylabel('Speedup Ratio (baseline_time / commit_time)')\r\n        plt.grid(True, linestyle='--', alpha=0.7)\r\n        plt.legend(loc='best')\r\n        plt.tight_layout()\r\n\r\n        plt.savefig(output_file.replace('.png', '_time_ratio.png'), dpi=300)\r\n\r\n    with open(output_file.replace('.png', '.csv'), 'w') as f:\r\n        for name, _, pairs in sorted_results:\r\n            f.write(f\"{name},{','.join(f'{t}:{h}' for t, h in pairs)}\\n\")\r\n\r\n    plt.show()\r\n\r\n\r\nif __name__ == \"__main__\":\r\n    log_dir = sys.argv[1] if len(sys.argv) > 1 else \".\"\r\n    output_file = sys.argv[2] if len(sys.argv) > 2 else \"block_height_progress.png\"\r\n    process_log_files_and_plot(log_dir, output_file)\r\n\r\n```\r\n\r\n</details>\r\n\r\n<img width=\"1000\" alt=\"image\" src=\"https://github.com/user-attachments/assets/a43b43da-209c-4736-b1ef-d4d57f838d74\" />\r\n\r\n\r\n<img width=\"1000\" alt=\"image\" src=\"https://github.com/user-attachments/assets/2d43d867-0c9e-4daf-9d47-bd1148c48b55\" />\r\n\r\n\r\n### Baseline\r\nBase commit was 88debb3e42.\r\n\r\n<details>\r\n<summary>8.59 hour IBD time</summary>\r\n\r\n```bash\r\nCOMPILER=gcc COMMIT=88debb3e4297ef4ebc8966ffe599359bc7b231d0 ./build/bin/bitcoind -datadir=/mnt/my_storage/BitcoinData -stopatheight=886000 -dbcache=5000 -blocksonly -printtoconsole=0\r\n  Time (mean Â± Ïƒ):     30932.610 s Â± 156.891 s    [User: 58248.505 s, System: 2142.974 s]\r\n  Range (min â€¦ max):   30821.671 s â€¦ 31043.549 s    2 runs\r\n  ```\r\n\r\n</details>\r\n\r\n-----\r\n\r\n* https://github.com/bitcoin/bitcoin/pull/31551\r\n\r\n<details>\r\n<summary>7.91 hour IBD time</summary>\r\n\r\n```bash\r\nCOMPILER=gcc COMMIT=6a8ce46e32dae2ffef2a73d2314ca33a2039186e ./build/bin/bitcoind -datadir=/mnt/my_storage/BitcoinData -stopatheight=886000 -dbcache=5000 -blocksonly -printtoconsole=0\r\n  Time (mean Â± Ïƒ):     28501.588 s Â± 119.886 s    [User: 56419.060 s, System: 1833.126 s]\r\n  Range (min â€¦ max):   28416.815 s â€¦ 28586.361 s    2 runs\r\n```\r\n\r\nWe can serialize the blocks and undos to any `Stream` which implements the appropriate read/write methods.\r\n`AutoFile` is one of these, writing the results \"directly\" to disk (through the OS file cache). Batching these in memory first and reading/writing these to disk is measurably faster (likely because of fewer native fread calls or less locking, as [observed](https://github.com/bitcoin/bitcoin/pull/28226#issuecomment-1666842501) by @martinus in a similar change).\r\n\r\nDifferential flame graphs indicate that the before/after speed change is because of fewer `AutoFile` reads and writes:\r\n![writes](https://github.com/user-attachments/assets/c5e45ddf-3a94-4c5b-999a-94a139d5776d)\r\n![reads](https://github.com/user-attachments/assets/f11982ea-f2dc-4fc6-afce-faa132724658)\r\n</details>\r\n\r\n-----\r\n\r\n* https://github.com/bitcoin/bitcoin/pull/31144\r\n\r\n<details>\r\n<summary>7.60 hour IBD time</summary>\r\n\r\n```bash\r\nCOMPILER=gcc COMMIT=c5cc54d10187c9cb3a6cba8cc10f652b4f882e2a ./build/bin/bitcoind -datadir=/mnt/my_storage/BitcoinData -stopatheight=886000 -dbcache=5000 -blocksonly -printtoconsole=0\r\n  Time (mean Â± Ïƒ):     27394.210 s Â± 565.877 s    [User: 54902.315 s, System: 1891.951 s]\r\n  Range (min â€¦ max):   26994.075 s â€¦ 27794.346 s    2 runs\r\n```\r\n</details>\r\n\r\nCurrent block obfuscations are done byte-by-byte, this PR batches them to 64 bit primitives to speed up obfuscating bigger memory batches.\r\nThis is especially relevant after https://github.com/bitcoin/bitcoin/pull/31551 where we end up with bigger obfuscatable chunks.\r\n\r\n![obfuscation calls during IBD without batching](https://github.com/user-attachments/assets/b521e3fc-f8cd-42d8-9068-a9b23f65b45b)\r\n\r\n-----\r\n\r\n* https://github.com/bitcoin/bitcoin/pull/31645\r\n\r\n<details>\r\n<summary>7.50 hour IBD time</summary>\r\n\r\n```bash\r\nCOMPILER=gcc COMMIT=9b4be912d20222b3b275ef056c1494a15ccde3f5 ./build/bin/bitcoind -datadir=/mnt/my_storage/BitcoinData -stopatheight=886000 -dbcache=5000 -blocksonly -printtoconsole=0\r\n  Time (mean Â± Ïƒ):     27019.086 s Â± 112.340 s    [User: 54927.344 s, System: 1652.376 s]\r\n  Range (min â€¦ max):   26939.649 s â€¦ 27098.522 s    2 runs\r\n```\r\n\r\n</details>\r\n\r\nWhen the in-memory UTXO set is [flushed](https://github.com/bitcoin/bitcoin/blob/master/src/txdb.cpp#L130-L133) to LevelDB (after IBD or AssumeUTXO load), it does so in batches to manage memory usage during the flush.\r\nWhile a hidden [-dbbatchsize](https://github.com/bitcoin/bitcoin/blob/master/src/init.cpp#L490) config option exists to modify this value, this PR introduces dynamic calculation of the batch size based on the -dbcache setting. By using larger batches when more memory is available (i.e., higher -dbcache), we can reduce the overhead from numerous small writes, minimize constant overhead per batch, improve I/O efficiency (especially on HDDs), and potentially allow LevelDB to optimize writes more effectively (e.g. by sorting the keys before write).\r\n\r\n<img width=\"1000\" alt=\"image\" src=\"https://github.com/user-attachments/assets/0a99e32e-6a9b-481e-a08a-7216c82fe722\" />\r\n\r\nNote that this PR mainly optimizes a critical section of IBD (memory to disk dump) - even if the effect on overall speed is modest:\r\n<img width=\"1000\" alt=\"image\" src=\"https://github.com/user-attachments/assets/8b56674b-b3e3-43cf-a19b-574e66948e72\" />\r\n\r\n<img width=\"1000\" alt=\"image\" src=\"https://github.com/user-attachments/assets/ce56cfba-a59f-4360-a6d7-2cc3e74959a3\" />\r\n\r\n<img width=\"1000\" alt=\"image\" src=\"https://github.com/user-attachments/assets/e346414c-b009-47c5-92ff-a264b1e2c6c4\" />\r\n\r\n<img width=\"1000\" alt=\"image\" src=\"https://github.com/user-attachments/assets/4db30a70-1ca9-401c-8c9c-2ddecd0d7516\" />\r\n\r\n-----\r\n\r\n\r\n* https://github.com/bitcoin/bitcoin/pull/31868\r\n\r\n<details>\r\n<summary>7.41 hour IBD time</summary>\r\n\r\n```bash\r\nCOMPILER=gcc COMMIT=817d7ac0767a3984295aa3cf6c961dcc5f29d571 ./build/bin/bitcoind -datadir=/mnt/my_storage/BitcoinData -stopatheight=886000 -dbcache=5000 -blocksonly -printtoconsole=0\r\n  Time (mean Â± Ïƒ):     26711.460 s Â± 244.118 s    [User: 54654.348 s, System: 1652.087 s]\r\n  Range (min â€¦ max):   26538.843 s â€¦ 26884.077 s    2 runs\r\n```\r\n</details>\r\n\r\nThe commits merge similar (de)serialization methods, and separates them internally with if constexpr - similarly to how it has been https://github.com/bitcoin/bitcoin/pull/28203. This enabled further SizeComputer optimizations as well.\r\n\r\nOther than these, since single byte writes are used very often (used for every (u)int8_t or std::byte or bool and for every VarInt's first byte which is also needed for every (pre)Vector), it makes sense to avoid unnecessary generalized serialization infrastructure.\r\n\r\n-----\r\n\r\n* https://github.com/bitcoin/bitcoin/pull/31682\r\n\r\n<details>\r\n<summary>7.31 hour IBD time</summary>\r\n\r\n```bash\r\nCOMPILER=gcc COMMIT=182745cec4c0baf2f3c8cff2f74f847eac3c4330 ./build/bin/bitcoind -datadir=/mnt/my_storage/BitcoinData -stopatheight=886000 -dbcache=5000 -blocksonly -printtoconsole=0\r\n  Time (mean Â± Ïƒ):     26326.867 s Â± 45.887 s    [User: 54367.156 s, System: 1619.348 s]\r\n  Range (min â€¦ max):   26294.420 s â€¦ 26359.314 s    2 runs\r\n```\r\n</details>\r\n\r\n`CheckBlock`'s latency is critical for efficiently validating correct inputs during transaction validation, including mempool acceptance and new block creation.\r\n\r\nThis PR improves performance and maintainability by introducing the following changes:\r\n* Simplified checks for the most common cases (1 or 2 inputs - [70-90% of transactions have a single input](https://transactionfee.info/charts/transactions-1in)).\r\n* Optimized the general case by replacing `std::set` with sorted `std::vector` for improved locality.\r\n* Simplified Null prevout checks from linear to constant time.\r\n\r\n-----\r\n\r\n* https://github.com/bitcoin/bitcoin/pull/30442\r\n\r\n<details>\r\n<summary>7.25 hour IBD time</summary>\r\n\r\n```bash\r\nCOMPILER=gcc COMMIT=47d377bd0bb88dae6b34553a7789400170e0ccf6 ./build/bin/bitcoind -datadir=/mnt/my_storage/BitcoinData -stopatheight=886000 -dbcache=5000 -blocksonly -printtoconsole=0\r\n  Time (mean Â± Ïƒ):     26084.429 s Â± 473.611 s    [User: 54310.780 s, System: 1815.967 s]\r\n  Range (min â€¦ max):   25749.536 s â€¦ 26419.323 s    2 runs\r\n```\r\n\r\n</details>\r\n\r\nThe in-memory representation of the UTXO set uses [(salted) SipHash](https://github.com/bitcoin/bitcoin/blob/master/src/coins.h#L226) for avoiding key collision attacks.\r\n\r\nHashing a `uint256` key is done so often that a specialized optimization was extracted to [SipHashUint256Extra](https://github.com/bitcoin/bitcoin/blob/master/src/crypto/siphash.cpp#L135). The constant salting operations were already extracted in the [general case](https://github.com/bitcoin/bitcoin/blob/master/src/crypto/siphash.cpp#L20-L23), this PR adjusts the main specialization similarly.\r\n\r\n\r\n-----\r\n\r\n* https://github.com/bitcoin/bitcoin/pull/32279\r\n\r\nThe current `prevector` size of 28 bytes (chosen to fill the `sizeof(CScript)` aligned size) was introduced in 2015 (https://github.com/bitcoin/bitcoin/pull/6914) before SegWit and TapRoot.\r\nHowever, the increasingly common P2WSH and P2TR scripts are both 34 bytes, and are forced to use heap (re)allocation rather than efficient inline storage.\r\n\r\nThe core trade-off of this change is to eliminate heap allocations for common 29-36 byte scripts at the cost of increasing the base memory footprint of all `CScript` objects by 8 bytes (while still respecting peak memory usage defined by -dbcache).\r\n\r\n![image](https://github.com/user-attachments/assets/284ce2ab-32b8-4c85-9ada-11aae0e2ff39)\r\n\r\n-----\r\n\r\n## Other similar efforts waiting for reviews or revives (not included in this tracking PR):\r\n* https://github.com/bitcoin/bitcoin/pull/30611 - for very big in-memory caches make sure we still flush to disk regularly (no significant IBD speed change)\r\n* https://github.com/bitcoin/bitcoin/pull/28945 - was meant to preallocate the memory of recreated caches (~6% IBD speedup for small caches)\r\n* https://github.com/bitcoin/bitcoin/pull/31102 - was meant to try to evict entries selectively instead of dropping the whole cache when full\r\n* https://github.com/bitcoin/bitcoin/pull/32128 - draft PR showcasing a few other possible caching speedups\r\n\r\n-----\r\n\r\nThis PR is meant to stay in draft (not meant to be merged directly), to continually change based on comments received here and in the PRs.\r\nComments, reproducers and high-level discussions are welcome here - code reviews should rather be done in the individual PRs.\r\n",
      "state": "closed",
      "user": "l0rinc",
      "created_at": "2025-03-12T16:20:16Z",
      "updated_at": "2026-01-14T10:24:08Z",
      "comments": 21,
      "url": "https://github.com/bitcoin/bitcoin/pull/32043",
      "labels": [
        "P2P",
        "Block storage",
        "Needs rebase"
      ]
    },
    {
      "number": 32041,
      "title": "build: bump CLIENT_VERSION_MAJOR to 29",
      "body": "",
      "state": "closed",
      "user": "glozow",
      "created_at": "2025-03-12T15:02:07Z",
      "updated_at": "2025-04-01T12:52:25Z",
      "comments": 2,
      "url": "https://github.com/bitcoin/bitcoin/pull/32041",
      "labels": [
        "Build system"
      ],
      "comment_list": [
        {
          "user": "DrahtBot",
          "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/32041.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| ACK | [fanquake](https://github.com/bitcoin/bitcoin/pull/32041#pullrequestreview-2678861797) |\n\nIf your review is incorrectly listed, please react with ðŸ‘Ž to this comment and the bot will ignore it on the next update.\n",
          "created_at": "2025-03-12T15:02:10Z"
        },
        {
          "user": "glozow",
          "body": "Missed for branch-off, my bad. Thanks @fanquake",
          "created_at": "2025-03-12T15:02:31Z"
        }
      ]
    },
    {
      "number": 32040,
      "title": ".",
      "body": "Testing",
      "state": "closed",
      "user": "soldate",
      "created_at": "2025-03-12T14:35:34Z",
      "updated_at": "2025-03-12T15:06:12Z",
      "comments": 1,
      "url": "https://github.com/bitcoin/bitcoin/pull/32040",
      "labels": [],
      "comment_list": [
        {
          "user": "DrahtBot",
          "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/32040.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\nA summary of reviews will appear here.\n",
          "created_at": "2025-03-12T14:35:37Z"
        }
      ]
    },
    {
      "number": 32038,
      "title": "depends: remove `NO_HARDEN` option",
      "body": "This was only needed to work around a (Libtool related iirc) Windows issue, when hardening was disabled. I can no-longer recreate this failure, so it'd be good to remove this Windows carveout.",
      "state": "closed",
      "user": "fanquake",
      "created_at": "2025-03-12T12:06:11Z",
      "updated_at": "2025-03-14T19:07:29Z",
      "comments": 7,
      "url": "https://github.com/bitcoin/bitcoin/pull/32038",
      "labels": [
        "Build system"
      ],
      "comment_list": [
        {
          "user": "DrahtBot",
          "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/32038.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| ACK | [davidgumberg](https://github.com/bitcoin/bitcoin/pull/32038#issuecomment-2719073609), [laanwj](https://github.com/bitcoin/bitcoin/pull/32038#pullrequestreview-2681205220) |\n| Concept ACK | [hebasto](https://github.com/bitcoin/bitcoin/pull/32038#issuecomment-2718326026) |\n\nIf your review is incorrectly listed, please react with ðŸ‘Ž to this comment and the bot will ignore it on the next update.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#31802](https://github.com/bitcoin/bitcoin/pull/31802) (Add bitcoin-{node,gui} to release binaries for IPC by Sjors)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n",
          "created_at": "2025-03-12T12:06:15Z"
        },
        {
          "user": "laanwj",
          "body": "Concept ACK, for a project like this it's unreasonable to disable hardening features, there is no reason to maintain this functionailty.",
          "created_at": "2025-03-12T12:28:20Z"
        },
        {
          "user": "hebasto",
          "body": "Concept ACK.",
          "created_at": "2025-03-12T15:45:13Z"
        },
        {
          "user": "davidgumberg",
          "body": "crACK 5dfef6b9b379f51e\r\n\r\nSanity tested that the following depends build works:\r\n\r\n```bash\r\nmake -C depends/ HOST=x86_64-w64-mingw32\r\ncmake -B build --toolchain depends/x86_64-w64-mingw32/toolchain.cmake\r\ncmake --build build\r\n```\r\n\r\n---\r\n\r\n> for a project like this it's unreasonable to disable hardening features\r\n\r\nWould it make sense to also drop `ENABLE_HARDENING`? Currently set `OFF` in the `clang-tidy` ci job, but I [flipped it `ON`](https://github.com/davidgumberg/bitcoin/commit/ce79bea14ae1427395b7eddb0a0e1c21fa78516d)  and ran the clang-tidy job locally and it seems to work. (But I have no context for why hardening was disabled in clang-tidy cc: @maflcko) ",
          "created_at": "2025-03-12T20:38:55Z"
        },
        {
          "user": "laanwj",
          "body": "> Would it make sense to also drop ENABLE_HARDENING? Currently set OFF in the clang-tidy ci job, but I [flipped it ON](https://github.com/davidgumberg/bitcoin/commit/ce79bea14ae1427395b7eddb0a0e1c21fa78516d) and ran the clang-tidy job locally and it seems to work. (But I have no context for why hardening was disabled in clang-tidy cc: @maflcko)\r\n\r\nRight, if it's needed for some of our own tooling/testing that might be a valid reason to keep it, but otherwise, nah.\r\n\r\nAnd even then cmake provides ways to override the `CXXFLAGS` and such entirely if someone needs to build with specific flags only. No reason to single out hardening there.",
          "created_at": "2025-03-13T09:15:38Z"
        },
        {
          "user": "maflcko",
          "body": "> Would it make sense to also drop `ENABLE_HARDENING`? Currently set `OFF` in the `clang-tidy` ci job, but I [flipped it `ON`](https://github.com/davidgumberg/bitcoin/commit/ce79bea14ae1427395b7eddb0a0e1c21fa78516d) and ran the clang-tidy job locally and it seems to work. (But I have no context for why hardening was disabled in clang-tidy cc: @maflcko)\r\n\r\nIIRC it was added in fab24f8c3540b6f1a128cb9d6812df6678472b8d, because I copy-pasted it from another CI task and forgot to remove it.  I guess it would be best to remove it, if it is confusing and the removal doesn't cause issues.\r\n\r\n(Edit: An alternative guess could be to minimize the number of compiler options in an attempt to speed up compilation, but without benchmarks this seems like premature optimization)",
          "created_at": "2025-03-14T07:47:27Z"
        },
        {
          "user": "davidgumberg",
          "body": "I've opened https://github.com/bitcoin/bitcoin/pull/32071 to drop the `ENABLE_HARDENING` option in Bitcoin Core builds.",
          "created_at": "2025-03-14T19:07:26Z"
        }
      ]
    },
    {
      "number": 32037,
      "title": "chore: remove redundant words in comment",
      "body": "remove redundant words in comment",
      "state": "closed",
      "user": "kevincatty",
      "created_at": "2025-03-12T07:31:00Z",
      "updated_at": "2025-03-12T07:48:59Z",
      "comments": 2,
      "url": "https://github.com/bitcoin/bitcoin/pull/32037",
      "labels": [
        "CI failed"
      ],
      "comment_list": [
        {
          "user": "DrahtBot",
          "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/32037.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\nA summary of reviews will appear here.\n",
          "created_at": "2025-03-12T07:31:03Z"
        },
        {
          "user": "DrahtBot",
          "body": "<!--85328a0da195eb286784d51f73fa0af9-->\nðŸš§ At least one of the CI tasks failed.\n<sub>Debug: https://github.com/bitcoin/bitcoin/runs/38616721845</sub>\n\n<details><summary>Hints</summary>\n\nTry to run the tests locally, according to the documentation. However, a CI failure may still\nhappen due to a number of reasons, for example:\n\n* Possibly due to a silent merge conflict (the changes in this pull request being\nincompatible with the current code in the target branch). If so, make sure to rebase on the latest\ncommit of the target branch.\n\n* A sanitizer issue, which can only be found by compiling with the sanitizer and running the\n  affected test.\n\n* An intermittent issue.\n\nLeave a comment here, if you need help tracking down a confusing failure.\n\n</details>\n",
          "created_at": "2025-03-12T07:36:59Z"
        }
      ]
    }
  ],
  "issues": [
    {
      "number": 32047,
      "title": "BnB untested/unused condition in UTXO exclusion optimization",
      "body": "If the following condition is remove, no failure occurs:\n`utxo.fee != utxo_pool.at(utxo_pool_index - 1).fee)`\n\nhttps://github.com/bitcoin/bitcoin/blob/eb9730ab65887279309af338ad0201924f945ac5/src/wallet/coinselection.cpp#L177\n\nFurthermore, I believe that this condition isn't actually needed and can be removed, which would slightly boost performance.  The section is checking if a UTXO can be omitted from evaluation if it has the same effective_value as the previous UTXO and the previous was already omitted.  The condition in question is comparing if the fee is different between the previous and the current UTXO.  The only way for the fees to be different is if the effective_value is different, however the previous condition: `utxo.GetSelectionAmount() != utxo_pool.at(utxo_pool_index - 1).GetSelectionAmount()` already compared the effective_values.\n\nPut another way, if one of the conditions is true, the UTXO shortcut can _not_ be applied.  If the effective_values where not the same, then don't do the shortcut except if the fees are the same.  ~But the only way fees can be different is if the effective_values are different which creates a contradiction.~\n\nLastly, I'm struggling to understand what the motivation is to have this condition in the first place.  The condition translates to: If the fee is different between the current UTXO and the previous UTXO, then exclude the current one from the selection shortcut (which as I pointed out would never happen because of the aforementioned contradiction where the effective_value and fee are conditionally dependent).",
      "state": "open",
      "user": "yancyribbens",
      "created_at": "2025-03-12T20:30:37Z",
      "updated_at": "2025-03-27T02:34:04Z",
      "comments": 18,
      "url": "https://github.com/bitcoin/bitcoin/issues/32047",
      "labels": [
        "Wallet"
      ],
      "comment_list": [
        {
          "user": "yancyribbens",
          "body": "cc @murchandamus ",
          "created_at": "2025-03-12T20:39:21Z"
        },
        {
          "user": "yancyribbens",
          "body": "I also just wanted to add that, even if there was the extremely unlikely event where two utxos had the same effective_value and different fee values, the optimization should only compare effective_values as I understand it.",
          "created_at": "2025-03-12T20:57:01Z"
        },
        {
          "user": "Nouridin",
          "body": "In summary, while the fee check may be redundant given the current relationships between effective value and fee, it was likely originally added to ensure that the shortcut is _only_ applied when both the effective value and the spending fee are identical. Since testing shows that removing it does not lead to failures, it appears safe to remove it, but any change in this wellâ€tuned coin selection code must be approached with caution given the subtle and sometimes unexpected interactions in coin selection.\n(at least that what I believe)",
          "created_at": "2025-03-12T22:32:03Z"
        },
        {
          "user": "yancyribbens",
          "body": "I believe it's possible for effective_value to _not_ be equal between two successive UTXO combinations while two fees _are_ equal.  This would have the consequence of _not_ applying the optimization when in principle the optimization _should_ be applied.  In fact, I think it's very likely for two fees to be equal since it's likely the fee_rates are equal and the weight is equal of two UTXOs.  Therefore, leaving this condition in has the disadvantage of nullifying the effect of the UTXO optimization performance increase. Earlier I believe I misspoke when I said it was unlikely for effective_value and fee to contradict each other per UTXO, but I believe adding this [parameter](https://github.com/bitcoin/bitcoin/blob/eb9730ab65887279309af338ad0201924f945ac5/src/wallet/coinselection.cpp#L177) is unneeded and is likely to worsen performance.",
          "created_at": "2025-03-13T11:56:05Z"
        },
        {
          "user": "Nouridin",
          "body": "Your reasoning is sound. If you consider that many UTXOs will have equal feesâ€”because they share the same fee rate and weightâ€”then requiring both the effective value and the fee to match before applying the shortcut can indeed be overly strict. In scenarios where the fees are identical but the effective values differ slightly (perhaps due to minor rounding or variation in the UTXO values), the condition\n`utxo.fee != utxo_pool.at(utxo_pool_index - 1).fee`\n\nwill cause the optimization to be bypassed. This means that even if the fee component is effectively the same across UTXOs, any difference in effective value prevents the shortcut from being used, thereby nullifying the potential performance improvement.\n\nRemoving the fee comparison would allow the optimization to trigger based solely on matching effective values. This is particularly attractive if, in practice, the fee rates and weights are uniform enough that fees are almost always equal. Of course, such a change would need thorough testing to ensure that no edge cases are missed where the fee difference might indicate a meaningful divergence between UTXOs.\n\nIn summary, if the vast majority of your UTXOs have equal fees due to identical fee rates and weights, then the fee check can indeed be seen as an unnecessary constraint that prevents the coin selection optimization from being applied, potentially worsening performance.",
          "created_at": "2025-03-13T12:07:26Z"
        },
        {
          "user": "yancyribbens",
          "body": "I did some testing on this issue and I found that if the [parameter](https://github.com/bitcoin/bitcoin/blob/eb9730ab65887279309af338ad0201924f945ac5/src/wallet/coinselection.cpp#L177) is removed, one of [tests](https://github.com/bitcoin/bitcoin/blob/master/src/wallet/test/coinselector_tests.cpp#L427) finishes in 3 fewer iterations, from 38 iterations to 35.  The reason the test is more efficient without the added parameter is that there are two UTXOs with the same effective value of `5000000 sats` but different weights and fees:\n\n```\nUTXO A\nvalue: 5000000\nfee: 204\nweight: 272\n\nUTXO B\nvalue: 5000000\nfee: 1200000\nweight: 1600000\n```\n\nDuring the selection, if UTXO A is found to not contribute towards a solution, the algorithm should dismiss UTXO B as also not contributing toward the  solution and skip without an iteration consumed.  However, since the parameter will only skip if the fees are equivalent, the UTXO is instead evaluated and _not_skipped.\n\nA few other observations about this test is that the fee of `UTXO B` is not a practical value because the weight is extreme (1600000).  However, even if the fee and weight are reasonable and different, the same fault would occur during evaluation of the UTXO skip optimization.  Furthermore, this code could also be improved by skipping evaluation of the UTXO if the weight is greater than `max_selection_weight` which it is by far.\n\nLastly, I tried to track down when the [parameter](https://github.com/bitcoin/bitcoin/blob/eb9730ab65887279309af338ad0201924f945ac5/src/wallet/coinselection.cpp#L177) was added in hopes of understanding why.  Unfortunately the param was present in the origin PR  [here](\nhttps://github.com/bitcoin/bitcoin/pull/10637/files#diff-d473ed8396f9451afb848923cfcfaa630c9811a78e07f3ae1ffd3a65da218accR145) by @achow101 without an explanation from what I can tell.  So I'm at a loss to understand why this parameter exists which appears to degrade performance without any added benefit that I can find.\n\nThe recommendations I have to improve the state of the algorithm:\n* Remove the [parameter](https://github.com/bitcoin/bitcoin/blob/eb9730ab65887279309af338ad0201924f945ac5/src/wallet/coinselection.cpp#L177) which is degrading performance in some occasions where two effective values are the same but have different fees\n* Add an iteration count to the API so it can be clearly seen when performance improves or degrades in terms of iteration count\n* Skip evaluating UTXOs that are greater than `max_selection_weight`",
          "created_at": "2025-03-17T15:04:25Z"
        },
        {
          "user": "murchandamus",
          "body": "> The only way for the fees to be different is if the effective_value is different, however the previous condition: `utxo.GetSelectionAmount() != utxo_pool.at(utxo_pool_index - 1).GetSelectionAmount()` already compared the effective_values.\n\nThis is not accurate. You could have two UTXOs of different output types that have the same effective value but differing fees. Counterexample:\n\nFeerate: 10 sat/vB\n\nUTXO_1:\n  type: P2WPKH,\n  amount: 10,680 sats\n  input weight: 68 vB\n  **fee: 680 sats**\n  **eff_value: 10,000**\n\nUTXO_2:\n  type: P2TR\n  amount: 10,575 sats\n  input_weight: 57.5 vB\n  **fee: 575 sats**\n  **eff_value: 10,000**\n\nHowever, since [CoinGrinder got merged](https://github.com/bitcoin/bitcoin/pull/27877/commits/89d09566431f57034d9a7df32547ceb13d79c62c) UTXO sorting tiebreaks by preferring lower waste on equal effective value, so yes, if the first UTXO is skipped combining with a later UTXO of same effective value will always have worse waste, so I think skipping a subsequent UTXO even when the fee differs is now correct.\n\nI.e. at low feerates, P2WPKH would sort before P2TR when effective value ties, and at high feerates P2TR would sort before P2WPKH when effective value ties.",
          "created_at": "2025-03-19T00:09:02Z"
        },
        {
          "user": "yancyribbens",
          "body": "> This is not accurate. You could have two UTXOs of different output types that have the same effective value but differing fees. Counterexample:\n\nYes, I redacted that comment later in the thread as my understand of the problem improved.  As I posted last, there's even a test [here](https://github.com/bitcoin/bitcoin/blob/master/src/wallet/test/coinselector_tests.cpp#L427) that tests two UTXOs with the same effective_value yet different fees.\n\n> However, since [CoinGrinder got merged](https://github.com/bitcoin/bitcoin/pull/27877/commits/89d09566431f57034d9a7df32547ceb13d79c62c) UTXO sorting tiebreaks by preferring lower waste on equal effective value, so yes, if the first UTXO is skipped combining with a later UTXO of same effective value will always have worse waste, so I think skipping a subsequent UTXO even when the fee differs is now correct\n\nAh that's interesting.  I see now why the param was originally added.  Before `coin_grinder` was added which imposed a sort order on waste and effective value, it _was_ possible for two UTXOs to have the same `effective_value` yet different waste scores.  That is, two UTXOs can have the same `effective_value` but a different future `effective_value` as calculated with `long_term_fee_rate`.  I agree though that now the parameter is superfluous where as before the sort order was improved, it did make a difference.\n",
          "created_at": "2025-03-19T18:33:01Z"
        },
        {
          "user": "yancyribbens",
          "body": "However, doesn't the waste score account for long_term_fee_rate as well as fee_rate?  In other-words, just comparing `fee` amounts and not `long_term_fee_rate` would not be enough to know if comparing two UTXOs have different waste scores..",
          "created_at": "2025-03-19T18:41:09Z"
        },
        {
          "user": "murchandamus",
          "body": "The `long_term_fee_rate` and `fee_rate` are the same for all UTXOs in a single coin selection attempt, so if two UTXOs have the same fee, their inputs have the same weight, if they also have the same effective value, they are interchangeable. If they only have the same effective value but different fees, it means that they have differing weights. Similarly, waste simply scales with the weight across UTXOs, as it is weight times `long_term_fee_rate - fee_rate`. So, if two UTXOs have the same effective value, but different waste scores, it is congruent to them having different fees.",
          "created_at": "2025-03-20T17:46:39Z"
        },
        {
          "user": "yancyribbens",
          "body": "> The long_term_fee_rate and fee_rate are the same for all UTXOs in a single coin selection attempt\n\nAgree.  I think that's a little confusing the way the C++ algorithm is structured and treats fee_rate and long_term_fee_rate per UTXO instead of just passing in the fee_rate params as a per sort argument.\n\n> so if two UTXOs have the same fee, their inputs have the same weight\n\nRight, since fee is derived from fee_rate and weight, and fee_rate is guaranteed to be the same, the only true variable is weight.\n\n>  if they also have the same effective value, they are interchangeable.\n\nYes, so they are interchangeable if they have the same weight and the same value since effective_value is derived from fee_rate (not variable between UTXOs), value and weight.\n\n> If they only have the same effective value but different fees, it means that they have differing weights.\n\nYes, it follows given that the only variable of consequence have been shown to be value and weight.\n\n> Similarly, waste simply scales with the weight across UTXOs, as it is weight times long_term_fee_rate - fee_rate\n\nAlright, so that means waste is derivative of Weight since long_term_fee_rate and fee_rate are both non-variable between UTXOs.\n\n> So, if two UTXOs have the same effective value, but different waste scores, it is congruent to them having different fees.\n\nAnd different Weights.\n\nIn summery, two UTXOs are equivalent if both value and weight are the same, and if value is the same but weight is different, prefer the UTXO with lower weight since waste score is a derivative of weight.  Therefore, if UTXOs are sorted by value with a tie breaker of weight, then if UTXO A was a skip during selection and a successive UTXO B has the same value, it can also be skipped regardless of fee given it's sort order.  A sort by only `effective_value` would not be enough to make such a guarantee since `effective_values` between two successive UTXOs could have the same `effective_value` but different `weights` and therefore different waste scores.\n\nAlso, sorting UTXOs by the ratio of value/weight would have the same benefit as sorting by value with tie breaker of weight but that's besides the point.\n",
          "created_at": "2025-03-21T15:33:12Z"
        },
        {
          "user": "murchandamus",
          "body": "> In summery, two UTXOs are equivalent if both value and weight are the same, and if value is the same but weight is different, prefer the UTXO with lower weight since waste score is a derivative of weight. \n\nClose, but there is a subtlety here. If we were sorting by effective_value and tie-breaking fee or weight, we would always be preferring lower weight, but instead, we tie-break on waste. That means that we will prefer lower weight if `fee_rate` is higher than `long_term_fee_rate`, but we will prefer _higher_ weight if `fee_rate` is lower than `long_term_fee_rate`. This dynamic ensures that we prefer spending old, less blockspace-efficient UTXOs at low feerates, but prefer more blockspace-efficient UTXOs at high feerates.\n\n> Therefore, if UTXOs are sorted by value with a tie breaker of weight, then if UTXO A was a skip during selection and a successive UTXO B has the same value, it can also be skipped regardless of fee given it's sort order. A sort by only `effective_value` would not be enough to make such a guarantee since `effective_values` between two successive UTXOs could have the same `effective_value` but different `weights` and therefore different waste scores.\n\nCorrect, and this still works with our waste-based sort order as intended: if we are in a low-feerate situation, the heaviest UTXOs are sorted first, and we skip same-weight or lighter UTXOs of the same effective value. If we are in a high-feerate situation, we skip same-weight and heavier UTXOs of the same effective value, because in both situation the subsequent UTXOs would lead to a similar selection with a worse waste score.\n\n> Also, sorting UTXOs by the ratio of value/weight would have the same benefit as sorting by value with tie breaker of weight but that's besides the point.\n\nUnfortunately not. We explored sorting by descending value density while developing CoinGrinder, and the problem with that approach is that two subsequent UTXO no longer make similar progress toward the `selection_target` and may not be good replacements for each other (e.g., a P2PKH UTXO with 148,000 sats and a P2TR UTXO with 57,500 sats have the same value density). It lead to CoinGrinder sometimes finding the best solution much faster, but sometimes finding it slower. It just traversed the combination space in a radically different order. I think that it would not be compatible with most of the optimizations we found for CoinGrinder, although there might be other similar ones. We had wondered whether it might generally be stronger for CoinGrinder, but discarded the approach after determining that it was just differentâ€”vying instead to keep it similar to BnB and easier to reason about. I think that sorting by value density would not work at all for BnB, as I would expect it to significantly reduce the opportunities to bound the search space if we cannot skip many subtrees in the search graph after overshooting the target.",
          "created_at": "2025-03-21T18:36:07Z"
        },
        {
          "user": "yancyribbens",
          "body": "> Close, but there is a subtlety here..\n\nThanks, that's a good point I might have overlooked, that in a high fee environment, the tie break on weight is different than in a low fee environment.\n\n> Unfortunately not. We explored sorting by descending value density while developing CoinGrinder..\n\nHmm that make sense now that you say it.  sorting by density isn't strictly equivalent to sorting by value with weight as a tie break and as such would change the behavior of the search.\n\nSo, it sounds like we are in agreement that the [fee comparison](https://github.com/bitcoin/bitcoin/blob/eb9730ab65887279309af338ad0201924f945ac5/src/wallet/coinselection.cpp#L177) in BnB can be removed.  I'm tempted to explore adding an iteration count to BnB like coin-grinder since that would make the change nicer.  IE if we had an iteration count, then removing the parameter wouldn't require any test changes because it would be apparent that in [test](https://github.com/bitcoin/bitcoin/blob/master/src/wallet/test/coinselector_tests.cpp#L427) the iteration count was reduced with the removal of the condition.  Adding an iteration count would also strengthen the tests now and against future changes.  However, the easiest change for this would be to add a test where 5k or so inputs have the same effective_value and different fee values and a solution can't be found because the [condition](https://github.com/bitcoin/bitcoin/blob/eb9730ab65887279309af338ad0201924f945ac5/src/wallet/coinselection.cpp#L177) causes the UTXO shortcut to not be evaluated.  And maybe a test to show it behaves different in low-fee vs high-fee environment.",
          "created_at": "2025-03-22T13:06:14Z"
        },
        {
          "user": "murchandamus",
          "body": "> So, it sounds like we are in agreement that the [fee comparison](https://github.com/bitcoin/bitcoin/blob/eb9730ab65887279309af338ad0201924f945ac5/src/wallet/coinselection.cpp#L177) in BnB can be removed.\n\nYes, it looks to me like it should actually be an optimization to remove it.\n\n> I'm tempted to explore adding an iteration count to BnB like coin-grinder since that would make the change nicer. IE if we had an iteration count, then removing the parameter wouldn't require any test changes because it would be apparent that in [test](https://github.com/bitcoin/bitcoin/blob/master/src/wallet/test/coinselector_tests.cpp#L427) the iteration count was reduced with the removal of the condition. Adding an iteration count would also strengthen the tests now and against future changes. \n\nYeah, I have had in my backlog that I would like to refactor BnB into the style of CoinGrinder since I wrote CoinGrinder, because I think it would be easier to understand, the iteration count would make more sense (currently it counts and evaluates the backtracking steps as well, but they can never yield a new solution!), and maybe easier to test. Given that my new job is explicitly more focused on working on the wallet, I was hoping to get to that once we are in the new office in April, but it might not be the highest priority.\n\n> However, the easiest change for this would be to add a test where 5k or so inputs have the same effective_value and different fee values and a solution can't be found because the [condition](https://github.com/bitcoin/bitcoin/blob/eb9730ab65887279309af338ad0201924f945ac5/src/wallet/coinselection.cpp#L177) causes the UTXO shortcut to not be evaluated. And maybe a test to show it behaves different in low-fee vs high-fee environment.\n\nI could have sworn we had such a test already, but if we donâ€™t that would be a great addition to the [`bnb_feerate_sensitivity_test`](https://github.com/bitcoin/bitcoin/pull/29532/files#diff-36088c93368e137d955348aba223985bd4f198f2aaecd626c830f4612ca884c8R191). You or I could add it there.",
          "created_at": "2025-03-22T18:59:34Z"
        },
        {
          "user": "yancyribbens",
          "body": "> Yeah, I have had in my backlog that I would like to refactor BnB into the style of CoinGrinder since I wrote CoinGrinder, because I think it would be easier to understand, the iteration count would make more sense (currently it counts and evaluates the backtracking steps as well, but they can never yield a new solution!), and maybe easier to test. Given that my new job is explicitly more focused on working on the wallet, I was hoping to get to that once we are in the new office in April, but it might not be the highest priority.\n\nThat would be great to update BnB to be more like coin-grinder.  Adding an iteration count would be a good first step towards that.\n\n> I could have sworn we had such a test already, but if we donâ€™t that would be a great addition to the [bnb_feerate_sensitivity_test](https://github.com/bitcoin/bitcoin/pull/29532/files#diff-36088c93368e137d955348aba223985bd4f198f2aaecd626c830f4612ca884c8R191). You or I could add it there.\n\nThat sounds good.  What is preventing this PR from being merged?  Are you waiting on more Acks?",
          "created_at": "2025-03-23T16:01:42Z"
        },
        {
          "user": "murchandamus",
          "body": "> That would be great to update BnB to be more like coin-grinder. Adding an iteration count would be a good first step towards that.\n\nI donâ€™t think it makes sense to add just the iteration count, if it should be refactored completely anyway.â€”Better to do it all in one.\n\n> > I could have sworn we had such a test already, but if we donâ€™t that would be a great addition to the [bnb_feerate_sensitivity_test](https://github.com/bitcoin/bitcoin/pull/29532/files#diff-36088c93368e137d955348aba223985bd4f198f2aaecd626c830f4612ca884c8R191). You or I could add it there.\n> \n> That sounds good. What is preventing this PR from being merged? Are you waiting on more Acks?\n\nI extended the feerate sensitivity test to show that it prefers two heavy inputs at low feerate over two light inputs and vice versa at high feerate: https://github.com/bitcoin/bitcoin/pull/29532/commits/afd4b807ff1300e4f74ceab6a683f3ff1376369d#diff-36088c93368e137d955348aba223985bd4f198f2aaecd626c830f4612ca884c8R139-R146\n\nBut we are getting a bit off-topic here. Do you want to open a PR with the discussed optimization?",
          "created_at": "2025-03-24T20:38:51Z"
        },
        {
          "user": "yancyribbens",
          "body": "> I donâ€™t think it makes sense to add just the iteration count, if it should be refactored completely anyway.â€”Better to do it all in one.\n\nThat would be great if you manage to find the time to do it.\n\n> I extended the feerate sensitivity test to show that it prefers two heavy inputs at low feerate over two light inputs and vice versa at high feerate: https://github.com/bitcoin/bitcoin/commit/afd4b807ff1300e4f74ceab6a683f3ff1376369d#diff-36088c93368e137d955348aba223985bd4f198f2aaecd626c830f4612ca884c8R139-R146\n\nThanks, I noticed that.  Although I think it's somewhat orthogonal to the discussed optimization.\n\n> But we are getting a bit off-topic here. Do you want to open a PR with the discussed optimization?\n\nSure, I can.  I think along with removing the condition, a test should go with the commit which shows that if two UTXOs with the same effective_value and different weights are selection candidates, the heavier more expensive of the two is selected when fees are low, and the cheaper lighter of the two is selected when fees are high.  Similar to the test you made above but with equal effective_values which tests the skip optimization performs correctly when the fee comparison is removed .",
          "created_at": "2025-03-25T17:52:27Z"
        },
        {
          "user": "murchandamus",
          "body": "It was easier than expected: https://github.com/bitcoin/bitcoin/pull/32150",
          "created_at": "2025-03-27T02:34:03Z"
        }
      ]
    },
    {
      "number": 32045,
      "title": "Wallet migration includes rescan",
      "body": "Users may want to migrate legacy wallets they haven't used in years. The migration itself is typically very quick, but it's followed by a rescan (if the wallet is behind).\n\nDepending on whether the user has `-blockfilterindex` enabled, this rescan takes somewhere between long and really really long.\n\nThere's no visual indication, only the logs show what's going on:\n\n<img width=\"383\" alt=\"Image\" src=\"https://github.com/user-attachments/assets/da911b44-8052-4b90-aa16-67625e550e3e\" />\n\nIdeally the migration should finish and then prompt the user that a rescan is about to happen. That way the user can abort the rescan and resume it some other time if it takes too long.\n\nAlternatively, the migrate wallet dialog could at least warn that a rescan is (or may be) happening and could take a while.\n\nFun aside: block filters don't work on legacy wallets, so it's much faster to first migrate and then rescan.",
      "state": "open",
      "user": "Sjors",
      "created_at": "2025-03-12T18:14:56Z",
      "updated_at": "2025-04-08T23:07:09Z",
      "comments": 2,
      "url": "https://github.com/bitcoin/bitcoin/issues/32045",
      "labels": [
        "GUI",
        "Wallet"
      ],
      "comment_list": [
        {
          "user": "furszy",
          "body": "> Ideally the migration should finish and then prompt the user that a rescan is about to happen. That way the user can abort the rescan and resume it some other time if it takes too long.\n\nSadly, we cannot do that right away. The rescan is being triggered by the loading procedure when the wallet is reloaded from disk after migration. We could add a \"no scan during init\" option (this should also be a new init flag).\n\n> Alternatively, the migrate wallet dialog could at least warn that a rescan is (or may be) happening and could take a while.\n\nFor this to happen, we would need to provide a callback function in the migration method so it can bubble up the progress. But it would only be able to say something like \"Migration completed, loading wallet...\" because, as mentioned above, rescanning occurs during the loading procedure (unless we also provide the callback to the loading procedure..)",
          "created_at": "2025-03-13T18:55:18Z"
        },
        {
          "user": "w0xlt",
          "body": "I just took a quick look, but adding a boolean parameter to `CWallet::Create()` that prevents `AttachChain()` from being called during the migration doesn't do the trick ?",
          "created_at": "2025-04-08T22:43:54Z"
        }
      ]
    },
    {
      "number": 32042,
      "title": "Script Validation Performance Improvement Tracking Issue",
      "body": "This is a tracking issue for a couple of improvements targeting performance of script validation that are closely related. The topic was [discussed at CoreDev in February 2025](https://gist.github.com/fjahr/b020a16255f044ef62c48e9adf18881a) as well.\n\n### Benchmarking\n- Pending: Benchmarking across different available threads ([using benchkit](https://github.com/bitcoin-dev-tools/benchkit))\n- https://github.com/bitcoin/bitcoin/pull/31689\n- https://github.com/bitcoin/bitcoin/pull/33740\n\n### Schnorr Batch Validation\n- https://github.com/bitcoin-core/secp256k1/pull/1134\n  - Rebased branch: https://github.com/fjahr/secp256k1/tree/pr1134-rebase-2024\n- https://github.com/bitcoin/bitcoin/pull/29491\n\n### CheckQueue improvements/refactors\n- Pending reinvestigation: https://github.com/bitcoin/bitcoin/pull/9938\n- Pending reinvestigation: https://github.com/bitcoin/bitcoin/pull/26776\n",
      "state": "open",
      "user": "fjahr",
      "created_at": "2025-03-12T15:21:14Z",
      "updated_at": "2025-10-30T23:52:21Z",
      "comments": 0,
      "url": "https://github.com/bitcoin/bitcoin/issues/32042",
      "labels": [
        "Validation",
        "Resource usage",
        "Tracking Issue"
      ]
    },
    {
      "number": 32039,
      "title": ".",
      "body": ".",
      "state": "closed",
      "user": "Aste525",
      "created_at": "2025-03-12T12:15:33Z",
      "updated_at": "2025-03-12T14:59:49Z",
      "comments": 0,
      "url": "https://github.com/bitcoin/bitcoin/issues/32039",
      "labels": [
        "Feature"
      ]
    }
  ],
  "summary": {
    "pull_requests": 9,
    "issues": 4
  }
}