{
  "source": "github",
  "repository": "bitcoin/bitcoin",
  "fetched_at": "2026-01-15T20:19:09.969641+00:00",
  "date": "2025-10-01",
  "pull_requests": [
    {
      "number": 33517,
      "title": "multiprocess: Fix high overhead from message logging",
      "body": "This fixes https://github.com/bitcoin-core/libmultiprocess/issues/215 on Core's side. ~It depends on https://github.com/bitcoin-core/libmultiprocess/pull/220 being merged upstream, and a PR to update our subtree. I've included a subtree merge from my repo here for now, but will rebase on top of the merge from upstream once it's in.~ Edit: Rebased on top of #33518.\r\n\r\nFor context: before https://github.com/bitcoin-core/libmultiprocess/pull/220, libmultiprocess serializesd every log message parameter, even if that message was ultimately going to be discarded. The upstream PR accomplished 2 main things:\r\n- Creates logging categories, similar to Core's\r\n- Using macros, avoids serializing parameters for disabled log levels.\r\n\r\nThat allowed the expensive serialization to be skipped, but the default log level is `Trace`. This PR updates our usage of libmultiprocess options to honor our log categories and levels.\r\n\r\nBecause of the substantial unnecessary overhead (see the [flamegraphs](https://github.com/bitcoin-core/libmultiprocess/issues/215). Logging accounts for 50% of my application's cpu time, and nearly 10% of bitcoin-node's, both of which go to ~0% once fixed), it'd be a shame to ship the first multiprocess binaries without this fixed. So I propose that we also backport this (and the required libmultiprocess subtree merge) ~to v30. Sorry about the timing~ :(\r\n\r\nEdit: Didn't make it for v30, but it would still make sense to backport for a v30.1.",
      "state": "closed",
      "user": "theuni",
      "created_at": "2025-10-01T22:34:59Z",
      "updated_at": "2025-10-23T07:30:47Z",
      "comments": 10,
      "url": "https://github.com/bitcoin/bitcoin/pull/33517",
      "labels": [
        "interfaces"
      ],
      "comment_list": [
        {
          "user": "DrahtBot",
          "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/33517.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| ACK | [Sjors](https://github.com/bitcoin/bitcoin/pull/33517#issuecomment-3400641744), [TheCharlatan](https://github.com/bitcoin/bitcoin/pull/33517#pullrequestreview-3335516834), [sipa](https://github.com/bitcoin/bitcoin/pull/33517#pullrequestreview-3335624700) |\n| Concept ACK | [Raimo33](https://github.com/bitcoin/bitcoin/pull/33517#issuecomment-3360234292) |\n| Stale ACK | [ryanofsky](https://github.com/bitcoin/bitcoin/pull/33517#pullrequestreview-3318880294) |\n\nIf your review is incorrectly listed, please react with ðŸ‘Ž to this comment and the bot will ignore it on the next update.\n<!--5faf32d7da4f0f540f40219e4f7537a3-->",
          "created_at": "2025-10-01T22:35:06Z"
        },
        {
          "user": "sedited",
          "body": "Concept ACK",
          "created_at": "2025-10-02T05:13:21Z"
        },
        {
          "user": "Raimo33",
          "body": "Concept ACK\n\nI agree with the backporting",
          "created_at": "2025-10-02T09:54:35Z"
        },
        {
          "user": "theuni",
          "body": "Rebased on #33518 temporarily to make sure ci is happy with everything combined.",
          "created_at": "2025-10-07T15:03:31Z"
        },
        {
          "user": "fanquake",
          "body": "#33518 has gone in, so this could be rebased / undrafted.",
          "created_at": "2025-10-10T09:48:00Z"
        },
        {
          "user": "Sjors",
          "body": "CI doesn't look happy. Update: seems fine again.",
          "created_at": "2025-10-13T08:57:17Z"
        },
        {
          "user": "Sjors",
          "body": "ACK 0626b90f507db68610a69feec86deb712dd095a1",
          "created_at": "2025-10-14T08:16:28Z"
        },
        {
          "user": "fanquake",
          "body": "Backported to `30.x` in #33609.",
          "created_at": "2025-10-16T08:57:15Z"
        },
        {
          "user": "ryanofsky",
          "body": "Just to follow up, I think it was unclear if this change was compatible with the [logging RPC](https://github.com/bitcoin/bitcoin/blob/7d27af98c7cf858b5ab5a02e64f89a857cc53172/src/rpc/node.cpp#L215) that allows log levels to be changed at runtime.\r\n\r\nI think it actually is compatible because the current RPC method only allows enabling/disabling categories without adjusting levels. If a way to adjust log levels is added though, a special case like the one added for [libevent](https://github.com/bitcoin/bitcoin/blob/7d27af98c7cf858b5ab5a02e64f89a857cc53172/src/rpc/node.cpp#L259-L262) might need to be added for libmultiprocess as well.",
          "created_at": "2025-10-22T14:22:57Z"
        },
        {
          "user": "theuni",
          "body": "Agreed. Thanks for having a look.",
          "created_at": "2025-10-23T07:30:47Z"
        }
      ]
    },
    {
      "number": 33516,
      "title": "doc: Correct typo 'implementes' to 'implements'",
      "body": "Fixes a typo in `src\\crc32c\\.ycm_extra_conf.py` where \"implementes\" was used instead of \"implements\". This change improves readability and ensures consistency in the documentation.\r\n\r\nNo functional changes or tests are required, as this is a trivial documentation fix.\r\n\r\n",
      "state": "closed",
      "user": "GabrielSchnei",
      "created_at": "2025-10-01T21:29:22Z",
      "updated_at": "2025-10-01T21:31:22Z",
      "comments": 2,
      "url": "https://github.com/bitcoin/bitcoin/pull/33516",
      "labels": [
        "Docs"
      ],
      "comment_list": [
        {
          "user": "DrahtBot",
          "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/33516.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\nA summary of reviews will appear here.\n<!--5faf32d7da4f0f540f40219e4f7537a3-->",
          "created_at": "2025-10-01T21:29:28Z"
        },
        {
          "user": "fanquake",
          "body": "Thanks, this needs to go upstream.",
          "created_at": "2025-10-01T21:31:12Z"
        }
      ]
    },
    {
      "number": 33515,
      "title": "Improve LastCommonAncestor performance + add tests",
      "body": "In theory, the `LastCommonAncestor` function in chain.cpp can take $\\mathcal{O}(n)$ time, walking over the entire chain, if the forking point is very early, which could take ~milliseconds. I expect this to be very rare in normal occurrences, but it seems nontrivial to reason about worst cases as it's accessible from several places in net_processing.\r\n\r\nThis PR modifies the algorithm to make use of the `CBlockIndex::pskip` skip pointers to find the forking point in sublinear time (a simulation shows that for heights up to $34 \\cdot 4^k - 2$ and $k \\geq 8$, no more than $k^2 + 10k + 13$ steps are ever needed), in a way that should be nearly free - at worst the same number of memory accesses should be made, with a tiny increase in computation.\r\n\r\nAs it appears we didn't really have tests for this function, unit tests are added for that function as well as `CBlockIndex::GetAncestor()`.\r\n\r\nThis is inspired by https://github.com/bitcoin/bitcoin/pull/32180#discussion_r2394877881\r\n\r\n",
      "state": "closed",
      "user": "sipa",
      "created_at": "2025-10-01T18:06:12Z",
      "updated_at": "2025-10-07T20:54:44Z",
      "comments": 4,
      "url": "https://github.com/bitcoin/bitcoin/pull/33515",
      "labels": [],
      "comment_list": [
        {
          "user": "DrahtBot",
          "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/33515.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| ACK | [vasild](https://github.com/bitcoin/bitcoin/pull/33515#pullrequestreview-3298109883), [mzumsande](https://github.com/bitcoin/bitcoin/pull/33515#pullrequestreview-3300473697), [furszy](https://github.com/bitcoin/bitcoin/pull/33515#pullrequestreview-3302435512), [optout21](https://github.com/bitcoin/bitcoin/pull/33515#issuecomment-3371390469), [stratospher](https://github.com/bitcoin/bitcoin/pull/33515#pullrequestreview-3310200173), [achow101](https://github.com/bitcoin/bitcoin/pull/33515#issuecomment-3378659388) |\n\nIf your review is incorrectly listed, please react with ðŸ‘Ž to this comment and the bot will ignore it on the next update.\n<!--5faf32d7da4f0f540f40219e4f7537a3-->",
          "created_at": "2025-10-01T18:06:17Z"
        },
        {
          "user": "optout21",
          "body": "ACK 3635d62f5a935801e26a0d5fa2cb5e2dbbb42f9b\r\n\r\nWith the new `chain_test` test, this optimization reduces the number of steps in `LastCommonAncestor` by at least 5-fold (e.g. from 5898713 to 1119703), an obvious optimization.\r\nHowever, timing the tests (pre and post optimization) I could not measure a difference.\r\nI've left two non-blocking nit comments.",
          "created_at": "2025-10-06T12:26:52Z"
        },
        {
          "user": "optout21",
          "body": "> However, timing the tests (pre and post optimization) I could not measure a difference.\r\n\r\nMost of the CPU time in the test is taken by the `NaiveGetAncestor` and `NaiveLastCommonAncestor` naive implementations. Taken out calls to those, I have measured a 47% speedup in the execution of the test (user time).\r\n\r\n",
          "created_at": "2025-10-06T12:36:45Z"
        },
        {
          "user": "achow101",
          "body": "ACK 3635d62f5a935801e26a0d5fa2cb5e2dbbb42f9b",
          "created_at": "2025-10-07T20:45:54Z"
        }
      ]
    },
    {
      "number": 33514,
      "title": "ci: clear out space on CentOS, depends, gui GHA job",
      "body": "Fixes #33293\r\n\r\nClear out space on jobs running on GHA by deleteing unnecessary files.\r\n\r\nRaised in #33293 which pointed to a solution like https://github.com/google/oss-fuzz/commit/b7f04d782277638a67bc44865de445977eed4708 which is adapted slightly here.\r\n\r\nOnly runs when cache provider (runner) is `gha`.\r\n\r\nA run on my fork can be seen here: https://github.com/willcl-ark/bitcoin/actions/runs/19703413734/job/56444984809",
      "state": "closed",
      "user": "willcl-ark",
      "created_at": "2025-10-01T14:04:53Z",
      "updated_at": "2025-11-27T18:48:01Z",
      "comments": 21,
      "url": "https://github.com/bitcoin/bitcoin/pull/33514",
      "labels": [
        "Tests"
      ]
    },
    {
      "number": 33512,
      "title": "coins: use number of dirty cache entries in flush warnings/logs",
      "body": "Revival of https://github.com/bitcoin/bitcoin/pull/31703 with all outstanding review feedback addressed.\r\n\r\n<details>\r\n<summary>Changes compared to the original</summary>\r\n\r\n* `EmplaceCoinInternalDANGER` is also fuzz tested now\r\n* Warning and logging moved from `FlushStateToDisk` to `CCoinsViewDB::BatchWrite`, ensuring `AssumeUTXO` snapshot writes also display progress warnings\r\n* Removed the redundant changed counter in `BatchWrite` since we now track `dirty_count` directly\r\n* All instances use `dirty_count` (not num_dirty) and parameter alignment is corrected\r\n\r\n</details>\r\n\r\n----\r\n\r\n> Since #28280 and #28233, the percentage of dirty entries in the cache when a flush happens may in practice be far from 100%. The log output, the decision to warn about a large flush (#31534), and the disk-full detection, however always use the entire size of the cache.\r\n>\r\n> Fix this by keeping track of the number of dirty entries in `CCoinsViewCache`, and using that number. We've dropped the usage of `DynamicMemoryUsage` as it's the wrong metric, even before the non-wiping flushes were introduced (if everything is dirty, memory usage is correlated with, but not the same as, the amount of disk space written or used). They could be improved by keeping track of proper write size estimates in a follow-up, but here we're just using a fixed 48 bytes per entry estimate.",
      "state": "open",
      "user": "l0rinc",
      "created_at": "2025-10-01T02:24:51Z",
      "updated_at": "2026-01-07T00:55:03Z",
      "comments": 8,
      "url": "https://github.com/bitcoin/bitcoin/pull/33512",
      "labels": [
        "UTXO Db and Indexes"
      ],
      "comment_list": [
        {
          "user": "DrahtBot",
          "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/33512.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\nA summary of reviews will appear here.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#34207](https://github.com/bitcoin/bitcoin/pull/34207) (coins/refactor: enforce `GetCoin()` returns only unspent coins by l0rinc)\n* [#34124](https://github.com/bitcoin/bitcoin/pull/34124) (refactor: make `CCoinsView` a purely virtual abstract base class by l0rinc)\n* [#33018](https://github.com/bitcoin/bitcoin/pull/33018) (coins: remove SetFresh method from CCoinsCacheEntry by andrewtoth)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n<!--5faf32d7da4f0f540f40219e4f7537a3-->",
          "created_at": "2025-10-01T02:24:56Z"
        },
        {
          "user": "fanquake",
          "body": "https://github.com/bitcoin/bitcoin/actions/runs/18149289661/job/51656823259?pr=33512#step:9:2059:\r\n```bash\r\nRun coins_view_db with args ['/home/admin/actions-runner/_work/_temp/build/bin/fuzz', '-runs=1', PosixPath('/home/admin/actions-runner/_work/_temp/ci/scratch/qa-assets/fuzz_corpora/coins_view_db')]INFO: Running with entropic power schedule (0xFF, 100).\r\nINFO: Seed: 1436700023\r\nINFO: Loaded 1 modules   (611994 inline 8-bit counters): 611994 [0x6082fc8a27f8, 0x6082fc937e92), \r\nINFO: Loaded 1 PC tables (611994 PCs): 611994 [0x6082fc937e98,0x6082fd28e838), \r\nINFO:     2396 files found in /home/admin/actions-runner/_work/_temp/ci/scratch/qa-assets/fuzz_corpora/coins_view_db\r\nINFO: -max_len is not provided; libFuzzer will not generate inputs larger than 275937 bytes\r\nINFO: seed corpus: files: 2396 min: 2b max: 275937b total: 27207582b rss: 109Mb\r\n/home/admin/actions-runner/_work/_temp/src/coins.h:288:23: runtime error: unsigned integer overflow: 0 - 1 cannot be represented in type 'size_t' (aka 'unsigned long')\r\n    #0 0x6082f97eb6c4 in CoinsViewCacheCursor::NextAndMaybeErase(std::pair<COutPoint const, CCoinsCacheEntry>&) /home/admin/actions-runner/_work/_temp/build/src/test/fuzz/./coins.h:288:23\r\n    #1 0x6082fb3e30bb in CCoinsViewDB::BatchWrite(CoinsViewCacheCursor&, uint256 const&) /home/admin/actions-runner/_work/_temp/build/src/./txdb.cpp:137:21\r\n    #2 0x6082f9ec4573 in CCoinsViewCache::Flush() /home/admin/actions-runner/_work/_temp/build/src/./coins.cpp:265:22\r\n    #3 0x6082f97cb77f in TestCoinsView(FuzzedDataProvider&, CCoinsView&, bool)::$_0::operator()() const /home/admin/actions-runner/_work/_temp/build/src/test/fuzz/./test/fuzz/coins_view.cpp:77:48\r\n    #4 0x6082f97cb77f in unsigned long CallOneOf<TestCoinsView(FuzzedDataProvider&, CCoinsView&, bool)::$_0, TestCoinsView(FuzzedDataProvider&, CCoinsView&, bool)::$_1, TestCoinsView(FuzzedDataProvider&, CCoinsView&, bool)::$_2, TestCoinsView(FuzzedDataProvider&, CCoinsView&, bool)::$_3, TestCoinsView(FuzzedDataProvider&, CCoinsView&, bool)::$_4, TestCoinsView(FuzzedDataProvider&, CCoinsView&, bool)::$_5, TestCoinsView(FuzzedDataProvider&, CCoinsView&, bool)::$_6, TestCoinsView(FuzzedDataProvider&, CCoinsView&, bool)::$_7, TestCoinsView(FuzzedDataProvider&, CCoinsView&, bool)::$_8, TestCoinsView(FuzzedDataProvider&, CCoinsView&, bool)::$_9, TestCoinsView(FuzzedDataProvider&, CCoinsView&, bool)::$_10>(FuzzedDataProvider&, TestCoinsView(FuzzedDataProvider&, CCoinsView&, bool)::$_0, TestCoinsView(FuzzedDataProvider&, CCoinsView&, bool)::$_1, TestCoinsView(FuzzedDataProvider&, CCoinsView&, bool)::$_2, TestCoinsView(FuzzedDataProvider&, CCoinsView&, bool)::$_3, TestCoinsView(FuzzedDataProvider&, CCoinsView&, bool)::$_4, TestCoinsView(FuzzedDataProvider&, CCoinsView&, bool)::$_5, TestCoinsView(FuzzedDataProvider&, CCoinsView&, bool)::$_6, TestCoinsView(FuzzedDataProvider&, CCoinsView&, bool)::$_7, TestCoinsView(FuzzedDataProvider&, CCoinsView&, bool)::$_8, TestCoinsView(FuzzedDataProvider&, CCoinsView&, bool)::$_9, TestCoinsView(FuzzedDataProvider&, CCoinsView&, bool)::$_10) /home/admin/actions-runner/_work/_temp/build/src/test/fuzz/./test/fuzz/util.h:42:27\r\n    #5 0x6082f97cb77f in TestCoinsView(FuzzedDataProvider&, CCoinsView&, bool) /home/admin/actions-runner/_work/_temp/build/src/test/fuzz/./test/fuzz/coins_view.cpp:56:9\r\n    #6 0x6082f97cfc0c in coins_view_db_fuzz_target(std::span<unsigned char const, 18446744073709551615ul>) /home/admin/actions-runner/_work/_temp/build/src/test/fuzz/./test/fuzz/coins_view.cpp:323:5\r\n    #7 0x6082f9e6efae in std::function<void (std::span<unsigned char const, 18446744073709551615ul>)>::operator()(std::span<unsigned char const, 18446744073709551615ul>) const /usr/lib/gcc/x86_64-linux-gnu/13/../../../../include/c++/13/bits/std_function.h:591:9\r\n    #8 0x6082f9e6efae in test_one_input(std::span<unsigned char const, 18446744073709551615ul>) /home/admin/actions-runner/_work/_temp/build/src/test/fuzz/util/./test/fuzz/fuzz.cpp:88:5\r\n    #9 0x6082f9e6efae in LLVMFuzzerTestOneInput /home/admin/actions-runner/_work/_temp/build/src/test/fuzz/util/./test/fuzz/fuzz.cpp:216:5\r\n    #10 0x6082f947d66f in fuzzer::Fuzzer::ExecuteCallback(unsigned char const*, unsigned long) (/home/admin/actions-runner/_work/_temp/build/bin/fuzz+0x1a8366f) (BuildId: c46e5f78c23c1d0b2ce0fb85b0817bc7fae97dd8)\r\n    #11 0x6082f947cc79 in fuzzer::Fuzzer::RunOne(unsigned char const*, unsigned long, bool, fuzzer::InputInfo*, bool, bool*) (/home/admin/actions-runner/_work/_temp/build/bin/fuzz+0x1a82c79) (BuildId: c46e5f78c23c1d0b2ce0fb85b0817bc7fae97dd8)\r\n    #12 0x6082f947e9e2 in fuzzer::Fuzzer::ReadAndExecuteSeedCorpora(std::vector<fuzzer::SizedFile, std::allocator<fuzzer::SizedFile>>&) (/home/admin/actions-runner/_work/_temp/build/bin/fuzz+0x1a849e2) (BuildId: c46e5f78c23c1d0b2ce0fb85b0817bc7fae97dd8)\r\n    #13 0x6082f947ef00 in fuzzer::Fuzzer::Loop(std::vector<fuzzer::SizedFile, std::allocator<fuzzer::SizedFile>>&) (/home/admin/actions-runner/_work/_temp/build/bin/fuzz+0x1a84f00) (BuildId: c46e5f78c23c1d0b2ce0fb85b0817bc7fae97dd8)\r\n    #14 0x6082f946b585 in fuzzer::FuzzerDriver(int*, char***, int (*)(unsigned char const*, unsigned long)) (/home/admin/actions-runner/_work/_temp/build/bin/fuzz+0x1a71585) (BuildId: c46e5f78c23c1d0b2ce0fb85b0817bc7fae97dd8)\r\n    #15 0x6082f9497946 in main (/home/admin/actions-runner/_work/_temp/build/bin/fuzz+0x1a9d946) (BuildId: c46e5f78c23c1d0b2ce0fb85b0817bc7fae97dd8)\r\n    #16 0x756d565fa1c9  (/lib/x86_64-linux-gnu/libc.so.6+0x2a1c9) (BuildId: 274eec488d230825a136fa9c4d85370fed7a0a5e)\r\n    #17 0x756d565fa28a in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x2a28a) (BuildId: 274eec488d230825a136fa9c4d85370fed7a0a5e)\r\n    #18 0x6082f945fb54 in _start (/home/admin/actions-runner/_work/_temp/build/bin/fuzz+0x1a65b54) (BuildId: c46e5f78c23c1d0b2ce0fb85b0817bc7fae97dd8)\r\n\r\nSUMMARY: UndefinedBehaviorSanitizer: unsigned-integer-overflow /home/admin/actions-runner/_work/_temp/src/coins.h:288:23 \r\nMS: 0 ; base unit: 0000000000000000000000000000000000000000\r\n0x1,0xff,0xff,0xff,0xf2,0xfc,0xff,0x2f,0x1f,0xa9,0x5d,0x30,0x30,0x90,0x0,0x0,0x0,0x14,0x69,0x0,0x0,0x0,0x0,0x0,0x0,0xc1,0xc1,0xc1,0xc1,0xc1,0xc1,0xb7,0xc1,0xc1,0x5c,0x91,0x3b,0x72,0x0,0xff,0xfa,0x21,\r\n\\001\\377\\377\\377\\362\\374\\377/\\037\\251]00\\220\\000\\000\\000\\024i\\000\\000\\000\\000\\000\\000\\301\\301\\301\\301\\301\\301\\267\\301\\301\\\\\\221;r\\000\\377\\372!\r\nartifact_prefix='./'; Test unit written to ./crash-ebc99ca6d40a3c7a37202cdba9a8b36a2cb6007b\r\nBase64: Af////L8/y8fqV0wMJAAAAAUaQAAAAAAAMHBwcHBwbfBwVyRO3IA//oh\r\n\r\nINFO: Running with entropic power schedule (0xFF, 100).\r\nINFO: Seed: 1436700023\r\nINFO: Loaded 1 modules   (611994 inline 8-bit counters): 611994 [0x6082fc8a27f8, 0x6082fc937e92), \r\nINFO: Loaded 1 PC tables (611994 PCs): 611994 [0x6082fc937e98,0x6082fd28e838), \r\nINFO:     2396 files found in /home/admin/actions-runner/_work/_temp/ci/scratch/qa-assets/fuzz_corpora/coins_view_db\r\nINFO: -max_len is not provided; libFuzzer will not generate inputs larger than 275937 bytes\r\nINFO: seed corpus: files: 2396 min: 2b max: 275937b total: 27207582b rss: 109Mb\r\n/home/admin/actions-runner/_work/_temp/src/coins.h:288:23: runtime error: unsigned integer overflow: 0 - 1 cannot be represented in type 'size_t' (aka 'unsigned long')\r\n    #0 0x6082f97eb6c4 in CoinsViewCacheCursor::NextAndMaybeErase(std::pair<COutPoint const, CCoinsCacheEntry>&) /home/admin/actions-runner/_work/_temp/build/src/test/fuzz/./coins.h:288:23\r\n    #1 0x6082fb3e30bb in CCoinsViewDB::BatchWrite(CoinsViewCacheCursor&, uint256 const&) /home/admin/actions-runner/_work/_temp/build/src/./txdb.cpp:137:21\r\n    #2 0x6082f9ec4573 in CCoinsViewCache::Flush() /home/admin/actions-runner/_work/_temp/build/src/./coins.cpp:265:22\r\n    #3 0x6082f97cb77f in TestCoinsView(FuzzedDataProvider&, CCoinsView&, bool)::$_0::operator()() const /home/admin/actions-runner/_work/_temp/build/src/test/fuzz/./test/fuzz/coins_view.cpp:77:48\r\n    #4 0x6082f97cb77f in unsigned long CallOneOf<TestCoinsView(FuzzedDataProvider&, CCoinsView&, bool)::$_0, TestCoinsView(FuzzedDataProvider&, CCoinsView&, bool)::$_1, TestCoinsView(FuzzedDataProvider&, CCoinsView&, bool)::$_2, TestCoinsView(FuzzedDataProvider&, CCoinsView&, bool)::$_3, TestCoinsView(FuzzedDataProvider&, CCoinsView&, bool)::$_4, TestCoinsView(FuzzedDataProvider&, CCoinsView&, bool)::$_5, TestCoinsView(FuzzedDataProvider&, CCoinsView&, bool)::$_6, TestCoinsView(FuzzedDataProvider&, CCoinsView&, bool)::$_7, TestCoinsView(FuzzedDataProvider&, CCoinsView&, bool)::$_8, TestCoinsView(FuzzedDataProvider&, CCoinsView&, bool)::$_9, TestCoinsView(FuzzedDataProvider&, CCoinsView&, bool)::$_10>(FuzzedDataProvider&, TestCoinsView(FuzzedDataProvider&, CCoinsView&, bool)::$_0, TestCoinsView(FuzzedDataProvider&, CCoinsView&, bool)::$_1, TestCoinsView(FuzzedDataProvider&, CCoinsView&, bool)::$_2, TestCoinsView(FuzzedDataProvider&, CCoinsView&, bool)::$_3, TestCoinsView(FuzzedDataProvider&, CCoinsView&, bool)::$_4, TestCoinsView(FuzzedDataProvider&, CCoinsView&, bool)::$_5, TestCoinsView(FuzzedDataProvider&, CCoinsView&, bool)::$_6, TestCoinsView(FuzzedDataProvider&, CCoinsView&, bool)::$_7, TestCoinsView(FuzzedDataProvider&, CCoinsView&, bool)::$_8, TestCoinsView(FuzzedDataProvider&, CCoinsView&, bool)::$_9, TestCoinsView(FuzzedDataProvider&, CCoinsView&, bool)::$_10) /home/admin/actions-runner/_work/_temp/build/src/test/fuzz/./test/fuzz/util.h:42:27\r\n    #5 0x6082f97cb77f in TestCoinsView(FuzzedDataProvider&, CCoinsView&, bool) /home/admin/actions-runner/_work/_temp/build/src/test/fuzz/./test/fuzz/coins_view.cpp:56:9\r\n    #6 0x6082f97cfc0c in coins_view_db_fuzz_target(std::span<unsigned char const, 18446744073709551615ul>) /home/admin/actions-runner/_work/_temp/build/src/test/fuzz/./test/fuzz/coins_view.cpp:323:5\r\n    #7 0x6082f9e6efae in std::function<void (std::span<unsigned char const, 18446744073709551615ul>)>::operator()(std::span<unsigned char const, 18446744073709551615ul>) const /usr/lib/gcc/x86_64-linux-gnu/13/../../../../include/c++/13/bits/std_function.h:591:9\r\n    #8 0x6082f9e6efae in test_one_input(std::span<unsigned char const, 18446744073709551615ul>) /home/admin/actions-runner/_work/_temp/build/src/test/fuzz/util/./test/fuzz/fuzz.cpp:88:5\r\n    #9 0x6082f9e6efae in LLVMFuzzerTestOneInput /home/admin/actions-runner/_work/_temp/build/src/test/fuzz/util/./test/fuzz/fuzz.cpp:216:5\r\n    #10 0x6082f947d66f in fuzzer::Fuzzer::ExecuteCallback(unsigned char const*, unsigned long) (/home/admin/actions-runner/_work/_temp/build/bin/fuzz+0x1a8366f) (BuildId: c46e5f78c23c1d0b2ce0fb85b0817bc7fae97dd8)\r\n    #11 0x6082f947cc79 in fuzzer::Fuzzer::RunOne(unsigned char const*, unsigned long, bool, fuzzer::InputInfo*, bool, bool*) (/home/admin/actions-runner/_work/_temp/build/bin/fuzz+0x1a82c79) (BuildId: c46e5f78c23c1d0b2ce0fb85b0817bc7fae97dd8)\r\n    #12 0x6082f947e9e2 in fuzzer::Fuzzer::ReadAndExecuteSeedCorpora(std::vector<fuzzer::SizedFile, std::allocator<fuzzer::SizedFile>>&) (/home/admin/actions-runner/_work/_temp/build/bin/fuzz+0x1a849e2) (BuildId: c46e5f78c23c1d0b2ce0fb85b0817bc7fae97dd8)\r\n    #13 0x6082f947ef00 in fuzzer::Fuzzer::Loop(std::vector<fuzzer::SizedFile, std::allocator<fuzzer::SizedFile>>&) (/home/admin/actions-runner/_work/_temp/build/bin/fuzz+0x1a84f00) (BuildId: c46e5f78c23c1d0b2ce0fb85b0817bc7fae97dd8)\r\n    #14 0x6082f946b585 in fuzzer::FuzzerDriver(int*, char***, int (*)(unsigned char const*, unsigned long)) (/home/admin/actions-runner/_work/_temp/build/bin/fuzz+0x1a71585) (BuildId: c46e5f78c23c1d0b2ce0fb85b0817bc7fae97dd8)\r\n    #15 0x6082f9497946 in main (/home/admin/actions-runner/_work/_temp/build/bin/fuzz+0x1a9d946) (BuildId: c46e5f78c23c1d0b2ce0fb85b0817bc7fae97dd8)\r\n    #16 0x756d565fa1c9  (/lib/x86_64-linux-gnu/libc.so.6+0x2a1c9) (BuildId: 274eec488d230825a136fa9c4d85370fed7a0a5e)\r\n    #17 0x756d565fa28a in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x2a28a) (BuildId: 274eec488d230825a136fa9c4d85370fed7a0a5e)\r\n    #18 0x6082f945fb54 in _start (/home/admin/actions-runner/_work/_temp/build/bin/fuzz+0x1a65b54) (BuildId: c46e5f78c23c1d0b2ce0fb85b0817bc7fae97dd8)\r\n\r\nSUMMARY: UndefinedBehaviorSanitizer: unsigned-integer-overflow /home/admin/actions-runner/_work/_temp/src/coins.h:288:23 \r\nMS: 0 ; base unit: 0000000000000000000000000000000000000000\r\n0x1,0xff,0xff,0xff,0xf2,0xfc,0xff,0x2f,0x1f,0xa9,0x5d,0x30,0x30,0x90,0x0,0x0,0x0,0x14,0x69,0x0,0x0,0x0,0x0,0x0,0x0,0xc1,0xc1,0xc1,0xc1,0xc1,0xc1,0xb7,0xc1,0xc1,0x5c,0x91,0x3b,0x72,0x0,0xff,0xfa,0x21,\r\n\\001\\377\\377\\377\\362\\374\\377/\\037\\251]00\\220\\000\\000\\000\\024i\\000\\000\\000\\000\\000\\000\\301\\301\\301\\301\\301\\301\\267\\301\\301\\\\\\221;r\\000\\377\\372!\r\nartifact_prefix='./'; Test unit written to ./crash-ebc99ca6d40a3c7a37202cdba9a8b36a2cb6007b\r\nBase64: Af////L8/y8fqV0wMJAAAAAUaQAAAAAAAMHBwcHBwbfBwVyRO3IA//oh\r\n\r\nâš ï¸ Failure generated from target with exit code 1: ['/home/admin/actions-runner/_work/_temp/build/bin/fuzz', '-runs=1', PosixPath('/home/admin/actions-runner/_work/_temp/ci/scratch/qa-assets/fuzz_corpora/coins_view_db')]\r\n```",
          "created_at": "2025-10-01T02:49:23Z"
        },
        {
          "user": "l0rinc",
          "body": "@fanquake the fuzz test is fixed in a [separate PR](https://github.com/bitcoin/bitcoin/pull/32313), I have reverted a similar attempt here",
          "created_at": "2025-10-01T02:51:40Z"
        },
        {
          "user": "l0rinc",
          "body": "Rebased after https://github.com/bitcoin/bitcoin/pull/32313, the PR is simpler and better tested this way.",
          "created_at": "2025-10-16T00:33:15Z"
        },
        {
          "user": "l0rinc",
          "body": "Rebased, ready for review.",
          "created_at": "2025-11-10T17:31:25Z"
        },
        {
          "user": "optout21",
          "body": "A general observation: keeping a count like the dirty count is very efficient, but prone to going out of sync, e.g with future incorrect code changes. For eg., a missing decrement can result in the value creeping higher, a missing increment can result the value going lower, event to underflow -- `size_t` is unsigned. One mitigation is to create (inlinable) inc/dec methods, with sanity checks (in debug mode); pre-decrease the value cannot be 0, pre-increase it cannot be equal to the total entries. Event thought this value is used only for logging, checking for sub-0 underflow would make sense, as a guard against future bugs.",
          "created_at": "2025-11-15T17:13:00Z"
        },
        {
          "user": "l0rinc",
          "body": "Clean rebase, reviews are welcome again.",
          "created_at": "2025-12-11T13:07:00Z"
        },
        {
          "user": "l0rinc",
          "body": "Rebased after https://github.com/bitcoin/bitcoin/pull/33866\r\n\r\n`git range-diff -U0 master eac63b2 0ac4cb6`:\r\n* Adjusted the `Flush`/`Sync` changes;\r\n* Removed a useless move from: `stack.back()->AddCoin(op, std::move(newcoin), ...`;\r\n\r\nReady for review again!",
          "created_at": "2026-01-03T11:37:11Z"
        }
      ]
    }
  ],
  "issues": [
    {
      "number": 33513,
      "title": ".",
      "body": "",
      "state": "closed",
      "user": "venpisey12",
      "created_at": "2025-10-01T12:40:13Z",
      "updated_at": "2025-10-01T13:41:17Z",
      "comments": 0,
      "url": "https://github.com/bitcoin/bitcoin/issues/33513",
      "labels": []
    }
  ],
  "summary": {
    "pull_requests": 5,
    "issues": 1
  }
}