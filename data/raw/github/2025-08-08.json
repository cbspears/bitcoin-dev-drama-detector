{
  "source": "github",
  "repository": "bitcoin/bitcoin",
  "fetched_at": "2026-01-15T20:04:52.194862+00:00",
  "date": "2025-08-08",
  "pull_requests": [
    {
      "number": 33158,
      "title": "macdeploy: avoid use of `Bitcoin Core` in Linux cross build",
      "body": "Output `bitcoin-macos-app.zip`, similar to what we do for Windows: `bitcoin-win64-setup.exe`.",
      "state": "closed",
      "user": "fanquake",
      "created_at": "2025-08-08T16:26:41Z",
      "updated_at": "2025-09-24T13:59:57Z",
      "comments": 6,
      "url": "https://github.com/bitcoin/bitcoin/pull/33158",
      "labels": [],
      "comment_list": [
        {
          "user": "DrahtBot",
          "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/33158.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| ACK | [hodlinator](https://github.com/bitcoin/bitcoin/pull/33158#pullrequestreview-3180311911), [willcl-ark](https://github.com/bitcoin/bitcoin/pull/33158#pullrequestreview-3262868167) |\n| Concept ACK | [jonatack](https://github.com/bitcoin/bitcoin/pull/33158#pullrequestreview-3101552998) |\n\nIf your review is incorrectly listed, please react with üëé to this comment and the bot will ignore it on the next update.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nNo conflicts as of last run.\n<!--5faf32d7da4f0f540f40219e4f7537a3-->",
          "created_at": "2025-08-08T16:26:45Z"
        },
        {
          "user": "hodlinator",
          "body": "Concept ACK",
          "created_at": "2025-08-09T23:00:52Z"
        },
        {
          "user": "achow101",
          "body": "~0\r\n\r\nI find it weird that we would produce files named differently for the same target when the hosts are different. Is there a reason that the zip should include the software name in its name anyways?",
          "created_at": "2025-08-12T18:13:03Z"
        },
        {
          "user": "hodlinator",
          "body": "Agreed that different names depending on originating platform might be a bit confusing.\r\n\r\nWould be slightly more straightforward to switch to *bitcoin-macos-app.zip* as output for all, or allow `-zip` without a value in *contrib/macdeploy/macdeployqtplus* and just produce something like \"macdeploy-output.zip\".",
          "created_at": "2025-08-22T09:24:00Z"
        },
        {
          "user": "fanquake",
          "body": "> I find it weird that we would produce files named differently for the same target when the hosts are different\r\n> Agreed that different names depending on originating platform might be a bit confusing.\r\n\r\nI don't mind much, but I don't think the different names are that weird, given the two outputs are different. One is a release-like zip, with an immediately usable binary, the other is a zip containing a binary that wont run, which is immediately renamed, and fed into the codesigning process.\r\n\r\nIn any case, have changed this to just use `bitcoin-macos-app.zip` everywhere.",
          "created_at": "2025-09-01T15:40:15Z"
        },
        {
          "user": "willcl-ark",
          "body": "Guix hashes:\r\n\r\n```\r\ne522b04c6af1759ea97e71c01b55713685ecb0b25557a864a9fa36af26042a8d  guix-build-8e434a84999c/output/arm64-apple-darwin/SHA256SUMS.part\r\n740e33ee5d6d9a9cbc25dc0b4775e108612650b8c644f75adbce00537316abd9  guix-build-8e434a84999c/output/arm64-apple-darwin/bitcoin-8e434a84999c-arm64-apple-darwin-codesigning.tar.gz\r\nbca939a67f3ac36c4345d61ed498d815608b4889a0e2367a2f71273e8f03b605  guix-build-8e434a84999c/output/arm64-apple-darwin/bitcoin-8e434a84999c-arm64-apple-darwin-unsigned.tar.gz\r\n4347c0de606a919f8923946b7f55960498aa9517e25649168dadef2f0ee67f6f  guix-build-8e434a84999c/output/arm64-apple-darwin/bitcoin-8e434a84999c-arm64-apple-darwin-unsigned.zip\r\na8d4b028bf25b162c9bc89ad68492ee129364721ab70789f578630f71bae9d66  guix-build-8e434a84999c/output/dist-archive/bitcoin-8e434a84999c.tar.gz\r\n9b71793b31e1fdefe374121a3398c51289b80f2a160bacc40aab416423cb029e  guix-build-8e434a84999c/output/x86_64-apple-darwin/SHA256SUMS.part\r\ne30c0a516d949be88c54cb99b6d02a741a5f28a928fc106688aa30720a9ce6fd  guix-build-8e434a84999c/output/x86_64-apple-darwin/bitcoin-8e434a84999c-x86_64-apple-darwin-codesigning.tar.gz\r\n2bd7d35382659c47f5d7f4832a2b2d27623265ffc64079a7b2a21f87686a81ae  guix-build-8e434a84999c/output/x86_64-apple-darwin/bitcoin-8e434a84999c-x86_64-apple-darwin-unsigned.tar.gz\r\n0810727e3fbb856415bb0c5e7df5581959def107178d78cf0b91d05a3c409f98  guix-build-8e434a84999c/output/x86_64-apple-darwin/bitcoin-8e434a84999c-x86_64-apple-darwin-unsigned.zip\r\n```",
          "created_at": "2025-09-24T13:12:56Z"
        }
      ]
    },
    {
      "number": 33157,
      "title": "cluster mempool: control/optimize TxGraph memory usage",
      "body": "Part of #30289.\r\n\r\nThis adds a few optimizations to reduce `TxGraph`'s memory usage, and makes sure that dynamic memory it uses doesn't linger after shrinking clusters. Finally, it exposes a function `GetMainMemoryUsage()` to compute `TxGraph`'s approximate memory usage.\r\n\r\nIt makes the `Cluster` type abstract, with two instances (`SingletonClusterImpl` for 1-transaction clusters, and `GenericClusterImpl` for others).\r\n\r\nOn my 64-bit system, I obtain the following numbers:\r\n* `SingletonClusterImpl`: 48 bytes, plus 16 bytes malloc overhead in its `unique_ptr`, plus 8-byte pointer in `m_clusters`\r\n* `GenericClusterImpl`: 104 bytes, plus 16 bytes malloc overhead in its `unique_ptr`, plus 8-byte pointer in `m_clusters`, plus 72 bytes malloc overhead inside its vectors and `DepGraph`, plus 40 bytes per transaction in those.\r\n* `TxGraphImpl::Entry`: 72 bytes per transaction\r\n* `TxGraphImpl::ChunkData`: 8 bytes, plus 56 bytes in `std::set` overhead + malloc overhead, all per chunk.\r\n* `TxGraph::Ref`: 16 bytes per transaction\r\n\r\nThis overall amounts to 200 bytes per cluster, plus 64 bytes per chunk, plus 128 bytes per transaction, but only 224 bytes overall per singleton cluster.",
      "state": "closed",
      "user": "sipa",
      "created_at": "2025-08-08T14:21:15Z",
      "updated_at": "2025-11-03T11:20:49Z",
      "comments": 15,
      "url": "https://github.com/bitcoin/bitcoin/pull/33157",
      "labels": [],
      "comment_list": [
        {
          "user": "DrahtBot",
          "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/33157.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| ACK | [l0rinc](https://github.com/bitcoin/bitcoin/pull/33157#issuecomment-3393852130), [instagibbs](https://github.com/bitcoin/bitcoin/pull/33157#issuecomment-3397331200), [ismaelsadeeq](https://github.com/bitcoin/bitcoin/pull/33157#pullrequestreview-3335404536), [glozow](https://github.com/bitcoin/bitcoin/pull/33157#pullrequestreview-3336180752) |\n\nIf your review is incorrectly listed, please react with üëé to this comment and the bot will ignore it on the next update.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#33591](https://github.com/bitcoin/bitcoin/pull/33591) (Cluster mempool followups by sdaftuar)\n* [#33469](https://github.com/bitcoin/bitcoin/pull/33469) (TxGraph: change m_excluded_clusters by instagibbs)\n* [#28676](https://github.com/bitcoin/bitcoin/pull/28676) (Cluster mempool implementation by sdaftuar)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n<!--5faf32d7da4f0f540f40219e4f7537a3-->\n### LLM Linter (‚ú® experimental)\n\nPossible typos and grammar issues:\n\n- */ -> (remove) [Trailing \"*/\" after a // comment produces a mismatched comment terminator and is confusing / invalid in the comment \"Cannot move or copy (would invalidate Cluster* in Locator and ClusterSet). */\".]\n\n<sup>drahtbot_id_5_m</sup>\n",
          "created_at": "2025-08-08T14:21:20Z"
        },
        {
          "user": "DrahtBot",
          "body": "<!--85328a0da195eb286784d51f73fa0af9-->\nüöß At least one of the CI tasks failed.\n<sub>Task `macOS-cross, gui, no tests`: https://github.com/bitcoin/bitcoin/runs/47684523262</sub>\n<sub>LLM reason (‚ú® experimental): The CI failure is caused by a compilation error due to ambiguous call to 'DynamicUsage' in txgraph.cpp.</sub>\n\n<details><summary>Hints</summary>\n\nTry to run the tests locally, according to the documentation. However, a CI failure may still\nhappen due to a number of reasons, for example:\n\n* Possibly due to a silent merge conflict (the changes in this pull request being\nincompatible with the current code in the target branch). If so, make sure to rebase on the latest\ncommit of the target branch.\n\n* A sanitizer issue, which can only be found by compiling with the sanitizer and running the\n  affected test.\n\n* An intermittent issue.\n\nLeave a comment here, if you need help tracking down a confusing failure.\n\n</details>\n\n",
          "created_at": "2025-08-08T14:31:05Z"
        },
        {
          "user": "sipa",
          "body": "I had missed a few sources of memory usage in the numbers posted in the PR description before. I've redone the derivation, and explained it in more detail. Thanks @glozow for trying to make sense of my incorrect numbers.",
          "created_at": "2025-09-04T17:43:16Z"
        },
        {
          "user": "sipa",
          "body": "I have implemented the \"abstract Cluster\" approach anyway, as special-casing singletons outside of the Cluster logic was too cumbersome.\r\n\r\nOld numbers:\r\n* 384 bytes per singleton cluster\r\n* 512 or 576 bytes per pair cluster\r\n\r\nNew numbers:\r\n* 224 bytes per singleton cluster\r\n* 520 or 584 bytes per pair cluster",
          "created_at": "2025-09-05T20:39:36Z"
        },
        {
          "user": "sipa",
          "body": "And with the addition of `SingletonClusterImpl`, overall mempool usage (determined by loading a `mempool.dat` from a long-running node into both (1) master and (2) #28676 + this PR), the mempool memusage/vsize ratio seems to have dropped ~4.5%, meaning cluster mempool will effectively increase mempool size by that much for a constant `-maxmempool` setting.\r\n\r\nMaster (6.09 membyte/vbyte):\r\n```\r\n  \"size\": 58610,\r\n  \"bytes\": 28502050,\r\n  \"usage\": 173585008,\r\n  \"total_fee\": 0.05257629,\r\n  \"maxmempool\": 300000000,\r\n```\r\n\r\nCluster mempool + this PR (5.83 membyte/vbyte):\r\n```\r\n  \"size\": 58348,\r\n  \"bytes\": 28461800,\r\n  \"usage\": 165896648,\r\n  \"total_fee\": 0.05210373,\r\n  \"maxmempool\": 300000000,\r\n```",
          "created_at": "2025-09-06T13:02:19Z"
        },
        {
          "user": "sipa",
          "body": "Rebased after #33354 merge.",
          "created_at": "2025-09-11T17:07:58Z"
        },
        {
          "user": "instagibbs",
          "body": "reACK 99e144778eeffc1074d5a1c193896bea335db8af \r\n\r\nvia `git range-diff master 66401148ddcba04c27751e39e53fc41e6deb5d14 99e144778eeffc1074d5a1c193896bea335db8af`",
          "created_at": "2025-09-23T13:55:33Z"
        },
        {
          "user": "instagibbs",
          "body": "reACK 5ac32aa441bf3ec1f1fa826f689405bc4a7b7354\r\n\r\njust a rebase",
          "created_at": "2025-09-23T14:58:53Z"
        },
        {
          "user": "ismaelsadeeq",
          "body": "reACK 5ac32aa441bf3ec1f1fa826f689405bc4a7b7354\r\n\r\nChanges since last ACK are nits fixes.",
          "created_at": "2025-09-25T09:58:45Z"
        },
        {
          "user": "sipa",
          "body": "Addressed many comments, and made some bigger changes:\r\n* Restructured the commits to first make all abstractions, and then do the abstract class `Cluster` change cleanly.\r\n* Use `GetTxCount()` in more places, instead of `m_graph_index != GraphIndex(-1)`\r\n* Made `Compact()` and memory accounting work at the `TxGraphImpl::Merge` level rather than `Cluster::Merge`: the old code could be compacting O(n) times when merging n clusters together simultaneously.\r\n* Made the dealing with which implementations are valid for which ranges of transaction counts much cleaner.\r\n* Improved comments.",
          "created_at": "2025-10-09T18:23:23Z"
        },
        {
          "user": "l0rinc",
          "body": "Thank you for considering the suggestions, I find the new layout a lot easier to follow.\r\n\r\nI have left a few more nits, but I'm fine doing them in a follow-up.\r\nI like these memory optimizations, my only concern is that we're likely doing a lot heavier copying because of the regular compactions (especially since most move constructors seem unused based on previous fuzzing reports). As mentioned, in a follow-up we can experiment with leaving a tiny buffer.\r\n\r\nI have also added a few redundant assertions locally and ran a fuzzer for `FUZZ=clusterlin_depgraph_sim` and `FUZZ=txgraph` overnight (without sanitizers which I can't get to work on a Mac anyway) and they both passed üëç \r\n\r\n<details>\r\n<summary>patch with extra assertions and other minor changes done during review</summary>\r\n\r\n```patch\r\ndiff --git a/src/txgraph.cpp b/src/txgraph.cpp\r\n--- a/src/txgraph.cpp\t(revision 262762bbb6f7157ba8c54972909c9214448c304b)\r\n+++ b/src/txgraph.cpp\t(date 1760202864002)\r\n@@ -99,6 +99,9 @@\r\n class Cluster\r\n {\r\n     friend class TxGraphImpl;\r\n+    /** Sequence number for this Cluster (for tie-breaking comparison between equal-chunk-feerate\r\n+        transactions in distinct clusters). */\r\n+    uint64_t m_sequence;\r\n \r\n protected:\r\n     using GraphIndex = TxGraph::GraphIndex;\r\n@@ -107,9 +110,6 @@\r\n     QualityLevel m_quality{QualityLevel::NONE};\r\n     /** Which position this Cluster has in TxGraphImpl::ClusterSet::m_clusters[m_quality]. */\r\n     ClusterSetIndex m_setindex{ClusterSetIndex(-1)};\r\n-    /** Sequence number for this Cluster (for tie-breaking comparison between equal-chunk-feerate\r\n-        transactions in distinct clusters). */\r\n-    uint64_t m_sequence;\r\n \r\n     explicit Cluster(uint64_t sequence) noexcept : m_sequence(sequence) {}\r\n \r\n@@ -616,7 +616,7 @@\r\n     /** If idx exists in the specified level ClusterSet (explicitly, or in the level below and not\r\n     *   removed), return the Cluster it is in. Otherwise, return nullptr. */\r\n     Cluster* FindCluster(GraphIndex idx, int level) const noexcept { return FindClusterAndLevel(idx, level).first; }\r\n-    /** Like FindClusterAndLevel, but also return what level the match was found in (-1 if not found). */\r\n+    /** Like FindCluster, but also return what level the match was found in (-1 if not found). */\r\n     std::pair<Cluster*, int> FindClusterAndLevel(GraphIndex idx, int level) const noexcept;\r\n     /** Extract a Cluster from its ClusterSet, and set its quality to QualityLevel::NONE. */\r\n     std::unique_ptr<Cluster> ExtractCluster(int level, QualityLevel quality, ClusterSetIndex setindex) noexcept;\r\n@@ -663,8 +663,7 @@\r\n         if (tx_count >= GenericClusterImpl::MIN_INTENDED_TX_COUNT && tx_count <= GenericClusterImpl::MAX_TX_COUNT) {\r\n             return CreateEmptyGenericCluster();\r\n         }\r\n-        assert(false);\r\n-        return {};\r\n+        std::abort();\r\n     }\r\n \r\n     // Functions for handling Refs.\r\n@@ -722,7 +721,7 @@\r\n     /** If cluster is not in staging, copy it there, and return a pointer to it.\r\n     *   Staging must exist, and this modifies the locators of its\r\n     *   transactions from inherited (P,M) to explicit (P,P). */\r\n-    Cluster* PullIn(Cluster* cluster) noexcept;\r\n+    Cluster* PullIn(Cluster* cluster, int level) noexcept;\r\n     /** Apply all removals queued up in m_to_remove to the relevant Clusters (which get a\r\n      *  NEEDS_SPLIT* QualityLevel) up to the specified level. */\r\n     void ApplyRemovals(int up_to_level) noexcept;\r\n@@ -896,22 +895,22 @@\r\n \r\n DepGraphIndex SingletonClusterImpl::AppendTransaction(GraphIndex graph_idx, FeePerWeight feerate) noexcept\r\n {\r\n-    Assume(m_graph_index == GraphIndex(-1));\r\n+    Assume(!GetTxCount());\r\n     m_graph_index = graph_idx;\r\n     m_feerate = feerate;\r\n     return 0;\r\n }\r\n \r\n-void GenericClusterImpl::AddDependencies(SetType parent, DepGraphIndex child) noexcept\r\n+void GenericClusterImpl::AddDependencies(SetType parents, DepGraphIndex child) noexcept\r\n {\r\n-    m_depgraph.AddDependencies(parent, child);\r\n+    m_depgraph.AddDependencies(parents, child);\r\n }\r\n \r\n-void SingletonClusterImpl::AddDependencies(SetType parent, DepGraphIndex child) noexcept\r\n+void SingletonClusterImpl::AddDependencies(SetType parents, DepGraphIndex child) noexcept\r\n {\r\n     // Singletons cannot have any dependencies.\r\n     Assume(child == 0);\r\n-    Assume(parent == SetType{} || parent == SetType::Fill(0));\r\n+    Assume(parents == SetType{} || parents == SetType::Fill(0));\r\n }\r\n \r\n void GenericClusterImpl::ExtractTransactions(const std::function<void (DepGraphIndex, GraphIndex, FeePerWeight, SetType)>& visit_fn) noexcept\r\n@@ -946,8 +945,7 @@\r\n     }\r\n     // Given that we started with an Entry that occurs in this Cluster, one of its Locators must\r\n     // point back to it.\r\n-    assert(false);\r\n-    return -1;\r\n+    std::abort();\r\n }\r\n \r\n int SingletonClusterImpl::GetLevel(const TxGraphImpl& graph) const noexcept\r\n@@ -963,8 +961,7 @@\r\n     }\r\n     // Given that we started with an Entry that occurs in this Cluster, one of its Locators must\r\n     // point back to it.\r\n-    assert(false);\r\n-    return -1;\r\n+    std::abort();\r\n }\r\n \r\n void TxGraphImpl::ClearLocator(int level, GraphIndex idx, bool oversized_tx) noexcept\r\n@@ -981,6 +978,7 @@\r\n     }\r\n     // Update the transaction count.\r\n     --clusterset.m_txcount;\r\n+    Assert(clusterset.m_txcount_oversized >= oversized_tx);\r\n     clusterset.m_txcount_oversized -= oversized_tx;\r\n     // If clearing main, adjust the status of Locators of this transaction in staging, if it exists.\r\n     if (level == 0 && GetTopLevel() == 1) {\r\n@@ -988,6 +986,7 @@\r\n             entry.m_locator[1].SetMissing();\r\n         } else if (!entry.m_locator[1].IsPresent()) {\r\n             --m_staging_clusterset->m_txcount;\r\n+            Assert(m_staging_clusterset->m_txcount_oversized >= oversized_tx);\r\n             m_staging_clusterset->m_txcount_oversized -= oversized_tx;\r\n         }\r\n     }\r\n@@ -1091,7 +1090,7 @@\r\n std::vector<Cluster*> TxGraphImpl::GetConflicts() const noexcept\r\n {\r\n     Assume(GetTopLevel() == 1);\r\n-    auto& clusterset = GetClusterSet(1);\r\n+    auto& clusterset = GetClusterSet(/*level=*/1);\r\n     std::vector<Cluster*> ret;\r\n     // All main Clusters containing transactions in m_removed (so (P,R) ones) are conflicts.\r\n     for (auto i : clusterset.m_removed) {\r\n@@ -1140,11 +1139,11 @@\r\n     ptr->m_graph_index = m_graph_index;\r\n     ptr->m_feerate = m_feerate;\r\n     // Insert the new Cluster into the graph.\r\n-    graph.InsertCluster(1, std::move(ret), m_quality);\r\n+    graph.InsertCluster(/*level=*/1, std::move(ret), m_quality);\r\n     // Update its Locators.\r\n-    ptr->Updated(graph, 1);\r\n+    ptr->Updated(graph, /*level=*/1);\r\n     // Update memory usage.\r\n-    graph.GetClusterSet(1).m_cluster_usage += ptr->TotalMemoryUsage();\r\n+    graph.GetClusterSet(/*level=*/1).m_cluster_usage += ptr->TotalMemoryUsage();\r\n     return ptr;\r\n }\r\n \r\n@@ -1153,6 +1152,7 @@\r\n     // Iterate over the prefix of to_remove that applies to this cluster.\r\n     Assume(!to_remove.empty());\r\n     SetType todo;\r\n+    Assert(graph.GetClusterSet(level).m_cluster_usage >= TotalMemoryUsage());\r\n     graph.GetClusterSet(level).m_cluster_usage -= TotalMemoryUsage();\r\n     do {\r\n         GraphIndex idx = to_remove.front();\r\n@@ -1231,6 +1231,8 @@\r\n \r\n void GenericClusterImpl::Clear(TxGraphImpl& graph, int level) noexcept\r\n {\r\n+    Assume(GetTxCount());\r\n+    Assert(graph.GetClusterSet(level).m_cluster_usage >= TotalMemoryUsage());\r\n     graph.GetClusterSet(level).m_cluster_usage -= TotalMemoryUsage();\r\n     for (auto i : m_linearization) {\r\n         graph.ClearLocator(level, m_mapping[i], m_quality == QualityLevel::OVERSIZED_SINGLETON);\r\n@@ -1243,6 +1245,7 @@\r\n void SingletonClusterImpl::Clear(TxGraphImpl& graph, int level) noexcept\r\n {\r\n     Assume(GetTxCount());\r\n+    Assert(graph.GetClusterSet(level).m_cluster_usage >= TotalMemoryUsage());\r\n     graph.GetClusterSet(level).m_cluster_usage -= TotalMemoryUsage();\r\n     graph.ClearLocator(level, m_graph_index, m_quality == QualityLevel::OVERSIZED_SINGLETON);\r\n     m_graph_index = GraphIndex(-1);\r\n@@ -1257,10 +1260,11 @@\r\n     }\r\n     auto quality = m_quality;\r\n     // Subtract memory usage from staging and add it to main.\r\n+    Assert(graph.GetClusterSet(/*level=*/1).m_cluster_usage >= TotalMemoryUsage());\r\n     graph.GetClusterSet(/*level=*/1).m_cluster_usage -= TotalMemoryUsage();\r\n     graph.GetClusterSet(/*level=*/0).m_cluster_usage += TotalMemoryUsage();\r\n     // Remove cluster itself from staging and add it to main.\r\n-    auto cluster = graph.ExtractCluster(1, quality, m_setindex);\r\n+    auto cluster = graph.ExtractCluster(/*level=*/1, quality, m_setindex);\r\n     graph.InsertCluster(/*level=*/0, std::move(cluster), quality);\r\n     Updated(graph, /*level=*/0);\r\n }\r\n@@ -1272,10 +1276,11 @@\r\n         entry.m_locator[1].SetMissing();\r\n     }\r\n     auto quality = m_quality;\r\n-    graph.GetClusterSet(1).m_cluster_usage -= TotalMemoryUsage();\r\n-    auto cluster = graph.ExtractCluster(1, quality, m_setindex);\r\n-    graph.InsertCluster(0, std::move(cluster), quality);\r\n-    graph.GetClusterSet(0).m_cluster_usage += TotalMemoryUsage();\r\n+    Assert(graph.GetClusterSet(/*level=*/1).m_cluster_usage >= TotalMemoryUsage());\r\n+    graph.GetClusterSet(/*level=*/1).m_cluster_usage -= TotalMemoryUsage();\r\n+    auto cluster = graph.ExtractCluster(/*level=*/1, quality, m_setindex);\r\n+    graph.InsertCluster(/*level=*/0, std::move(cluster), quality);\r\n+    graph.GetClusterSet(/*level=*/0).m_cluster_usage += TotalMemoryUsage();\r\n     Updated(graph, 0);\r\n }\r\n \r\n@@ -1374,7 +1379,7 @@\r\n         auto component = m_depgraph.FindConnectedComponent(todo);\r\n         auto component_size = component.Count();\r\n         auto split_quality = component_size <= 2 ? QualityLevel::OPTIMAL : new_quality;\r\n-        if (first && component == todo && SetType::Fill(component_size) == component && component_size >= MIN_INTENDED_TX_COUNT) {\r\n+        if (first && component == todo && SetType::Fill(component_size) == component && component_size >= GetMinIntendedTxCount()) {\r\n             // The existing Cluster is an entire component, without holes. Leave it be, but update\r\n             // its quality. If there are holes, we continue, so that the Cluster is reconstructed\r\n             // without holes, reducing memory usage. If the component's size is below the intended\r\n@@ -1400,6 +1405,7 @@\r\n         todo -= component;\r\n     }\r\n     // We have to split the Cluster up. Remove accounting for the existing one first.\r\n+    Assert(graph.GetClusterSet(level).m_cluster_usage >= TotalMemoryUsage());\r\n     graph.GetClusterSet(level).m_cluster_usage -= TotalMemoryUsage();\r\n     // Redistribute the transactions.\r\n     for (auto i : m_linearization) {\r\n@@ -1435,6 +1441,7 @@\r\n     Assume(NeedsSplitting());\r\n     if (GetTxCount() == 0) {\r\n         // The cluster is now empty.\r\n+        Assert(graph.GetClusterSet(level).m_cluster_usage >= TotalMemoryUsage());\r\n         graph.GetClusterSet(level).m_cluster_usage -= TotalMemoryUsage();\r\n         return true;\r\n     } else {\r\n@@ -1453,10 +1460,10 @@\r\n     other.ExtractTransactions([&](DepGraphIndex pos, GraphIndex idx, FeePerWeight feerate, SetType other_parents) noexcept {\r\n         // Copy the transaction into this Cluster, and remember its position.\r\n         auto new_pos = m_depgraph.AddTransaction(feerate);\r\n-        remap[pos] = new_pos;\r\n         // Since this cluster must have been made hole-free before being merged into, all added\r\n         // transactions should appear at the end.\r\n         Assume(new_pos == m_mapping.size());\r\n+        remap[pos] = new_pos;\r\n         m_mapping.push_back(idx);\r\n         m_linearization.push_back(new_pos);\r\n         // Copy the transaction's dependencies, translating them using remap. Note that since\r\n@@ -1610,10 +1617,8 @@\r\n \r\n void TxGraphImpl::DeleteCluster(Cluster& cluster, int level) noexcept\r\n {\r\n-    // Extract the cluster from where it currently resides.\r\n-    auto cluster_ptr = ExtractCluster(level, cluster.m_quality, cluster.m_setindex);\r\n-    // And throw it away.\r\n-    cluster_ptr.reset();\r\n+    // Extract the cluster from where it currently resides and throw it away.\r\n+    ExtractCluster(level, cluster.m_quality, cluster.m_setindex);\r\n }\r\n \r\n std::pair<Cluster*, int> TxGraphImpl::FindClusterAndLevel(GraphIndex idx, int level) const noexcept\r\n@@ -1634,11 +1639,12 @@\r\n     return {nullptr, -1};\r\n }\r\n \r\n-Cluster* TxGraphImpl::PullIn(Cluster* cluster) noexcept\r\n+Cluster* TxGraphImpl::PullIn(Cluster* cluster, int cluster_level) noexcept\r\n {\r\n     int to_level = GetTopLevel();\r\n     Assume(to_level == 1);\r\n     int level = cluster->GetLevel(*this);\r\n+    Assert(level == cluster_level); // TODO use parent call calculations instead\r\n     Assume(level <= to_level);\r\n     // Copy the Cluster from main to staging, if it's not already there.\r\n     if (level == 0) {\r\n@@ -1661,8 +1667,8 @@\r\n         // Pull in all Clusters that are not in staging.\r\n         if (level == 1) {\r\n             for (GraphIndex index : to_remove) {\r\n-                auto cluster = FindCluster(index, level);\r\n-                if (cluster != nullptr) PullIn(cluster);\r\n+                auto [cluster, cluster_level] = FindClusterAndLevel(index, level);\r\n+                if (cluster != nullptr) PullIn(cluster, cluster_level);\r\n             }\r\n         }\r\n         // Group the set of to-be-removed entries by Cluster::m_sequence.\r\n@@ -2012,9 +2018,11 @@\r\n     // moves.\r\n     size_t max_size_pos{0};\r\n     DepGraphIndex max_size = to_merge[max_size_pos]->GetTxCount();\r\n+    Assert(GetClusterSet(level).m_cluster_usage >= to_merge[max_size_pos]->TotalMemoryUsage());\r\n     GetClusterSet(level).m_cluster_usage -= to_merge[max_size_pos]->TotalMemoryUsage();\r\n     DepGraphIndex total_size = max_size;\r\n     for (size_t i = 1; i < to_merge.size(); ++i) {\r\n+        Assert(GetClusterSet(level).m_cluster_usage >= to_merge[i]->TotalMemoryUsage());\r\n         GetClusterSet(level).m_cluster_usage -= to_merge[i]->TotalMemoryUsage();\r\n         DepGraphIndex size = to_merge[i]->GetTxCount();\r\n         total_size += size;\r\n@@ -2067,7 +2075,7 @@\r\n         // Pull in all the Clusters that contain dependencies.\r\n         if (level == 1) {\r\n             for (Cluster*& cluster : cluster_span) {\r\n-                cluster = PullIn(cluster);\r\n+                cluster = PullIn(cluster, cluster->GetLevel(*this));\r\n             }\r\n         }\r\n         // Invoke Merge() to merge them into a single Cluster.\r\n@@ -2925,7 +2933,7 @@\r\n \r\n                 // Check the sequence number.\r\n                 assert(cluster.m_sequence < m_next_sequence_counter);\r\n-                assert(sequences.count(cluster.m_sequence) == 0);\r\n+                assert(!sequences.contains(cluster.m_sequence));\r\n                 sequences.insert(cluster.m_sequence);\r\n                 // Remember we saw this Cluster (only if it is non-empty; empty Clusters aren't\r\n                 // expected to be referenced by the Entry vector).\r\ndiff --git a/src/test/fuzz/txgraph.cpp b/src/test/fuzz/txgraph.cpp\r\n--- a/src/test/fuzz/txgraph.cpp\t(revision 262762bbb6f7157ba8c54972909c9214448c304b)\r\n+++ b/src/test/fuzz/txgraph.cpp\t(date 1760204180327)\r\n@@ -462,6 +462,7 @@\r\n                 auto ref_loc = top_sim.AddTransaction(feerate);\r\n                 // Move it in place.\r\n                 *ref_loc = std::move(ref);\r\n+                real->SanityCheck();\r\n                 break;\r\n             } else if ((block_builders.empty() || sims.size() > 1) && top_sim.GetTransactionCount() + top_sim.removed.size() > 1 && command-- == 0) {\r\n                 // AddDependency.\r\n@@ -477,6 +478,7 @@\r\n                 top_sim.AddDependency(par, chl);\r\n                 top_sim.real_is_optimal = false;\r\n                 real->AddDependency(*par, *chl);\r\n+                real->SanityCheck();\r\n                 break;\r\n             } else if ((block_builders.empty() || sims.size() > 1) && top_sim.removed.size() < 100 && command-- == 0) {\r\n                 // RemoveTransaction. Either all its ancestors or all its descendants are also\r\n@@ -492,6 +494,7 @@\r\n                     real->RemoveTransaction(*ptr);\r\n                     top_sim.RemoveTransaction(ptr);\r\n                 }\r\n+                real->SanityCheck();\r\n                 break;\r\n             } else if (sel_sim.removed.size() > 0 && command-- == 0) {\r\n                 // ~Ref (of an already-removed transaction). Destroying a TxGraph::Ref has an\r\n@@ -507,6 +510,7 @@\r\n                     std::swap(sel_sim.removed[removed_pos], sel_sim.removed.back());\r\n                 }\r\n                 sel_sim.removed.pop_back();\r\n+                real->SanityCheck();\r\n                 break;\r\n             } else if (block_builders.empty() && command-- == 0) {\r\n                 // ~Ref (of any transaction).\r\n@@ -529,6 +533,7 @@\r\n                         sims[level].DestroyTransaction(ptr, level == sims.size() - 1);\r\n                     }\r\n                 }\r\n+                real->SanityCheck();\r\n                 break;\r\n             } else if (block_builders.empty() && command-- == 0) {\r\n                 // SetTransactionFee.\r\n@@ -543,10 +548,12 @@\r\n                 for (auto& sim : sims) {\r\n                     sim.SetTransactionFee(ref, fee);\r\n                 }\r\n+                real->SanityCheck();\r\n                 break;\r\n             } else if (command-- == 0) {\r\n                 // GetTransactionCount.\r\n                 assert(real->GetTransactionCount(level_select) == sel_sim.GetTransactionCount());\r\n+                real->SanityCheck();\r\n                 break;\r\n             } else if (command-- == 0) {\r\n                 // Exists.\r\n@@ -554,10 +561,12 @@\r\n                 bool exists = real->Exists(*ref, level_select);\r\n                 bool should_exist = sel_sim.Find(ref) != SimTxGraph::MISSING;\r\n                 assert(exists == should_exist);\r\n+                real->SanityCheck();\r\n                 break;\r\n             } else if (command-- == 0) {\r\n                 // IsOversized.\r\n                 assert(sel_sim.IsOversized() == real->IsOversized(level_select));\r\n+                real->SanityCheck();\r\n                 break;\r\n             } else if (command-- == 0) {\r\n                 // GetIndividualFeerate.\r\n@@ -572,6 +581,7 @@\r\n                     }\r\n                 }\r\n                 if (!found) assert(feerate.IsEmpty());\r\n+                real->SanityCheck();\r\n                 break;\r\n             } else if (!main_sim.IsOversized() && command-- == 0) {\r\n                 // GetMainChunkFeerate.\r\n@@ -586,6 +596,7 @@\r\n                     assert(feerate.size >= main_sim.graph.FeeRate(simpos).size);\r\n                     assert(feerate.size <= main_sim.SumAll().size);\r\n                 }\r\n+                real->SanityCheck();\r\n                 break;\r\n             } else if (!sel_sim.IsOversized() && command-- == 0) {\r\n                 // GetAncestors/GetDescendants.\r\n@@ -597,6 +608,7 @@\r\n                 assert(result.size() == result_set.Count());\r\n                 auto expect_set = sel_sim.GetAncDesc(ref, alt);\r\n                 assert(result_set == expect_set);\r\n+                real->SanityCheck();\r\n                 break;\r\n             } else if (!sel_sim.IsOversized() && command-- == 0) {\r\n                 // GetAncestorsUnion/GetDescendantsUnion.\r\n@@ -619,6 +631,7 @@\r\n                 for (TxGraph::Ref* ref : refs) expect_set |= sel_sim.GetAncDesc(ref, alt);\r\n                 // Compare.\r\n                 assert(result_set == expect_set);\r\n+                real->SanityCheck();\r\n                 break;\r\n             } else if (!sel_sim.IsOversized() && command-- == 0) {\r\n                 // GetCluster.\r\n@@ -654,16 +667,19 @@\r\n                     assert(sel_sim.graph.Ancestors(i).IsSubsetOf(result_set));\r\n                     assert(sel_sim.graph.Descendants(i).IsSubsetOf(result_set));\r\n                 }\r\n+                real->SanityCheck();\r\n                 break;\r\n             } else if (command-- == 0) {\r\n                 // HaveStaging.\r\n                 assert((sims.size() == 2) == real->HaveStaging());\r\n+                real->SanityCheck();\r\n                 break;\r\n             } else if (sims.size() < 2 && command-- == 0) {\r\n                 // StartStaging.\r\n                 sims.emplace_back(sims.back());\r\n                 sims.back().modified = SimTxGraph::SetType{};\r\n                 real->StartStaging();\r\n+                real->SanityCheck();\r\n                 break;\r\n             } else if (block_builders.empty() && sims.size() > 1 && command-- == 0) {\r\n                 // CommitStaging.\r\n@@ -672,6 +688,7 @@\r\n                 const bool main_optimal = std::all_of(sims.cbegin(), sims.cend(), [](const auto &sim) { return sim.real_is_optimal; });\r\n                 sims.erase(sims.begin());\r\n                 sims.front().real_is_optimal = main_optimal;\r\n+                real->SanityCheck();\r\n                 break;\r\n             } else if (sims.size() > 1 && command-- == 0) {\r\n                 // AbortStaging.\r\n@@ -681,6 +698,7 @@\r\n                 // removals of main transactions while staging was active, then aborting will\r\n                 // cause it to be re-evaluated in TxGraph).\r\n                 sims.back().oversized = std::nullopt;\r\n+                real->SanityCheck();\r\n                 break;\r\n             } else if (!main_sim.IsOversized() && command-- == 0) {\r\n                 // CompareMainOrder.\r\n@@ -699,6 +717,7 @@\r\n                 // Do not verify consistency with chunk feerates, as we cannot easily determine\r\n                 // these here without making more calls to real, which could affect its internal\r\n                 // state. A full comparison is done at the end.\r\n+                real->SanityCheck();\r\n                 break;\r\n             } else if (!sel_sim.IsOversized() && command-- == 0) {\r\n                 // CountDistinctClusters.\r\n@@ -730,6 +749,7 @@\r\n                 // Compare the number of deduplicated representatives with the value returned by\r\n                 // the real function.\r\n                 assert(result == sim_reps.Count());\r\n+                real->SanityCheck();\r\n                 break;\r\n             } else if (command-- == 0) {\r\n                 // DoWork.\r\n@@ -767,6 +787,7 @@\r\n                     // allowed to touch.\r\n                     assert(iters <= iters_for_optimal);\r\n                 }\r\n+                real->SanityCheck();\r\n                 break;\r\n             } else if (sims.size() == 2 && !sims[0].IsOversized() && !sims[1].IsOversized() && command-- == 0) {\r\n                 // GetMainStagingDiagrams()\r\n@@ -786,14 +807,17 @@\r\n                 for (size_t i = 1; i < real_staged_diagram.size(); ++i) {\r\n                     assert(FeeRateCompare(real_staged_diagram[i], real_staged_diagram[i - 1]) <= 0);\r\n                 }\r\n+                real->SanityCheck();\r\n                 break;\r\n             } else if (block_builders.size() < 4 && !main_sim.IsOversized() && command-- == 0) {\r\n                 // GetBlockBuilder.\r\n                 block_builders.emplace_back(real->GetBlockBuilder());\r\n+                real->SanityCheck();\r\n                 break;\r\n             } else if (!block_builders.empty() && command-- == 0) {\r\n                 // ~BlockBuilder.\r\n                 block_builders.erase(block_builders.begin() + builder_idx);\r\n+                real->SanityCheck();\r\n                 break;\r\n             } else if (!block_builders.empty() && command-- == 0) {\r\n                 // BlockBuilder::GetCurrentChunk, followed by Include/Skip.\r\n@@ -845,6 +869,7 @@\r\n                     builder_data.included = new_included;\r\n                 }\r\n                 builder_data.done = new_done;\r\n+                real->SanityCheck();\r\n                 break;\r\n             } else if (!main_sim.IsOversized() && command-- == 0) {\r\n                 // GetWorstMainChunk.\r\n@@ -871,6 +896,7 @@\r\n                     }\r\n                     assert(sum == worst_chunk_feerate);\r\n                 }\r\n+                real->SanityCheck();\r\n                 break;\r\n             } else if ((block_builders.empty() || sims.size() > 1) && command-- == 0) {\r\n                 // Trim.\r\n@@ -895,6 +921,7 @@\r\n                     top_sim.RemoveTransaction(top_sim.GetRef(simpos));\r\n                 }\r\n                 assert(!top_sim.IsOversized());\r\n+                real->SanityCheck();\r\n                 break;\r\n             } else if ((block_builders.empty() || sims.size() > 1) &&\r\n                        top_sim.GetTransactionCount() > max_cluster_count && !top_sim.IsOversized() && command-- == 0) {\r\n@@ -932,6 +959,7 @@\r\n                         for (auto j : clusters[par_cl]) {\r\n                             if (par_idx == 0) {\r\n                                 par_pos = j;\r\n+                                real->SanityCheck();\r\n                                 break;\r\n                             }\r\n                             --par_idx;\r\n@@ -942,6 +970,7 @@\r\n                         for (auto j : clusters[chl_cl]) {\r\n                             if (chl_idx == 0) {\r\n                                 chl_pos = j;\r\n+                                real->SanityCheck();\r\n                                 break;\r\n                             }\r\n                             --chl_idx;\r\n@@ -1011,6 +1040,7 @@\r\n                     top_sim.RemoveTransaction(top_sim.GetRef(simpos));\r\n                 }\r\n                 assert(!top_sim.IsOversized());\r\n+                real->SanityCheck();\r\n                 break;\r\n             } else if (command-- == 0) {\r\n                 // GetMainMemoryUsage().\r\n@@ -1026,6 +1056,7 @@\r\n                 } else {\r\n                     assert(usage > 0);\r\n                 }\r\n+                real->SanityCheck();\r\n                 break;\r\n             }\r\n         }\r\ndiff --git a/src/test/fuzz/cluster_linearize.cpp b/src/test/fuzz/cluster_linearize.cpp\r\n--- a/src/test/fuzz/cluster_linearize.cpp\t(revision 262762bbb6f7157ba8c54972909c9214448c304b)\r\n+++ b/src/test/fuzz/cluster_linearize.cpp\t(date 1760155666348)\r\n@@ -453,7 +453,6 @@\r\n     };\r\n \r\n     auto last_compaction_pos{real.PositionRange()};\r\n-\r\n     LIMITED_WHILE(provider.remaining_bytes() > 0, 1000) {\r\n         int command = provider.ConsumeIntegral<uint8_t>() % 4;\r\n         while (true) {\r\n@@ -476,6 +475,7 @@\r\n                 // Update sim.\r\n                 sim[idx] = {feerate, TestBitSet::Singleton(idx)};\r\n                 ++num_tx_sim;\r\n+                SanityCheck(real);\r\n                 break;\r\n             } else if (num_tx_sim > 0 && command-- == 0) {\r\n                 // AddDependencies.\r\n@@ -485,6 +485,7 @@\r\n                 real.AddDependencies(parents, child);\r\n                 // Apply to sim.\r\n                 sim[child]->second |= parents;\r\n+                SanityCheck(real);\r\n                 break;\r\n             } else if (num_tx_sim > 0 && command-- == 0) {\r\n                 // Remove transactions.\r\n@@ -507,6 +508,7 @@\r\n                         }\r\n                     }\r\n                 }\r\n+                SanityCheck(real);\r\n                 break;\r\n             } else if (command-- == 0) {\r\n                 // Compact.\r\n@@ -515,6 +517,7 @@\r\n                 const size_t mem_after{real.DynamicMemoryUsage()};\r\n                 assert(real.PositionRange() < last_compaction_pos ? mem_after < mem_before : mem_after <= mem_before);\r\n                 last_compaction_pos = real.PositionRange();\r\n+                SanityCheck(real);\r\n                 break;\r\n             }\r\n         }\r\ndiff --git a/src/cluster_linearize.h b/src/cluster_linearize.h\r\n--- a/src/cluster_linearize.h\t(revision 262762bbb6f7157ba8c54972909c9214448c304b)\r\n+++ b/src/cluster_linearize.h\t(date 1760204167676)\r\n@@ -165,9 +165,10 @@\r\n         // Remove the deleted transactions from ancestors/descendants of other transactions. Note\r\n         // that the deleted positions will retain old feerate and dependency information. This does\r\n         // not matter as they will be overwritten by AddTransaction if they get used again.\r\n-        for (auto& entry : entries) {\r\n-            entry.ancestors &= m_used;\r\n-            entry.descendants &= m_used;\r\n+        assert(entries.size() >= m_used.Count()); // TODO delete\r\n+        for (auto idx : m_used) {\r\n+            entries[idx].ancestors &= m_used;\r\n+            entries[idx].descendants &= m_used;\r\n         }\r\n     }\r\n ```\r\n\r\n</details>\r\n\r\ncode review ACK 7421e58dee402ee8b5b58a18684953a89ad350d7",
          "created_at": "2025-10-11T18:03:06Z"
        },
        {
          "user": "sipa",
          "body": "Not going to address any further nits, unless I need to repush for other reasons.",
          "created_at": "2025-10-11T22:14:34Z"
        },
        {
          "user": "l0rinc",
          "body": "code review reACK 023cd5a5469ad61205bf7bb1135895f2b4a20ea9\r\n\r\nThanks for the quick responses.\r\nBuild failures seem systemic and unrelated.",
          "created_at": "2025-10-12T02:27:53Z"
        },
        {
          "user": "instagibbs",
          "body": "reACK 023cd5a5469ad61205bf7bb1135895f2b4a20ea9\r\n\r\n`git range-diff master 7421e58dee402ee8b5b58a18684953a89ad350d7 023cd5a5469ad61205bf7bb1135895f2b4a20ea9`",
          "created_at": "2025-10-13T12:29:55Z"
        },
        {
          "user": "fanquake",
          "body": "Kicked all the unrelated failures.",
          "created_at": "2025-10-13T12:57:55Z"
        }
      ]
    },
    {
      "number": 33156,
      "title": "cmake: Do not require Python to build GUI",
      "body": "This PR fixes https://github.com/bitcoin/bitcoin/issues/33146, which may be considered a regression introduced in https://github.com/bitcoin/bitcoin/pull/31233.\r\n\r\nThis approach was chosen for its minimal diff.\r\n\r\nAn alternative approach would be to convert the `translate` build target into a CMake script. This could be justified, as the goal is to update files in the source tree and then commit them to the repository, which is something regular build targets are not intended to do.\r\n\r\nOn a related note, the [`share/qt/extract_strings_qt.py`](https://github.com/bitcoin/bitcoin/blob/master/share/qt/extract_strings_qt.py) looks simple enough to be rewritten in pure CMake code.",
      "state": "closed",
      "user": "hebasto",
      "created_at": "2025-08-08T12:51:04Z",
      "updated_at": "2025-08-18T12:15:21Z",
      "comments": 9,
      "url": "https://github.com/bitcoin/bitcoin/pull/33156",
      "labels": [
        "Docs",
        "Build system",
        "Needs rebase"
      ],
      "comment_list": [
        {
          "user": "DrahtBot",
          "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/33156.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| ACK | [pablomartin4btc](https://github.com/bitcoin/bitcoin/pull/33156#pullrequestreview-3106898898) |\n| Concept ACK | [Sammie05](https://github.com/bitcoin/bitcoin/pull/33156#issuecomment-3172277096) |\n\nIf your review is incorrectly listed, please react with üëé to this comment and the bot will ignore it on the next update.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#33200](https://github.com/bitcoin/bitcoin/pull/33200) (cmake: Introduce translate.cmake script for translate target by purpleKarrot)\n* [#31802](https://github.com/bitcoin/bitcoin/pull/31802) (Add bitcoin-{node,gui} to release binaries for IPC by Sjors)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n<!--5faf32d7da4f0f540f40219e4f7537a3-->",
          "created_at": "2025-08-08T12:51:08Z"
        },
        {
          "user": "Sammie05",
          "body": "This is a solid improvement and should be especially beneficial for developers without Python environments and enhances our build system‚Äôs efficiency by reducing  dependencies. Great work!\r\n\r\nACK \r\n",
          "created_at": "2025-08-10T01:05:34Z"
        },
        {
          "user": "hebasto",
          "body": "Add to the 30.0 milestone?",
          "created_at": "2025-08-15T14:46:06Z"
        },
        {
          "user": "maflcko",
          "body": "> Add to the 30.0 milestone?\r\n\r\nThis one or https://github.com/bitcoin/bitcoin/pull/33200?",
          "created_at": "2025-08-18T10:48:14Z"
        },
        {
          "user": "hebasto",
          "body": "> > Add to the 30.0 milestone?\r\n> \r\n> This one or #33200?\r\n\r\n#33200 doesn't solve the issue. But @purpleKarrot has a working branch on top of it that replaces Python code with pure CMake code.",
          "created_at": "2025-08-18T11:07:44Z"
        },
        {
          "user": "purpleKarrot",
          "body": "This removes the Python dependency: https://github.com/bitcoin/bitcoin/pull/33209",
          "created_at": "2025-08-18T11:13:26Z"
        },
        {
          "user": "maflcko",
          "body": "I see. No strong opinion on which direction to take, but this one need rebase, if still relevant.",
          "created_at": "2025-08-18T11:26:02Z"
        },
        {
          "user": "DrahtBot",
          "body": "<!--cf906140f33d8803c4a75a2196329ecb-->\nüêô This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n",
          "created_at": "2025-08-18T11:41:04Z"
        },
        {
          "user": "hebasto",
          "body": "Closing in favour of https://github.com/bitcoin/bitcoin/pull/33209.",
          "created_at": "2025-08-18T12:15:20Z"
        }
      ]
    },
    {
      "number": 33155,
      "title": "contrib: drop `bitcoin-util` exception from FORTIFY check",
      "body": "It's got `memcpy_chk`.\r\n\r\nGuix Build (aarch64):\r\n```bash\r\n955c15e4b40dae5f0a80185a5a759764eb650003b56a997f2f18b058f979e212  guix-build-4bff4ce561b0/output/aarch64-linux-gnu/SHA256SUMS.part\r\n4e57193921b5a96b1da82e964577e20fdc8f287de9f28dc15b818f94bdc12fd2  guix-build-4bff4ce561b0/output/aarch64-linux-gnu/bitcoin-4bff4ce561b0-aarch64-linux-gnu-debug.tar.gz\r\nfb9779bfe3412f80393b85c7c12763fe34909879a34edbfe08d00bbea222d357  guix-build-4bff4ce561b0/output/aarch64-linux-gnu/bitcoin-4bff4ce561b0-aarch64-linux-gnu.tar.gz\r\n42068fd17c33c7de75556b257de7e9ec7f94f9a0610c2a2be75050053cf18aff  guix-build-4bff4ce561b0/output/arm-linux-gnueabihf/SHA256SUMS.part\r\na0297f846e03f79f99d812f879eb09587c90bd03b8573aeb98bf8e56ef81544c  guix-build-4bff4ce561b0/output/arm-linux-gnueabihf/bitcoin-4bff4ce561b0-arm-linux-gnueabihf-debug.tar.gz\r\nfb20033e5a9f61a2d5f932ddfb1f402226d33b776f3c6fb5df1de8cecde36eeb  guix-build-4bff4ce561b0/output/arm-linux-gnueabihf/bitcoin-4bff4ce561b0-arm-linux-gnueabihf.tar.gz\r\nb0298c7c5176f67039e32d7691f99e0e9cd53d50af1c4a3a745ff02810867aac  guix-build-4bff4ce561b0/output/arm64-apple-darwin/SHA256SUMS.part\r\n0c498c6721dfae596a15bd3b083a635951ff4441cf5545d63f00fd743c481527  guix-build-4bff4ce561b0/output/arm64-apple-darwin/bitcoin-4bff4ce561b0-arm64-apple-darwin-codesigning.tar.gz\r\n04f7ac0d9c6103c302c165db21428f39afbd2bb506def903d259feae740f758d  guix-build-4bff4ce561b0/output/arm64-apple-darwin/bitcoin-4bff4ce561b0-arm64-apple-darwin-unsigned.tar.gz\r\n899b2efa608200508153bbb4d745099d525c2196b0f00a8bb0e960070c3cd3c6  guix-build-4bff4ce561b0/output/arm64-apple-darwin/bitcoin-4bff4ce561b0-arm64-apple-darwin-unsigned.zip\r\n51aeb7a040a0910e7466c14ce554362b4924b821be093ba73dffdda07c73618b  guix-build-4bff4ce561b0/output/dist-archive/bitcoin-4bff4ce561b0.tar.gz\r\n3119f9da15028a5d84645360dad9eab2e85b8ef363af919ea3e60104211b7d62  guix-build-4bff4ce561b0/output/powerpc64-linux-gnu/SHA256SUMS.part\r\n6d4d7cd1d8e294b65340669c2979079ff5c73e09df1e9629b182af8414a45b66  guix-build-4bff4ce561b0/output/powerpc64-linux-gnu/bitcoin-4bff4ce561b0-powerpc64-linux-gnu-debug.tar.gz\r\n9c36b47c37b0f77c23ab9a5a0b080e6e82b17e8d1de352b3096f2b96994e1d49  guix-build-4bff4ce561b0/output/powerpc64-linux-gnu/bitcoin-4bff4ce561b0-powerpc64-linux-gnu.tar.gz\r\nef8ebcb015e282a969f36564b4c430dd1e74237b2362256f0485a3fc20d86bcf  guix-build-4bff4ce561b0/output/riscv64-linux-gnu/SHA256SUMS.part\r\nff6313218a98a73603f2efa9f66f14289eb84f2561715ff99833b55aabc694d5  guix-build-4bff4ce561b0/output/riscv64-linux-gnu/bitcoin-4bff4ce561b0-riscv64-linux-gnu-debug.tar.gz\r\n75047bd03387b45995186ba4fad0d403f15b0590f064ed9a7bac7a38b07ef227  guix-build-4bff4ce561b0/output/riscv64-linux-gnu/bitcoin-4bff4ce561b0-riscv64-linux-gnu.tar.gz\r\nf714833a5fa772f4617e268ba75aa83435e755c97e378903b80dbf0808a5d4f5  guix-build-4bff4ce561b0/output/x86_64-apple-darwin/SHA256SUMS.part\r\n567925e2e2438fac7e5928f63088ae32ff8b4a6feaceb94b404e087377bacf8b  guix-build-4bff4ce561b0/output/x86_64-apple-darwin/bitcoin-4bff4ce561b0-x86_64-apple-darwin-codesigning.tar.gz\r\n1b018bc5e57512de19ff671ec03bb0fc5ff4be2e03a49263b7baa9b3c9cccf23  guix-build-4bff4ce561b0/output/x86_64-apple-darwin/bitcoin-4bff4ce561b0-x86_64-apple-darwin-unsigned.tar.gz\r\n06f41fad17071ca96013cd645bdbef4b81d1ead2dd83e3b484241fb9c092c5ae  guix-build-4bff4ce561b0/output/x86_64-apple-darwin/bitcoin-4bff4ce561b0-x86_64-apple-darwin-unsigned.zip\r\n77003ff6a044d55d72a8e8bf7d66d65da07a7ce22c2d6bb6ff41d3cd2540c826  guix-build-4bff4ce561b0/output/x86_64-linux-gnu/SHA256SUMS.part\r\n3160e76ddc373c5c9b3f230a8d21ee0d9f46f19cf547f4799d6bd6f692369400  guix-build-4bff4ce561b0/output/x86_64-linux-gnu/bitcoin-4bff4ce561b0-x86_64-linux-gnu-debug.tar.gz\r\nff4a05d53920efd903f7f3ea13a0a7738548f1eb92165d32bd707e09a687262a  guix-build-4bff4ce561b0/output/x86_64-linux-gnu/bitcoin-4bff4ce561b0-x86_64-linux-gnu.tar.gz\r\n150b79a688eb5b2718b6a12a32eaeaf296fe5b7e0c5090dfc30f3f749c88fc44  guix-build-4bff4ce561b0/output/x86_64-w64-mingw32/SHA256SUMS.part\r\n692612b7989c4a90cff9cd30821d8210e4a556003d77c48560c0038e7cd7bc89  guix-build-4bff4ce561b0/output/x86_64-w64-mingw32/bitcoin-4bff4ce561b0-win64-codesigning.tar.gz\r\nb480ec868f6d4e070707a8ff98ae53416de88c7cb1125e475de823e6046c2a52  guix-build-4bff4ce561b0/output/x86_64-w64-mingw32/bitcoin-4bff4ce561b0-win64-debug.zip\r\nac2108d4c80a85aa9d72258e5d69f90b8fa8475ab91a0305717d5ce478f4951c  guix-build-4bff4ce561b0/output/x86_64-w64-mingw32/bitcoin-4bff4ce561b0-win64-setup-unsigned.exe\r\ndaef011a4775354b715591ca3e629bcfd9a7b582875c16dae26dc1cb91bde829  guix-build-4bff4ce561b0/output/x86_64-w64-mingw32/bitcoin-4bff4ce561b0-win64-unsigned.zip\r\n```",
      "state": "closed",
      "user": "fanquake",
      "created_at": "2025-08-08T09:29:19Z",
      "updated_at": "2025-08-11T09:13:01Z",
      "comments": 3,
      "url": "https://github.com/bitcoin/bitcoin/pull/33155",
      "labels": [
        "Scripts and tools"
      ],
      "comment_list": [
        {
          "user": "DrahtBot",
          "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/33155.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| ACK | [hebasto](https://github.com/bitcoin/bitcoin/pull/33155#pullrequestreview-3102895240) |\n\nIf your review is incorrectly listed, please react with üëé to this comment and the bot will ignore it on the next update.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#33126](https://github.com/bitcoin/bitcoin/pull/33126) (Removing Bitcoin core text where unnecessary by Ataraxia009)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n<!--5faf32d7da4f0f540f40219e4f7537a3-->",
          "created_at": "2025-08-08T09:29:25Z"
        },
        {
          "user": "hebasto",
          "body": "Concept ACK.\n\n> It's got `memcpy_chk`.\n\nIt would be good to know when this happened.",
          "created_at": "2025-08-08T09:40:19Z"
        },
        {
          "user": "DrahtBot",
          "body": "<!--9cd9c72976c961c55c7acef8f6ba82cd-->\n### Guix builds (on x86_64) [untrusted test-only build, possibly unsafe, not for production use]\n\n| File | commit 26e9db2df0762e41b1964cdd4c67e5bc2cacf404<br>(master) | commit 3397f26e0ef8bc599ed53b948ccb3340b362e6fe<br>(pull/33155/merge) |\n|--|--|--|\n| *-aarch64-linux-gnu-debug.tar.gz | [`3cba453544462c90...`](https://drahtbot.space/guix/monotree/26e9db2df0762e41b1964cdd4c67e5bc2cacf404/bitcoin-26e9db2df076-aarch64-linux-gnu-debug.tar.gz) | [`d57209a168396649...`](https://drahtbot.space/guix/monotree/3397f26e0ef8bc599ed53b948ccb3340b362e6fe/bitcoin-3397f26e0ef8-aarch64-linux-gnu-debug.tar.gz) |\n| *-aarch64-linux-gnu.tar.gz | [`33b04b28ea3b0c1b...`](https://drahtbot.space/guix/monotree/26e9db2df0762e41b1964cdd4c67e5bc2cacf404/bitcoin-26e9db2df076-aarch64-linux-gnu.tar.gz) | [`91c7e10dc8fcbb00...`](https://drahtbot.space/guix/monotree/3397f26e0ef8bc599ed53b948ccb3340b362e6fe/bitcoin-3397f26e0ef8-aarch64-linux-gnu.tar.gz) |\n| *-arm-linux-gnueabihf-debug.tar.gz | [`ddaba67bf478ff3b...`](https://drahtbot.space/guix/monotree/26e9db2df0762e41b1964cdd4c67e5bc2cacf404/bitcoin-26e9db2df076-arm-linux-gnueabihf-debug.tar.gz) | [`dd4c5b686dae45da...`](https://drahtbot.space/guix/monotree/3397f26e0ef8bc599ed53b948ccb3340b362e6fe/bitcoin-3397f26e0ef8-arm-linux-gnueabihf-debug.tar.gz) |\n| *-arm-linux-gnueabihf.tar.gz | [`94b716848982215e...`](https://drahtbot.space/guix/monotree/26e9db2df0762e41b1964cdd4c67e5bc2cacf404/bitcoin-26e9db2df076-arm-linux-gnueabihf.tar.gz) | [`37a54a347e72b11b...`](https://drahtbot.space/guix/monotree/3397f26e0ef8bc599ed53b948ccb3340b362e6fe/bitcoin-3397f26e0ef8-arm-linux-gnueabihf.tar.gz) |\n| *-arm64-apple-darwin-codesigning.tar.gz | [`36b8ca6be59dc284...`](https://drahtbot.space/guix/monotree/26e9db2df0762e41b1964cdd4c67e5bc2cacf404/bitcoin-26e9db2df076-arm64-apple-darwin-codesigning.tar.gz) | [`25b5b38d0364cc86...`](https://drahtbot.space/guix/monotree/3397f26e0ef8bc599ed53b948ccb3340b362e6fe/bitcoin-3397f26e0ef8-arm64-apple-darwin-codesigning.tar.gz) |\n| *-arm64-apple-darwin-unsigned.tar.gz | [`66aa64f0e1a4a750...`](https://drahtbot.space/guix/monotree/26e9db2df0762e41b1964cdd4c67e5bc2cacf404/bitcoin-26e9db2df076-arm64-apple-darwin-unsigned.tar.gz) | [`85638ab53e85fb49...`](https://drahtbot.space/guix/monotree/3397f26e0ef8bc599ed53b948ccb3340b362e6fe/bitcoin-3397f26e0ef8-arm64-apple-darwin-unsigned.tar.gz) |\n| *-arm64-apple-darwin-unsigned.zip | [`c80c6fb952bd7a5d...`](https://drahtbot.space/guix/monotree/26e9db2df0762e41b1964cdd4c67e5bc2cacf404/bitcoin-26e9db2df076-arm64-apple-darwin-unsigned.zip) | [`67fb13f47e6eab5f...`](https://drahtbot.space/guix/monotree/3397f26e0ef8bc599ed53b948ccb3340b362e6fe/bitcoin-3397f26e0ef8-arm64-apple-darwin-unsigned.zip) |\n| *-powerpc64-linux-gnu-debug.tar.gz | [`117d7f061cfc0645...`](https://drahtbot.space/guix/monotree/26e9db2df0762e41b1964cdd4c67e5bc2cacf404/bitcoin-26e9db2df076-powerpc64-linux-gnu-debug.tar.gz) | [`cf7b7fbce537c51b...`](https://drahtbot.space/guix/monotree/3397f26e0ef8bc599ed53b948ccb3340b362e6fe/bitcoin-3397f26e0ef8-powerpc64-linux-gnu-debug.tar.gz) |\n| *-powerpc64-linux-gnu.tar.gz | [`1557e7e7a2565440...`](https://drahtbot.space/guix/monotree/26e9db2df0762e41b1964cdd4c67e5bc2cacf404/bitcoin-26e9db2df076-powerpc64-linux-gnu.tar.gz) | [`1ee62cce0767b1c9...`](https://drahtbot.space/guix/monotree/3397f26e0ef8bc599ed53b948ccb3340b362e6fe/bitcoin-3397f26e0ef8-powerpc64-linux-gnu.tar.gz) |\n| *-riscv64-linux-gnu-debug.tar.gz | [`b22be26e5047e57b...`](https://drahtbot.space/guix/monotree/26e9db2df0762e41b1964cdd4c67e5bc2cacf404/bitcoin-26e9db2df076-riscv64-linux-gnu-debug.tar.gz) | [`56cc2ed6868d52c8...`](https://drahtbot.space/guix/monotree/3397f26e0ef8bc599ed53b948ccb3340b362e6fe/bitcoin-3397f26e0ef8-riscv64-linux-gnu-debug.tar.gz) |\n| *-riscv64-linux-gnu.tar.gz | [`dcec64fabe9347bc...`](https://drahtbot.space/guix/monotree/26e9db2df0762e41b1964cdd4c67e5bc2cacf404/bitcoin-26e9db2df076-riscv64-linux-gnu.tar.gz) | [`3ce0b7f3b9b4c18f...`](https://drahtbot.space/guix/monotree/3397f26e0ef8bc599ed53b948ccb3340b362e6fe/bitcoin-3397f26e0ef8-riscv64-linux-gnu.tar.gz) |\n| *-x86_64-apple-darwin-codesigning.tar.gz | [`55a60fc72c2adc71...`](https://drahtbot.space/guix/monotree/26e9db2df0762e41b1964cdd4c67e5bc2cacf404/bitcoin-26e9db2df076-x86_64-apple-darwin-codesigning.tar.gz) | [`7d67998258c15c31...`](https://drahtbot.space/guix/monotree/3397f26e0ef8bc599ed53b948ccb3340b362e6fe/bitcoin-3397f26e0ef8-x86_64-apple-darwin-codesigning.tar.gz) |\n| *-x86_64-apple-darwin-unsigned.tar.gz | [`c61aaa637aa27399...`](https://drahtbot.space/guix/monotree/26e9db2df0762e41b1964cdd4c67e5bc2cacf404/bitcoin-26e9db2df076-x86_64-apple-darwin-unsigned.tar.gz) | [`d990000ea1d007f6...`](https://drahtbot.space/guix/monotree/3397f26e0ef8bc599ed53b948ccb3340b362e6fe/bitcoin-3397f26e0ef8-x86_64-apple-darwin-unsigned.tar.gz) |\n| *-x86_64-apple-darwin-unsigned.zip | [`d0e757b31529d94d...`](https://drahtbot.space/guix/monotree/26e9db2df0762e41b1964cdd4c67e5bc2cacf404/bitcoin-26e9db2df076-x86_64-apple-darwin-unsigned.zip) | [`44dbc90e2de183a7...`](https://drahtbot.space/guix/monotree/3397f26e0ef8bc599ed53b948ccb3340b362e6fe/bitcoin-3397f26e0ef8-x86_64-apple-darwin-unsigned.zip) |\n| *-x86_64-linux-gnu-debug.tar.gz | [`1f90ff006dccd9f5...`](https://drahtbot.space/guix/monotree/26e9db2df0762e41b1964cdd4c67e5bc2cacf404/bitcoin-26e9db2df076-x86_64-linux-gnu-debug.tar.gz) | [`64223819f5572d86...`](https://drahtbot.space/guix/monotree/3397f26e0ef8bc599ed53b948ccb3340b362e6fe/bitcoin-3397f26e0ef8-x86_64-linux-gnu-debug.tar.gz) |\n| *-x86_64-linux-gnu.tar.gz | [`d2ddd203626b6311...`](https://drahtbot.space/guix/monotree/26e9db2df0762e41b1964cdd4c67e5bc2cacf404/bitcoin-26e9db2df076-x86_64-linux-gnu.tar.gz) | [`09a037394b5600b6...`](https://drahtbot.space/guix/monotree/3397f26e0ef8bc599ed53b948ccb3340b362e6fe/bitcoin-3397f26e0ef8-x86_64-linux-gnu.tar.gz) |\n| *.tar.gz | [`d6a60b3d4f413ad7...`](https://drahtbot.space/guix/monotree/26e9db2df0762e41b1964cdd4c67e5bc2cacf404/bitcoin-26e9db2df076.tar.gz) | [`521a51e153d6b332...`](https://drahtbot.space/guix/monotree/3397f26e0ef8bc599ed53b948ccb3340b362e6fe/bitcoin-3397f26e0ef8.tar.gz) |\n| SHA256SUMS.part | [`ad7c9d0bdea3e511...`](https://drahtbot.space/guix/monotree/26e9db2df0762e41b1964cdd4c67e5bc2cacf404/SHA256SUMS.part) | [`44d9649053e8d5c2...`](https://drahtbot.space/guix/monotree/3397f26e0ef8bc599ed53b948ccb3340b362e6fe/SHA256SUMS.part) |\n| guix_build.log | [`ef11c399a8aaf643...`](https://drahtbot.space/guix/monotree/26e9db2df0762e41b1964cdd4c67e5bc2cacf404/guix_build.log) | [`219b0fa29f58ebf6...`](https://drahtbot.space/guix/monotree/3397f26e0ef8bc599ed53b948ccb3340b362e6fe/guix_build.log) |\n| guix_build.log.diff |  | [`8b5e0ddcf11e9a3f...`](https://drahtbot.space/guix/monotree/3397f26e0ef8bc599ed53b948ccb3340b362e6fe/guix_build.log.diff) |\n\n",
          "created_at": "2025-08-09T09:24:11Z"
        }
      ]
    }
  ],
  "issues": [],
  "summary": {
    "pull_requests": 4,
    "issues": 0
  }
}